<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.2.313">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Pandas II</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="pandas_2_files/libs/clipboard/clipboard.min.js"></script>
<script src="pandas_2_files/libs/quarto-html/quarto.js"></script>
<script src="pandas_2_files/libs/quarto-html/popper.min.js"></script>
<script src="pandas_2_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="pandas_2_files/libs/quarto-html/anchor.min.js"></script>
<link href="pandas_2_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="pandas_2_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="pandas_2_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="pandas_2_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="pandas_2_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script>
<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>


</head>

<body>

<div id="quarto-content" class="page-columns page-rows-contents page-layout-full">
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
  <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Pandas II</h2>
   
  <ul>
  <li><a href="#conditional-selection" id="toc-conditional-selection" class="nav-link active" data-scroll-target="#conditional-selection">Conditional Selection</a></li>
  <li><a href="#sorting-with-a-custom-key" id="toc-sorting-with-a-custom-key" class="nav-link" data-scroll-target="#sorting-with-a-custom-key">Sorting With a Custom Key</a></li>
  <li><a href="#adding-and-removing-columns" id="toc-adding-and-removing-columns" class="nav-link" data-scroll-target="#adding-and-removing-columns">Adding and Removing Columns</a></li>
  <li><a href="#aggregating-data-with-groupby" id="toc-aggregating-data-with-groupby" class="nav-link" data-scroll-target="#aggregating-data-with-groupby">Aggregating Data with GroupBy</a>
  <ul class="collapse">
  <li><a href="#parting-note" id="toc-parting-note" class="nav-link" data-scroll-target="#parting-note">Parting note</a></li>
  </ul></li>
  </ul>
</nav>
</div>
<main class="content column-page-left" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title">Pandas II</h1><button type="button" class="btn code-tools-button dropdown-toggle" id="quarto-code-tools-menu" data-bs-toggle="dropdown" aria-expanded="false"><i class="bi"></i> Code</button><ul class="dropdown-menu dropdown-menu-end" aria-labelelledby="quarto-code-tools-menu"><li><a id="quarto-show-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Show All Code</a></li><li><a id="quarto-hide-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Hide All Code</a></li></ul></div></div>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<div class="callout-note callout callout-style-default no-icon callout-captioned">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-1-contents" aria-controls="callout-1" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Learning Outcomes
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-1" class="callout-1-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<ul>
<li>Build familiarity with advanced <code>pandas</code> syntax</li>
<li>Recognize situations where aggregation is useful and identify the correct technique for performing an aggregation</li>
<li>Understand the real-world need for joining and perform a simple merge</li>
</ul>
</div>
</div>
</div>
<p>Last time, we introduced the <code>pandas</code> library as a toolkit for processing data. We learned the DataFrame and Series data structures, familiarized ourselves with the basic syntax for manipulating tabular data, and began writing our first lines of <code>pandas</code> code.</p>
<p>In this lecture, we’ll start to dive into some advanced <code>pandas</code> syntax. You may find it helpful to follow along with a notebook of your own as we walk through these new pieces of code.</p>
<p>We’ll start by loading the <code>babynames</code> dataset.</p>
<div class="cell" data-execution_count="2">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> urllib.request</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> os.path</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> zipfile</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>data_url <span class="op">=</span> <span class="st">"https://www.ssa.gov/oact/babynames/state/namesbystate.zip"</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>local_filename <span class="op">=</span> <span class="st">"babynamesbystate.zip"</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="kw">not</span> os.path.exists(local_filename): <span class="co"># if the data exists don't download again</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>    <span class="cf">with</span> urllib.request.urlopen(data_url) <span class="im">as</span> resp, <span class="bu">open</span>(local_filename, <span class="st">'wb'</span>) <span class="im">as</span> f:</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>        f.write(resp.read())</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>zf <span class="op">=</span> zipfile.ZipFile(local_filename, <span class="st">'r'</span>)</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>ca_name <span class="op">=</span> <span class="st">'CA.TXT'</span></span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a>field_names <span class="op">=</span> [<span class="st">'State'</span>, <span class="st">'Sex'</span>, <span class="st">'Year'</span>, <span class="st">'Name'</span>, <span class="st">'Count'</span>]</span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> zf.<span class="bu">open</span>(ca_name) <span class="im">as</span> fh:</span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a>    babynames <span class="op">=</span> pd.read_csv(fh, header<span class="op">=</span><span class="va">None</span>, names<span class="op">=</span>field_names)</span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a>babynames.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="2">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>State</th>
      <th>Sex</th>
      <th>Year</th>
      <th>Name</th>
      <th>Count</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>CA</td>
      <td>F</td>
      <td>1910</td>
      <td>Mary</td>
      <td>295</td>
    </tr>
    <tr>
      <th>1</th>
      <td>CA</td>
      <td>F</td>
      <td>1910</td>
      <td>Helen</td>
      <td>239</td>
    </tr>
    <tr>
      <th>2</th>
      <td>CA</td>
      <td>F</td>
      <td>1910</td>
      <td>Dorothy</td>
      <td>220</td>
    </tr>
    <tr>
      <th>3</th>
      <td>CA</td>
      <td>F</td>
      <td>1910</td>
      <td>Margaret</td>
      <td>163</td>
    </tr>
    <tr>
      <th>4</th>
      <td>CA</td>
      <td>F</td>
      <td>1910</td>
      <td>Frances</td>
      <td>134</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<section id="conditional-selection" class="level2">
<h2 class="anchored" data-anchor-id="conditional-selection">Conditional Selection</h2>
<p>Conditional selection allows us to select a subset of rows in a DataFrame if they follow some specified condition.</p>
<p>To understand how to use conditional selection, we must look at another input of the <code>.loc</code> and <code>[]</code> methods - a boolean array. This boolean array must have a length equal to the number of rows in the DataFrame. It will return all rows in the position of a corresponding True value in the array.</p>
<p>Here, we will select all even-indexed rows in the first 10 rows of our DataFrame.</p>
<div class="cell" data-execution_count="3">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Why is :9 is the correct slice to select the first 10 rows?</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>babynames_first_10_rows <span class="op">=</span> babynames.loc[:<span class="dv">9</span>, :]</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Notice how we have exactly 10 elements in our boolean array argument</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>babynames_first_10_rows[[<span class="va">True</span>, <span class="va">False</span>, <span class="va">True</span>, <span class="va">False</span>, <span class="va">True</span>, <span class="op">\</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>                         <span class="va">False</span>, <span class="va">True</span>, <span class="va">False</span>, <span class="va">True</span>, <span class="va">False</span>]]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="3">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>State</th>
      <th>Sex</th>
      <th>Year</th>
      <th>Name</th>
      <th>Count</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>CA</td>
      <td>F</td>
      <td>1910</td>
      <td>Mary</td>
      <td>295</td>
    </tr>
    <tr>
      <th>2</th>
      <td>CA</td>
      <td>F</td>
      <td>1910</td>
      <td>Dorothy</td>
      <td>220</td>
    </tr>
    <tr>
      <th>4</th>
      <td>CA</td>
      <td>F</td>
      <td>1910</td>
      <td>Frances</td>
      <td>134</td>
    </tr>
    <tr>
      <th>6</th>
      <td>CA</td>
      <td>F</td>
      <td>1910</td>
      <td>Evelyn</td>
      <td>126</td>
    </tr>
    <tr>
      <th>8</th>
      <td>CA</td>
      <td>F</td>
      <td>1910</td>
      <td>Virginia</td>
      <td>101</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<p>Unfortunately, using this method to select multiple rows in a large DataFrame is infeasible. Instead, we can provide a logical condition as an input to <code>.loc</code> or <code>[]</code> that returns a boolean array with said length.</p>
<p>For example, to return all candidates affilliated with the Independent party:</p>
<div class="cell" data-execution_count="4">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>logical_operator <span class="op">=</span> babynames[<span class="st">'Sex'</span>] <span class="op">==</span> <span class="st">"F"</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>babynames[logical_operator]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="4">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>State</th>
      <th>Sex</th>
      <th>Year</th>
      <th>Name</th>
      <th>Count</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>CA</td>
      <td>F</td>
      <td>1910</td>
      <td>Mary</td>
      <td>295</td>
    </tr>
    <tr>
      <th>1</th>
      <td>CA</td>
      <td>F</td>
      <td>1910</td>
      <td>Helen</td>
      <td>239</td>
    </tr>
    <tr>
      <th>2</th>
      <td>CA</td>
      <td>F</td>
      <td>1910</td>
      <td>Dorothy</td>
      <td>220</td>
    </tr>
    <tr>
      <th>3</th>
      <td>CA</td>
      <td>F</td>
      <td>1910</td>
      <td>Margaret</td>
      <td>163</td>
    </tr>
    <tr>
      <th>4</th>
      <td>CA</td>
      <td>F</td>
      <td>1910</td>
      <td>Frances</td>
      <td>134</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>235786</th>
      <td>CA</td>
      <td>F</td>
      <td>2021</td>
      <td>Zarahi</td>
      <td>5</td>
    </tr>
    <tr>
      <th>235787</th>
      <td>CA</td>
      <td>F</td>
      <td>2021</td>
      <td>Zelia</td>
      <td>5</td>
    </tr>
    <tr>
      <th>235788</th>
      <td>CA</td>
      <td>F</td>
      <td>2021</td>
      <td>Zenobia</td>
      <td>5</td>
    </tr>
    <tr>
      <th>235789</th>
      <td>CA</td>
      <td>F</td>
      <td>2021</td>
      <td>Zeppelin</td>
      <td>5</td>
    </tr>
    <tr>
      <th>235790</th>
      <td>CA</td>
      <td>F</td>
      <td>2021</td>
      <td>Zoraya</td>
      <td>5</td>
    </tr>
  </tbody>
</table>
<p>235791 rows × 5 columns</p>
</div>
</div>
</div>
<p>Here, <code>logical_operator</code> evaluates to a <code>Series</code> of boolean values with length 400762.</p>
<div class="cell" data-execution_count="5">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>logical_operator</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="5">
<pre><code>0          True
1          True
2          True
3          True
4          True
          ...  
400757    False
400758    False
400759    False
400760    False
400761    False
Name: Sex, Length: 400762, dtype: bool</code></pre>
</div>
</div>
<p>Rows starting at row 0 and ending at row 235790 evaluate to <code>True</code> and are thus returned in the DataFrame.</p>
<div class="cell" data-execution_count="6">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(logical_operator.loc[logical_operator])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>0         True
1         True
2         True
3         True
4         True
          ... 
235786    True
235787    True
235788    True
235789    True
235790    True
Name: Sex, Length: 235791, dtype: bool</code></pre>
</div>
</div>
<p>Passing a <code>Series</code> as an argument to <code>babynames[]</code> has the same affect as using a boolean array. In fact, the <code>[]</code> selection operator can take a boolean <code>Series</code>, <code>array</code>, and <code>list</code> as arguments. These three are used interchangeably thoughout the course.</p>
<p>Similarly, we can use <code>.loc</code> to achieve similar results.</p>
<div class="cell" data-execution_count="7">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>babynames.loc[babynames[<span class="st">'Sex'</span>] <span class="op">==</span> <span class="st">"F"</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="7">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>State</th>
      <th>Sex</th>
      <th>Year</th>
      <th>Name</th>
      <th>Count</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>CA</td>
      <td>F</td>
      <td>1910</td>
      <td>Mary</td>
      <td>295</td>
    </tr>
    <tr>
      <th>1</th>
      <td>CA</td>
      <td>F</td>
      <td>1910</td>
      <td>Helen</td>
      <td>239</td>
    </tr>
    <tr>
      <th>2</th>
      <td>CA</td>
      <td>F</td>
      <td>1910</td>
      <td>Dorothy</td>
      <td>220</td>
    </tr>
    <tr>
      <th>3</th>
      <td>CA</td>
      <td>F</td>
      <td>1910</td>
      <td>Margaret</td>
      <td>163</td>
    </tr>
    <tr>
      <th>4</th>
      <td>CA</td>
      <td>F</td>
      <td>1910</td>
      <td>Frances</td>
      <td>134</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>235786</th>
      <td>CA</td>
      <td>F</td>
      <td>2021</td>
      <td>Zarahi</td>
      <td>5</td>
    </tr>
    <tr>
      <th>235787</th>
      <td>CA</td>
      <td>F</td>
      <td>2021</td>
      <td>Zelia</td>
      <td>5</td>
    </tr>
    <tr>
      <th>235788</th>
      <td>CA</td>
      <td>F</td>
      <td>2021</td>
      <td>Zenobia</td>
      <td>5</td>
    </tr>
    <tr>
      <th>235789</th>
      <td>CA</td>
      <td>F</td>
      <td>2021</td>
      <td>Zeppelin</td>
      <td>5</td>
    </tr>
    <tr>
      <th>235790</th>
      <td>CA</td>
      <td>F</td>
      <td>2021</td>
      <td>Zoraya</td>
      <td>5</td>
    </tr>
  </tbody>
</table>
<p>235791 rows × 5 columns</p>
</div>
</div>
</div>
<p>Boolean conditions can be combined using various operators that allow us to filter results by multiple conditions. Some examples include the <code>&amp;</code> (and) operator and the <code>|</code> (or) operator.</p>
<p><strong>Note:</strong> When combining multiple conditions with logical operators, be sure to surround each condition with a set of paranthesis <code>()</code>. If you forget, your code will throw an error.</p>
<p>For example, if we want to return data on all females born before the 21st century, we can do so:</p>
<div class="cell" data-execution_count="8">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>babynames[(babynames[<span class="st">'Sex'</span>] <span class="op">==</span> <span class="st">"F"</span>) <span class="op">\</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>          <span class="op">&amp;</span> (babynames[<span class="st">'Year'</span>] <span class="op">&lt;</span> <span class="dv">2000</span>)]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="8">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>State</th>
      <th>Sex</th>
      <th>Year</th>
      <th>Name</th>
      <th>Count</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>CA</td>
      <td>F</td>
      <td>1910</td>
      <td>Mary</td>
      <td>295</td>
    </tr>
    <tr>
      <th>1</th>
      <td>CA</td>
      <td>F</td>
      <td>1910</td>
      <td>Helen</td>
      <td>239</td>
    </tr>
    <tr>
      <th>2</th>
      <td>CA</td>
      <td>F</td>
      <td>1910</td>
      <td>Dorothy</td>
      <td>220</td>
    </tr>
    <tr>
      <th>3</th>
      <td>CA</td>
      <td>F</td>
      <td>1910</td>
      <td>Margaret</td>
      <td>163</td>
    </tr>
    <tr>
      <th>4</th>
      <td>CA</td>
      <td>F</td>
      <td>1910</td>
      <td>Frances</td>
      <td>134</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>149044</th>
      <td>CA</td>
      <td>F</td>
      <td>1999</td>
      <td>Zareen</td>
      <td>5</td>
    </tr>
    <tr>
      <th>149045</th>
      <td>CA</td>
      <td>F</td>
      <td>1999</td>
      <td>Zeinab</td>
      <td>5</td>
    </tr>
    <tr>
      <th>149046</th>
      <td>CA</td>
      <td>F</td>
      <td>1999</td>
      <td>Zhane</td>
      <td>5</td>
    </tr>
    <tr>
      <th>149047</th>
      <td>CA</td>
      <td>F</td>
      <td>1999</td>
      <td>Zoha</td>
      <td>5</td>
    </tr>
    <tr>
      <th>149048</th>
      <td>CA</td>
      <td>F</td>
      <td>1999</td>
      <td>Zoila</td>
      <td>5</td>
    </tr>
  </tbody>
</table>
<p>149049 rows × 5 columns</p>
</div>
</div>
</div>
</section>
<section id="sorting-with-a-custom-key" class="level2">
<h2 class="anchored" data-anchor-id="sorting-with-a-custom-key">Sorting With a Custom Key</h2>
<p>In the last lecture, we learned how to sort a DataFrame by the values in one or more of its columns using <a href="https://pandas.pydata.org/docs/reference/api/pandas.DataFrame.sort_values.html"><code>.sort_values</code></a>. <code>pandas</code> automatically sorted values in order according to numeric value (for number data) or alphabetical order (for string data).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Sort names by reverse-alphabetical order</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Recall that `.head(5)` displays the first five rows in the DataFrame</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>babynames.sort_values(<span class="st">"Name"</span>, ascending<span class="op">=</span><span class="va">False</span>).head(<span class="dv">5</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This offers us a lot of functionality, but what if we need to sort by some other metric? For example, what if we wanted to find the longest names in the DataFrame?</p>
<p>We can do this by specifying the <code>key</code> parameter of <code>.sort_values</code>. The <code>key</code> parameter is assigned to a function of our choice. This function is then applied to each value in the specified column. <code>pandas</code> will, finally, sort the DataFrame by the values outputted by the function.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Here, a lambda function is applied to find the length of each value, `x`, in the "Name" column</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>babynames.sort_values(<span class="st">"Name"</span>, key <span class="op">=</span> <span class="kw">lambda</span> x: x.<span class="bu">str</span>.<span class="bu">len</span>(), ascending<span class="op">=</span><span class="va">False</span>).head(<span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="adding-and-removing-columns" class="level2">
<h2 class="anchored" data-anchor-id="adding-and-removing-columns">Adding and Removing Columns</h2>
<p>To add a new column to a DataFrame, we use a syntax similar to that used when accessing an existing column. Specify the name of the new column by writing <code>dataframe["new_column"]</code>, then assign this to a Series or Array containing the values that will populate this column.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Add a column named "Length" that includes the length of each name</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>babynames[<span class="st">"Length"</span>] <span class="op">=</span> babynames[<span class="st">"Name"</span>].<span class="bu">str</span>.<span class="bu">len</span>()</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>babynames.head(<span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>In the example above, we made use of an in-built function given to us by the <code>str</code> accessor. What if we had wanted to generate the values in our new column using a function of our own making?</p>
<p>We can do this using the Series <a href="https://pandas.pydata.org/docs/reference/api/pandas.Series.map.html"><code>.map</code></a> method. <code>.map</code> takes in a function as input, and will apply this function to each value of a Series.</p>
<p>For example, say we wanted to find the number of occurrences of the sequence “dr” or “ea” in each name.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co"># First, define a function to count the number of times "dr" or "ea" appear in each name</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> dr_ea_count(string):</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> string.count(<span class="st">"dr"</span>) <span class="op">+</span> string.count(<span class="st">"ea"</span>)</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Then, use `map` to apply `dr_ea_count` to each name in the "Name" column</span></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>babynames[<span class="st">"dr_ea_count"</span>] <span class="op">=</span> babynames[<span class="st">"Name"</span>].<span class="bu">map</span>(dr_ea_count)</span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Sort the DataFrame by the new "dr_ea_count" column so we can see our handiwork</span></span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>babynames.sort_values(by <span class="op">=</span> <span class="st">"dr_ea_count"</span>, ascending <span class="op">=</span> <span class="va">False</span>).head(<span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>If we want to remove a column or row of a DataFrame, we can call the <a href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.drop.html"><code>.drop</code></a> method. Use the <code>axis</code> parameter to specify whether a column or row should be dropped. Unless otherwise specified, <code>pandas</code> will assume that we are dropping a row by default.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Drop the row of the DataFrame with label 2</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>babynames <span class="op">=</span> babynames.drop(<span class="dv">2</span>, axis<span class="op">=</span><span class="st">"rows"</span>)</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Drop our "dr_ea_count" and "length" columns from the DataFrame</span></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>babynames <span class="op">=</span> babynames.drop([<span class="st">"dr_ea_count"</span>, <span class="st">"Length"</span>], axis<span class="op">=</span><span class="st">"columns"</span>)</span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>babynames.head(<span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Notice that we reassigned <code>babynames</code> to the result of <code>babynames.drop(...)</code>. This is a subtle, but important point: <code>pandas</code> table operations <strong>do not occur in-place</strong>. Calling <code>dataframe.drop(...)</code> will output a <em>copy</em> of <code>dataframe</code> with the row/column of interest removed, without modifying the original <code>dataframe</code> table.</p>
<p>In other words, if we simply call:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co"># This creates a copy of `babynames` and removes the row with label 3...</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>babynames.drop(<span class="dv">3</span>, axis<span class="op">=</span><span class="st">"rows"</span>)</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a><span class="co"># ...but the original `babynames` is unchanged! </span></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Notice that the row with label 3 is still present</span></span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>babynames.head(<span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Our original <code>babynames</code> DataFrame will remain unmodified.</p>
</section>
<section id="aggregating-data-with-groupby" class="level2">
<h2 class="anchored" data-anchor-id="aggregating-data-with-groupby">Aggregating Data with GroupBy</h2>
<p>Up until this point, we have been working with individual rows of DataFrames. As data scientists, we often wish to investigate trends across a larger <em>subset</em> of our data. For example, we may want to compute some summary statistic (the mean, median, sum, etc.) for a group of rows in our DataFrame. To do this, we’ll use <code>pandas</code> <code>GroupBy</code> objects.</p>
<p>Let’s say we wanted to aggregate all rows in <code>babynames</code> for a given year.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>babynames.groupby(<span class="st">"Year"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>What does this strange output mean? Calling <a href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.groupby.html"><code>.groupby</code></a> has generated a <code>GroupBy</code> object. You can imagine this as a set of “mini” sub-DataFrames, where each subframe contains all of the rows from <code>babynames</code> that correspond to a particular year.</p>
<p>The diagram below shows a simplified view of <code>babynames</code> to help illustrate this idea.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/gb.png" class="img-fluid figure-img"></p>
<p></p><figcaption class="figure-caption">Creating a GroupBy object</figcaption><p></p>
</figure>
</div>
<p>We can’t work with a <code>GroupBy</code> object directly – that is why you saw that strange output earlier, rather than a standard view of a DataFrame. To actually manipulate values within these “mini” DataFrames, we’ll need to call an <em>aggregation method</em>. This is a method that tells <code>pandas</code> how to aggregate the values within the <code>GroupBy</code> object. Once the aggregation is applied, <code>pandas</code> will return a normal (now grouped) DataFrame.</p>
<p>The first aggregation method we’ll consider is <code>.agg</code>. The <code>.agg</code> method takes in a function as its argument; this function is then applied to each column of a “mini” grouped DataFrame. We end up with a new DataFrame with one aggregated row per subframe. Let’s see this in action by finding the <code>sum</code> of all counts for each year in <code>babynames</code> – this is equivalent to finding the number of babies born in each year.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>babynames.groupby(<span class="st">"Year"</span>).agg(<span class="bu">sum</span>).head(<span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We can relate this back to the diagram we used above. Remember that the diagram uses a simplified version of <code>babynames</code>, which is why we see smaller values for the summed counts.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/agg.png" class="img-fluid figure-img"></p>
<p></p><figcaption class="figure-caption">Performing an aggregation</figcaption><p></p>
</figure>
</div>
<p>Calling <code>.agg</code> has condensed each subframe back into a single row. This gives us our final output: a DataFrame that is now indexed by <code>"Year"</code>, with a single row for each unique year in the original <code>babynames</code> DataFrame.</p>
<p>You may be wondering: where did the <code>"State"</code>, <code>"Sex"</code>, and <code>"Name"</code> columns go? Logically, it doesn’t make sense to <code>sum</code> the string data in these columns (how would we add “Mary” + “Ann”?). Because of this, <code>pandas</code> will simply omit these columns when it performs the aggregation on the DataFrame. Since this happens implicitly, without the user specifying that these columns should be ignored, it’s easy to run into troubling situations where columns are removed without the programmer noticing. It is better coding practice to select <em>only</em> the columns we care about before performing the aggregation.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Same result, but now we explicitly tell Pandas to only consider the "Count" column when summing</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>babynames.groupby(<span class="st">"Year"</span>)[[<span class="st">"Count"</span>]].agg(<span class="bu">sum</span>).head(<span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>There is a whole host of aggregation methods we can use other than <code>.agg</code>. Some useful options are:</p>
<ul>
<li><a href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.core.groupby.GroupBy.max.html"><code>.max</code></a>: creates a new DataFrame with the maximum value of each group</li>
<li><a href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.core.groupby.GroupBy.mean.html"><code>.mean</code></a>: creates a new DataFrame with the mean value of each group</li>
<li><a href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.core.groupby.GroupBy.size.html"><code>.size</code></a>: creates a new Series with the number of entries in each group</li>
<li><a href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.core.groupby.DataFrameGroupBy.filter.html"><code>.filter</code></a>: creates a copy of the original DataFrame, keeping only the rows from subframes that obey a provided condition</li>
</ul>
<section id="parting-note" class="level3">
<h3 class="anchored" data-anchor-id="parting-note">Parting note</h3>
<p>With that, we will start digging deeper into the mechanics behind grouping data.</p>
</section>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>
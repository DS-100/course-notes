<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.8.21">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>5&nbsp; Data Cleaning and EDA – Principles and Techniques of Data Science</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.min.js" integrity="sha384-ZvpUoO/+PpLXR1lu4jmpXWu80pZlYUAfxl5NsBMWOEPSjUn/6Z/hRTt8+pR6L4N2" crossorigin="anonymous"></script><script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<link href="../regex/regex.html" rel="next">
<link href="../pandas_3/pandas_3.html" rel="prev">
<link href="../data100_logo.png" rel="icon" type="image/png">
<script src="../site_libs/quarto-html/quarto.js" type="module"></script>
<script src="../site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="../site_libs/quarto-html/axe/axe-check.js" type="module"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-ea1d7ac60288e0f1efdbc993fd8432ae.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap-48faffd076f6e246ab7435acea77d2f2.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script src="https://cdn.jsdelivr.net/npm/requirejs@2.3.6/require.min.js" integrity="sha384-c9c+LnTbwQ3aujuU7ULEPVvgLs+Fn6fJUvIGTsuu1ZcCf11fiEubah0ttpca4ntM sha384-6V1/AdqZRWk1KAlWbKBlGhN7VG4iE/yAZcO6NZPMF8od0vukrvr0tg4qY6NSrItx" crossorigin="anonymous"></script>

<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN" && texText && texText.data) {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

</head>

<body class="nav-sidebar floating quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../eda/eda.html"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Data Cleaning and EDA</span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-full">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header sidebar-header-stacked">
      <a href="../index.html" class="sidebar-logo-link">
      <img src="../data100_logo.png" alt="" class="sidebar-logo light-content py-0 d-lg-inline d-none">
      <img src="../data100_logo.png" alt="" class="sidebar-logo dark-content py-0 d-lg-inline d-none">
      </a>
    <div class="sidebar-title mb-0 py-0">
      <a href="../">Principles and Techniques of Data Science</a> 
        <div class="sidebar-tools-main">
    <a href="https://github.com/DS-100/course-notes" title="Source Code" class="quarto-navigation-tool px-1" aria-label="Source Code"><i class="bi bi-github"></i></a>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Welcome</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../intro_lec/introduction.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Introduction</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../pandas_1/pandas_1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Pandas I</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../pandas_2/pandas_2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Pandas II</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../pandas_3/pandas_3.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Pandas III</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../eda/eda.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Data Cleaning and EDA</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../regex/regex.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Regular Expressions</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../visualization_1/visualization_1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Visualization I</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../visualization_2/visualization_2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Visualization II</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../sampling/sampling.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Sampling</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../modeling_slr/modeling_slr.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Modeling &amp; SLR</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../constant_model_loss_transformations/loss_transformations.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Constant Model, Loss, and Transformations</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../ols/ols.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Ordinary Least Squares</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../case_study_HCE/case_study_HCE.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Case Study in Human Contexts and Ethics</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../gradient_descent/gradient_descent.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">sklearn and Gradient Descent</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../feature_engineering/feature_engineering.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">Gradient Descent Continuation, Feature Engineering</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../cv_regularization/cv_reg.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">16</span>&nbsp; <span class="chapter-title">Cross Validation and Regularization (Summer 2025)</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../probability_1/probability_1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">17</span>&nbsp; <span class="chapter-title">Random Variables (Summer 2025)</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../probability_2/probability_2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">18</span>&nbsp; <span class="chapter-title">Estimators, Bias, and Variance (Summer 2025)</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../inference_causality/inference_causality.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">19</span>&nbsp; <span class="chapter-title">Parameter Inference and Bootstrapping (Summer 2025)</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../sql_I/sql_I.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">20</span>&nbsp; <span class="chapter-title">SQL I (Summer 2025)</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../sql_II/sql_II.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">21</span>&nbsp; <span class="chapter-title">SQL II (Summer 2025)</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../logistic_regression_1/logistic_reg_1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">22</span>&nbsp; <span class="chapter-title">Logistic Regression I (Summer 2025)</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../logistic_regression_2/logistic_reg_2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">23</span>&nbsp; <span class="chapter-title">Logistic Regression II (Summer 2025)</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../pca_1/pca_1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">24</span>&nbsp; <span class="chapter-title">PCA I (Summer 2025)</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../pca_2/pca_2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">25</span>&nbsp; <span class="chapter-title">PCA II (Summer 2025)</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../clustering/clustering.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">26</span>&nbsp; <span class="chapter-title">Clustering (Summer 2025)</span></span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Data Cleaning and EDA</h2>
   
  <ul>
  <li><a href="#structure" id="toc-structure" class="nav-link active" data-scroll-target="#structure"><span class="header-section-number">5.1</span> Structure</a>
  <ul>
  <li><a href="#file-formats" id="toc-file-formats" class="nav-link" data-scroll-target="#file-formats"><span class="header-section-number">5.1.1</span> File Formats</a>
  <ul>
  <li><a href="#csv" id="toc-csv" class="nav-link" data-scroll-target="#csv"><span class="header-section-number">5.1.1.1</span> CSV</a></li>
  <li><a href="#tsv" id="toc-tsv" class="nav-link" data-scroll-target="#tsv"><span class="header-section-number">5.1.1.2</span> TSV</a></li>
  <li><a href="#json" id="toc-json" class="nav-link" data-scroll-target="#json"><span class="header-section-number">5.1.1.3</span> JSON</a>
  <ul class="collapse">
  <li><a href="#eda-with-json-united-states-congress-data" id="toc-eda-with-json-united-states-congress-data" class="nav-link" data-scroll-target="#eda-with-json-united-states-congress-data"><span class="header-section-number">5.1.1.3.1</span> EDA with JSON: United States Congress Data</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#other-data-formats" id="toc-other-data-formats" class="nav-link" data-scroll-target="#other-data-formats"><span class="header-section-number">5.1.2</span> Other Data Formats</a></li>
  <li><a href="#variable-types" id="toc-variable-types" class="nav-link" data-scroll-target="#variable-types"><span class="header-section-number">5.1.3</span> Variable Types</a></li>
  </ul></li>
  <li><a href="#granularity-and-temporality" id="toc-granularity-and-temporality" class="nav-link" data-scroll-target="#granularity-and-temporality"><span class="header-section-number">5.2</span> Granularity and Temporality</a>
  <ul>
  <li><a href="#granularity" id="toc-granularity" class="nav-link" data-scroll-target="#granularity"><span class="header-section-number">5.2.1</span> Granularity</a></li>
  <li><a href="#temporality" id="toc-temporality" class="nav-link" data-scroll-target="#temporality"><span class="header-section-number">5.2.2</span> Temporality</a>
  <ul>
  <li><a href="#temporality-with-pandas-dt-accessors" id="toc-temporality-with-pandas-dt-accessors" class="nav-link" data-scroll-target="#temporality-with-pandas-dt-accessors"><span class="header-section-number">5.2.2.1</span> Temporality with <code>pandas</code>’ <code>dt</code> accessors</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#faithfulness" id="toc-faithfulness" class="nav-link" data-scroll-target="#faithfulness"><span class="header-section-number">5.3</span> Faithfulness</a>
  <ul>
  <li><a href="#missing-values" id="toc-missing-values" class="nav-link" data-scroll-target="#missing-values"><span class="header-section-number">5.3.1</span> Missing Values</a></li>
  </ul></li>
  <li><a href="#eda-demo-1-tuberculosis-in-the-united-states" id="toc-eda-demo-1-tuberculosis-in-the-united-states" class="nav-link" data-scroll-target="#eda-demo-1-tuberculosis-in-the-united-states"><span class="header-section-number">5.4</span> EDA Demo 1: Tuberculosis in the United States</a>
  <ul>
  <li><a href="#csvs-and-field-names" id="toc-csvs-and-field-names" class="nav-link" data-scroll-target="#csvs-and-field-names"><span class="header-section-number">5.4.1</span> CSVs and Field Names</a></li>
  <li><a href="#record-granularity" id="toc-record-granularity" class="nav-link" data-scroll-target="#record-granularity"><span class="header-section-number">5.4.2</span> Record Granularity</a></li>
  <li><a href="#gather-census-data" id="toc-gather-census-data" class="nav-link" data-scroll-target="#gather-census-data"><span class="header-section-number">5.4.3</span> Gather Census Data</a></li>
  <li><a href="#joining-data-merging-dataframes" id="toc-joining-data-merging-dataframes" class="nav-link" data-scroll-target="#joining-data-merging-dataframes"><span class="header-section-number">5.4.4</span> Joining Data (Merging <code>DataFrame</code>s)</a></li>
  <li><a href="#reproducing-data-compute-incidence" id="toc-reproducing-data-compute-incidence" class="nav-link" data-scroll-target="#reproducing-data-compute-incidence"><span class="header-section-number">5.4.5</span> Reproducing Data: Compute Incidence</a></li>
  </ul></li>
  <li><a href="#summary" id="toc-summary" class="nav-link" data-scroll-target="#summary"><span class="header-section-number">5.5</span> Summary</a>
  <ul>
  <li><a href="#dealing-with-missing-values" id="toc-dealing-with-missing-values" class="nav-link" data-scroll-target="#dealing-with-missing-values"><span class="header-section-number">5.5.1</span> Dealing with Missing Values</a></li>
  <li><a href="#eda-and-data-wrangling" id="toc-eda-and-data-wrangling" class="nav-link" data-scroll-target="#eda-and-data-wrangling"><span class="header-section-number">5.5.2</span> EDA and Data Wrangling</a></li>
  </ul></li>
  <li><a href="#bonus-eda-demo-2-mauna-loa-co2-data-a-lesson-in-data-faithfulness" id="toc-bonus-eda-demo-2-mauna-loa-co2-data-a-lesson-in-data-faithfulness" class="nav-link" data-scroll-target="#bonus-eda-demo-2-mauna-loa-co2-data-a-lesson-in-data-faithfulness"><span class="header-section-number">5.6</span> [BONUS] EDA Demo 2: Mauna Loa CO<sub>2</sub> Data – A Lesson in Data Faithfulness</a>
  <ul>
  <li><a href="#reading-this-file-into-pandas" id="toc-reading-this-file-into-pandas" class="nav-link" data-scroll-target="#reading-this-file-into-pandas"><span class="header-section-number">5.6.1</span> Reading this file into <code>Pandas</code>?</a></li>
  <li><a href="#exploring-variable-feature-types" id="toc-exploring-variable-feature-types" class="nav-link" data-scroll-target="#exploring-variable-feature-types"><span class="header-section-number">5.6.2</span> Exploring Variable Feature Types</a></li>
  <li><a href="#visualizing-co2" id="toc-visualizing-co2" class="nav-link" data-scroll-target="#visualizing-co2"><span class="header-section-number">5.6.3</span> Visualizing CO<sub>2</sub></a></li>
  <li><a href="#sanity-checks-reasoning-about-the-data" id="toc-sanity-checks-reasoning-about-the-data" class="nav-link" data-scroll-target="#sanity-checks-reasoning-about-the-data"><span class="header-section-number">5.6.4</span> Sanity Checks: Reasoning about the data</a></li>
  <li><a href="#understanding-missing-value-1-days" id="toc-understanding-missing-value-1-days" class="nav-link" data-scroll-target="#understanding-missing-value-1-days"><span class="header-section-number">5.6.5</span> Understanding Missing Value 1: <code>Days</code></a></li>
  <li><a href="#understanding-missing-value-2-avg" id="toc-understanding-missing-value-2-avg" class="nav-link" data-scroll-target="#understanding-missing-value-2-avg"><span class="header-section-number">5.6.6</span> Understanding Missing Value 2: <code>Avg</code></a></li>
  <li><a href="#drop-nan-or-impute-missing-avg-data" id="toc-drop-nan-or-impute-missing-avg-data" class="nav-link" data-scroll-target="#drop-nan-or-impute-missing-avg-data"><span class="header-section-number">5.6.7</span> Drop, <code>NaN</code>, or Impute Missing <code>Avg</code> Data?</a></li>
  <li><a href="#presenting-the-data-a-discussion-on-data-granularity" id="toc-presenting-the-data-a-discussion-on-data-granularity" class="nav-link" data-scroll-target="#presenting-the-data-a-discussion-on-data-granularity"><span class="header-section-number">5.6.8</span> Presenting the Data: A Discussion on Data Granularity</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content column-body" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Data Cleaning and EDA</span></h1><button type="button" class="btn code-tools-button dropdown-toggle" id="quarto-code-tools-menu" data-bs-toggle="dropdown" aria-expanded="false"><i class="bi"></i> Code</button><ul class="dropdown-menu dropdown-menu-end" aria-labelelledby="quarto-code-tools-menu"><li><a id="quarto-show-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Show All Code</a></li><li><a id="quarto-hide-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Hide All Code</a></li><li><hr class="dropdown-divider"></li><li><a id="quarto-view-source" class="dropdown-item" href="javascript:void(0)" role="button">View Source</a></li></ul></div></div>
</div>



<div class="quarto-title-meta column-body">

    
  
    
  </div>
  


</header>


<div id="0ab1a6ae" class="cell" data-execution_count="1">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> seaborn <span class="im">as</span> sns</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="co">#%matplotlib inline</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>plt.rcParams[<span class="st">'figure.figsize'</span>] <span class="op">=</span> (<span class="dv">12</span>, <span class="dv">9</span>)</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>sns.<span class="bu">set</span>()</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>sns.set_context(<span class="st">'talk'</span>)</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>np.set_printoptions(threshold<span class="op">=</span><span class="dv">20</span>, precision<span class="op">=</span><span class="dv">2</span>, suppress<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>pd.set_option(<span class="st">'display.max_rows'</span>, <span class="dv">30</span>)</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>pd.set_option(<span class="st">'display.max_columns'</span>, <span class="va">None</span>)</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>pd.set_option(<span class="st">'display.precision'</span>, <span class="dv">2</span>)</span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a><span class="co"># This option stops scientific notation for pandas</span></span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a>pd.set_option(<span class="st">'display.float_format'</span>, <span class="st">'</span><span class="sc">{:.2f}</span><span class="st">'</span>.<span class="bu">format</span>)</span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Silence some spurious seaborn warnings</span></span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> warnings</span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a>warnings.filterwarnings(<span class="st">"ignore"</span>, category<span class="op">=</span><span class="pp">FutureWarning</span>)</span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a>warnings.filterwarnings(<span class="st">"ignore"</span>, category<span class="op">=</span><span class="pp">UserWarning</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
</div>
<div class="callout callout-style-default callout-note no-icon callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-1-contents" aria-controls="callout-1" aria-expanded="true" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Note</span>Learning Outcomes
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-1" class="callout-1-contents callout-collapse collapse show">
<div class="callout-body-container callout-body">
<ul>
<li>Recognize common file formats</li>
<li>Categorize data by its variable type</li>
<li>Build awareness of issues with data faithfulness and develop targeted solutions</li>
</ul>
</div>
</div>
</div>
<p>In the past few lectures, we’ve learned that <code>pandas</code> is a toolkit to restructure, modify, and explore a dataset. What we haven’t yet touched on is <em>how</em> to make these data transformation decisions. When we receive a new set of data from the “real world,” how do we know what processing we should do to convert this data into a usable form?</p>
<p><strong>Data cleaning</strong>, also called <strong>data wrangling</strong>, is the process of transforming raw data to facilitate subsequent analysis. It is often used to address issues like:</p>
<ul>
<li>Unclear structure or formatting</li>
<li>Missing or corrupted values</li>
<li>Unit conversions</li>
<li>…and so on</li>
</ul>
<p><strong>Exploratory Data Analysis (EDA)</strong> is the process of understanding a new dataset. It is an open-ended, informal analysis that involves familiarizing ourselves with the variables present in the data, discovering potential hypotheses, and identifying possible issues with the data. This last point can often motivate further data cleaning to address any problems with the dataset’s format; because of this, EDA and data cleaning are often thought of as an “infinite loop,” with each process driving the other.</p>
<p>In this lecture, we will consider the key properties of data to consider when performing data cleaning and EDA. In doing so, we’ll develop a “checklist” of sorts for you to consider when approaching a new dataset. Throughout this process, we’ll build a deeper understanding of this early (but very important!) stage of the data science lifecycle.</p>
<section id="structure" class="level2" data-number="5.1">
<h2 data-number="5.1" class="anchored" data-anchor-id="structure"><span class="header-section-number">5.1</span> Structure</h2>
<p>We often prefer rectangular data for data analysis. Rectangular structures are easy to manipulate and analyze. A key element of data cleaning is about transforming data to be more rectangular.</p>
<p>There are two kinds of rectangular data: tables and matrices. Tables have named columns with different data types and are manipulated using data transformation languages. Matrices contain numeric data of the same type and are manipulated using linear algebra.</p>
<section id="file-formats" class="level3" data-number="5.1.1">
<h3 data-number="5.1.1" class="anchored" data-anchor-id="file-formats"><span class="header-section-number">5.1.1</span> File Formats</h3>
<p>There are many file types for storing structured data: TSV, JSON, XML, ASCII, SAS, etc. We’ll only cover CSV, TSV, and JSON in lecture, but you’ll likely encounter other formats as you work with different datasets. Reading documentation is your best bet for understanding how to process the multitude of different file types.</p>
<section id="csv" class="level4" data-number="5.1.1.1">
<h4 data-number="5.1.1.1" class="anchored" data-anchor-id="csv"><span class="header-section-number">5.1.1.1</span> CSV</h4>
<p>CSVs, which stand for <strong>Comma-Separated Values</strong>, are a common tabular data format. In the past two <code>pandas</code> lectures, we briefly touched on the idea of file format: the way data is encoded in a file for storage. Specifically, our <code>elections</code> and <code>babynames</code> datasets were stored and loaded as CSVs:</p>
<div id="dae3c1af" class="cell" data-execution_count="2">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>pd.read_csv(<span class="st">"data/elections.csv"</span>).head(<span class="dv">5</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display" data-execution_count="2">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Year</th>
<th data-quarto-table-cell-role="th">Candidate</th>
<th data-quarto-table-cell-role="th">Party</th>
<th data-quarto-table-cell-role="th">Popular vote</th>
<th data-quarto-table-cell-role="th">Result</th>
<th data-quarto-table-cell-role="th">%</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<th data-quarto-table-cell-role="th">0</th>
<td>1824</td>
<td>Andrew Jackson</td>
<td>Democratic-Republican</td>
<td>151271</td>
<td>loss</td>
<td>57.21</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">1</th>
<td>1824</td>
<td>John Quincy Adams</td>
<td>Democratic-Republican</td>
<td>113142</td>
<td>win</td>
<td>42.79</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">2</th>
<td>1828</td>
<td>Andrew Jackson</td>
<td>Democratic</td>
<td>642806</td>
<td>win</td>
<td>56.20</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">3</th>
<td>1828</td>
<td>John Quincy Adams</td>
<td>National Republican</td>
<td>500897</td>
<td>loss</td>
<td>43.80</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">4</th>
<td>1832</td>
<td>Andrew Jackson</td>
<td>Democratic</td>
<td>702735</td>
<td>win</td>
<td>54.57</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>To better understand the properties of a CSV, let’s take a look at the first few rows of the raw data file to see what it looks like before being loaded into a <code>DataFrame</code>. We’ll use the <code>repr()</code> function to return the raw string with its special characters:</p>
<div id="3c68a0bc" class="cell" data-execution_count="3">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> <span class="bu">open</span>(<span class="st">"data/elections.csv"</span>, <span class="st">"r"</span>) <span class="im">as</span> table:</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>    i <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> row <span class="kw">in</span> table:</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="bu">repr</span>(row))</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>        i <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> i <span class="op">&gt;</span> <span class="dv">3</span>:</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>            <span class="cf">break</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>'Year,Candidate,Party,Popular vote,Result,%\n'
'1824,Andrew Jackson,Democratic-Republican,151271,loss,57.21012204\n'
'1824,John Quincy Adams,Democratic-Republican,113142,win,42.78987796\n'
'1828,Andrew Jackson,Democratic,642806,win,56.20392707\n'</code></pre>
</div>
</div>
<p>Each row, or <strong>record</strong>, in the data is delimited by a newline <code>\n</code>. Each column, or <strong>field</strong>, in the data is delimited by a comma <code>,</code> (hence, comma-separated!).</p>
</section>
<section id="tsv" class="level4" data-number="5.1.1.2">
<h4 data-number="5.1.1.2" class="anchored" data-anchor-id="tsv"><span class="header-section-number">5.1.1.2</span> TSV</h4>
<p>Another common file type is <strong>TSV (Tab-Separated Values)</strong>. In a TSV, records are still delimited by a newline <code>\n</code>, while fields are delimited by <code>\t</code> tab character.</p>
<p>Let’s check out the first few rows of the raw TSV file. Again, we’ll use the <code>repr()</code> function so that <code>print</code> shows the special characters.</p>
<div id="bec495f7" class="cell" data-execution_count="4">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> <span class="bu">open</span>(<span class="st">"data/elections.txt"</span>, <span class="st">"r"</span>) <span class="im">as</span> table:</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>    i <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> row <span class="kw">in</span> table:</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="bu">repr</span>(row))</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>        i <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> i <span class="op">&gt;</span> <span class="dv">3</span>:</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>            <span class="cf">break</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>'\ufeffYear\tCandidate\tParty\tPopular vote\tResult\t%\n'
'1824\tAndrew Jackson\tDemocratic-Republican\t151271\tloss\t57.21012204\n'
'1824\tJohn Quincy Adams\tDemocratic-Republican\t113142\twin\t42.78987796\n'
'1828\tAndrew Jackson\tDemocratic\t642806\twin\t56.20392707\n'</code></pre>
</div>
</div>
<p>TSVs can be loaded into <code>pandas</code> using <code>pd.read_csv</code>. We’ll need to specify the <strong>delimiter</strong> with parameter<code>sep='\t'</code> <a href="https://pandas.pydata.org/docs/reference/api/pandas.read_csv.html">(documentation)</a>.</p>
<div id="6e171a14" class="cell" data-execution_count="5">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>pd.read_csv(<span class="st">"data/elections.txt"</span>, sep<span class="op">=</span><span class="st">'</span><span class="ch">\t</span><span class="st">'</span>).head(<span class="dv">3</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display" data-execution_count="5">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Year</th>
<th data-quarto-table-cell-role="th">Candidate</th>
<th data-quarto-table-cell-role="th">Party</th>
<th data-quarto-table-cell-role="th">Popular vote</th>
<th data-quarto-table-cell-role="th">Result</th>
<th data-quarto-table-cell-role="th">%</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<th data-quarto-table-cell-role="th">0</th>
<td>1824</td>
<td>Andrew Jackson</td>
<td>Democratic-Republican</td>
<td>151271</td>
<td>loss</td>
<td>57.21</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">1</th>
<td>1824</td>
<td>John Quincy Adams</td>
<td>Democratic-Republican</td>
<td>113142</td>
<td>win</td>
<td>42.79</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">2</th>
<td>1828</td>
<td>Andrew Jackson</td>
<td>Democratic</td>
<td>642806</td>
<td>win</td>
<td>56.20</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>An issue with CSVs and TSVs comes up whenever there are commas or tabs within the records. How does <code>pandas</code> differentiate between a comma delimiter vs.&nbsp;a comma within the field itself, for example <code>8,900</code>? To remedy this, check out the <a href="https://pandas.pydata.org/docs/reference/api/pandas.read_csv.html"><code>quotechar</code> parameter</a>.</p>
</section>
<section id="json" class="level4" data-number="5.1.1.3">
<h4 data-number="5.1.1.3" class="anchored" data-anchor-id="json"><span class="header-section-number">5.1.1.3</span> JSON</h4>
<p><strong>JSON (JavaScript Object Notation)</strong> files behave similarly to Python dictionaries. A raw JSON is shown below.</p>
<div id="5c600461" class="cell" data-execution_count="6">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> <span class="bu">open</span>(<span class="st">"data/elections.json"</span>, <span class="st">"r"</span>) <span class="im">as</span> table:</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>    i <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> row <span class="kw">in</span> table:</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(row)</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>        i <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> i <span class="op">&gt;</span> <span class="dv">8</span>:</span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>            <span class="cf">break</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>[

 {

   "Year": 1824,

   "Candidate": "Andrew Jackson",

   "Party": "Democratic-Republican",

   "Popular vote": 151271,

   "Result": "loss",

   "%": 57.21012204

 },
</code></pre>
</div>
</div>
<p>JSON files can be loaded into <code>pandas</code> using <code>pd.read_json</code>.</p>
<div id="d3321cc9" class="cell" data-execution_count="7">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>pd.read_json(<span class="st">'data/elections.json'</span>).head(<span class="dv">3</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display" data-execution_count="7">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Year</th>
<th data-quarto-table-cell-role="th">Candidate</th>
<th data-quarto-table-cell-role="th">Party</th>
<th data-quarto-table-cell-role="th">Popular vote</th>
<th data-quarto-table-cell-role="th">Result</th>
<th data-quarto-table-cell-role="th">%</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<th data-quarto-table-cell-role="th">0</th>
<td>1824</td>
<td>Andrew Jackson</td>
<td>Democratic-Republican</td>
<td>151271</td>
<td>loss</td>
<td>57.21</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">1</th>
<td>1824</td>
<td>John Quincy Adams</td>
<td>Democratic-Republican</td>
<td>113142</td>
<td>win</td>
<td>42.79</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">2</th>
<td>1828</td>
<td>Andrew Jackson</td>
<td>Democratic</td>
<td>642806</td>
<td>win</td>
<td>56.20</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<section id="eda-with-json-united-states-congress-data" class="level5" data-number="5.1.1.3.1">
<h5 data-number="5.1.1.3.1" class="anchored" data-anchor-id="eda-with-json-united-states-congress-data"><span class="header-section-number">5.1.1.3.1</span> EDA with JSON: United States Congress Data</h5>
<p>The congress.gov API (Application Programming Interface) provides data about the activities and members of the United States Congress (i.e., the House of Representatives and the Senate). <br></p>
<p>To get a JSON file containing information about the current members of Congress from California, you could use the following <strong>API call</strong>:</p>
<ul>
<li><p><code>https://api.congress.gov/v3/member/CA?api_key=[INSERT_KEY]&amp;limit=250&amp;format=json&amp;currentMember=True</code></p></li>
<li><p>You can instantly sign up for a congress.gov <strong>API key</strong> <a href="https://gpo.congress.gov/sign-up/">here</a>. Once you have your key, replace <code>[INSERT_KEY]</code> above with your key, and enter the API call as a URL in your browser. What happens?</p></li>
<li><p>Once the JSON from the API call is visible in your browser, you can click <code>File</code> –&gt; <code>Save Page As</code> to save the JSON file to your coputer.</p></li>
<li><p>Coarsely, API keys are used to track how much a given user engages with the API. There might be limits to the number of API calls (e.g., congress.gov API limits to 5,000 calls per hour), or a cost for API calls (e.g., using the OpenAI API for programmatically using ChatGPT).</p></li>
</ul>
<p><br></p>
<p>After following these steps, we save this JSON file as <code>data/ca-congress-members.json</code>.</p>
<section id="file-contents" class="level6" data-number="5.1.1.3.1.1">
<h6 data-number="5.1.1.3.1.1" class="anchored" data-anchor-id="file-contents"><span class="header-section-number">5.1.1.3.1.1</span> File Contents</h6>
<p>Let’s examine this file using Python. We can programmatically view the first couple lines of the file using the same functions we used with CSVs:</p>
<div id="f635aa72" class="cell" data-execution_count="8">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>congress_file <span class="op">=</span> <span class="st">"data/ca-congress-members.json"</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Inspect the first five lines of the file</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> <span class="bu">open</span>(congress_file, <span class="st">"r"</span>) <span class="im">as</span> f:</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i, row <span class="kw">in</span> <span class="bu">enumerate</span>(f):</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(row)</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> i <span class="op">&gt;=</span> <span class="dv">4</span>: <span class="cf">break</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>{

    "members": [

        {

            "bioguideId": "T000491",

            "depiction": {
</code></pre>
</div>
</div>
</section>
<section id="eda-digging-into-json-with-python" class="level6" data-number="5.1.1.3.1.2">
<h6 data-number="5.1.1.3.1.2" class="anchored" data-anchor-id="eda-digging-into-json-with-python"><span class="header-section-number">5.1.1.3.1.2</span> EDA: Digging into JSON with Python</h6>
<p>JSON data closely matches the internal Python object model.</p>
<ul>
<li>In the following cell, we import the entire JSON datafile into a Python dictionary using the <code>json</code> package.</li>
</ul>
<div id="c4184671" class="cell" data-execution_count="9">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> json</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Import the JSON file into Python as a dictionary</span></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> <span class="bu">open</span>(congress_file, <span class="st">"rb"</span>) <span class="im">as</span> f:</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>    congress_json <span class="op">=</span> json.load(f)</span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a><span class="bu">type</span>(congress_json)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display" data-execution_count="9">
<pre><code>dict</code></pre>
</div>
</div>
<p>The <code>congress_json</code> variable is a dictionary encoding the data in the JSON file.</p>
<p>Below, we access the first element of the <code>members</code> element of the <code>congress_json</code> dictionary.</p>
<ul>
<li>This first element is also a dictionary (and there are more dictionaries inside of it!)</li>
</ul>
<div id="2aad5514" class="cell" data-execution_count="10">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Grab the list corresponding to the `members` key in the JSON dictionary, </span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="co"># and then grab the first element of this list.</span></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a><span class="co"># In a moment, we'll see how we knew to use the key `members`, and that</span></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a><span class="co"># the resulting object is a list.</span></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>congress_json[<span class="st">'members'</span>][<span class="dv">0</span>]</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display" data-execution_count="10">
<pre><code>{'bioguideId': 'T000491',
 'depiction': {'attribution': 'Image courtesy of the Member',
  'imageUrl': 'https://www.congress.gov/img/member/6774606d0b34857ecc9091a9_200.jpg'},
 'district': 45,
 'name': 'Tran, Derek',
 'partyName': 'Democratic',
 'state': 'California',
 'terms': {'item': [{'chamber': 'House of Representatives',
    'startYear': 2025}]},
 'updateDate': '2025-01-21T18:00:52Z',
 'url': 'https://api.congress.gov/v3/member/T000491?format=json'}</code></pre>
</div>
</div>
<p>How should we probe a nested dictionary like <code>congress_json</code>?</p>
<p>We can start by identifying the top-level <strong>keys</strong> of the dictionary:</p>
<div id="70a7711b" class="cell" data-execution_count="11">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb17"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Grab the top-level keys of the JSON dictionary</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>congress_json.keys()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display" data-execution_count="11">
<pre><code>dict_keys(['members', 'pagination', 'request'])</code></pre>
</div>
</div>
<p>Looks like we have three top-level keys: <code>members</code>, <code>pagination</code>, and <code>request</code>.</p>
<blockquote class="blockquote">
<p>You’ll often see a top-level <code>meta</code> key in JSON files. This does not refer to Meta (formerly Facebook). Instead, it typically refers to metadata (data about the data). Metadata are often maintained alongside the data.</p>
</blockquote>
<p>Let’s check the type of the <code>members</code> element:</p>
<div id="35fb6dcb" class="cell" data-execution_count="12">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb19"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="bu">type</span>(congress_json[<span class="st">'members'</span>])</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display" data-execution_count="12">
<pre><code>list</code></pre>
</div>
</div>
<p>Looks like a list! What are the first two elements?</p>
<div id="bc7b8355" class="cell" data-execution_count="13">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb21"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>congress_json[<span class="st">'members'</span>][:<span class="dv">2</span>]</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display" data-execution_count="13">
<pre><code>[{'bioguideId': 'T000491',
  'depiction': {'attribution': 'Image courtesy of the Member',
   'imageUrl': 'https://www.congress.gov/img/member/6774606d0b34857ecc9091a9_200.jpg'},
  'district': 45,
  'name': 'Tran, Derek',
  'partyName': 'Democratic',
  'state': 'California',
  'terms': {'item': [{'chamber': 'House of Representatives',
     'startYear': 2025}]},
  'updateDate': '2025-01-21T18:00:52Z',
  'url': 'https://api.congress.gov/v3/member/T000491?format=json'},
 {'bioguideId': 'M001241',
  'depiction': {'attribution': 'Image courtesy of the Member',
   'imageUrl': 'https://www.congress.gov/img/member/67744ed90b34857ecc909155_200.jpg'},
  'district': 47,
  'name': 'Min, Dave',
  'partyName': 'Democratic',
  'state': 'California',
  'terms': {'item': [{'chamber': 'House of Representatives',
     'startYear': 2025}]},
  'updateDate': '2025-01-21T18:00:52Z',
  'url': 'https://api.congress.gov/v3/member/M001241?format=json'}]</code></pre>
</div>
</div>
<p>More dictionaries! You can repeat the process above to traverse the nested dictionary.</p>
<p>You’ll notice that each record of <code>congress_json['members']</code> looks like it could be a column of a DataFrame.</p>
<ul>
<li>The keys look a lot like column names, and the values could be the entries in each row.</li>
</ul>
<p><br></p>
<p>But, the two other elements of <code>congress_json</code> don’t have the same structure as <code>congress_json['members']</code>.</p>
<ul>
<li><p>So, they probably don’t belong in a DataFrame containing the members of Congress from CA.</p></li>
<li><p>We’ll see the implications of this inconsistency in the next section.</p></li>
</ul>
<div id="c66097ce" class="cell" data-execution_count="14">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb23"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(congress_json[<span class="st">'pagination'</span>])</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(congress_json[<span class="st">'request'</span>])</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>{'count': 54}
{'contentType': 'application/json', 'format': 'json'}</code></pre>
</div>
</div>
</section>
<section id="json-with-pandas" class="level6" data-number="5.1.1.3.1.3">
<h6 data-number="5.1.1.3.1.3" class="anchored" data-anchor-id="json-with-pandas"><span class="header-section-number">5.1.1.3.1.3</span> JSON with pandas</h6>
<p><code>pandas</code> has a built in function called <code>pd.read_json</code> for reading in JSON files. In order to read in this JSON file, you might want to try something like the code in the cell below. However, if we tried to run this code, it would error.</p>
<div id="90e5d4ec" class="cell" data-execution_count="15">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb25"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="co">#pd.read_json(congress_file)</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<ul>
<li><p>The code above tries to import the entire JSON file located at <code>congress_file</code> (<code>congress_json</code>), including <code>congress_json['pagination']</code> and <code>congress_json['request']</code>.</p></li>
<li><p>We only want to make a DataFrame out of <code>congress_json['members']</code>.</p></li>
</ul>
<p>Instead, let’s try converting the <code>members</code> element of <code>congress_json</code> to a DataFrame by using <code>pd.DataFrame</code>:</p>
<div id="2c9da191" class="cell" data-execution_count="16">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb26"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert dictionary to DataFrame</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>congress_df <span class="op">=</span> pd.DataFrame(congress_json[<span class="st">'members'</span>])</span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>congress_df.head()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display" data-execution_count="16">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">bioguideId</th>
<th data-quarto-table-cell-role="th">depiction</th>
<th data-quarto-table-cell-role="th">district</th>
<th data-quarto-table-cell-role="th">name</th>
<th data-quarto-table-cell-role="th">partyName</th>
<th data-quarto-table-cell-role="th">state</th>
<th data-quarto-table-cell-role="th">terms</th>
<th data-quarto-table-cell-role="th">updateDate</th>
<th data-quarto-table-cell-role="th">url</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<th data-quarto-table-cell-role="th">0</th>
<td>T000491</td>
<td>{'attribution': 'Image courtesy of the Member'...</td>
<td>45.00</td>
<td>Tran, Derek</td>
<td>Democratic</td>
<td>California</td>
<td>{'item': [{'chamber': 'House of Representative...</td>
<td>2025-01-21T18:00:52Z</td>
<td>https://api.congress.gov/v3/member/T000491?for...</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">1</th>
<td>M001241</td>
<td>{'attribution': 'Image courtesy of the Member'...</td>
<td>47.00</td>
<td>Min, Dave</td>
<td>Democratic</td>
<td>California</td>
<td>{'item': [{'chamber': 'House of Representative...</td>
<td>2025-01-21T18:00:52Z</td>
<td>https://api.congress.gov/v3/member/M001241?for...</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">2</th>
<td>K000400</td>
<td>{'attribution': 'Image courtesy of the Member'...</td>
<td>37.00</td>
<td>Kamlager-Dove, Sydney</td>
<td>Democratic</td>
<td>California</td>
<td>{'item': [{'chamber': 'House of Representative...</td>
<td>2025-01-21T18:00:52Z</td>
<td>https://api.congress.gov/v3/member/K000400?for...</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">3</th>
<td>G000598</td>
<td>{'attribution': 'Image courtesy of the Member'...</td>
<td>42.00</td>
<td>Garcia, Robert</td>
<td>Democratic</td>
<td>California</td>
<td>{'item': [{'chamber': 'House of Representative...</td>
<td>2025-01-21T18:00:52Z</td>
<td>https://api.congress.gov/v3/member/G000598?for...</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">4</th>
<td>K000397</td>
<td>{'attribution': 'Image courtesy of the Member'...</td>
<td>40.00</td>
<td>Kim, Young</td>
<td>Republican</td>
<td>California</td>
<td>{'item': [{'chamber': 'House of Representative...</td>
<td>2025-01-21T18:00:52Z</td>
<td>https://api.congress.gov/v3/member/K000397?for...</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>We’ve successfully begun to rectangularize our JSON data!</p>
</section>
</section>
</section>
</section>
<section id="other-data-formats" class="level3" data-number="5.1.2">
<h3 data-number="5.1.2" class="anchored" data-anchor-id="other-data-formats"><span class="header-section-number">5.1.2</span> Other Data Formats</h3>
<p>So far, we’ve looked at text data that comes in a quite nice format. Although some data cleaning might be necessary, it has still had all of the components of a rectangular dataset. However, not all data comes like this, and there are also different kinds of data we can use. Some examples include:</p>
<ul>
<li><strong>Image Data</strong>: Used for medical diagnosis</li>
<li><strong>Audio Data</strong>: Used for speech recognition, sentiment analysis</li>
<li><strong>Video Data</strong>: Used for object tracking, facial recognition</li>
<li><strong>Text</strong>: Used for LLMs, document review</li>
</ul>
<p>Even though this may not look tabular at first, all of these formats can be represented in tabular/matrix form! So by learning how to work with tabular data, you are well equipped to deal with other kinds of data as well.</p>
</section>
<section id="variable-types" class="level3" data-number="5.1.3">
<h3 data-number="5.1.3" class="anchored" data-anchor-id="variable-types"><span class="header-section-number">5.1.3</span> Variable Types</h3>
<p>Variables are columns. A variable is a measurement of a particular concept. Variables have two common properties: data type/storage type and variable type/feature type. The data type of a variable indicates how each variable value is stored in memory (integer, floating point, boolean, etc.) and affects which <code>pandas</code> functions are used. The variable type is a conceptualized measurement of information (and therefore indicates what values a variable can take on). Variable type is identified through expert knowledge, exploring the data itself, or consulting the data codebook. The variable type affects how one visualizes and inteprets the data. In this class, “variable types” are conceptual.</p>
<p>After loading data into a file, it’s a good idea to take the time to understand what pieces of information are encoded in the dataset. In particular, we want to identify what variable types are present in our data. Broadly speaking, we can categorize variables into one of two overarching types.</p>
<p><strong>Quantitative variables</strong> describe some numeric quantity or amount. Some examples include weights, GPA, CO<sub>2</sub> concentrations, someone’s age, or the number of siblings they have.</p>
<p><strong>Qualitative variables</strong>, also known as <strong>categorical variables</strong>, describe data that isn’t measuring some quantity or amount. The sub-categories of categorical data are:</p>
<ul>
<li><strong>Ordinal qualitative variables</strong>: categories with ordered levels. Specifically, ordinal variables are those where the difference between levels has no consistent, quantifiable meaning. Some examples include levels of education (high school, undergrad, grad, etc.), income bracket (low, medium, high), or Yelp rating.</li>
<li><strong>Nominal qualitative variables</strong>: categories with no specific order. For example, someone’s political affiliation or Cal ID number.</li>
</ul>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/variable_types.png" class="img-fluid figure-img"></p>
<figcaption>Classification of variable types</figcaption>
</figure>
</div>
<p>Note that many variables don’t sit neatly in just one of these categories. Qualitative variables could have numeric levels, and conversely, quantitative variables could be stored as strings.</p>
</section>
</section>
<section id="granularity-and-temporality" class="level2" data-number="5.2">
<h2 data-number="5.2" class="anchored" data-anchor-id="granularity-and-temporality"><span class="header-section-number">5.2</span> Granularity and Temporality</h2>
<p>After understanding the structure of the dataset, the next task is to determine what exactly the data represents. We’ll do so by considering the data’s granularity and temporality.</p>
<section id="granularity" class="level3" data-number="5.2.1">
<h3 data-number="5.2.1" class="anchored" data-anchor-id="granularity"><span class="header-section-number">5.2.1</span> Granularity</h3>
<p>The <strong>granularity</strong> of a dataset is what a single row represents. You can also think of it as the level of detail included in the data. To determine the data’s granularity, ask: what does each row in the dataset represent? Fine-grained data contains a high level of detail, with a single row representing a small individual unit. For example, each record may represent one person. Coarse-grained data is encoded such that a single row represents a large individual unit – for example, each record may represent a group of people.</p>
</section>
<section id="temporality" class="level3" data-number="5.2.2">
<h3 data-number="5.2.2" class="anchored" data-anchor-id="temporality"><span class="header-section-number">5.2.2</span> Temporality</h3>
<p>The <strong>temporality</strong> of a dataset describes the periodicity over which the data was collected as well as when the data was most recently collected or updated.</p>
<p>Time and date fields of a dataset could represent a few things:</p>
<ol type="1">
<li>when the “event” happened</li>
<li>when the data was collected, or when it was entered into the system</li>
<li>when the data was copied into the database</li>
</ol>
<p>To fully understand the temporality of the data, it also may be necessary to standardize time zones or inspect recurring time-based trends in the data (do patterns recur in 24-hour periods? Over the course of a month? Seasonally?). The convention for standardizing time is the Coordinated Universal Time (UTC), an international time standard measured at 0 degrees latitude that stays consistent throughout the year (no daylight savings). We can represent Berkeley’s time zone, Pacific Standard Time (PST), as UTC-7 (with daylight savings).</p>
<section id="temporality-with-pandas-dt-accessors" class="level4" data-number="5.2.2.1">
<h4 data-number="5.2.2.1" class="anchored" data-anchor-id="temporality-with-pandas-dt-accessors"><span class="header-section-number">5.2.2.1</span> Temporality with <code>pandas</code>’ <code>dt</code> accessors</h4>
<p>Let’s briefly look at how we can use <code>pandas</code>’ <code>dt</code> accessors to work with dates/times in a dataset using the dataset you’ll see in Lab 3: the Berkeley PD Calls for Service dataset.</p>
<div id="e086ccdd" class="cell" data-execution_count="17">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb27"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>calls <span class="op">=</span> pd.read_csv(<span class="st">"data/Berkeley_PD_-_Calls_for_Service.csv"</span>)</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>calls.head()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="17">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">CASENO</th>
<th data-quarto-table-cell-role="th">OFFENSE</th>
<th data-quarto-table-cell-role="th">EVENTDT</th>
<th data-quarto-table-cell-role="th">EVENTTM</th>
<th data-quarto-table-cell-role="th">CVLEGEND</th>
<th data-quarto-table-cell-role="th">CVDOW</th>
<th data-quarto-table-cell-role="th">InDbDate</th>
<th data-quarto-table-cell-role="th">Block_Location</th>
<th data-quarto-table-cell-role="th">BLKADDR</th>
<th data-quarto-table-cell-role="th">City</th>
<th data-quarto-table-cell-role="th">State</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<th data-quarto-table-cell-role="th">0</th>
<td>21014296</td>
<td>THEFT MISD. (UNDER $950)</td>
<td>04/01/2021 12:00:00 AM</td>
<td>10:58</td>
<td>LARCENY</td>
<td>4</td>
<td>06/15/2021 12:00:00 AM</td>
<td>Berkeley, CA\n(37.869058, -122.270455)</td>
<td>NaN</td>
<td>Berkeley</td>
<td>CA</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">1</th>
<td>21014391</td>
<td>THEFT MISD. (UNDER $950)</td>
<td>04/01/2021 12:00:00 AM</td>
<td>10:38</td>
<td>LARCENY</td>
<td>4</td>
<td>06/15/2021 12:00:00 AM</td>
<td>Berkeley, CA\n(37.869058, -122.270455)</td>
<td>NaN</td>
<td>Berkeley</td>
<td>CA</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">2</th>
<td>21090494</td>
<td>THEFT MISD. (UNDER $950)</td>
<td>04/19/2021 12:00:00 AM</td>
<td>12:15</td>
<td>LARCENY</td>
<td>1</td>
<td>06/15/2021 12:00:00 AM</td>
<td>2100 BLOCK HASTE ST\nBerkeley, CA\n(37.864908,...</td>
<td>2100 BLOCK HASTE ST</td>
<td>Berkeley</td>
<td>CA</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">3</th>
<td>21090204</td>
<td>THEFT FELONY (OVER $950)</td>
<td>02/13/2021 12:00:00 AM</td>
<td>17:00</td>
<td>LARCENY</td>
<td>6</td>
<td>06/15/2021 12:00:00 AM</td>
<td>2600 BLOCK WARRING ST\nBerkeley, CA\n(37.86393...</td>
<td>2600 BLOCK WARRING ST</td>
<td>Berkeley</td>
<td>CA</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">4</th>
<td>21090179</td>
<td>BURGLARY AUTO</td>
<td>02/08/2021 12:00:00 AM</td>
<td>6:20</td>
<td>BURGLARY - VEHICLE</td>
<td>1</td>
<td>06/15/2021 12:00:00 AM</td>
<td>2700 BLOCK GARBER ST\nBerkeley, CA\n(37.86066,...</td>
<td>2700 BLOCK GARBER ST</td>
<td>Berkeley</td>
<td>CA</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>Looks like there are three columns with dates/times: <code>EVENTDT</code>, <code>EVENTTM</code>, and <code>InDbDate</code>.</p>
<p>Most likely, <code>EVENTDT</code> stands for the date when the event took place, <code>EVENTTM</code> stands for the time of day the event took place (in 24-hr format), and <code>InDbDate</code> is the date this call is recorded onto the database.</p>
<p>If we check the data type of these columns, we will see they are stored as strings. We can convert them to <code>datetime</code> objects using pandas <code>to_datetime</code> function.</p>
<div id="51209242" class="cell" data-execution_count="18">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb28"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>calls[<span class="st">"EVENTDT"</span>] <span class="op">=</span> pd.to_datetime(calls[<span class="st">"EVENTDT"</span>])</span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>calls.head()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display" data-execution_count="18">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">CASENO</th>
<th data-quarto-table-cell-role="th">OFFENSE</th>
<th data-quarto-table-cell-role="th">EVENTDT</th>
<th data-quarto-table-cell-role="th">EVENTTM</th>
<th data-quarto-table-cell-role="th">CVLEGEND</th>
<th data-quarto-table-cell-role="th">CVDOW</th>
<th data-quarto-table-cell-role="th">InDbDate</th>
<th data-quarto-table-cell-role="th">Block_Location</th>
<th data-quarto-table-cell-role="th">BLKADDR</th>
<th data-quarto-table-cell-role="th">City</th>
<th data-quarto-table-cell-role="th">State</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<th data-quarto-table-cell-role="th">0</th>
<td>21014296</td>
<td>THEFT MISD. (UNDER $950)</td>
<td>2021-04-01</td>
<td>10:58</td>
<td>LARCENY</td>
<td>4</td>
<td>06/15/2021 12:00:00 AM</td>
<td>Berkeley, CA\n(37.869058, -122.270455)</td>
<td>NaN</td>
<td>Berkeley</td>
<td>CA</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">1</th>
<td>21014391</td>
<td>THEFT MISD. (UNDER $950)</td>
<td>2021-04-01</td>
<td>10:38</td>
<td>LARCENY</td>
<td>4</td>
<td>06/15/2021 12:00:00 AM</td>
<td>Berkeley, CA\n(37.869058, -122.270455)</td>
<td>NaN</td>
<td>Berkeley</td>
<td>CA</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">2</th>
<td>21090494</td>
<td>THEFT MISD. (UNDER $950)</td>
<td>2021-04-19</td>
<td>12:15</td>
<td>LARCENY</td>
<td>1</td>
<td>06/15/2021 12:00:00 AM</td>
<td>2100 BLOCK HASTE ST\nBerkeley, CA\n(37.864908,...</td>
<td>2100 BLOCK HASTE ST</td>
<td>Berkeley</td>
<td>CA</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">3</th>
<td>21090204</td>
<td>THEFT FELONY (OVER $950)</td>
<td>2021-02-13</td>
<td>17:00</td>
<td>LARCENY</td>
<td>6</td>
<td>06/15/2021 12:00:00 AM</td>
<td>2600 BLOCK WARRING ST\nBerkeley, CA\n(37.86393...</td>
<td>2600 BLOCK WARRING ST</td>
<td>Berkeley</td>
<td>CA</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">4</th>
<td>21090179</td>
<td>BURGLARY AUTO</td>
<td>2021-02-08</td>
<td>6:20</td>
<td>BURGLARY - VEHICLE</td>
<td>1</td>
<td>06/15/2021 12:00:00 AM</td>
<td>2700 BLOCK GARBER ST\nBerkeley, CA\n(37.86066,...</td>
<td>2700 BLOCK GARBER ST</td>
<td>Berkeley</td>
<td>CA</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>Now, we can use the <code>dt</code> accessor on this column.</p>
<p>We can get the month:</p>
<div id="18de8a54" class="cell" data-execution_count="19">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb29"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>calls[<span class="st">"EVENTDT"</span>].dt.month.head()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display" data-execution_count="19">
<pre><code>0    4
1    4
2    4
3    2
4    2
Name: EVENTDT, dtype: int32</code></pre>
</div>
</div>
<p>Which day of the week the date is on:</p>
<div id="ba0313e4" class="cell" data-execution_count="20">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb31"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>calls[<span class="st">"EVENTDT"</span>].dt.dayofweek.head()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display" data-execution_count="20">
<pre><code>0    3
1    3
2    0
3    5
4    0
Name: EVENTDT, dtype: int32</code></pre>
</div>
</div>
<p>Check the mimimum values to see if there are any suspicious-looking, 70s dates:</p>
<div id="1a27d346" class="cell" data-execution_count="21">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb33"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>calls.sort_values(<span class="st">"EVENTDT"</span>).head()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display" data-execution_count="21">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">CASENO</th>
<th data-quarto-table-cell-role="th">OFFENSE</th>
<th data-quarto-table-cell-role="th">EVENTDT</th>
<th data-quarto-table-cell-role="th">EVENTTM</th>
<th data-quarto-table-cell-role="th">CVLEGEND</th>
<th data-quarto-table-cell-role="th">CVDOW</th>
<th data-quarto-table-cell-role="th">InDbDate</th>
<th data-quarto-table-cell-role="th">Block_Location</th>
<th data-quarto-table-cell-role="th">BLKADDR</th>
<th data-quarto-table-cell-role="th">City</th>
<th data-quarto-table-cell-role="th">State</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<th data-quarto-table-cell-role="th">2513</th>
<td>20057398</td>
<td>BURGLARY COMMERCIAL</td>
<td>2020-12-17</td>
<td>16:05</td>
<td>BURGLARY - COMMERCIAL</td>
<td>4</td>
<td>06/15/2021 12:00:00 AM</td>
<td>600 BLOCK GILMAN ST\nBerkeley, CA\n(37.878405,...</td>
<td>600 BLOCK GILMAN ST</td>
<td>Berkeley</td>
<td>CA</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">624</th>
<td>20057207</td>
<td>ASSAULT/BATTERY MISD.</td>
<td>2020-12-17</td>
<td>16:50</td>
<td>ASSAULT</td>
<td>4</td>
<td>06/15/2021 12:00:00 AM</td>
<td>2100 BLOCK SHATTUCK AVE\nBerkeley, CA\n(37.871...</td>
<td>2100 BLOCK SHATTUCK AVE</td>
<td>Berkeley</td>
<td>CA</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">154</th>
<td>20092214</td>
<td>THEFT FROM AUTO</td>
<td>2020-12-17</td>
<td>18:30</td>
<td>LARCENY - FROM VEHICLE</td>
<td>4</td>
<td>06/15/2021 12:00:00 AM</td>
<td>800 BLOCK SHATTUCK AVE\nBerkeley, CA\n(37.8918...</td>
<td>800 BLOCK SHATTUCK AVE</td>
<td>Berkeley</td>
<td>CA</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">659</th>
<td>20057324</td>
<td>THEFT MISD. (UNDER $950)</td>
<td>2020-12-17</td>
<td>15:44</td>
<td>LARCENY</td>
<td>4</td>
<td>06/15/2021 12:00:00 AM</td>
<td>1800 BLOCK 4TH ST\nBerkeley, CA\n(37.869888, -...</td>
<td>1800 BLOCK 4TH ST</td>
<td>Berkeley</td>
<td>CA</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">993</th>
<td>20057573</td>
<td>BURGLARY RESIDENTIAL</td>
<td>2020-12-17</td>
<td>22:15</td>
<td>BURGLARY - RESIDENTIAL</td>
<td>4</td>
<td>06/15/2021 12:00:00 AM</td>
<td>1700 BLOCK STUART ST\nBerkeley, CA\n(37.857495...</td>
<td>1700 BLOCK STUART ST</td>
<td>Berkeley</td>
<td>CA</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>Doesn’t look like it! We are good!</p>
<p>We can also do many things with the <code>dt</code> accessor like switching time zones and converting time back to UNIX/POSIX time. Check out the documentation on <a href="https://pandas.pydata.org/docs/user_guide/basics.html#basics-dt-accessors"><code>.dt</code> accessor</a> and <a href="https://pandas.pydata.org/docs/user_guide/timeseries.html#">time series/date functionality</a>.</p>
</section>
</section>
</section>
<section id="faithfulness" class="level2" data-number="5.3">
<h2 data-number="5.3" class="anchored" data-anchor-id="faithfulness"><span class="header-section-number">5.3</span> Faithfulness</h2>
<p>At this stage in our data cleaning and EDA workflow, we’ve achieved quite a lot: we’ve identified how our data is structured, come to terms with what information it encodes, and gained insight as to how it was generated. Throughout this process, we should always recall the original intent of our work in Data Science – to use data to better understand and model the real world. To achieve this goal, we need to ensure that the data we use is faithful to reality; that is, that our data accurately captures the “real world.”</p>
<p>Data used in research or industry is often “messy” – there may be errors or inaccuracies that impact the faithfulness of the dataset. Signs that data may not be faithful include:</p>
<ul>
<li>Unrealistic or “incorrect” values, such as negative counts, locations that don’t exist, or dates set in the future</li>
<li>Violations of obvious dependencies, like an age that does not match a birthday</li>
<li>Clear signs that data was entered by hand, which can lead to spelling errors or fields that are incorrectly shifted</li>
<li>Signs of data falsification, such as fake email addresses or repeated use of the same names</li>
<li>Duplicated records or fields containing the same information</li>
<li>Truncated data, e.g.&nbsp;Microsoft Excel would limit the number of rows to 655536 and the number of columns to 255</li>
</ul>
<p>We often solve some of these more common issues in the following ways:</p>
<ul>
<li>Spelling errors: apply corrections or drop records that aren’t in a dictionary</li>
<li>Time zone inconsistencies: convert to a common time zone (e.g.&nbsp;UTC)</li>
<li>Duplicated records or fields: identify and eliminate duplicates (using primary keys)</li>
<li>Unspecified or inconsistent units: infer the units and check that values are in reasonable ranges in the data</li>
</ul>
<section id="missing-values" class="level3" data-number="5.3.1">
<h3 data-number="5.3.1" class="anchored" data-anchor-id="missing-values"><span class="header-section-number">5.3.1</span> Missing Values</h3>
<p>Another common issue encountered with real-world datasets is that of missing data. One strategy to resolve this is to simply drop any records with missing values from the dataset. This does, however, introduce the risk of inducing biases – it is possible that the missing or corrupt records may be systemically related to some feature of interest in the data. Another solution is to keep the data as <code>NaN</code> values.</p>
<p>A third method to address missing data is to perform <strong>imputation</strong>: infer the missing values using other data available in the dataset. There is a wide variety of imputation techniques that can be implemented; some of the most common are listed below.</p>
<ul>
<li>Average imputation: replace missing values with the average value for that field</li>
<li>Hot deck imputation: replace missing values with some random value</li>
<li>Regression imputation: develop a model to predict missing values and replace with the predicted value from the model.</li>
<li>Multiple imputation: replace missing values with multiple random values</li>
</ul>
<p>Regardless of the strategy used to deal with missing data, we should think carefully about <em>why</em> particular records or fields may be missing – this can help inform whether or not the absence of these values is significant or meaningful.</p>
</section>
</section>
<section id="eda-demo-1-tuberculosis-in-the-united-states" class="level2" data-number="5.4">
<h2 data-number="5.4" class="anchored" data-anchor-id="eda-demo-1-tuberculosis-in-the-united-states"><span class="header-section-number">5.4</span> EDA Demo 1: Tuberculosis in the United States</h2>
<p>Now, let’s walk through the data-cleaning and EDA workflow to see what can we learn about the presence of Tuberculosis in the United States!</p>
<p>We will examine the data included in the <a href="https://www.cdc.gov/mmwr/volumes/71/wr/mm7112a1.htm?s_cid=mm7112a1_w#T1_down">original CDC article</a> published in 2021.</p>
<section id="csvs-and-field-names" class="level3" data-number="5.4.1">
<h3 data-number="5.4.1" class="anchored" data-anchor-id="csvs-and-field-names"><span class="header-section-number">5.4.1</span> CSVs and Field Names</h3>
<p>Suppose Table 1 was saved as a CSV file located in <code>data/cdc_tuberculosis.csv</code>.</p>
<p>We can then explore the CSV (which is a text file, and does not contain binary-encoded data) in many ways: 1. Using a text editor like emacs, vim, VSCode, etc. 2. Opening the CSV directly in DataHub (read-only), Excel, Google Sheets, etc. 3. The <code>Python</code> file object 4. <code>pandas</code>, using <code>pd.read_csv()</code></p>
<p>To try out options 1 and 2, you can view or download the Tuberculosis from the <a href="https://data100.datahub.berkeley.edu/hub/user-redirect/git-pull?repo=https%3A%2F%2Fgithub.com%2FDS-100%2Fsp25-student&amp;urlpath=lab%2Ftree%2Fsp25-student%2Flecture%2Flec05%2Flec05-part-1-eda-tuberculosis.ipynb&amp;branch=main">lecture demo notebook</a> under the <code>data</code> folder in the left hand menu. Notice how the CSV file is a type of <strong>rectangular data (i.e., tabular data) stored as comma-separated values</strong>.</p>
<p>Next, let’s try out option 3 using the <code>Python</code> file object. We’ll look at the first four lines:</p>
<div id="d8bdab40" class="cell" data-execution_count="22">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb34"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> <span class="bu">open</span>(<span class="st">"data/cdc_tuberculosis.csv"</span>, <span class="st">"r"</span>) <span class="im">as</span> f:</span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>    i <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> row <span class="kw">in</span> f:</span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(row)</span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a>        i <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> i <span class="op">&gt;</span> <span class="dv">3</span>:</span>
<span id="cb34-7"><a href="#cb34-7" aria-hidden="true" tabindex="-1"></a>            <span class="cf">break</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>,No. of TB cases,,

U.S. jurisdiction,2019,2020,2021

Total,"8,900","7,173","7,860"

Alabama,87,72,92
</code></pre>
</div>
</div>
<p>Whoa, why are there blank lines interspaced between the lines of the CSV?</p>
<p>You may recall that all line breaks in text files are encoded as the special newline character <code>\n</code>. Python’s <code>print()</code> prints each string (including the newline), and an additional newline on top of that.</p>
<p>If you’re curious, we can use the <code>repr()</code> function to return the raw string with all special characters:</p>
<div id="7dcf4475" class="cell" data-execution_count="23">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb36"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> <span class="bu">open</span>(<span class="st">"data/cdc_tuberculosis.csv"</span>, <span class="st">"r"</span>) <span class="im">as</span> f:</span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>    i <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> row <span class="kw">in</span> f:</span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="bu">repr</span>(row)) <span class="co"># print raw strings</span></span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a>        i <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> i <span class="op">&gt;</span> <span class="dv">3</span>:</span>
<span id="cb36-7"><a href="#cb36-7" aria-hidden="true" tabindex="-1"></a>            <span class="cf">break</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>',No. of TB cases,,\n'
'U.S. jurisdiction,2019,2020,2021\n'
'Total,"8,900","7,173","7,860"\n'
'Alabama,87,72,92\n'</code></pre>
</div>
</div>
<p>Finally, let’s try option 4 and use the tried-and-true Data 100 approach: <code>pandas</code>.</p>
<div id="da600f26" class="cell" data-execution_count="24">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb38"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>tb_df <span class="op">=</span> pd.read_csv(<span class="st">"data/cdc_tuberculosis.csv"</span>)</span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>tb_df.head()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display" data-execution_count="24">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Unnamed: 0</th>
<th data-quarto-table-cell-role="th">No. of TB cases</th>
<th data-quarto-table-cell-role="th">Unnamed: 2</th>
<th data-quarto-table-cell-role="th">Unnamed: 3</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<th data-quarto-table-cell-role="th">0</th>
<td>U.S. jurisdiction</td>
<td>2019</td>
<td>2020</td>
<td>2021</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">1</th>
<td>Total</td>
<td>8,900</td>
<td>7,173</td>
<td>7,860</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">2</th>
<td>Alabama</td>
<td>87</td>
<td>72</td>
<td>92</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">3</th>
<td>Alaska</td>
<td>58</td>
<td>58</td>
<td>58</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">4</th>
<td>Arizona</td>
<td>183</td>
<td>136</td>
<td>129</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>You may notice some strange things about this table: what’s up with the “Unnamed” column names and the first row?</p>
<p>Congratulations — you’re ready to wrangle your data! Because of how things are stored, we’ll need to clean the data a bit to name our columns better.</p>
<p>A reasonable first step is to identify the row with the right header. The <code>pd.read_csv()</code> function (<a href="https://pandas.pydata.org/docs/reference/api/pandas.read_csv.html">documentation</a>) has the convenient <code>header</code> parameter that we can set to use the elements in row 1 as the appropriate columns:</p>
<div id="fc92696d" class="cell" data-execution_count="25">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb39"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>tb_df <span class="op">=</span> pd.read_csv(<span class="st">"data/cdc_tuberculosis.csv"</span>, header<span class="op">=</span><span class="dv">1</span>) <span class="co"># row index</span></span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>tb_df.head(<span class="dv">5</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display" data-execution_count="25">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">U.S. jurisdiction</th>
<th data-quarto-table-cell-role="th">2019</th>
<th data-quarto-table-cell-role="th">2020</th>
<th data-quarto-table-cell-role="th">2021</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<th data-quarto-table-cell-role="th">0</th>
<td>Total</td>
<td>8,900</td>
<td>7,173</td>
<td>7,860</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">1</th>
<td>Alabama</td>
<td>87</td>
<td>72</td>
<td>92</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">2</th>
<td>Alaska</td>
<td>58</td>
<td>58</td>
<td>58</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">3</th>
<td>Arizona</td>
<td>183</td>
<td>136</td>
<td>129</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">4</th>
<td>Arkansas</td>
<td>64</td>
<td>59</td>
<td>69</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
<section id="record-granularity" class="level3" data-number="5.4.2">
<h3 data-number="5.4.2" class="anchored" data-anchor-id="record-granularity"><span class="header-section-number">5.4.2</span> Record Granularity</h3>
<p>You might already be wondering: what’s up with that first record?</p>
<p>Row 0 is what we call a <strong>rollup record</strong>, or summary record. It’s often useful when displaying tables to humans. The <strong>granularity</strong> of record 0 (Totals) vs the rest of the records (States) is different.</p>
<p>Okay, EDA step two. How was the rollup record aggregated?</p>
<p>Let’s check if Total TB cases is the sum of all state TB cases. If we sum over all rows, we should get <strong>2x</strong> the total cases in each of our TB cases by year (why do you think this is?).</p>
<div id="86abd343" class="cell" data-execution_count="26">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb40"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>tb_df.<span class="bu">sum</span>(axis<span class="op">=</span><span class="dv">0</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="26">
<pre><code>U.S. jurisdiction    TotalAlabamaAlaskaArizonaArkansasCaliforniaCol...
2019                 8,9008758183642,111666718245583029973261085237...
2020                 7,1737258136591,706525417194122219282169239376...
2021                 7,8609258129691,750585443194992281064255127494...
dtype: object</code></pre>
</div>
</div>
<p>Whoa, what’s going on with the TB cases in 2019, 2020, and 2021? Check out the column types:</p>
<div id="9ce6af29" class="cell" data-execution_count="27">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb42"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>tb_df.dtypes</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="27">
<pre><code>U.S. jurisdiction    object
2019                 object
2020                 object
2021                 object
dtype: object</code></pre>
</div>
</div>
<p>Since there are commas in the values for TB cases, the numbers are read as the <code>object</code> datatype, or <strong>storage type</strong> (close to the <code>Python</code> string datatype), so <code>pandas</code> is concatenating strings instead of adding integers (recall that Python can “sum”, or concatenate, strings together: <code>"data" + "100"</code> evaluates to <code>"data100"</code>).</p>
<p>Fortunately <code>read_csv</code> also has a <code>thousands</code> parameter (<a href="https://pandas.pydata.org/docs/reference/api/pandas.read_csv.html">documentation</a>):</p>
<div id="912d4a33" class="cell" data-execution_count="28">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb44"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="co"># improve readability: chaining method calls with outer parentheses/line breaks</span></span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>tb_df <span class="op">=</span> (</span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a>    pd.read_csv(<span class="st">"data/cdc_tuberculosis.csv"</span>, header<span class="op">=</span><span class="dv">1</span>, thousands<span class="op">=</span><span class="st">','</span>)</span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true" tabindex="-1"></a>tb_df.head(<span class="dv">5</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display" data-execution_count="28">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">U.S. jurisdiction</th>
<th data-quarto-table-cell-role="th">2019</th>
<th data-quarto-table-cell-role="th">2020</th>
<th data-quarto-table-cell-role="th">2021</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<th data-quarto-table-cell-role="th">0</th>
<td>Total</td>
<td>8900</td>
<td>7173</td>
<td>7860</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">1</th>
<td>Alabama</td>
<td>87</td>
<td>72</td>
<td>92</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">2</th>
<td>Alaska</td>
<td>58</td>
<td>58</td>
<td>58</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">3</th>
<td>Arizona</td>
<td>183</td>
<td>136</td>
<td>129</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">4</th>
<td>Arkansas</td>
<td>64</td>
<td>59</td>
<td>69</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div id="ef02c986" class="cell" data-execution_count="29">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb45"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a>tb_df.<span class="bu">sum</span>()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display" data-execution_count="29">
<pre><code>U.S. jurisdiction    TotalAlabamaAlaskaArizonaArkansasCaliforniaCol...
2019                                                             17800
2020                                                             14346
2021                                                             15720
dtype: object</code></pre>
</div>
</div>
<p>The total TB cases look right. Phew!</p>
<p>Let’s just look at the records with <strong>state-level granularity</strong>:</p>
<div id="fb13f242" class="cell" data-execution_count="30">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb47"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a>state_tb_df <span class="op">=</span> tb_df[<span class="dv">1</span>:]</span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a>state_tb_df.head(<span class="dv">5</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="30">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">U.S. jurisdiction</th>
<th data-quarto-table-cell-role="th">2019</th>
<th data-quarto-table-cell-role="th">2020</th>
<th data-quarto-table-cell-role="th">2021</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<th data-quarto-table-cell-role="th">1</th>
<td>Alabama</td>
<td>87</td>
<td>72</td>
<td>92</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">2</th>
<td>Alaska</td>
<td>58</td>
<td>58</td>
<td>58</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">3</th>
<td>Arizona</td>
<td>183</td>
<td>136</td>
<td>129</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">4</th>
<td>Arkansas</td>
<td>64</td>
<td>59</td>
<td>69</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">5</th>
<td>California</td>
<td>2111</td>
<td>1706</td>
<td>1750</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
<section id="gather-census-data" class="level3" data-number="5.4.3">
<h3 data-number="5.4.3" class="anchored" data-anchor-id="gather-census-data"><span class="header-section-number">5.4.3</span> Gather Census Data</h3>
<p>U.S. Census population estimates <a href="https://www.census.gov/data/tables/time-series/demo/popest/2010s-state-total.html">source</a> (2019), <a href="https://www.census.gov/data/tables/time-series/demo/popest/2020s-state-total.html">source</a> (2020-2024).</p>
<p>Running the below cells cleans the data. There are a few new methods here:</p>
<ul>
<li><code>df.convert_dtypes()</code> (<a href="https://pandas.pydata.org/docs/reference/api/pandas.DataFrame.convert_dtypes.html">documentation</a>) conveniently converts all float dtypes into ints and is out of scope for the class.</li>
<li><code>df.drop_na()</code> (<a href="https://pandas.pydata.org/docs/reference/api/pandas.DataFrame.dropna.html">documentation</a>) will be explained in more detail next time.</li>
</ul>
<div id="e82f0d53" class="cell" data-execution_count="31">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb48"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 2010s census data</span></span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a>census_2010s_df <span class="op">=</span> pd.read_csv(<span class="st">"data/nst-est2019-01.csv"</span>, header<span class="op">=</span><span class="dv">3</span>, thousands<span class="op">=</span><span class="st">","</span>)</span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a>census_2010s_df <span class="op">=</span> (</span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a>    census_2010s_df</span>
<span id="cb48-5"><a href="#cb48-5" aria-hidden="true" tabindex="-1"></a>    .rename(columns<span class="op">=</span>{<span class="st">"Unnamed: 0"</span>: <span class="st">"Geographic Area"</span>})</span>
<span id="cb48-6"><a href="#cb48-6" aria-hidden="true" tabindex="-1"></a>    .drop(columns<span class="op">=</span>[<span class="st">"Census"</span>, <span class="st">"Estimates Base"</span>])</span>
<span id="cb48-7"><a href="#cb48-7" aria-hidden="true" tabindex="-1"></a>    .convert_dtypes() <span class="co"># "smart" converting of columns to int, use at your own risk</span></span>
<span id="cb48-8"><a href="#cb48-8" aria-hidden="true" tabindex="-1"></a>    .dropna()  <span class="co"># we'll introduce this very soon</span></span>
<span id="cb48-9"><a href="#cb48-9" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb48-10"><a href="#cb48-10" aria-hidden="true" tabindex="-1"></a>census_2010s_df[<span class="st">'Geographic Area'</span>] <span class="op">=</span> census_2010s_df[<span class="st">'Geographic Area'</span>].<span class="bu">str</span>.strip(<span class="st">'.'</span>)</span>
<span id="cb48-11"><a href="#cb48-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-12"><a href="#cb48-12" aria-hidden="true" tabindex="-1"></a><span class="co"># with pd.option_context('display.min_rows', 30): # shows more rows</span></span>
<span id="cb48-13"><a href="#cb48-13" aria-hidden="true" tabindex="-1"></a><span class="co">#     display(census_2010s_df)</span></span>
<span id="cb48-14"><a href="#cb48-14" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb48-15"><a href="#cb48-15" aria-hidden="true" tabindex="-1"></a>census_2010s_df.head(<span class="dv">5</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="31">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Geographic Area</th>
<th data-quarto-table-cell-role="th">2010</th>
<th data-quarto-table-cell-role="th">2011</th>
<th data-quarto-table-cell-role="th">2012</th>
<th data-quarto-table-cell-role="th">2013</th>
<th data-quarto-table-cell-role="th">2014</th>
<th data-quarto-table-cell-role="th">2015</th>
<th data-quarto-table-cell-role="th">2016</th>
<th data-quarto-table-cell-role="th">2017</th>
<th data-quarto-table-cell-role="th">2018</th>
<th data-quarto-table-cell-role="th">2019</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<th data-quarto-table-cell-role="th">0</th>
<td>United States</td>
<td>309321666</td>
<td>311556874</td>
<td>313830990</td>
<td>315993715</td>
<td>318301008</td>
<td>320635163</td>
<td>322941311</td>
<td>324985539</td>
<td>326687501</td>
<td>328239523</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">1</th>
<td>Northeast</td>
<td>55380134</td>
<td>55604223</td>
<td>55775216</td>
<td>55901806</td>
<td>56006011</td>
<td>56034684</td>
<td>56042330</td>
<td>56059240</td>
<td>56046620</td>
<td>55982803</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">2</th>
<td>Midwest</td>
<td>66974416</td>
<td>67157800</td>
<td>67336743</td>
<td>67560379</td>
<td>67745167</td>
<td>67860583</td>
<td>67987540</td>
<td>68126781</td>
<td>68236628</td>
<td>68329004</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">3</th>
<td>South</td>
<td>114866680</td>
<td>116006522</td>
<td>117241208</td>
<td>118364400</td>
<td>119624037</td>
<td>120997341</td>
<td>122351760</td>
<td>123542189</td>
<td>124569433</td>
<td>125580448</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">4</th>
<td>West</td>
<td>72100436</td>
<td>72788329</td>
<td>73477823</td>
<td>74167130</td>
<td>74925793</td>
<td>75742555</td>
<td>76559681</td>
<td>77257329</td>
<td>77834820</td>
<td>78347268</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>Occasionally, you will want to modify code that you have imported. To reimport those modifications you can either use <code>python</code>’s <code>importlib</code> library:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb49"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> importlib <span class="im">import</span> <span class="bu">reload</span></span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a><span class="bu">reload</span>(utils)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>or use <code>iPython</code> magic which will intelligently import code when files change:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb50"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="op">%</span>load_ext autoreload</span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a><span class="op">%</span>autoreload <span class="dv">2</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div id="70d6562f" class="cell" data-execution_count="32">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb51"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="co"># census 2020s data</span></span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a>census_2020s_df <span class="op">=</span> pd.read_csv(<span class="st">"data/NST-EST2024-POP.csv"</span>, header<span class="op">=</span><span class="dv">3</span>, thousands<span class="op">=</span><span class="st">","</span>)</span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a>census_2020s_df <span class="op">=</span> (</span>
<span id="cb51-4"><a href="#cb51-4" aria-hidden="true" tabindex="-1"></a>    census_2020s_df</span>
<span id="cb51-5"><a href="#cb51-5" aria-hidden="true" tabindex="-1"></a>    .drop(columns<span class="op">=</span>[<span class="st">"Unnamed: 1"</span>])</span>
<span id="cb51-6"><a href="#cb51-6" aria-hidden="true" tabindex="-1"></a>    .rename(columns<span class="op">=</span>{<span class="st">"Unnamed: 0"</span>: <span class="st">"Geographic Area"</span>})</span>
<span id="cb51-7"><a href="#cb51-7" aria-hidden="true" tabindex="-1"></a>    .loc[:, <span class="st">"Geographic Area"</span>:<span class="st">"2024"</span>] <span class="co"># ignore all the blank extra columns</span></span>
<span id="cb51-8"><a href="#cb51-8" aria-hidden="true" tabindex="-1"></a>    .convert_dtypes()                 <span class="co"># "smart" converting of columns, use at your own risk</span></span>
<span id="cb51-9"><a href="#cb51-9" aria-hidden="true" tabindex="-1"></a>    .dropna()                         <span class="co"># we'll introduce this next ti</span></span>
<span id="cb51-10"><a href="#cb51-10" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb51-11"><a href="#cb51-11" aria-hidden="true" tabindex="-1"></a>census_2020s_df[<span class="st">'Geographic Area'</span>] <span class="op">=</span> census_2020s_df[<span class="st">'Geographic Area'</span>].<span class="bu">str</span>.strip(<span class="st">'.'</span>)</span>
<span id="cb51-12"><a href="#cb51-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-13"><a href="#cb51-13" aria-hidden="true" tabindex="-1"></a>census_2020s_df.head(<span class="dv">5</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="32">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Geographic Area</th>
<th data-quarto-table-cell-role="th">2020</th>
<th data-quarto-table-cell-role="th">2021</th>
<th data-quarto-table-cell-role="th">2022</th>
<th data-quarto-table-cell-role="th">2023</th>
<th data-quarto-table-cell-role="th">2024</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<th data-quarto-table-cell-role="th">0</th>
<td>United States</td>
<td>331577720</td>
<td>332099760</td>
<td>334017321</td>
<td>336806231</td>
<td>340110988</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">1</th>
<td>Northeast</td>
<td>57431458</td>
<td>57252533</td>
<td>57159597</td>
<td>57398303</td>
<td>57832935</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">2</th>
<td>Midwest</td>
<td>68984258</td>
<td>68872831</td>
<td>68903297</td>
<td>69186401</td>
<td>69596584</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">3</th>
<td>South</td>
<td>126476549</td>
<td>127368010</td>
<td>129037849</td>
<td>130893358</td>
<td>132665693</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">4</th>
<td>West</td>
<td>78685455</td>
<td>78606386</td>
<td>78916578</td>
<td>79328169</td>
<td>80015776</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
<section id="joining-data-merging-dataframes" class="level3" data-number="5.4.4">
<h3 data-number="5.4.4" class="anchored" data-anchor-id="joining-data-merging-dataframes"><span class="header-section-number">5.4.4</span> Joining Data (Merging <code>DataFrame</code>s)</h3>
<p>Time to <code>merge</code>! Here we use the <code>DataFrame</code> method <code>df1.merge(right=df2, ...)</code> on <code>DataFrame</code> <code>df1</code> (<a href="https://pandas.pydata.org/docs/reference/api/pandas.DataFrame.merge.html">documentation</a>). Contrast this with the function <code>pd.merge(left=df1, right=df2, ...)</code> (<a href="https://pandas.pydata.org/docs/reference/api/pandas.merge.html?highlight=pandas%20merge#pandas.merge">documentation</a>). Feel free to use either.</p>
<div id="35465013" class="cell" data-execution_count="33">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb52"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a><span class="co"># merge TB DataFrame with two US census DataFrames</span></span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a>tb_census_df <span class="op">=</span> (</span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a>    tb_df</span>
<span id="cb52-4"><a href="#cb52-4" aria-hidden="true" tabindex="-1"></a>    .merge(right<span class="op">=</span>census_2010s_df,</span>
<span id="cb52-5"><a href="#cb52-5" aria-hidden="true" tabindex="-1"></a>           left_on<span class="op">=</span><span class="st">"U.S. jurisdiction"</span>, right_on<span class="op">=</span><span class="st">"Geographic Area"</span>)</span>
<span id="cb52-6"><a href="#cb52-6" aria-hidden="true" tabindex="-1"></a>    .merge(right<span class="op">=</span>census_2020s_df,</span>
<span id="cb52-7"><a href="#cb52-7" aria-hidden="true" tabindex="-1"></a>           left_on<span class="op">=</span><span class="st">"U.S. jurisdiction"</span>, right_on<span class="op">=</span><span class="st">"Geographic Area"</span>)</span>
<span id="cb52-8"><a href="#cb52-8" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb52-9"><a href="#cb52-9" aria-hidden="true" tabindex="-1"></a>tb_census_df.head(<span class="dv">5</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display" data-execution_count="33">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">U.S. jurisdiction</th>
<th data-quarto-table-cell-role="th">2019_x</th>
<th data-quarto-table-cell-role="th">2020_x</th>
<th data-quarto-table-cell-role="th">2021_x</th>
<th data-quarto-table-cell-role="th">Geographic Area_x</th>
<th data-quarto-table-cell-role="th">2010</th>
<th data-quarto-table-cell-role="th">2011</th>
<th data-quarto-table-cell-role="th">2012</th>
<th data-quarto-table-cell-role="th">2013</th>
<th data-quarto-table-cell-role="th">2014</th>
<th data-quarto-table-cell-role="th">2015</th>
<th data-quarto-table-cell-role="th">2016</th>
<th data-quarto-table-cell-role="th">2017</th>
<th data-quarto-table-cell-role="th">2018</th>
<th data-quarto-table-cell-role="th">2019_y</th>
<th data-quarto-table-cell-role="th">Geographic Area_y</th>
<th data-quarto-table-cell-role="th">2020_y</th>
<th data-quarto-table-cell-role="th">2021_y</th>
<th data-quarto-table-cell-role="th">2022</th>
<th data-quarto-table-cell-role="th">2023</th>
<th data-quarto-table-cell-role="th">2024</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<th data-quarto-table-cell-role="th">0</th>
<td>Alabama</td>
<td>87</td>
<td>72</td>
<td>92</td>
<td>Alabama</td>
<td>4785437</td>
<td>4799069</td>
<td>4815588</td>
<td>4830081</td>
<td>4841799</td>
<td>4852347</td>
<td>4863525</td>
<td>4874486</td>
<td>4887681</td>
<td>4903185</td>
<td>Alabama</td>
<td>5033094</td>
<td>5049196</td>
<td>5076181</td>
<td>5117673</td>
<td>5157699</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">1</th>
<td>Alaska</td>
<td>58</td>
<td>58</td>
<td>58</td>
<td>Alaska</td>
<td>713910</td>
<td>722128</td>
<td>730443</td>
<td>737068</td>
<td>736283</td>
<td>737498</td>
<td>741456</td>
<td>739700</td>
<td>735139</td>
<td>731545</td>
<td>Alaska</td>
<td>733017</td>
<td>734420</td>
<td>734442</td>
<td>736510</td>
<td>740133</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">2</th>
<td>Arizona</td>
<td>183</td>
<td>136</td>
<td>129</td>
<td>Arizona</td>
<td>6407172</td>
<td>6472643</td>
<td>6554978</td>
<td>6632764</td>
<td>6730413</td>
<td>6829676</td>
<td>6941072</td>
<td>7044008</td>
<td>7158024</td>
<td>7278717</td>
<td>Arizona</td>
<td>7187135</td>
<td>7274078</td>
<td>7377566</td>
<td>7473027</td>
<td>7582384</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">3</th>
<td>Arkansas</td>
<td>64</td>
<td>59</td>
<td>69</td>
<td>Arkansas</td>
<td>2921964</td>
<td>2940667</td>
<td>2952164</td>
<td>2959400</td>
<td>2967392</td>
<td>2978048</td>
<td>2989918</td>
<td>3001345</td>
<td>3009733</td>
<td>3017804</td>
<td>Arkansas</td>
<td>3014546</td>
<td>3026870</td>
<td>3047704</td>
<td>3069463</td>
<td>3088354</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">4</th>
<td>California</td>
<td>2111</td>
<td>1706</td>
<td>1750</td>
<td>California</td>
<td>37319502</td>
<td>37638369</td>
<td>37948800</td>
<td>38260787</td>
<td>38596972</td>
<td>38918045</td>
<td>39167117</td>
<td>39358497</td>
<td>39461588</td>
<td>39512223</td>
<td>California</td>
<td>39521958</td>
<td>39142565</td>
<td>39142414</td>
<td>39198693</td>
<td>39431263</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>We’re only interested in the population for the years 2019, 2020, and 2021, so let’s select just those columns:</p>
<div id="1dfdbba5" class="cell" data-execution_count="34">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb53"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a>census_2019_df <span class="op">=</span> census_2010s_df[[<span class="st">'Geographic Area'</span>, <span class="st">'2019'</span>]]</span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a>census_2020_2021_df <span class="op">=</span> census_2020s_df[[<span class="st">'Geographic Area'</span>, <span class="st">'2020'</span>, <span class="st">'2021'</span>]]</span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-4"><a href="#cb53-4" aria-hidden="true" tabindex="-1"></a>display(tb_df.tail(<span class="dv">2</span>))</span>
<span id="cb53-5"><a href="#cb53-5" aria-hidden="true" tabindex="-1"></a>display(census_2019_df.tail(<span class="dv">2</span>))</span>
<span id="cb53-6"><a href="#cb53-6" aria-hidden="true" tabindex="-1"></a>display(census_2020_2021_df.tail(<span class="dv">2</span>))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">U.S. jurisdiction</th>
<th data-quarto-table-cell-role="th">2019</th>
<th data-quarto-table-cell-role="th">2020</th>
<th data-quarto-table-cell-role="th">2021</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<th data-quarto-table-cell-role="th">50</th>
<td>Wisconsin</td>
<td>51</td>
<td>35</td>
<td>66</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">51</th>
<td>Wyoming</td>
<td>1</td>
<td>0</td>
<td>3</td>
</tr>
</tbody>
</table>

</div>
</div>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Geographic Area</th>
<th data-quarto-table-cell-role="th">2019</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<th data-quarto-table-cell-role="th">55</th>
<td>Wyoming</td>
<td>578759</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">57</th>
<td>Puerto Rico</td>
<td>3193694</td>
</tr>
</tbody>
</table>

</div>
</div>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Geographic Area</th>
<th data-quarto-table-cell-role="th">2020</th>
<th data-quarto-table-cell-role="th">2021</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<th data-quarto-table-cell-role="th">55</th>
<td>Wyoming</td>
<td>577681</td>
<td>579636</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">57</th>
<td>Puerto Rico</td>
<td>3281590</td>
<td>3262711</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>All three dataframes have a column containing U.S. states, along with some other geographic areas. These columns are our <strong>join keys</strong>.</p>
<ul>
<li><p>Below, we use <code>df1.merge(right=df2, ...)</code> to carry out the merge (<a href="https://pandas.pydata.org/docs/reference/api/pandas.DataFrame.merge.html">documentation</a>).</p></li>
<li><p>We could have alternatively used the function <code>pd.merge(left=df1, right=df2, ...)</code> (<a href="https://pandas.pydata.org/docs/reference/api/pandas.merge.html#pandas.merge">documentation</a>).</p></li>
</ul>
<div id="1dfb6a64" class="cell" data-execution_count="35">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb54"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a><span class="co"># merge TB dataframe with two US census dataframes</span></span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a>tb_census_df <span class="op">=</span> (</span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true" tabindex="-1"></a>    tb_df</span>
<span id="cb54-4"><a href="#cb54-4" aria-hidden="true" tabindex="-1"></a>    .merge(right<span class="op">=</span>census_2019_df,</span>
<span id="cb54-5"><a href="#cb54-5" aria-hidden="true" tabindex="-1"></a>           left_on<span class="op">=</span><span class="st">"U.S. jurisdiction"</span>, right_on<span class="op">=</span><span class="st">"Geographic Area"</span>)</span>
<span id="cb54-6"><a href="#cb54-6" aria-hidden="true" tabindex="-1"></a>    .merge(right<span class="op">=</span>census_2020_2021_df,</span>
<span id="cb54-7"><a href="#cb54-7" aria-hidden="true" tabindex="-1"></a>           left_on<span class="op">=</span><span class="st">"U.S. jurisdiction"</span>, right_on<span class="op">=</span><span class="st">"Geographic Area"</span>)</span>
<span id="cb54-8"><a href="#cb54-8" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb54-9"><a href="#cb54-9" aria-hidden="true" tabindex="-1"></a>tb_census_df.tail(<span class="dv">2</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display" data-execution_count="35">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">U.S. jurisdiction</th>
<th data-quarto-table-cell-role="th">2019_x</th>
<th data-quarto-table-cell-role="th">2020_x</th>
<th data-quarto-table-cell-role="th">2021_x</th>
<th data-quarto-table-cell-role="th">Geographic Area_x</th>
<th data-quarto-table-cell-role="th">2019_y</th>
<th data-quarto-table-cell-role="th">Geographic Area_y</th>
<th data-quarto-table-cell-role="th">2020_y</th>
<th data-quarto-table-cell-role="th">2021_y</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<th data-quarto-table-cell-role="th">49</th>
<td>Wisconsin</td>
<td>51</td>
<td>35</td>
<td>66</td>
<td>Wisconsin</td>
<td>5822434</td>
<td>Wisconsin</td>
<td>5897375</td>
<td>5881608</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">50</th>
<td>Wyoming</td>
<td>1</td>
<td>0</td>
<td>3</td>
<td>Wyoming</td>
<td>578759</td>
<td>Wyoming</td>
<td>577681</td>
<td>579636</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>To see what’s going on with the duplicate columns, and the <code>_x</code> and <code>_y</code>, let’s do the just the first merge:</p>
<div id="969a60e9" class="cell" data-execution_count="36">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb55"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a>tb_df.merge(right<span class="op">=</span>census_2019_df, </span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a>            left_on<span class="op">=</span><span class="st">"U.S. jurisdiction"</span>, </span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a>            right_on<span class="op">=</span><span class="st">"Geographic Area"</span>).head()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display" data-execution_count="36">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">U.S. jurisdiction</th>
<th data-quarto-table-cell-role="th">2019_x</th>
<th data-quarto-table-cell-role="th">2020</th>
<th data-quarto-table-cell-role="th">2021</th>
<th data-quarto-table-cell-role="th">Geographic Area</th>
<th data-quarto-table-cell-role="th">2019_y</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<th data-quarto-table-cell-role="th">0</th>
<td>Alabama</td>
<td>87</td>
<td>72</td>
<td>92</td>
<td>Alabama</td>
<td>4903185</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">1</th>
<td>Alaska</td>
<td>58</td>
<td>58</td>
<td>58</td>
<td>Alaska</td>
<td>731545</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">2</th>
<td>Arizona</td>
<td>183</td>
<td>136</td>
<td>129</td>
<td>Arizona</td>
<td>7278717</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">3</th>
<td>Arkansas</td>
<td>64</td>
<td>59</td>
<td>69</td>
<td>Arkansas</td>
<td>3017804</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">4</th>
<td>California</td>
<td>2111</td>
<td>1706</td>
<td>1750</td>
<td>California</td>
<td>39512223</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>Notice that the columns containing the <strong>join keys</strong> have all been retained, and all contain the same values.</p>
<ul>
<li><p>Furthermore, notice that the duplicated columns are appended with <code>_x</code> and <code>_y</code> to keep the column names unique.</p></li>
<li><p>In the TB case count data, column <code>2019</code> represents the number of TB cases in 2019, but in the Census data, column <code>2019</code> represents the U.S. population.</p></li>
</ul>
<p>We can use the <code>suffixes</code> argument to modify the <code>_x</code> and <code>_y</code> defaults to our liking (<a href="https://pandas.pydata.org/docs/reference/api/pandas.merge.html#pandas.merge">documentation</a>).</p>
<div id="b6275c4f" class="cell" data-execution_count="37">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb56"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Specify the suffixes to use for duplicated column names</span></span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a>tb_df.merge(right<span class="op">=</span>census_2019_df,</span>
<span id="cb56-3"><a href="#cb56-3" aria-hidden="true" tabindex="-1"></a>           left_on<span class="op">=</span><span class="st">"U.S. jurisdiction"</span>, </span>
<span id="cb56-4"><a href="#cb56-4" aria-hidden="true" tabindex="-1"></a>           right_on<span class="op">=</span><span class="st">"Geographic Area"</span>,</span>
<span id="cb56-5"><a href="#cb56-5" aria-hidden="true" tabindex="-1"></a>           suffixes<span class="op">=</span>(<span class="st">'_cases'</span>, <span class="st">'_population'</span>)).head()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display" data-execution_count="37">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">U.S. jurisdiction</th>
<th data-quarto-table-cell-role="th">2019_cases</th>
<th data-quarto-table-cell-role="th">2020</th>
<th data-quarto-table-cell-role="th">2021</th>
<th data-quarto-table-cell-role="th">Geographic Area</th>
<th data-quarto-table-cell-role="th">2019_population</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<th data-quarto-table-cell-role="th">0</th>
<td>Alabama</td>
<td>87</td>
<td>72</td>
<td>92</td>
<td>Alabama</td>
<td>4903185</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">1</th>
<td>Alaska</td>
<td>58</td>
<td>58</td>
<td>58</td>
<td>Alaska</td>
<td>731545</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">2</th>
<td>Arizona</td>
<td>183</td>
<td>136</td>
<td>129</td>
<td>Arizona</td>
<td>7278717</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">3</th>
<td>Arkansas</td>
<td>64</td>
<td>59</td>
<td>69</td>
<td>Arkansas</td>
<td>3017804</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">4</th>
<td>California</td>
<td>2111</td>
<td>1706</td>
<td>1750</td>
<td>California</td>
<td>39512223</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>Notice the <code>_x</code> and <code>_y</code> have changed to <code>_cases</code> and <code>_population</code>, just like we specified.</p>
<p>Putting it all together, and dropping the duplicated <code>Geographic Area</code> columns:</p>
<div id="1e85a7fb" class="cell" data-execution_count="38">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb57"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Redux: merge TB dataframe with two US census dataframes</span></span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a>tb_census_df <span class="op">=</span> (</span>
<span id="cb57-3"><a href="#cb57-3" aria-hidden="true" tabindex="-1"></a>    tb_df</span>
<span id="cb57-4"><a href="#cb57-4" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb57-5"><a href="#cb57-5" aria-hidden="true" tabindex="-1"></a>    .merge(right<span class="op">=</span>census_2019_df,</span>
<span id="cb57-6"><a href="#cb57-6" aria-hidden="true" tabindex="-1"></a>           left_on<span class="op">=</span><span class="st">"U.S. jurisdiction"</span>, right_on<span class="op">=</span><span class="st">"Geographic Area"</span>,</span>
<span id="cb57-7"><a href="#cb57-7" aria-hidden="true" tabindex="-1"></a>           suffixes<span class="op">=</span>(<span class="st">'_cases'</span>, <span class="st">'_population'</span>))</span>
<span id="cb57-8"><a href="#cb57-8" aria-hidden="true" tabindex="-1"></a>    .drop(columns<span class="op">=</span><span class="st">"Geographic Area"</span>)</span>
<span id="cb57-9"><a href="#cb57-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-10"><a href="#cb57-10" aria-hidden="true" tabindex="-1"></a>    .merge(right<span class="op">=</span>census_2020_2021_df,</span>
<span id="cb57-11"><a href="#cb57-11" aria-hidden="true" tabindex="-1"></a>           left_on<span class="op">=</span><span class="st">"U.S. jurisdiction"</span>, right_on<span class="op">=</span><span class="st">"Geographic Area"</span>,</span>
<span id="cb57-12"><a href="#cb57-12" aria-hidden="true" tabindex="-1"></a>           suffixes<span class="op">=</span>(<span class="st">'_cases'</span>, <span class="st">'_population'</span>))</span>
<span id="cb57-13"><a href="#cb57-13" aria-hidden="true" tabindex="-1"></a>    .drop(columns<span class="op">=</span><span class="st">"Geographic Area"</span>)</span>
<span id="cb57-14"><a href="#cb57-14" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb57-15"><a href="#cb57-15" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb57-16"><a href="#cb57-16" aria-hidden="true" tabindex="-1"></a>tb_census_df.tail(<span class="dv">2</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display" data-execution_count="38">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">U.S. jurisdiction</th>
<th data-quarto-table-cell-role="th">2019_cases</th>
<th data-quarto-table-cell-role="th">2020_cases</th>
<th data-quarto-table-cell-role="th">2021_cases</th>
<th data-quarto-table-cell-role="th">2019_population</th>
<th data-quarto-table-cell-role="th">2020_population</th>
<th data-quarto-table-cell-role="th">2021_population</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<th data-quarto-table-cell-role="th">49</th>
<td>Wisconsin</td>
<td>51</td>
<td>35</td>
<td>66</td>
<td>5822434</td>
<td>5897375</td>
<td>5881608</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">50</th>
<td>Wyoming</td>
<td>1</td>
<td>0</td>
<td>3</td>
<td>578759</td>
<td>577681</td>
<td>579636</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
<section id="reproducing-data-compute-incidence" class="level3" data-number="5.4.5">
<h3 data-number="5.4.5" class="anchored" data-anchor-id="reproducing-data-compute-incidence"><span class="header-section-number">5.4.5</span> Reproducing Data: Compute Incidence</h3>
<p>Let’s see if we can reproduce the original CDC numbers from our augmented dataset of TB case counts and state populations.</p>
<ul>
<li><p>Recall that the nationwide TB incidence was <strong>2.7 in 2019</strong>, <strong>2.2 in 2020</strong>, and <strong>2.4 in 2021</strong>.</p></li>
<li><p>Along the way, we’ll also compute state-level incidence.</p></li>
</ul>
<p>From the <a href="https://www.cdc.gov/mmwr/volumes/71/wr/mm7112a1.htm?s_cid=mm7112a1_w#T1_down">CDC report</a>: TB incidence is computed as “Cases per 100,000 persons using mid-year population estimates from the U.S. Census Bureau.”</p>
<p>Let’s start with a simpler question: What is the per person incidence?</p>
<ul>
<li>In other words, what is the probability that a randomly selected person in the population had TB within a given year?</li>
</ul>
<p><span class="math display">\[\text{TB incidence per person} = \frac{\text{\# TB cases in population}}{\text{Total population size}}\]</span></p>
<p>Let’s calculate per person incidence for 2019:</p>
<div id="cb2b7790" class="cell" data-execution_count="39">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb58"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate per person incidence for 2019</span></span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a>tb_census_df[<span class="st">"per person incidence 2019"</span>] <span class="op">=</span> (</span>
<span id="cb58-3"><a href="#cb58-3" aria-hidden="true" tabindex="-1"></a>    tb_census_df[<span class="st">"2019_cases"</span>]<span class="op">/</span>tb_census_df[<span class="st">"2019_population"</span>]</span>
<span id="cb58-4"><a href="#cb58-4" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb58-5"><a href="#cb58-5" aria-hidden="true" tabindex="-1"></a>tb_census_df</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display" data-execution_count="39">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">U.S. jurisdiction</th>
<th data-quarto-table-cell-role="th">2019_cases</th>
<th data-quarto-table-cell-role="th">2020_cases</th>
<th data-quarto-table-cell-role="th">2021_cases</th>
<th data-quarto-table-cell-role="th">2019_population</th>
<th data-quarto-table-cell-role="th">2020_population</th>
<th data-quarto-table-cell-role="th">2021_population</th>
<th data-quarto-table-cell-role="th">per person incidence 2019</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<th data-quarto-table-cell-role="th">0</th>
<td>Alabama</td>
<td>87</td>
<td>72</td>
<td>92</td>
<td>4903185</td>
<td>5033094</td>
<td>5049196</td>
<td>0.00</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">1</th>
<td>Alaska</td>
<td>58</td>
<td>58</td>
<td>58</td>
<td>731545</td>
<td>733017</td>
<td>734420</td>
<td>0.00</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">2</th>
<td>Arizona</td>
<td>183</td>
<td>136</td>
<td>129</td>
<td>7278717</td>
<td>7187135</td>
<td>7274078</td>
<td>0.00</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">3</th>
<td>Arkansas</td>
<td>64</td>
<td>59</td>
<td>69</td>
<td>3017804</td>
<td>3014546</td>
<td>3026870</td>
<td>0.00</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">4</th>
<td>California</td>
<td>2111</td>
<td>1706</td>
<td>1750</td>
<td>39512223</td>
<td>39521958</td>
<td>39142565</td>
<td>0.00</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">...</th>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">46</th>
<td>Virginia</td>
<td>191</td>
<td>169</td>
<td>161</td>
<td>8535519</td>
<td>8637615</td>
<td>8658910</td>
<td>0.00</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">47</th>
<td>Washington</td>
<td>221</td>
<td>163</td>
<td>199</td>
<td>7614893</td>
<td>7727209</td>
<td>7743760</td>
<td>0.00</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">48</th>
<td>West Virginia</td>
<td>9</td>
<td>13</td>
<td>7</td>
<td>1792147</td>
<td>1791646</td>
<td>1785618</td>
<td>0.00</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">49</th>
<td>Wisconsin</td>
<td>51</td>
<td>35</td>
<td>66</td>
<td>5822434</td>
<td>5897375</td>
<td>5881608</td>
<td>0.00</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">50</th>
<td>Wyoming</td>
<td>1</td>
<td>0</td>
<td>3</td>
<td>578759</td>
<td>577681</td>
<td>579636</td>
<td>0.00</td>
</tr>
</tbody>
</table>

<p>51 rows × 8 columns</p>
</div>
</div>
</div>
<p>TB is really rare in the United States, so per person TB incidence is really low, as expected.</p>
<ul>
<li><p>But, if we were to consider 100,000 people, the probability of seeing a TB case is higher.</p></li>
<li><p>In fact, it would be 100,000 times higher!</p></li>
</ul>
<p><span class="math display">\[\text{TB incidence per 100,000} = \text{100,000} * \text{TB incidence per person}\]</span></p>
<div id="c73221fe" class="cell" data-execution_count="40">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb59"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a><span class="co"># To help read bigger numbers in Python, you can use _ to separate thousands,</span></span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a><span class="co"># akin to using commas. 100_000 is the same as writing 100000, but more readable.</span></span>
<span id="cb59-3"><a href="#cb59-3" aria-hidden="true" tabindex="-1"></a>tb_census_df[<span class="st">"per 100k incidence 2019"</span>] <span class="op">=</span> (</span>
<span id="cb59-4"><a href="#cb59-4" aria-hidden="true" tabindex="-1"></a>    <span class="dv">100_000</span> <span class="op">*</span> tb_census_df[<span class="st">"per person incidence 2019"</span>] </span>
<span id="cb59-5"><a href="#cb59-5" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb59-6"><a href="#cb59-6" aria-hidden="true" tabindex="-1"></a>tb_census_df</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display" data-execution_count="40">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">U.S. jurisdiction</th>
<th data-quarto-table-cell-role="th">2019_cases</th>
<th data-quarto-table-cell-role="th">2020_cases</th>
<th data-quarto-table-cell-role="th">2021_cases</th>
<th data-quarto-table-cell-role="th">2019_population</th>
<th data-quarto-table-cell-role="th">2020_population</th>
<th data-quarto-table-cell-role="th">2021_population</th>
<th data-quarto-table-cell-role="th">per person incidence 2019</th>
<th data-quarto-table-cell-role="th">per 100k incidence 2019</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<th data-quarto-table-cell-role="th">0</th>
<td>Alabama</td>
<td>87</td>
<td>72</td>
<td>92</td>
<td>4903185</td>
<td>5033094</td>
<td>5049196</td>
<td>0.00</td>
<td>1.77</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">1</th>
<td>Alaska</td>
<td>58</td>
<td>58</td>
<td>58</td>
<td>731545</td>
<td>733017</td>
<td>734420</td>
<td>0.00</td>
<td>7.93</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">2</th>
<td>Arizona</td>
<td>183</td>
<td>136</td>
<td>129</td>
<td>7278717</td>
<td>7187135</td>
<td>7274078</td>
<td>0.00</td>
<td>2.51</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">3</th>
<td>Arkansas</td>
<td>64</td>
<td>59</td>
<td>69</td>
<td>3017804</td>
<td>3014546</td>
<td>3026870</td>
<td>0.00</td>
<td>2.12</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">4</th>
<td>California</td>
<td>2111</td>
<td>1706</td>
<td>1750</td>
<td>39512223</td>
<td>39521958</td>
<td>39142565</td>
<td>0.00</td>
<td>5.34</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">...</th>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">46</th>
<td>Virginia</td>
<td>191</td>
<td>169</td>
<td>161</td>
<td>8535519</td>
<td>8637615</td>
<td>8658910</td>
<td>0.00</td>
<td>2.24</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">47</th>
<td>Washington</td>
<td>221</td>
<td>163</td>
<td>199</td>
<td>7614893</td>
<td>7727209</td>
<td>7743760</td>
<td>0.00</td>
<td>2.90</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">48</th>
<td>West Virginia</td>
<td>9</td>
<td>13</td>
<td>7</td>
<td>1792147</td>
<td>1791646</td>
<td>1785618</td>
<td>0.00</td>
<td>0.50</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">49</th>
<td>Wisconsin</td>
<td>51</td>
<td>35</td>
<td>66</td>
<td>5822434</td>
<td>5897375</td>
<td>5881608</td>
<td>0.00</td>
<td>0.88</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">50</th>
<td>Wyoming</td>
<td>1</td>
<td>0</td>
<td>3</td>
<td>578759</td>
<td>577681</td>
<td>579636</td>
<td>0.00</td>
<td>0.17</td>
</tr>
</tbody>
</table>

<p>51 rows × 9 columns</p>
</div>
</div>
</div>
<p>Now we’re seeing more human-readable values.</p>
<ul>
<li>For example, there 5.3 tuberculosis cases for every 100,000 California residents in 2019.</li>
</ul>
<p>To wrap up this exercise, let’s calculate the nationwide incidence of TB in 2019.</p>
<div id="3ce1f7fc" class="cell" data-execution_count="41">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb60"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Recall that the CDC reported an incidence of 2.7 per 100,000 in 2019.</span></span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a>tot_tb_cases_50_states <span class="op">=</span> tb_census_df[<span class="st">"2019_cases"</span>].<span class="bu">sum</span>()</span>
<span id="cb60-3"><a href="#cb60-3" aria-hidden="true" tabindex="-1"></a>tot_pop_50_states <span class="op">=</span> tb_census_df[<span class="st">"2019_population"</span>].<span class="bu">sum</span>()</span>
<span id="cb60-4"><a href="#cb60-4" aria-hidden="true" tabindex="-1"></a>tb_per_100k_50_states <span class="op">=</span> <span class="dv">100_000</span> <span class="op">*</span> tot_tb_cases_50_states <span class="op">/</span> tot_pop_50_states</span>
<span id="cb60-5"><a href="#cb60-5" aria-hidden="true" tabindex="-1"></a>tb_per_100k_50_states</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display" data-execution_count="41">
<pre><code>2.7114346007625656</code></pre>
</div>
</div>
<p>We can use a <code>for</code> loop to compute the incidence for 2019, 2020, and 2021.</p>
<ul>
<li>You’ll notice that we get the same numbers reported by the CDC!</li>
</ul>
<div id="d019a793" class="cell" data-execution_count="42">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb62"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a><span class="co"># f strings (f"...") are a handy way to pass in variables to strings.</span></span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> year <span class="kw">in</span> [<span class="dv">2019</span>, <span class="dv">2020</span>, <span class="dv">2021</span>]:</span>
<span id="cb62-3"><a href="#cb62-3" aria-hidden="true" tabindex="-1"></a>  tot_tb_cases_50_states <span class="op">=</span> tb_census_df[<span class="ss">f"</span><span class="sc">{</span>year<span class="sc">}</span><span class="ss">_cases"</span>].<span class="bu">sum</span>()</span>
<span id="cb62-4"><a href="#cb62-4" aria-hidden="true" tabindex="-1"></a>  tot_pop_50_states <span class="op">=</span> tb_census_df[<span class="ss">f"</span><span class="sc">{</span>year<span class="sc">}</span><span class="ss">_population"</span>].<span class="bu">sum</span>()</span>
<span id="cb62-5"><a href="#cb62-5" aria-hidden="true" tabindex="-1"></a>  tb_per_100k_50_states <span class="op">=</span> <span class="dv">100_000</span> <span class="op">*</span> tot_tb_cases_50_states <span class="op">/</span> tot_pop_50_states</span>
<span id="cb62-6"><a href="#cb62-6" aria-hidden="true" tabindex="-1"></a>  <span class="bu">print</span>(tb_per_100k_50_states)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>2.7114346007625656
2.163293721906285
2.366758711298075</code></pre>
</div>
</div>
</section>
</section>
<section id="summary" class="level2" data-number="5.5">
<h2 data-number="5.5" class="anchored" data-anchor-id="summary"><span class="header-section-number">5.5</span> Summary</h2>
<p>We went over a lot of content this lecture; let’s summarize the most important points:</p>
<section id="dealing-with-missing-values" class="level3" data-number="5.5.1">
<h3 data-number="5.5.1" class="anchored" data-anchor-id="dealing-with-missing-values"><span class="header-section-number">5.5.1</span> Dealing with Missing Values</h3>
<p>There are a few options we can take to deal with missing data:</p>
<ul>
<li>Drop missing records</li>
<li>Keep <code>NaN</code> missing values</li>
<li>Impute using an interpolated column</li>
</ul>
</section>
<section id="eda-and-data-wrangling" class="level3" data-number="5.5.2">
<h3 data-number="5.5.2" class="anchored" data-anchor-id="eda-and-data-wrangling"><span class="header-section-number">5.5.2</span> EDA and Data Wrangling</h3>
<p>There are several ways to approach EDA and Data Wrangling:</p>
<ul>
<li>Examine the <strong>data and metadata</strong>: what is the date, size, organization, and structure of the data?</li>
<li>Examine each <strong>field/attribute/dimension</strong> individually.</li>
<li>Examine pairs of related dimensions (e.g.&nbsp;breaking down grades by major).</li>
<li>Along the way, we can:
<ul>
<li><strong>Visualize</strong> or summarize the data.</li>
<li><strong>Validate assumptions</strong> about data and its collection process. Pay particular attention to when the data was collected.</li>
<li>Identify and <strong>address anomalies</strong>.</li>
<li>Apply data transformations and corrections (we’ll cover this in the upcoming lecture).</li>
<li><strong>Record everything you do!</strong> Developing in Jupyter Notebook promotes <em>reproducibility</em> of your own work!</li>
</ul></li>
</ul>
</section>
</section>
<section id="bonus-eda-demo-2-mauna-loa-co2-data-a-lesson-in-data-faithfulness" class="level2" data-number="5.6">
<h2 data-number="5.6" class="anchored" data-anchor-id="bonus-eda-demo-2-mauna-loa-co2-data-a-lesson-in-data-faithfulness"><span class="header-section-number">5.6</span> [BONUS] EDA Demo 2: Mauna Loa CO<sub>2</sub> Data – A Lesson in Data Faithfulness</h2>
<p>We no longer cover the following demo in lecture, but we provide the following section in the course notes for interested students.</p>
<p><a href="https://gml.noaa.gov/ccgg/trends/data.html">Mauna Loa Observatory</a> has been monitoring CO<sub>2</sub> concentrations since 1958.</p>
<div id="0a3ba208" class="cell" data-execution_count="43">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb64"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a>co2_file <span class="op">=</span> <span class="st">"data/co2_mm_mlo.txt"</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>Let’s do some <strong>EDA</strong>!!</p>
<section id="reading-this-file-into-pandas" class="level3" data-number="5.6.1">
<h3 data-number="5.6.1" class="anchored" data-anchor-id="reading-this-file-into-pandas"><span class="header-section-number">5.6.1</span> Reading this file into <code>Pandas</code>?</h3>
<p>Let’s instead check out this <code>.txt</code> file. Some questions to keep in mind: Do we trust this file extension? What structure is it?</p>
<p>Lines 71-78 (inclusive) are shown below:</p>
<pre><code>line number |                            file contents

71          |   #            decimal     average   interpolated    trend    #days
72          |   #             date                             (season corr)
73          |   1958   3    1958.208      315.71      315.71      314.62     -1
74          |   1958   4    1958.292      317.45      317.45      315.29     -1
75          |   1958   5    1958.375      317.50      317.50      314.71     -1
76          |   1958   6    1958.458      -99.99      317.10      314.85     -1
77          |   1958   7    1958.542      315.86      315.86      314.98     -1
78          |   1958   8    1958.625      314.93      314.93      315.94     -1</code></pre>
<p>Notice how:</p>
<ul>
<li>The values are separated by white space, possibly tabs.</li>
<li>The data line up down the rows. For example, the month appears in 7th to 8th position of each line.</li>
<li>The 71st and 72nd lines in the file contain column headings split over two lines.</li>
</ul>
<p>We can use&nbsp;<code>read_csv</code>&nbsp;to read the data into a <code>pandas</code> <code>DataFrame</code>, and we provide several arguments to specify that the separators are white space, there is no header (<strong>we will set our own column names</strong>), and to skip the first 72 rows of the file.</p>
<div id="6813f77e" class="cell" data-execution_count="44">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb66"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a>co2 <span class="op">=</span> pd.read_csv(</span>
<span id="cb66-2"><a href="#cb66-2" aria-hidden="true" tabindex="-1"></a>    co2_file, header <span class="op">=</span> <span class="va">None</span>, skiprows <span class="op">=</span> <span class="dv">72</span>,</span>
<span id="cb66-3"><a href="#cb66-3" aria-hidden="true" tabindex="-1"></a>    sep <span class="op">=</span> <span class="vs">r'</span><span class="dv">\s</span><span class="op">+</span><span class="vs">'</span>       <span class="co">#delimiter for continuous whitespace (stay tuned for regex next lecture))</span></span>
<span id="cb66-4"><a href="#cb66-4" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb66-5"><a href="#cb66-5" aria-hidden="true" tabindex="-1"></a>co2.head()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display" data-execution_count="44">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">0</th>
<th data-quarto-table-cell-role="th">1</th>
<th data-quarto-table-cell-role="th">2</th>
<th data-quarto-table-cell-role="th">3</th>
<th data-quarto-table-cell-role="th">4</th>
<th data-quarto-table-cell-role="th">5</th>
<th data-quarto-table-cell-role="th">6</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<th data-quarto-table-cell-role="th">0</th>
<td>1958</td>
<td>3</td>
<td>1958.21</td>
<td>315.71</td>
<td>315.71</td>
<td>314.62</td>
<td>-1</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">1</th>
<td>1958</td>
<td>4</td>
<td>1958.29</td>
<td>317.45</td>
<td>317.45</td>
<td>315.29</td>
<td>-1</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">2</th>
<td>1958</td>
<td>5</td>
<td>1958.38</td>
<td>317.50</td>
<td>317.50</td>
<td>314.71</td>
<td>-1</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">3</th>
<td>1958</td>
<td>6</td>
<td>1958.46</td>
<td>-99.99</td>
<td>317.10</td>
<td>314.85</td>
<td>-1</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">4</th>
<td>1958</td>
<td>7</td>
<td>1958.54</td>
<td>315.86</td>
<td>315.86</td>
<td>314.98</td>
<td>-1</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>Congratulations! You’ve wrangled the data!</p>
<p><br></p>
<p>…But our columns aren’t named. <strong>We need to do more EDA.</strong></p>
</section>
<section id="exploring-variable-feature-types" class="level3" data-number="5.6.2">
<h3 data-number="5.6.2" class="anchored" data-anchor-id="exploring-variable-feature-types"><span class="header-section-number">5.6.2</span> Exploring Variable Feature Types</h3>
<p>The NOAA <a href="https://gml.noaa.gov/ccgg/trends/">webpage</a> might have some useful tidbits (in this case it doesn’t).</p>
<p>Using this information, we’ll rerun <code>pd.read_csv</code>, but this time with some <strong>custom column names.</strong></p>
<div id="5730851b" class="cell" data-execution_count="45">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb67"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a>co2 <span class="op">=</span> pd.read_csv(</span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true" tabindex="-1"></a>    co2_file, header <span class="op">=</span> <span class="va">None</span>, skiprows <span class="op">=</span> <span class="dv">72</span>,</span>
<span id="cb67-3"><a href="#cb67-3" aria-hidden="true" tabindex="-1"></a>    sep <span class="op">=</span> <span class="vs">r'</span><span class="dv">\s</span><span class="op">+</span><span class="vs">'</span>, <span class="co">#regex for continuous whitespace (next lecture)</span></span>
<span id="cb67-4"><a href="#cb67-4" aria-hidden="true" tabindex="-1"></a>    names <span class="op">=</span> [<span class="st">'Yr'</span>, <span class="st">'Mo'</span>, <span class="st">'DecDate'</span>, <span class="st">'Avg'</span>, <span class="st">'Int'</span>, <span class="st">'Trend'</span>, <span class="st">'Days'</span>]</span>
<span id="cb67-5"><a href="#cb67-5" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb67-6"><a href="#cb67-6" aria-hidden="true" tabindex="-1"></a>co2.head()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display" data-execution_count="45">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Yr</th>
<th data-quarto-table-cell-role="th">Mo</th>
<th data-quarto-table-cell-role="th">DecDate</th>
<th data-quarto-table-cell-role="th">Avg</th>
<th data-quarto-table-cell-role="th">Int</th>
<th data-quarto-table-cell-role="th">Trend</th>
<th data-quarto-table-cell-role="th">Days</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<th data-quarto-table-cell-role="th">0</th>
<td>1958</td>
<td>3</td>
<td>1958.21</td>
<td>315.71</td>
<td>315.71</td>
<td>314.62</td>
<td>-1</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">1</th>
<td>1958</td>
<td>4</td>
<td>1958.29</td>
<td>317.45</td>
<td>317.45</td>
<td>315.29</td>
<td>-1</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">2</th>
<td>1958</td>
<td>5</td>
<td>1958.38</td>
<td>317.50</td>
<td>317.50</td>
<td>314.71</td>
<td>-1</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">3</th>
<td>1958</td>
<td>6</td>
<td>1958.46</td>
<td>-99.99</td>
<td>317.10</td>
<td>314.85</td>
<td>-1</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">4</th>
<td>1958</td>
<td>7</td>
<td>1958.54</td>
<td>315.86</td>
<td>315.86</td>
<td>314.98</td>
<td>-1</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
<section id="visualizing-co2" class="level3" data-number="5.6.3">
<h3 data-number="5.6.3" class="anchored" data-anchor-id="visualizing-co2"><span class="header-section-number">5.6.3</span> Visualizing CO<sub>2</sub></h3>
<p>Scientific studies tend to have very clean data, right…? Let’s jump right in and make a time series plot of CO<sub>2</sub> monthly averages.</p>
<div id="31400863" class="cell" data-execution_count="46">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb68"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a>sns.lineplot(x<span class="op">=</span><span class="st">'DecDate'</span>, y<span class="op">=</span><span class="st">'Avg'</span>, data<span class="op">=</span>co2)<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="eda_files/figure-html/cell-47-output-1.png" width="1006" height="749" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<p>The code above uses the <code>seaborn</code> plotting library (abbreviated <code>sns</code>). We will cover this in the Visualization lecture, but now you don’t need to worry about how it works!</p>
<p>Yikes! Plotting the data uncovered a problem. The sharp vertical lines suggest that we have some <strong>missing values</strong>. What happened here?</p>
<div id="8acfc151" class="cell" data-execution_count="47">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb69"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a>co2.head()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display" data-execution_count="47">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Yr</th>
<th data-quarto-table-cell-role="th">Mo</th>
<th data-quarto-table-cell-role="th">DecDate</th>
<th data-quarto-table-cell-role="th">Avg</th>
<th data-quarto-table-cell-role="th">Int</th>
<th data-quarto-table-cell-role="th">Trend</th>
<th data-quarto-table-cell-role="th">Days</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<th data-quarto-table-cell-role="th">0</th>
<td>1958</td>
<td>3</td>
<td>1958.21</td>
<td>315.71</td>
<td>315.71</td>
<td>314.62</td>
<td>-1</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">1</th>
<td>1958</td>
<td>4</td>
<td>1958.29</td>
<td>317.45</td>
<td>317.45</td>
<td>315.29</td>
<td>-1</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">2</th>
<td>1958</td>
<td>5</td>
<td>1958.38</td>
<td>317.50</td>
<td>317.50</td>
<td>314.71</td>
<td>-1</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">3</th>
<td>1958</td>
<td>6</td>
<td>1958.46</td>
<td>-99.99</td>
<td>317.10</td>
<td>314.85</td>
<td>-1</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">4</th>
<td>1958</td>
<td>7</td>
<td>1958.54</td>
<td>315.86</td>
<td>315.86</td>
<td>314.98</td>
<td>-1</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div id="2e5c4a66" class="cell" data-execution_count="48">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb70"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a>co2.tail()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display" data-execution_count="48">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Yr</th>
<th data-quarto-table-cell-role="th">Mo</th>
<th data-quarto-table-cell-role="th">DecDate</th>
<th data-quarto-table-cell-role="th">Avg</th>
<th data-quarto-table-cell-role="th">Int</th>
<th data-quarto-table-cell-role="th">Trend</th>
<th data-quarto-table-cell-role="th">Days</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<th data-quarto-table-cell-role="th">733</th>
<td>2019</td>
<td>4</td>
<td>2019.29</td>
<td>413.32</td>
<td>413.32</td>
<td>410.49</td>
<td>26</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">734</th>
<td>2019</td>
<td>5</td>
<td>2019.38</td>
<td>414.66</td>
<td>414.66</td>
<td>411.20</td>
<td>28</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">735</th>
<td>2019</td>
<td>6</td>
<td>2019.46</td>
<td>413.92</td>
<td>413.92</td>
<td>411.58</td>
<td>27</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">736</th>
<td>2019</td>
<td>7</td>
<td>2019.54</td>
<td>411.77</td>
<td>411.77</td>
<td>411.43</td>
<td>23</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">737</th>
<td>2019</td>
<td>8</td>
<td>2019.62</td>
<td>409.95</td>
<td>409.95</td>
<td>411.84</td>
<td>29</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>Some data have unusual values like -1 and -99.99.</p>
<p>Let’s check the description at the top of the file again.</p>
<ul>
<li>-1 signifies a missing value for the number of days <code>Days</code> the equipment was in operation that month.</li>
<li>-99.99 denotes a missing monthly average <code>Avg</code></li>
</ul>
<p>How can we fix this? First, let’s explore other aspects of our data. Understanding our data will help us decide what to do with the missing values.</p>
<p><br></p>
</section>
<section id="sanity-checks-reasoning-about-the-data" class="level3" data-number="5.6.4">
<h3 data-number="5.6.4" class="anchored" data-anchor-id="sanity-checks-reasoning-about-the-data"><span class="header-section-number">5.6.4</span> Sanity Checks: Reasoning about the data</h3>
<p>First, we consider the shape of the data. How many rows should we have?</p>
<ul>
<li>If chronological order, we should have one record per month.</li>
<li>Data from March 1958 to August 2019.</li>
<li>We should have $ 12 (2019-1957) - 2 - 4 = 738 $ records.</li>
</ul>
<div id="74b8400d" class="cell" data-execution_count="49">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb71"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a>co2.shape</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display" data-execution_count="49">
<pre><code>(738, 7)</code></pre>
</div>
</div>
<p>Nice!! The number of rows (i.e.&nbsp;records) match our expectations.</p>
<p>Let’s now check the quality of each feature.</p>
</section>
<section id="understanding-missing-value-1-days" class="level3" data-number="5.6.5">
<h3 data-number="5.6.5" class="anchored" data-anchor-id="understanding-missing-value-1-days"><span class="header-section-number">5.6.5</span> Understanding Missing Value 1: <code>Days</code></h3>
<p><code>Days</code> is a time field, so let’s analyze other time fields to see if there is an explanation for missing values of days of operation.</p>
<p>Let’s start with <strong>months</strong>, <code>Mo</code>.</p>
<p>Are we missing any records? The number of months should have 62 or 61 instances (March 1957-August 2019).</p>
<div id="4da05006" class="cell" data-execution_count="50">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb73"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a>co2[<span class="st">"Mo"</span>].value_counts().sort_index()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display" data-execution_count="50">
<pre><code>Mo
1     61
2     61
3     62
4     62
5     62
6     62
7     62
8     62
9     61
10    61
11    61
12    61
Name: count, dtype: int64</code></pre>
</div>
</div>
<p>As expected Jan, Feb, Sep, Oct, Nov, and Dec have 61 occurrences and the rest 62.</p>
<p><br></p>
<p>Next let’s explore <strong>days</strong> <code>Days</code> itself, which is the number of days that the measurement equipment worked.</p>
<div id="e492ce70" class="cell" data-execution_count="51">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb75"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a>sns.displot(co2[<span class="st">'Days'</span>])<span class="op">;</span></span>
<span id="cb75-2"><a href="#cb75-2" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"Distribution of days feature"</span>)<span class="op">;</span> <span class="co"># suppresses unneeded plotting output</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="eda_files/figure-html/cell-52-output-1.png" width="447" height="473" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<p>In terms of data quality, a handful of months have averages based on measurements taken on fewer than half the days. In addition, there are nearly 200 missing values–<strong>that’s about 27% of the data</strong>!</p>
<p><br></p>
<p>Finally, let’s check the last time feature, <strong>year</strong> <code>Yr</code>.</p>
<p>Let’s check to see if there is any connection between missing-ness and the year of the recording.</p>
<div id="af4d5a56" class="cell" data-execution_count="52">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb76"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a>sns.scatterplot(x<span class="op">=</span><span class="st">"Yr"</span>, y<span class="op">=</span><span class="st">"Days"</span>, data<span class="op">=</span>co2)<span class="op">;</span></span>
<span id="cb76-2"><a href="#cb76-2" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"Day field by Year"</span>)<span class="op">;</span> <span class="co"># the ; suppresses output</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="eda_files/figure-html/cell-53-output-1.png" width="981" height="775" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<p><strong>Observations</strong>:</p>
<ul>
<li>All of the missing data are in the early years of operation.</li>
<li>It appears there may have been problems with equipment in the mid to late 80s.</li>
</ul>
<p><strong>Potential Next Steps</strong>:</p>
<ul>
<li>Confirm these explanations through documentation about the historical readings.</li>
<li>Maybe drop the earliest recordings? However, we would want to delay such action until after we have examined the time trends and assess whether there are any potential problems.</li>
</ul>
<p><br></p>
</section>
<section id="understanding-missing-value-2-avg" class="level3" data-number="5.6.6">
<h3 data-number="5.6.6" class="anchored" data-anchor-id="understanding-missing-value-2-avg"><span class="header-section-number">5.6.6</span> Understanding Missing Value 2: <code>Avg</code></h3>
<p>Next, let’s return to the -99.99 values in <code>Avg</code> to analyze the overall quality of the CO<sub>2</sub> measurements. We’ll plot a histogram of the average CO<sub>2</sub> measurements</p>
<div id="49a3595f" class="cell" data-execution_count="53">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb77"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Histograms of average CO2 measurements</span></span>
<span id="cb77-2"><a href="#cb77-2" aria-hidden="true" tabindex="-1"></a>sns.displot(co2[<span class="st">'Avg'</span>])<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="eda_files/figure-html/cell-54-output-1.png" width="447" height="447" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<p>The non-missing values are in the 300-400 range (a regular range of CO<sub>2</sub> levels).</p>
<p>We also see that there are only a few missing <code>Avg</code> values (<strong>&lt;1% of values</strong>). Let’s examine all of them:</p>
<div id="acc0b2ee" class="cell" data-execution_count="54">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb78"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a>co2[co2[<span class="st">"Avg"</span>] <span class="op">&lt;</span> <span class="dv">0</span>]</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display" data-execution_count="54">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Yr</th>
<th data-quarto-table-cell-role="th">Mo</th>
<th data-quarto-table-cell-role="th">DecDate</th>
<th data-quarto-table-cell-role="th">Avg</th>
<th data-quarto-table-cell-role="th">Int</th>
<th data-quarto-table-cell-role="th">Trend</th>
<th data-quarto-table-cell-role="th">Days</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<th data-quarto-table-cell-role="th">3</th>
<td>1958</td>
<td>6</td>
<td>1958.46</td>
<td>-99.99</td>
<td>317.10</td>
<td>314.85</td>
<td>-1</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">7</th>
<td>1958</td>
<td>10</td>
<td>1958.79</td>
<td>-99.99</td>
<td>312.66</td>
<td>315.61</td>
<td>-1</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">71</th>
<td>1964</td>
<td>2</td>
<td>1964.12</td>
<td>-99.99</td>
<td>320.07</td>
<td>319.61</td>
<td>-1</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">72</th>
<td>1964</td>
<td>3</td>
<td>1964.21</td>
<td>-99.99</td>
<td>320.73</td>
<td>319.55</td>
<td>-1</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">73</th>
<td>1964</td>
<td>4</td>
<td>1964.29</td>
<td>-99.99</td>
<td>321.77</td>
<td>319.48</td>
<td>-1</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">213</th>
<td>1975</td>
<td>12</td>
<td>1975.96</td>
<td>-99.99</td>
<td>330.59</td>
<td>331.60</td>
<td>0</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">313</th>
<td>1984</td>
<td>4</td>
<td>1984.29</td>
<td>-99.99</td>
<td>346.84</td>
<td>344.27</td>
<td>2</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>There doesn’t seem to be a pattern to these values, other than that most records also were missing <code>Days</code> data.</p>
</section>
<section id="drop-nan-or-impute-missing-avg-data" class="level3" data-number="5.6.7">
<h3 data-number="5.6.7" class="anchored" data-anchor-id="drop-nan-or-impute-missing-avg-data"><span class="header-section-number">5.6.7</span> Drop, <code>NaN</code>, or Impute Missing <code>Avg</code> Data?</h3>
<p>How should we address the invalid <code>Avg</code> data?</p>
<ol type="1">
<li>Drop records</li>
<li>Set to NaN</li>
<li>Impute using some strategy</li>
</ol>
<p>Remember we want to fix the following plot:</p>
<div id="a702e986" class="cell" data-execution_count="55">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb79"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a>sns.lineplot(x<span class="op">=</span><span class="st">'DecDate'</span>, y<span class="op">=</span><span class="st">'Avg'</span>, data<span class="op">=</span>co2)</span>
<span id="cb79-2"><a href="#cb79-2" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"CO2 Average By Month"</span>)<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="eda_files/figure-html/cell-56-output-1.png" width="1006" height="775" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<p>Since we are plotting <code>Avg</code> vs <code>DecDate</code>, we should just focus on dealing with missing values for <code>Avg</code>.</p>
<p>Let’s consider a few options: 1. Drop those records 2. Replace -99.99 with NaN 3. Substitute it with a likely value for the average CO<sub>2</sub>?</p>
<p>What do you think are the pros and cons of each possible action?</p>
<p>Let’s examine each of these three options.</p>
<div id="3a548967" class="cell" data-execution_count="56">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb80"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 1. Drop missing values</span></span>
<span id="cb80-2"><a href="#cb80-2" aria-hidden="true" tabindex="-1"></a>co2_drop <span class="op">=</span> co2[co2[<span class="st">'Avg'</span>] <span class="op">&gt;</span> <span class="dv">0</span>]</span>
<span id="cb80-3"><a href="#cb80-3" aria-hidden="true" tabindex="-1"></a>co2_drop.head()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display" data-execution_count="56">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Yr</th>
<th data-quarto-table-cell-role="th">Mo</th>
<th data-quarto-table-cell-role="th">DecDate</th>
<th data-quarto-table-cell-role="th">Avg</th>
<th data-quarto-table-cell-role="th">Int</th>
<th data-quarto-table-cell-role="th">Trend</th>
<th data-quarto-table-cell-role="th">Days</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<th data-quarto-table-cell-role="th">0</th>
<td>1958</td>
<td>3</td>
<td>1958.21</td>
<td>315.71</td>
<td>315.71</td>
<td>314.62</td>
<td>-1</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">1</th>
<td>1958</td>
<td>4</td>
<td>1958.29</td>
<td>317.45</td>
<td>317.45</td>
<td>315.29</td>
<td>-1</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">2</th>
<td>1958</td>
<td>5</td>
<td>1958.38</td>
<td>317.50</td>
<td>317.50</td>
<td>314.71</td>
<td>-1</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">4</th>
<td>1958</td>
<td>7</td>
<td>1958.54</td>
<td>315.86</td>
<td>315.86</td>
<td>314.98</td>
<td>-1</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">5</th>
<td>1958</td>
<td>8</td>
<td>1958.62</td>
<td>314.93</td>
<td>314.93</td>
<td>315.94</td>
<td>-1</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div id="b063a7c1" class="cell" data-execution_count="57">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb81"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 2. Replace NaN with -99.99</span></span>
<span id="cb81-2"><a href="#cb81-2" aria-hidden="true" tabindex="-1"></a>co2_NA <span class="op">=</span> co2.replace(<span class="op">-</span><span class="fl">99.99</span>, np.nan)</span>
<span id="cb81-3"><a href="#cb81-3" aria-hidden="true" tabindex="-1"></a>co2_NA.head()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display" data-execution_count="57">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Yr</th>
<th data-quarto-table-cell-role="th">Mo</th>
<th data-quarto-table-cell-role="th">DecDate</th>
<th data-quarto-table-cell-role="th">Avg</th>
<th data-quarto-table-cell-role="th">Int</th>
<th data-quarto-table-cell-role="th">Trend</th>
<th data-quarto-table-cell-role="th">Days</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<th data-quarto-table-cell-role="th">0</th>
<td>1958</td>
<td>3</td>
<td>1958.21</td>
<td>315.71</td>
<td>315.71</td>
<td>314.62</td>
<td>-1</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">1</th>
<td>1958</td>
<td>4</td>
<td>1958.29</td>
<td>317.45</td>
<td>317.45</td>
<td>315.29</td>
<td>-1</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">2</th>
<td>1958</td>
<td>5</td>
<td>1958.38</td>
<td>317.50</td>
<td>317.50</td>
<td>314.71</td>
<td>-1</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">3</th>
<td>1958</td>
<td>6</td>
<td>1958.46</td>
<td>NaN</td>
<td>317.10</td>
<td>314.85</td>
<td>-1</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">4</th>
<td>1958</td>
<td>7</td>
<td>1958.54</td>
<td>315.86</td>
<td>315.86</td>
<td>314.98</td>
<td>-1</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>We’ll also use a third version of the data.</p>
<p>First, we note that the dataset already comes with a <strong>substitute value</strong> for the -99.99.</p>
<p>From the file description:</p>
<blockquote class="blockquote">
<p>The <code>interpolated</code> column includes average values from the preceding column (<code>average</code>) and <strong>interpolated values</strong> where data are missing. Interpolated values are computed in two steps…</p>
</blockquote>
<p>The <code>Int</code> feature has values that exactly match those in <code>Avg</code>, except when <code>Avg</code> is -99.99, and then a <strong>reasonable</strong> estimate is used instead.</p>
<p>So, the third version of our data will use the <code>Int</code> feature instead of <code>Avg</code>.</p>
<div id="f3a1bf3c" class="cell" data-execution_count="58">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb82"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 3. Use interpolated column which estimates missing Avg values</span></span>
<span id="cb82-2"><a href="#cb82-2" aria-hidden="true" tabindex="-1"></a>co2_impute <span class="op">=</span> co2.copy()</span>
<span id="cb82-3"><a href="#cb82-3" aria-hidden="true" tabindex="-1"></a>co2_impute[<span class="st">'Avg'</span>] <span class="op">=</span> co2[<span class="st">'Int'</span>]</span>
<span id="cb82-4"><a href="#cb82-4" aria-hidden="true" tabindex="-1"></a>co2_impute.head()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display" data-execution_count="58">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Yr</th>
<th data-quarto-table-cell-role="th">Mo</th>
<th data-quarto-table-cell-role="th">DecDate</th>
<th data-quarto-table-cell-role="th">Avg</th>
<th data-quarto-table-cell-role="th">Int</th>
<th data-quarto-table-cell-role="th">Trend</th>
<th data-quarto-table-cell-role="th">Days</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<th data-quarto-table-cell-role="th">0</th>
<td>1958</td>
<td>3</td>
<td>1958.21</td>
<td>315.71</td>
<td>315.71</td>
<td>314.62</td>
<td>-1</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">1</th>
<td>1958</td>
<td>4</td>
<td>1958.29</td>
<td>317.45</td>
<td>317.45</td>
<td>315.29</td>
<td>-1</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">2</th>
<td>1958</td>
<td>5</td>
<td>1958.38</td>
<td>317.50</td>
<td>317.50</td>
<td>314.71</td>
<td>-1</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">3</th>
<td>1958</td>
<td>6</td>
<td>1958.46</td>
<td>317.10</td>
<td>317.10</td>
<td>314.85</td>
<td>-1</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">4</th>
<td>1958</td>
<td>7</td>
<td>1958.54</td>
<td>315.86</td>
<td>315.86</td>
<td>314.98</td>
<td>-1</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>What’s a <strong>reasonable</strong> estimate?</p>
<p>To answer this question, let’s zoom in on a short time period, say the measurements in 1958 (where we know we have two missing values).</p>
<div id="a361d5e0" class="cell" data-execution_count="59">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb83"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb83-1"><a href="#cb83-1" aria-hidden="true" tabindex="-1"></a><span class="co"># results of plotting data in 1958</span></span>
<span id="cb83-2"><a href="#cb83-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-3"><a href="#cb83-3" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> line_and_points(data, ax, title):</span>
<span id="cb83-4"><a href="#cb83-4" aria-hidden="true" tabindex="-1"></a>    <span class="co"># assumes single year, hence Mo</span></span>
<span id="cb83-5"><a href="#cb83-5" aria-hidden="true" tabindex="-1"></a>    ax.plot(<span class="st">'Mo'</span>, <span class="st">'Avg'</span>, data<span class="op">=</span>data)</span>
<span id="cb83-6"><a href="#cb83-6" aria-hidden="true" tabindex="-1"></a>    ax.scatter(<span class="st">'Mo'</span>, <span class="st">'Avg'</span>, data<span class="op">=</span>data)</span>
<span id="cb83-7"><a href="#cb83-7" aria-hidden="true" tabindex="-1"></a>    ax.set_xlim(<span class="dv">2</span>, <span class="dv">13</span>)</span>
<span id="cb83-8"><a href="#cb83-8" aria-hidden="true" tabindex="-1"></a>    ax.set_title(title)</span>
<span id="cb83-9"><a href="#cb83-9" aria-hidden="true" tabindex="-1"></a>    ax.set_xticks(np.arange(<span class="dv">3</span>, <span class="dv">13</span>))</span>
<span id="cb83-10"><a href="#cb83-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-11"><a href="#cb83-11" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> data_year(data, year):</span>
<span id="cb83-12"><a href="#cb83-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> data[data[<span class="st">"Yr"</span>] <span class="op">==</span> <span class="dv">1958</span>]</span>
<span id="cb83-13"><a href="#cb83-13" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb83-14"><a href="#cb83-14" aria-hidden="true" tabindex="-1"></a><span class="co"># uses matplotlib subplots</span></span>
<span id="cb83-15"><a href="#cb83-15" aria-hidden="true" tabindex="-1"></a><span class="co"># you may see more next week; focus on output for now</span></span>
<span id="cb83-16"><a href="#cb83-16" aria-hidden="true" tabindex="-1"></a>fig, axes <span class="op">=</span> plt.subplots(ncols <span class="op">=</span> <span class="dv">3</span>, figsize<span class="op">=</span>(<span class="dv">12</span>, <span class="dv">4</span>), sharey<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb83-17"><a href="#cb83-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-18"><a href="#cb83-18" aria-hidden="true" tabindex="-1"></a>year <span class="op">=</span> <span class="dv">1958</span></span>
<span id="cb83-19"><a href="#cb83-19" aria-hidden="true" tabindex="-1"></a>line_and_points(data_year(co2_drop, year), axes[<span class="dv">0</span>], title<span class="op">=</span><span class="st">"1. Drop Missing"</span>)</span>
<span id="cb83-20"><a href="#cb83-20" aria-hidden="true" tabindex="-1"></a>line_and_points(data_year(co2_NA, year), axes[<span class="dv">1</span>], title<span class="op">=</span><span class="st">"2. Missing Set to NaN"</span>)</span>
<span id="cb83-21"><a href="#cb83-21" aria-hidden="true" tabindex="-1"></a>line_and_points(data_year(co2_impute, year), axes[<span class="dv">2</span>], title<span class="op">=</span><span class="st">"3. Missing Interpolated"</span>)</span>
<span id="cb83-22"><a href="#cb83-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-23"><a href="#cb83-23" aria-hidden="true" tabindex="-1"></a>fig.suptitle(<span class="ss">f"Monthly Averages for </span><span class="sc">{</span>year<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb83-24"><a href="#cb83-24" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="eda_files/figure-html/cell-60-output-1.png" width="1119" height="370" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<p>In the big picture since there are only 7 <code>Avg</code> values missing (<strong>&lt;1%</strong> of 738 months), any of these approaches would work.</p>
<p>However there is some appeal to <strong>option C, Imputing</strong>:</p>
<ul>
<li>Shows seasonal trends for CO<sub>2</sub></li>
<li>We are plotting all months in our data as a line plot</li>
</ul>
<p>Let’s replot our original figure with option 3:</p>
<div id="d4607a31" class="cell" data-execution_count="60">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb84"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb84-1"><a href="#cb84-1" aria-hidden="true" tabindex="-1"></a>sns.lineplot(x<span class="op">=</span><span class="st">'DecDate'</span>, y<span class="op">=</span><span class="st">'Avg'</span>, data<span class="op">=</span>co2_impute)</span>
<span id="cb84-2"><a href="#cb84-2" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"CO2 Average By Month, Imputed"</span>)<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="eda_files/figure-html/cell-61-output-1.png" width="993" height="775" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<p>Looks pretty close to what we see on the NOAA <a href="https://gml.noaa.gov/ccgg/trends/">website</a>!</p>
</section>
<section id="presenting-the-data-a-discussion-on-data-granularity" class="level3" data-number="5.6.8">
<h3 data-number="5.6.8" class="anchored" data-anchor-id="presenting-the-data-a-discussion-on-data-granularity"><span class="header-section-number">5.6.8</span> Presenting the Data: A Discussion on Data Granularity</h3>
<p>From the description:</p>
<ul>
<li>Monthly measurements are averages of average day measurements.</li>
<li>The NOAA GML website has datasets for daily/hourly measurements too.</li>
</ul>
<p>The data you present depends on your research question.</p>
<p><strong>How do CO<sub>2</sub> levels vary by season?</strong></p>
<ul>
<li>You might want to keep average monthly data.</li>
</ul>
<p><strong>Are CO<sub>2</sub> levels rising over the past 50+ years, consistent with global warming predictions?</strong></p>
<ul>
<li>You might be happier with a <strong>coarser granularity</strong> of average year data!</li>
</ul>
<div id="a9cb6a3d" class="cell" data-execution_count="61">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb85"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb85-1"><a href="#cb85-1" aria-hidden="true" tabindex="-1"></a>co2_year <span class="op">=</span> co2_impute.groupby(<span class="st">'Yr'</span>).mean()</span>
<span id="cb85-2"><a href="#cb85-2" aria-hidden="true" tabindex="-1"></a>sns.lineplot(x<span class="op">=</span><span class="st">'Yr'</span>, y<span class="op">=</span><span class="st">'Avg'</span>, data<span class="op">=</span>co2_year)</span>
<span id="cb85-3"><a href="#cb85-3" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"CO2 Average By Year"</span>)<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="eda_files/figure-html/cell-62-output-1.png" width="994" height="775" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<p>Indeed, we see a rise by nearly 100 ppm of CO<sub>2</sub> since Mauna Loa began recording in 1958.</p>


<!-- -->

</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
    const viewSource = window.document.getElementById('quarto-view-source') ||
                       window.document.getElementById('quarto-code-tools-source');
    if (viewSource) {
      const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
      viewSource.addEventListener("click", function(e) {
        if (sourceUrl) {
          // rstudio viewer pane
          if (/\bcapabilities=\b/.test(window.location)) {
            window.open(sourceUrl);
          } else {
            window.location.href = sourceUrl;
          }
        } else {
          const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
          modal.show();
        }
        return false;
      });
    }
    function toggleCodeHandler(show) {
      return function(e) {
        const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
        for (let i=0; i<detailsSrc.length; i++) {
          const details = detailsSrc[i].parentElement;
          if (show) {
            details.open = true;
          } else {
            details.removeAttribute("open");
          }
        }
        const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
        const fromCls = show ? "hidden" : "unhidden";
        const toCls = show ? "unhidden" : "hidden";
        for (let i=0; i<cellCodeDivs.length; i++) {
          const codeDiv = cellCodeDivs[i];
          if (codeDiv.classList.contains(fromCls)) {
            codeDiv.classList.remove(fromCls);
            codeDiv.classList.add(toCls);
          } 
        }
        return false;
      }
    }
    const hideAllCode = window.document.getElementById("quarto-hide-all-code");
    if (hideAllCode) {
      hideAllCode.addEventListener("click", toggleCodeHandler(false));
    }
    const showAllCode = window.document.getElementById("quarto-show-all-code");
    if (showAllCode) {
      showAllCode.addEventListener("click", toggleCodeHandler(true));
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
<nav class="page-navigation column-body">
  <div class="nav-page nav-page-previous">
      <a href="../pandas_3/pandas_3.html" class="pagination-link" aria-label="Pandas III">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Pandas III</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="../regex/regex.html" class="pagination-link" aria-label="Regular Expressions">
        <span class="nav-page-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Regular Expressions</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb86" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb86-1"><a href="#cb86-1" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb86-2"><a href="#cb86-2" aria-hidden="true" tabindex="-1"></a><span class="an">title:</span><span class="co"> Data Cleaning and EDA</span></span>
<span id="cb86-3"><a href="#cb86-3" aria-hidden="true" tabindex="-1"></a><span class="an">execute:</span></span>
<span id="cb86-4"><a href="#cb86-4" aria-hidden="true" tabindex="-1"></a><span class="co">  echo: true</span></span>
<span id="cb86-5"><a href="#cb86-5" aria-hidden="true" tabindex="-1"></a><span class="an">format:</span></span>
<span id="cb86-6"><a href="#cb86-6" aria-hidden="true" tabindex="-1"></a><span class="co">  html:</span></span>
<span id="cb86-7"><a href="#cb86-7" aria-hidden="true" tabindex="-1"></a><span class="co">    code-fold: true</span></span>
<span id="cb86-8"><a href="#cb86-8" aria-hidden="true" tabindex="-1"></a><span class="co">    code-tools: true</span></span>
<span id="cb86-9"><a href="#cb86-9" aria-hidden="true" tabindex="-1"></a><span class="co">    toc: true</span></span>
<span id="cb86-10"><a href="#cb86-10" aria-hidden="true" tabindex="-1"></a><span class="co">    toc-title: Data Cleaning and EDA</span></span>
<span id="cb86-11"><a href="#cb86-11" aria-hidden="true" tabindex="-1"></a><span class="co">    page-layout: full</span></span>
<span id="cb86-12"><a href="#cb86-12" aria-hidden="true" tabindex="-1"></a><span class="co">    theme:</span></span>
<span id="cb86-13"><a href="#cb86-13" aria-hidden="true" tabindex="-1"></a><span class="co">      - cosmo</span></span>
<span id="cb86-14"><a href="#cb86-14" aria-hidden="true" tabindex="-1"></a><span class="co">      - cerulean</span></span>
<span id="cb86-15"><a href="#cb86-15" aria-hidden="true" tabindex="-1"></a><span class="co">    callout-icon: false</span></span>
<span id="cb86-16"><a href="#cb86-16" aria-hidden="true" tabindex="-1"></a><span class="an">jupyter:</span><span class="co"> python3</span></span>
<span id="cb86-17"><a href="#cb86-17" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb86-18"><a href="#cb86-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-19"><a href="#cb86-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-22"><a href="#cb86-22" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb86-23"><a href="#cb86-23" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: true</span></span>
<span id="cb86-24"><a href="#cb86-24" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb86-25"><a href="#cb86-25" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb86-26"><a href="#cb86-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-27"><a href="#cb86-27" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb86-28"><a href="#cb86-28" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> seaborn <span class="im">as</span> sns</span>
<span id="cb86-29"><a href="#cb86-29" aria-hidden="true" tabindex="-1"></a><span class="co">#%matplotlib inline</span></span>
<span id="cb86-30"><a href="#cb86-30" aria-hidden="true" tabindex="-1"></a>plt.rcParams[<span class="st">'figure.figsize'</span>] <span class="op">=</span> (<span class="dv">12</span>, <span class="dv">9</span>)</span>
<span id="cb86-31"><a href="#cb86-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-32"><a href="#cb86-32" aria-hidden="true" tabindex="-1"></a>sns.<span class="bu">set</span>()</span>
<span id="cb86-33"><a href="#cb86-33" aria-hidden="true" tabindex="-1"></a>sns.set_context(<span class="st">'talk'</span>)</span>
<span id="cb86-34"><a href="#cb86-34" aria-hidden="true" tabindex="-1"></a>np.set_printoptions(threshold<span class="op">=</span><span class="dv">20</span>, precision<span class="op">=</span><span class="dv">2</span>, suppress<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb86-35"><a href="#cb86-35" aria-hidden="true" tabindex="-1"></a>pd.set_option(<span class="st">'display.max_rows'</span>, <span class="dv">30</span>)</span>
<span id="cb86-36"><a href="#cb86-36" aria-hidden="true" tabindex="-1"></a>pd.set_option(<span class="st">'display.max_columns'</span>, <span class="va">None</span>)</span>
<span id="cb86-37"><a href="#cb86-37" aria-hidden="true" tabindex="-1"></a>pd.set_option(<span class="st">'display.precision'</span>, <span class="dv">2</span>)</span>
<span id="cb86-38"><a href="#cb86-38" aria-hidden="true" tabindex="-1"></a><span class="co"># This option stops scientific notation for pandas</span></span>
<span id="cb86-39"><a href="#cb86-39" aria-hidden="true" tabindex="-1"></a>pd.set_option(<span class="st">'display.float_format'</span>, <span class="st">'</span><span class="sc">{:.2f}</span><span class="st">'</span>.<span class="bu">format</span>)</span>
<span id="cb86-40"><a href="#cb86-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-41"><a href="#cb86-41" aria-hidden="true" tabindex="-1"></a><span class="co"># Silence some spurious seaborn warnings</span></span>
<span id="cb86-42"><a href="#cb86-42" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> warnings</span>
<span id="cb86-43"><a href="#cb86-43" aria-hidden="true" tabindex="-1"></a>warnings.filterwarnings(<span class="st">"ignore"</span>, category<span class="op">=</span><span class="pp">FutureWarning</span>)</span>
<span id="cb86-44"><a href="#cb86-44" aria-hidden="true" tabindex="-1"></a>warnings.filterwarnings(<span class="st">"ignore"</span>, category<span class="op">=</span><span class="pp">UserWarning</span>)</span>
<span id="cb86-45"><a href="#cb86-45" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb86-46"><a href="#cb86-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-47"><a href="#cb86-47" aria-hidden="true" tabindex="-1"></a>::: {.callout-note collapse="false"}</span>
<span id="cb86-48"><a href="#cb86-48" aria-hidden="true" tabindex="-1"></a><span class="fu">## Learning Outcomes</span></span>
<span id="cb86-49"><a href="#cb86-49" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>Recognize common file formats</span>
<span id="cb86-50"><a href="#cb86-50" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>Categorize data by its variable type</span>
<span id="cb86-51"><a href="#cb86-51" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>Build awareness of issues with data faithfulness and develop targeted solutions</span>
<span id="cb86-52"><a href="#cb86-52" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb86-53"><a href="#cb86-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-54"><a href="#cb86-54" aria-hidden="true" tabindex="-1"></a>In the past few lectures, we've learned that <span class="in">`pandas`</span> is a toolkit to restructure, modify, and explore a dataset. What we haven't yet touched on is *how* to make these data transformation decisions. When we receive a new set of data from the "real world," how do we know what processing we should do to convert this data into a usable form?</span>
<span id="cb86-55"><a href="#cb86-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-56"><a href="#cb86-56" aria-hidden="true" tabindex="-1"></a>**Data cleaning**, also called **data wrangling**, is the process of transforming raw data to facilitate subsequent analysis. It is often used to address issues like:</span>
<span id="cb86-57"><a href="#cb86-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-58"><a href="#cb86-58" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>Unclear structure or formatting</span>
<span id="cb86-59"><a href="#cb86-59" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>Missing or corrupted values</span>
<span id="cb86-60"><a href="#cb86-60" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>Unit conversions</span>
<span id="cb86-61"><a href="#cb86-61" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>...and so on</span>
<span id="cb86-62"><a href="#cb86-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-63"><a href="#cb86-63" aria-hidden="true" tabindex="-1"></a>**Exploratory Data Analysis (EDA)** is the process of understanding a new dataset. It is an open-ended, informal analysis that involves familiarizing ourselves with the variables present in the data, discovering potential hypotheses, and identifying possible issues with the data. This last point can often motivate further data cleaning to address any problems with the dataset's format; because of this, EDA and data cleaning are often thought of as an "infinite loop," with each process driving the other.</span>
<span id="cb86-64"><a href="#cb86-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-65"><a href="#cb86-65" aria-hidden="true" tabindex="-1"></a>In this lecture, we will consider the key properties of data to consider when performing data cleaning and EDA. In doing so, we'll develop a "checklist" of sorts for you to consider when approaching a new dataset. Throughout this process, we'll build a deeper understanding of this early (but very important!) stage of the data science lifecycle.</span>
<span id="cb86-66"><a href="#cb86-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-67"><a href="#cb86-67" aria-hidden="true" tabindex="-1"></a><span class="fu">## Structure</span></span>
<span id="cb86-68"><a href="#cb86-68" aria-hidden="true" tabindex="-1"></a>We often prefer rectangular data for data analysis. Rectangular structures are easy to manipulate and analyze. A key element of data cleaning is about transforming data to be more rectangular. </span>
<span id="cb86-69"><a href="#cb86-69" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-70"><a href="#cb86-70" aria-hidden="true" tabindex="-1"></a>There are two kinds of rectangular data: tables and matrices. Tables have named columns with different data types and are manipulated using data transformation languages. Matrices contain numeric data of the same type and are manipulated using linear algebra.</span>
<span id="cb86-71"><a href="#cb86-71" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-72"><a href="#cb86-72" aria-hidden="true" tabindex="-1"></a><span class="fu">### File Formats</span></span>
<span id="cb86-73"><a href="#cb86-73" aria-hidden="true" tabindex="-1"></a>There are many file types for storing structured data: TSV, JSON, XML, ASCII, SAS, etc. We'll only cover CSV, TSV, and JSON in lecture, but you'll likely encounter other formats as you work with different datasets. Reading documentation is your best bet for understanding how to process the multitude of different file types. </span>
<span id="cb86-74"><a href="#cb86-74" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-75"><a href="#cb86-75" aria-hidden="true" tabindex="-1"></a><span class="fu">#### CSV</span></span>
<span id="cb86-76"><a href="#cb86-76" aria-hidden="true" tabindex="-1"></a>CSVs, which stand for **Comma-Separated Values**, are a common tabular data format. </span>
<span id="cb86-77"><a href="#cb86-77" aria-hidden="true" tabindex="-1"></a>In the past two <span class="in">`pandas`</span> lectures, we briefly touched on the idea of file format: the way data is encoded in a file for storage. Specifically, our <span class="in">`elections`</span> and <span class="in">`babynames`</span> datasets were stored and loaded as CSVs:</span>
<span id="cb86-78"><a href="#cb86-78" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-81"><a href="#cb86-81" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb86-82"><a href="#cb86-82" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: false</span></span>
<span id="cb86-83"><a href="#cb86-83" aria-hidden="true" tabindex="-1"></a>pd.read_csv(<span class="st">"data/elections.csv"</span>).head(<span class="dv">5</span>)</span>
<span id="cb86-84"><a href="#cb86-84" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb86-85"><a href="#cb86-85" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-86"><a href="#cb86-86" aria-hidden="true" tabindex="-1"></a>To better understand the properties of a CSV, let's take a look at the first few rows of the raw data file to see what it looks like before being loaded into a <span class="in">`DataFrame`</span>. We'll use the <span class="in">`repr()`</span> function to return the raw string with its special characters: </span>
<span id="cb86-87"><a href="#cb86-87" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-90"><a href="#cb86-90" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb86-91"><a href="#cb86-91" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: false</span></span>
<span id="cb86-92"><a href="#cb86-92" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> <span class="bu">open</span>(<span class="st">"data/elections.csv"</span>, <span class="st">"r"</span>) <span class="im">as</span> table:</span>
<span id="cb86-93"><a href="#cb86-93" aria-hidden="true" tabindex="-1"></a>    i <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb86-94"><a href="#cb86-94" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> row <span class="kw">in</span> table:</span>
<span id="cb86-95"><a href="#cb86-95" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="bu">repr</span>(row))</span>
<span id="cb86-96"><a href="#cb86-96" aria-hidden="true" tabindex="-1"></a>        i <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb86-97"><a href="#cb86-97" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> i <span class="op">&gt;</span> <span class="dv">3</span>:</span>
<span id="cb86-98"><a href="#cb86-98" aria-hidden="true" tabindex="-1"></a>            <span class="cf">break</span></span>
<span id="cb86-99"><a href="#cb86-99" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb86-100"><a href="#cb86-100" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-101"><a href="#cb86-101" aria-hidden="true" tabindex="-1"></a>Each row, or **record**, in the data is delimited by a newline `\n`. Each column, or **field**, in the data is delimited by a comma <span class="in">`,`</span> (hence, comma-separated!). </span>
<span id="cb86-102"><a href="#cb86-102" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-103"><a href="#cb86-103" aria-hidden="true" tabindex="-1"></a><span class="fu">#### TSV</span></span>
<span id="cb86-104"><a href="#cb86-104" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-105"><a href="#cb86-105" aria-hidden="true" tabindex="-1"></a>Another common file type is **TSV (Tab-Separated Values)**. In a TSV, records are still delimited by a newline <span class="in">`\n`</span>, while fields are delimited by <span class="in">`\t`</span> tab character. </span>
<span id="cb86-106"><a href="#cb86-106" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-107"><a href="#cb86-107" aria-hidden="true" tabindex="-1"></a>Let's check out the first few rows of the raw TSV file. Again, we'll use the <span class="in">`repr()`</span> function so that <span class="in">`print`</span> shows the special characters.</span>
<span id="cb86-108"><a href="#cb86-108" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-111"><a href="#cb86-111" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb86-112"><a href="#cb86-112" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: false</span></span>
<span id="cb86-113"><a href="#cb86-113" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> <span class="bu">open</span>(<span class="st">"data/elections.txt"</span>, <span class="st">"r"</span>) <span class="im">as</span> table:</span>
<span id="cb86-114"><a href="#cb86-114" aria-hidden="true" tabindex="-1"></a>    i <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb86-115"><a href="#cb86-115" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> row <span class="kw">in</span> table:</span>
<span id="cb86-116"><a href="#cb86-116" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="bu">repr</span>(row))</span>
<span id="cb86-117"><a href="#cb86-117" aria-hidden="true" tabindex="-1"></a>        i <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb86-118"><a href="#cb86-118" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> i <span class="op">&gt;</span> <span class="dv">3</span>:</span>
<span id="cb86-119"><a href="#cb86-119" aria-hidden="true" tabindex="-1"></a>            <span class="cf">break</span></span>
<span id="cb86-120"><a href="#cb86-120" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb86-121"><a href="#cb86-121" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-122"><a href="#cb86-122" aria-hidden="true" tabindex="-1"></a>TSVs can be loaded into <span class="in">`pandas`</span> using <span class="in">`pd.read_csv`</span>. We'll need to specify the **delimiter** with parameter<span class="in">` sep='\t'`</span> <span class="co">[</span><span class="ot">(documentation)</span><span class="co">](https://pandas.pydata.org/docs/reference/api/pandas.read_csv.html)</span>.</span>
<span id="cb86-123"><a href="#cb86-123" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-126"><a href="#cb86-126" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb86-127"><a href="#cb86-127" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: false</span></span>
<span id="cb86-128"><a href="#cb86-128" aria-hidden="true" tabindex="-1"></a>pd.read_csv(<span class="st">"data/elections.txt"</span>, sep<span class="op">=</span><span class="st">'</span><span class="ch">\t</span><span class="st">'</span>).head(<span class="dv">3</span>)</span>
<span id="cb86-129"><a href="#cb86-129" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb86-130"><a href="#cb86-130" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-131"><a href="#cb86-131" aria-hidden="true" tabindex="-1"></a>An issue with CSVs and TSVs comes up whenever there are commas or tabs within the records. How does <span class="in">`pandas`</span> differentiate between a comma delimiter vs. a comma within the field itself, for example <span class="in">`8,900`</span>? To remedy this, check out the <span class="co">[</span><span class="ot">`quotechar` parameter</span><span class="co">](https://pandas.pydata.org/docs/reference/api/pandas.read_csv.html)</span>. </span>
<span id="cb86-132"><a href="#cb86-132" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-133"><a href="#cb86-133" aria-hidden="true" tabindex="-1"></a><span class="fu">#### JSON</span></span>
<span id="cb86-134"><a href="#cb86-134" aria-hidden="true" tabindex="-1"></a>**JSON (JavaScript Object Notation)** files behave similarly to Python dictionaries. A raw JSON is shown below.</span>
<span id="cb86-135"><a href="#cb86-135" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-138"><a href="#cb86-138" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb86-139"><a href="#cb86-139" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: false</span></span>
<span id="cb86-140"><a href="#cb86-140" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> <span class="bu">open</span>(<span class="st">"data/elections.json"</span>, <span class="st">"r"</span>) <span class="im">as</span> table:</span>
<span id="cb86-141"><a href="#cb86-141" aria-hidden="true" tabindex="-1"></a>    i <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb86-142"><a href="#cb86-142" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> row <span class="kw">in</span> table:</span>
<span id="cb86-143"><a href="#cb86-143" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(row)</span>
<span id="cb86-144"><a href="#cb86-144" aria-hidden="true" tabindex="-1"></a>        i <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb86-145"><a href="#cb86-145" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> i <span class="op">&gt;</span> <span class="dv">8</span>:</span>
<span id="cb86-146"><a href="#cb86-146" aria-hidden="true" tabindex="-1"></a>            <span class="cf">break</span></span>
<span id="cb86-147"><a href="#cb86-147" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb86-148"><a href="#cb86-148" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-149"><a href="#cb86-149" aria-hidden="true" tabindex="-1"></a>JSON files can be loaded into <span class="in">`pandas`</span> using <span class="in">`pd.read_json`</span>. </span>
<span id="cb86-150"><a href="#cb86-150" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-153"><a href="#cb86-153" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb86-154"><a href="#cb86-154" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: false</span></span>
<span id="cb86-155"><a href="#cb86-155" aria-hidden="true" tabindex="-1"></a>pd.read_json(<span class="st">'data/elections.json'</span>).head(<span class="dv">3</span>)</span>
<span id="cb86-156"><a href="#cb86-156" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb86-157"><a href="#cb86-157" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-158"><a href="#cb86-158" aria-hidden="true" tabindex="-1"></a><span class="fu">##### EDA with JSON: United States Congress Data</span></span>
<span id="cb86-159"><a href="#cb86-159" aria-hidden="true" tabindex="-1"></a>The congress.gov API (Application Programming Interface) provides data about the activities and members of the United States Congress (i.e., the House of Representatives and the Senate). </span>
<span id="cb86-160"><a href="#cb86-160" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;</span><span class="kw">br</span><span class="dt">&gt;</span></span>
<span id="cb86-161"><a href="#cb86-161" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-162"><a href="#cb86-162" aria-hidden="true" tabindex="-1"></a>To get a JSON file containing information about the current members of Congress from California, you could use the following **API call**:</span>
<span id="cb86-163"><a href="#cb86-163" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-164"><a href="#cb86-164" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="in">`https://api.congress.gov/v3/member/CA?api_key=[INSERT_KEY]&amp;limit=250&amp;format=json&amp;currentMember=True`</span></span>
<span id="cb86-165"><a href="#cb86-165" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-166"><a href="#cb86-166" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>You can instantly sign up for a congress.gov **API key** <span class="co">[</span><span class="ot">here</span><span class="co">](https://gpo.congress.gov/sign-up/)</span>. Once you have your key, replace <span class="in">`[INSERT_KEY]`</span> above with your key, and enter the API call as a URL in your browser. What happens? </span>
<span id="cb86-167"><a href="#cb86-167" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-168"><a href="#cb86-168" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Once the JSON from the API call is visible in your browser, you can click <span class="in">`File`</span> --&gt; <span class="in">`Save Page As`</span> to save the JSON file to your coputer.</span>
<span id="cb86-169"><a href="#cb86-169" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-170"><a href="#cb86-170" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Coarsely, API keys are used to track how much a given user engages with the API. There might be limits to the number of API calls (e.g., congress.gov API limits to 5,000 calls per hour), or a cost for API calls (e.g., using the OpenAI API for programmatically using ChatGPT).</span>
<span id="cb86-171"><a href="#cb86-171" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-172"><a href="#cb86-172" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;</span><span class="kw">br</span><span class="dt">&gt;</span></span>
<span id="cb86-173"><a href="#cb86-173" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-174"><a href="#cb86-174" aria-hidden="true" tabindex="-1"></a>After following these steps, we save this JSON file as <span class="in">`data/ca-congress-members.json`</span>. </span>
<span id="cb86-175"><a href="#cb86-175" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-176"><a href="#cb86-176" aria-hidden="true" tabindex="-1"></a><span class="fu">###### File Contents</span></span>
<span id="cb86-177"><a href="#cb86-177" aria-hidden="true" tabindex="-1"></a>Let's examine this file using Python. We can programmatically view the first couple lines of the file using the same functions we used with CSVs:</span>
<span id="cb86-178"><a href="#cb86-178" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-181"><a href="#cb86-181" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb86-182"><a href="#cb86-182" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: false</span></span>
<span id="cb86-183"><a href="#cb86-183" aria-hidden="true" tabindex="-1"></a>congress_file <span class="op">=</span> <span class="st">"data/ca-congress-members.json"</span></span>
<span id="cb86-184"><a href="#cb86-184" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-185"><a href="#cb86-185" aria-hidden="true" tabindex="-1"></a><span class="co"># Inspect the first five lines of the file</span></span>
<span id="cb86-186"><a href="#cb86-186" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> <span class="bu">open</span>(congress_file, <span class="st">"r"</span>) <span class="im">as</span> f:</span>
<span id="cb86-187"><a href="#cb86-187" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i, row <span class="kw">in</span> <span class="bu">enumerate</span>(f):</span>
<span id="cb86-188"><a href="#cb86-188" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(row)</span>
<span id="cb86-189"><a href="#cb86-189" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> i <span class="op">&gt;=</span> <span class="dv">4</span>: <span class="cf">break</span></span>
<span id="cb86-190"><a href="#cb86-190" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb86-191"><a href="#cb86-191" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-192"><a href="#cb86-192" aria-hidden="true" tabindex="-1"></a><span class="fu">###### EDA: Digging into JSON with Python</span></span>
<span id="cb86-193"><a href="#cb86-193" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-194"><a href="#cb86-194" aria-hidden="true" tabindex="-1"></a>JSON data closely matches the internal Python object model.  </span>
<span id="cb86-195"><a href="#cb86-195" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-196"><a href="#cb86-196" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>In the following cell, we import the entire JSON datafile into a Python dictionary using the <span class="in">`json`</span> package.</span>
<span id="cb86-197"><a href="#cb86-197" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-200"><a href="#cb86-200" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb86-201"><a href="#cb86-201" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: false</span></span>
<span id="cb86-202"><a href="#cb86-202" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> json</span>
<span id="cb86-203"><a href="#cb86-203" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-204"><a href="#cb86-204" aria-hidden="true" tabindex="-1"></a><span class="co"># Import the JSON file into Python as a dictionary</span></span>
<span id="cb86-205"><a href="#cb86-205" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> <span class="bu">open</span>(congress_file, <span class="st">"rb"</span>) <span class="im">as</span> f:</span>
<span id="cb86-206"><a href="#cb86-206" aria-hidden="true" tabindex="-1"></a>    congress_json <span class="op">=</span> json.load(f)</span>
<span id="cb86-207"><a href="#cb86-207" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-208"><a href="#cb86-208" aria-hidden="true" tabindex="-1"></a><span class="bu">type</span>(congress_json)</span>
<span id="cb86-209"><a href="#cb86-209" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb86-210"><a href="#cb86-210" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-211"><a href="#cb86-211" aria-hidden="true" tabindex="-1"></a>The <span class="in">`congress_json`</span> variable is a dictionary encoding the data in the JSON file.</span>
<span id="cb86-212"><a href="#cb86-212" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-213"><a href="#cb86-213" aria-hidden="true" tabindex="-1"></a>Below, we access the first element of the <span class="in">`members`</span> element of the <span class="in">`congress_json`</span> dictionary.</span>
<span id="cb86-214"><a href="#cb86-214" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-215"><a href="#cb86-215" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>This first element is also a dictionary (and there are more dictionaries inside of it!)</span>
<span id="cb86-216"><a href="#cb86-216" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-219"><a href="#cb86-219" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb86-220"><a href="#cb86-220" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: false</span></span>
<span id="cb86-221"><a href="#cb86-221" aria-hidden="true" tabindex="-1"></a><span class="co"># Grab the list corresponding to the `members` key in the JSON dictionary, </span></span>
<span id="cb86-222"><a href="#cb86-222" aria-hidden="true" tabindex="-1"></a><span class="co"># and then grab the first element of this list.</span></span>
<span id="cb86-223"><a href="#cb86-223" aria-hidden="true" tabindex="-1"></a><span class="co"># In a moment, we'll see how we knew to use the key `members`, and that</span></span>
<span id="cb86-224"><a href="#cb86-224" aria-hidden="true" tabindex="-1"></a><span class="co"># the resulting object is a list.</span></span>
<span id="cb86-225"><a href="#cb86-225" aria-hidden="true" tabindex="-1"></a>congress_json[<span class="st">'members'</span>][<span class="dv">0</span>]</span>
<span id="cb86-226"><a href="#cb86-226" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb86-227"><a href="#cb86-227" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-228"><a href="#cb86-228" aria-hidden="true" tabindex="-1"></a>How should we probe a nested dictionary like <span class="in">`congress_json`</span>?</span>
<span id="cb86-229"><a href="#cb86-229" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-230"><a href="#cb86-230" aria-hidden="true" tabindex="-1"></a>We can start by identifying the top-level **keys** of the dictionary:</span>
<span id="cb86-231"><a href="#cb86-231" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-234"><a href="#cb86-234" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb86-235"><a href="#cb86-235" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: false</span></span>
<span id="cb86-236"><a href="#cb86-236" aria-hidden="true" tabindex="-1"></a><span class="co"># Grab the top-level keys of the JSON dictionary</span></span>
<span id="cb86-237"><a href="#cb86-237" aria-hidden="true" tabindex="-1"></a>congress_json.keys()</span>
<span id="cb86-238"><a href="#cb86-238" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb86-239"><a href="#cb86-239" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-240"><a href="#cb86-240" aria-hidden="true" tabindex="-1"></a>Looks like we have three top-level keys: <span class="in">`members`</span>, <span class="in">`pagination`</span>, and <span class="in">`request`</span>.</span>
<span id="cb86-241"><a href="#cb86-241" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-242"><a href="#cb86-242" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; You'll often see a top-level </span><span class="in">`meta`</span><span class="at"> key in JSON files. This does not refer to Meta (formerly Facebook). Instead, it typically refers to metadata (data about the data).  Metadata are often maintained alongside the data.</span></span>
<span id="cb86-243"><a href="#cb86-243" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-244"><a href="#cb86-244" aria-hidden="true" tabindex="-1"></a>Let's check the type of the <span class="in">`members`</span> element:</span>
<span id="cb86-245"><a href="#cb86-245" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-248"><a href="#cb86-248" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb86-249"><a href="#cb86-249" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: false</span></span>
<span id="cb86-250"><a href="#cb86-250" aria-hidden="true" tabindex="-1"></a><span class="bu">type</span>(congress_json[<span class="st">'members'</span>])</span>
<span id="cb86-251"><a href="#cb86-251" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb86-252"><a href="#cb86-252" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-253"><a href="#cb86-253" aria-hidden="true" tabindex="-1"></a>Looks like a list! What are the first two elements?</span>
<span id="cb86-254"><a href="#cb86-254" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-257"><a href="#cb86-257" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb86-258"><a href="#cb86-258" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: false</span></span>
<span id="cb86-259"><a href="#cb86-259" aria-hidden="true" tabindex="-1"></a>congress_json[<span class="st">'members'</span>][:<span class="dv">2</span>]</span>
<span id="cb86-260"><a href="#cb86-260" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb86-261"><a href="#cb86-261" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-262"><a href="#cb86-262" aria-hidden="true" tabindex="-1"></a>More dictionaries! You can repeat the process above to traverse the nested dictionary.</span>
<span id="cb86-263"><a href="#cb86-263" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-264"><a href="#cb86-264" aria-hidden="true" tabindex="-1"></a>You'll notice that each record of <span class="in">`congress_json['members']`</span> looks like it could be a column of a DataFrame.</span>
<span id="cb86-265"><a href="#cb86-265" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-266"><a href="#cb86-266" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>The keys look a lot like column names, and the values could be the entries in each row.</span>
<span id="cb86-267"><a href="#cb86-267" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-268"><a href="#cb86-268" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;</span><span class="kw">br</span><span class="dt">&gt;</span> </span>
<span id="cb86-269"><a href="#cb86-269" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-270"><a href="#cb86-270" aria-hidden="true" tabindex="-1"></a>But, the two other elements of <span class="in">`congress_json`</span> don't have the same structure as <span class="in">`congress_json['members']`</span>.</span>
<span id="cb86-271"><a href="#cb86-271" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-272"><a href="#cb86-272" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>So, they probably don't belong in a DataFrame containing the members of Congress from CA.</span>
<span id="cb86-273"><a href="#cb86-273" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-274"><a href="#cb86-274" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>We'll see the implications of this inconsistency in the next section.</span>
<span id="cb86-275"><a href="#cb86-275" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-278"><a href="#cb86-278" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb86-279"><a href="#cb86-279" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: false</span></span>
<span id="cb86-280"><a href="#cb86-280" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(congress_json[<span class="st">'pagination'</span>])</span>
<span id="cb86-281"><a href="#cb86-281" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(congress_json[<span class="st">'request'</span>])</span>
<span id="cb86-282"><a href="#cb86-282" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb86-283"><a href="#cb86-283" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-284"><a href="#cb86-284" aria-hidden="true" tabindex="-1"></a><span class="fu">###### JSON with pandas</span></span>
<span id="cb86-285"><a href="#cb86-285" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-286"><a href="#cb86-286" aria-hidden="true" tabindex="-1"></a><span class="in">`pandas`</span> has a built in function called <span class="in">`pd.read_json`</span> for reading in JSON files. In order to read in this JSON file, you might want to try something like the code in the cell below. However, if we tried to run this code, it would error.</span>
<span id="cb86-287"><a href="#cb86-287" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-290"><a href="#cb86-290" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb86-291"><a href="#cb86-291" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: false</span></span>
<span id="cb86-292"><a href="#cb86-292" aria-hidden="true" tabindex="-1"></a><span class="co">#pd.read_json(congress_file)</span></span>
<span id="cb86-293"><a href="#cb86-293" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb86-294"><a href="#cb86-294" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-295"><a href="#cb86-295" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>The code above tries to import the entire JSON file located at <span class="in">`congress_file`</span> (<span class="in">`congress_json`</span>), including <span class="in">`congress_json['pagination']`</span> and <span class="in">`congress_json['request']`</span>.</span>
<span id="cb86-296"><a href="#cb86-296" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-297"><a href="#cb86-297" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>We only want to make a DataFrame out of <span class="in">`congress_json['members']`</span>.</span>
<span id="cb86-298"><a href="#cb86-298" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-299"><a href="#cb86-299" aria-hidden="true" tabindex="-1"></a>Instead, let's try converting the <span class="in">`members`</span> element of <span class="in">`congress_json`</span> to a DataFrame by using <span class="in">`pd.DataFrame`</span>:</span>
<span id="cb86-300"><a href="#cb86-300" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-303"><a href="#cb86-303" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb86-304"><a href="#cb86-304" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: false</span></span>
<span id="cb86-305"><a href="#cb86-305" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert dictionary to DataFrame</span></span>
<span id="cb86-306"><a href="#cb86-306" aria-hidden="true" tabindex="-1"></a>congress_df <span class="op">=</span> pd.DataFrame(congress_json[<span class="st">'members'</span>])</span>
<span id="cb86-307"><a href="#cb86-307" aria-hidden="true" tabindex="-1"></a>congress_df.head()</span>
<span id="cb86-308"><a href="#cb86-308" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb86-309"><a href="#cb86-309" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-310"><a href="#cb86-310" aria-hidden="true" tabindex="-1"></a>We've successfully begun to rectangularize our JSON data!</span>
<span id="cb86-311"><a href="#cb86-311" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-312"><a href="#cb86-312" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb86-313"><a href="#cb86-313" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-314"><a href="#cb86-314" aria-hidden="true" tabindex="-1"></a><span class="fu">### Other Data Formats</span></span>
<span id="cb86-315"><a href="#cb86-315" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-316"><a href="#cb86-316" aria-hidden="true" tabindex="-1"></a>So far, we've looked at text data that comes in a quite nice format. Although some data cleaning might be necessary, it has still had all of the components of a rectangular dataset. However, not all data comes like this, and there are also different kinds of data we can use. Some examples include:</span>
<span id="cb86-317"><a href="#cb86-317" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-318"><a href="#cb86-318" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>**Image Data**: Used for medical diagnosis</span>
<span id="cb86-319"><a href="#cb86-319" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>**Audio Data**: Used for speech recognition, sentiment analysis</span>
<span id="cb86-320"><a href="#cb86-320" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>**Video Data**: Used for object tracking, facial recognition</span>
<span id="cb86-321"><a href="#cb86-321" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>**Text**: Used for LLMs, document review</span>
<span id="cb86-322"><a href="#cb86-322" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-323"><a href="#cb86-323" aria-hidden="true" tabindex="-1"></a>Even though this may not look tabular at first, all of these formats can be represented in tabular/matrix form! So by learning how to work with tabular data, you are well equipped to deal with other kinds of data as well.</span>
<span id="cb86-324"><a href="#cb86-324" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-325"><a href="#cb86-325" aria-hidden="true" tabindex="-1"></a><span class="fu">### Variable Types</span></span>
<span id="cb86-326"><a href="#cb86-326" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-327"><a href="#cb86-327" aria-hidden="true" tabindex="-1"></a>Variables are columns. A variable is a measurement of a particular concept. Variables have two common properties: data type/storage type and variable type/feature type. The data type of a variable indicates how each variable value is stored in memory (integer, floating point, boolean, etc.) and affects which <span class="in">`pandas`</span> functions are used. The variable type is a conceptualized measurement of information (and therefore indicates what values a variable can take on). Variable type is identified through expert knowledge, exploring the data itself, or consulting the data codebook. The variable type affects how one visualizes and inteprets the data. In this class, "variable types" are conceptual.</span>
<span id="cb86-328"><a href="#cb86-328" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-329"><a href="#cb86-329" aria-hidden="true" tabindex="-1"></a>After loading data into a file, it's a good idea to take the time to understand what pieces of information are encoded in the dataset. In particular, we want to identify what variable types are present in our data. Broadly speaking, we can categorize variables into one of two overarching types. </span>
<span id="cb86-330"><a href="#cb86-330" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-331"><a href="#cb86-331" aria-hidden="true" tabindex="-1"></a>**Quantitative variables** describe some numeric quantity or amount. Some examples include weights, GPA, CO<span class="dt">&lt;</span><span class="kw">sub</span><span class="dt">&gt;</span>2<span class="dt">&lt;/</span><span class="kw">sub</span><span class="dt">&gt;</span> concentrations, someone's age, or the number of siblings they have.</span>
<span id="cb86-332"><a href="#cb86-332" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-333"><a href="#cb86-333" aria-hidden="true" tabindex="-1"></a>**Qualitative variables**, also known as **categorical variables**, describe data that isn't measuring some quantity or amount. The sub-categories of categorical data are:</span>
<span id="cb86-334"><a href="#cb86-334" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-335"><a href="#cb86-335" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>**Ordinal qualitative variables**: categories with ordered levels. Specifically, ordinal variables are those where the difference between levels has no consistent, quantifiable meaning. Some examples include levels of education (high school, undergrad, grad, etc.), income bracket (low, medium, high), or Yelp rating. </span>
<span id="cb86-336"><a href="#cb86-336" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>**Nominal qualitative variables**: categories with no specific order. For example, someone's political affiliation or Cal ID number.</span>
<span id="cb86-337"><a href="#cb86-337" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-338"><a href="#cb86-338" aria-hidden="true" tabindex="-1"></a><span class="al">![Classification of variable types](images/variable_types.png)</span></span>
<span id="cb86-339"><a href="#cb86-339" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-340"><a href="#cb86-340" aria-hidden="true" tabindex="-1"></a>Note that many variables don't sit neatly in just one of these categories. Qualitative variables could have numeric levels, and conversely, quantitative variables could be stored as strings. </span>
<span id="cb86-341"><a href="#cb86-341" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-342"><a href="#cb86-342" aria-hidden="true" tabindex="-1"></a><span class="fu">## Granularity and Temporality</span></span>
<span id="cb86-343"><a href="#cb86-343" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-344"><a href="#cb86-344" aria-hidden="true" tabindex="-1"></a>After understanding the structure of the dataset, the next task is to determine what exactly the data represents. We'll do so by considering the data's granularity and temporality.</span>
<span id="cb86-345"><a href="#cb86-345" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-346"><a href="#cb86-346" aria-hidden="true" tabindex="-1"></a><span class="fu">### Granularity</span></span>
<span id="cb86-347"><a href="#cb86-347" aria-hidden="true" tabindex="-1"></a>The **granularity** of a dataset is what a single row represents. You can also think of it as the level of detail included in the data. To determine the data's granularity, ask: what does each row in the dataset represent? Fine-grained data contains a high level of detail, with a single row representing a small individual unit. For example, each record may represent one person. Coarse-grained data is encoded such that a single row represents a large individual unit – for example, each record may represent a group of people.</span>
<span id="cb86-348"><a href="#cb86-348" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-349"><a href="#cb86-349" aria-hidden="true" tabindex="-1"></a><span class="fu">### Temporality</span></span>
<span id="cb86-350"><a href="#cb86-350" aria-hidden="true" tabindex="-1"></a>The **temporality** of a dataset describes the periodicity over which the data was collected as well as when the data was most recently collected or updated. </span>
<span id="cb86-351"><a href="#cb86-351" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-352"><a href="#cb86-352" aria-hidden="true" tabindex="-1"></a>Time and date fields of a dataset could represent a few things:</span>
<span id="cb86-353"><a href="#cb86-353" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-354"><a href="#cb86-354" aria-hidden="true" tabindex="-1"></a><span class="ss">1. </span>when the "event" happened</span>
<span id="cb86-355"><a href="#cb86-355" aria-hidden="true" tabindex="-1"></a><span class="ss">2. </span>when the data was collected, or when it was entered into the system</span>
<span id="cb86-356"><a href="#cb86-356" aria-hidden="true" tabindex="-1"></a><span class="ss">3. </span>when the data was copied into the database </span>
<span id="cb86-357"><a href="#cb86-357" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-358"><a href="#cb86-358" aria-hidden="true" tabindex="-1"></a>To fully understand the temporality of the data, it also may be necessary to standardize time zones or inspect recurring time-based trends in the data (do patterns recur in 24-hour periods? Over the course of a month? Seasonally?). The convention for standardizing time is the Coordinated Universal Time (UTC), an international time standard measured at 0 degrees latitude that stays consistent throughout the year (no daylight savings). We can represent Berkeley's time zone, Pacific Standard Time (PST), as UTC-7 (with daylight savings). </span>
<span id="cb86-359"><a href="#cb86-359" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-360"><a href="#cb86-360" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Temporality with `pandas`' `dt` accessors </span></span>
<span id="cb86-361"><a href="#cb86-361" aria-hidden="true" tabindex="-1"></a>Let's briefly look at how we can use <span class="in">`pandas`</span>' <span class="in">`dt`</span> accessors to work with dates/times in a dataset using the dataset you'll see in Lab 3: the Berkeley PD Calls for Service dataset.</span>
<span id="cb86-362"><a href="#cb86-362" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-365"><a href="#cb86-365" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb86-366"><a href="#cb86-366" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: true</span></span>
<span id="cb86-367"><a href="#cb86-367" aria-hidden="true" tabindex="-1"></a>calls <span class="op">=</span> pd.read_csv(<span class="st">"data/Berkeley_PD_-_Calls_for_Service.csv"</span>)</span>
<span id="cb86-368"><a href="#cb86-368" aria-hidden="true" tabindex="-1"></a>calls.head()</span>
<span id="cb86-369"><a href="#cb86-369" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb86-370"><a href="#cb86-370" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-371"><a href="#cb86-371" aria-hidden="true" tabindex="-1"></a>Looks like there are three columns with dates/times: <span class="in">`EVENTDT`</span>, <span class="in">`EVENTTM`</span>, and <span class="in">`InDbDate`</span>. </span>
<span id="cb86-372"><a href="#cb86-372" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-373"><a href="#cb86-373" aria-hidden="true" tabindex="-1"></a>Most likely, <span class="in">`EVENTDT`</span> stands for the date when the event took place, <span class="in">`EVENTTM`</span> stands for the time of day the event took place (in 24-hr format), and <span class="in">`InDbDate`</span> is the date this call is recorded onto the database.</span>
<span id="cb86-374"><a href="#cb86-374" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-375"><a href="#cb86-375" aria-hidden="true" tabindex="-1"></a>If we check the data type of these columns, we will see they are stored as strings. We can convert them to <span class="in">`datetime`</span> objects using pandas <span class="in">`to_datetime`</span> function.</span>
<span id="cb86-376"><a href="#cb86-376" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-379"><a href="#cb86-379" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb86-380"><a href="#cb86-380" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: false</span></span>
<span id="cb86-381"><a href="#cb86-381" aria-hidden="true" tabindex="-1"></a>calls[<span class="st">"EVENTDT"</span>] <span class="op">=</span> pd.to_datetime(calls[<span class="st">"EVENTDT"</span>])</span>
<span id="cb86-382"><a href="#cb86-382" aria-hidden="true" tabindex="-1"></a>calls.head()</span>
<span id="cb86-383"><a href="#cb86-383" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb86-384"><a href="#cb86-384" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-385"><a href="#cb86-385" aria-hidden="true" tabindex="-1"></a>Now, we can use the <span class="in">`dt`</span> accessor on this column.</span>
<span id="cb86-386"><a href="#cb86-386" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-387"><a href="#cb86-387" aria-hidden="true" tabindex="-1"></a>We can get the month: </span>
<span id="cb86-388"><a href="#cb86-388" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-391"><a href="#cb86-391" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb86-392"><a href="#cb86-392" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: false</span></span>
<span id="cb86-393"><a href="#cb86-393" aria-hidden="true" tabindex="-1"></a>calls[<span class="st">"EVENTDT"</span>].dt.month.head()</span>
<span id="cb86-394"><a href="#cb86-394" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb86-395"><a href="#cb86-395" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-396"><a href="#cb86-396" aria-hidden="true" tabindex="-1"></a>Which day of the week the date is on:</span>
<span id="cb86-397"><a href="#cb86-397" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-400"><a href="#cb86-400" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb86-401"><a href="#cb86-401" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: false</span></span>
<span id="cb86-402"><a href="#cb86-402" aria-hidden="true" tabindex="-1"></a>calls[<span class="st">"EVENTDT"</span>].dt.dayofweek.head()</span>
<span id="cb86-403"><a href="#cb86-403" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb86-404"><a href="#cb86-404" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-405"><a href="#cb86-405" aria-hidden="true" tabindex="-1"></a>Check the mimimum values to see if there are any suspicious-looking, 70s dates:</span>
<span id="cb86-406"><a href="#cb86-406" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-409"><a href="#cb86-409" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb86-410"><a href="#cb86-410" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: false</span></span>
<span id="cb86-411"><a href="#cb86-411" aria-hidden="true" tabindex="-1"></a>calls.sort_values(<span class="st">"EVENTDT"</span>).head()</span>
<span id="cb86-412"><a href="#cb86-412" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb86-413"><a href="#cb86-413" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-414"><a href="#cb86-414" aria-hidden="true" tabindex="-1"></a>Doesn't look like it! We are good!</span>
<span id="cb86-415"><a href="#cb86-415" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-416"><a href="#cb86-416" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-417"><a href="#cb86-417" aria-hidden="true" tabindex="-1"></a>We can also do many things with the <span class="in">`dt`</span> accessor like switching time zones and converting time back to UNIX/POSIX time. Check out the documentation on <span class="co">[</span><span class="ot">`.dt` accessor</span><span class="co">](https://pandas.pydata.org/docs/user_guide/basics.html#basics-dt-accessors)</span> and <span class="co">[</span><span class="ot">time series/date functionality</span><span class="co">](https://pandas.pydata.org/docs/user_guide/timeseries.html#)</span>.</span>
<span id="cb86-418"><a href="#cb86-418" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-419"><a href="#cb86-419" aria-hidden="true" tabindex="-1"></a><span class="fu">## Faithfulness</span></span>
<span id="cb86-420"><a href="#cb86-420" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-421"><a href="#cb86-421" aria-hidden="true" tabindex="-1"></a>At this stage in our data cleaning and EDA workflow, we've achieved quite a lot: we've identified how our data is structured, come to terms with what information it encodes, and gained insight as to how it was generated. Throughout this process, we should always recall the original intent of our work in Data Science – to use data to better understand and model the real world. To achieve this goal, we need to ensure that the data we use is faithful to reality; that is, that our data accurately captures the "real world."</span>
<span id="cb86-422"><a href="#cb86-422" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-423"><a href="#cb86-423" aria-hidden="true" tabindex="-1"></a>Data used in research or industry is often "messy" – there may be errors or inaccuracies that impact the faithfulness of the dataset. Signs that data may not be faithful include:</span>
<span id="cb86-424"><a href="#cb86-424" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-425"><a href="#cb86-425" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>Unrealistic or "incorrect" values, such as negative counts, locations that don't exist, or dates set in the future</span>
<span id="cb86-426"><a href="#cb86-426" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>Violations of obvious dependencies, like an age that does not match a birthday</span>
<span id="cb86-427"><a href="#cb86-427" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>Clear signs that data was entered by hand, which can lead to spelling errors or fields that are incorrectly shifted</span>
<span id="cb86-428"><a href="#cb86-428" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>Signs of data falsification, such as fake email addresses or repeated use of the same names</span>
<span id="cb86-429"><a href="#cb86-429" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>Duplicated records or fields containing the same information</span>
<span id="cb86-430"><a href="#cb86-430" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>Truncated data, e.g. Microsoft Excel would limit the number of rows to 655536 and the number of columns to 255</span>
<span id="cb86-431"><a href="#cb86-431" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-432"><a href="#cb86-432" aria-hidden="true" tabindex="-1"></a>We often solve some of these more common issues in the following ways: </span>
<span id="cb86-433"><a href="#cb86-433" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-434"><a href="#cb86-434" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>Spelling errors: apply corrections or drop records that aren't in a dictionary</span>
<span id="cb86-435"><a href="#cb86-435" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>Time zone inconsistencies: convert to a common time zone (e.g. UTC) </span>
<span id="cb86-436"><a href="#cb86-436" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>Duplicated records or fields: identify and eliminate duplicates (using primary keys)</span>
<span id="cb86-437"><a href="#cb86-437" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>Unspecified or inconsistent units: infer the units and check that values are in reasonable ranges in the data</span>
<span id="cb86-438"><a href="#cb86-438" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-439"><a href="#cb86-439" aria-hidden="true" tabindex="-1"></a><span class="fu">### Missing Values</span></span>
<span id="cb86-440"><a href="#cb86-440" aria-hidden="true" tabindex="-1"></a>Another common issue encountered with real-world datasets is that of missing data. One strategy to resolve this is to simply drop any records with missing values from the dataset. This does, however, introduce the risk of inducing biases – it is possible that the missing or corrupt records may be systemically related to some feature of interest in the data. Another solution is to keep the data as <span class="in">`NaN`</span> values. </span>
<span id="cb86-441"><a href="#cb86-441" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-442"><a href="#cb86-442" aria-hidden="true" tabindex="-1"></a>A third method to address missing data is to perform **imputation**: infer the missing values using other data available in the dataset. There is a wide variety of imputation techniques that can be implemented; some of the most common are listed below.</span>
<span id="cb86-443"><a href="#cb86-443" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-444"><a href="#cb86-444" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>Average imputation: replace missing values with the average value for that field</span>
<span id="cb86-445"><a href="#cb86-445" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>Hot deck imputation: replace missing values with some random value</span>
<span id="cb86-446"><a href="#cb86-446" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>Regression imputation: develop a model to predict missing values and replace with the predicted value from the model.</span>
<span id="cb86-447"><a href="#cb86-447" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>Multiple imputation: replace missing values with multiple random values</span>
<span id="cb86-448"><a href="#cb86-448" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-449"><a href="#cb86-449" aria-hidden="true" tabindex="-1"></a>Regardless of the strategy used to deal with missing data, we should think carefully about *why* particular records or fields may be missing – this can help inform whether or not the absence of these values is significant or meaningful.</span>
<span id="cb86-450"><a href="#cb86-450" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-451"><a href="#cb86-451" aria-hidden="true" tabindex="-1"></a><span class="fu">## EDA Demo 1: Tuberculosis in the United States</span></span>
<span id="cb86-452"><a href="#cb86-452" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-453"><a href="#cb86-453" aria-hidden="true" tabindex="-1"></a>Now, let's walk through the data-cleaning and EDA workflow to see what can we learn about the presence of Tuberculosis in the United States!</span>
<span id="cb86-454"><a href="#cb86-454" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-455"><a href="#cb86-455" aria-hidden="true" tabindex="-1"></a>We will examine the data included in the <span class="co">[</span><span class="ot">original CDC article</span><span class="co">](https://www.cdc.gov/mmwr/volumes/71/wr/mm7112a1.htm?s_cid=mm7112a1_w#T1_down)</span> published in 2021.</span>
<span id="cb86-456"><a href="#cb86-456" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-457"><a href="#cb86-457" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-458"><a href="#cb86-458" aria-hidden="true" tabindex="-1"></a><span class="fu">### CSVs and Field Names</span></span>
<span id="cb86-459"><a href="#cb86-459" aria-hidden="true" tabindex="-1"></a>Suppose Table 1 was saved as a CSV file located in <span class="in">`data/cdc_tuberculosis.csv`</span>.</span>
<span id="cb86-460"><a href="#cb86-460" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-461"><a href="#cb86-461" aria-hidden="true" tabindex="-1"></a>We can then explore the CSV (which is a text file, and does not contain binary-encoded data) in many ways:</span>
<span id="cb86-462"><a href="#cb86-462" aria-hidden="true" tabindex="-1"></a><span class="ss">1. </span>Using a text editor like emacs, vim, VSCode, etc.</span>
<span id="cb86-463"><a href="#cb86-463" aria-hidden="true" tabindex="-1"></a><span class="ss">2. </span>Opening the CSV directly in DataHub (read-only), Excel, Google Sheets, etc.</span>
<span id="cb86-464"><a href="#cb86-464" aria-hidden="true" tabindex="-1"></a><span class="ss">3. </span>The <span class="in">`Python`</span> file object</span>
<span id="cb86-465"><a href="#cb86-465" aria-hidden="true" tabindex="-1"></a><span class="ss">4. </span><span class="in">`pandas`</span>, using <span class="in">`pd.read_csv()`</span></span>
<span id="cb86-466"><a href="#cb86-466" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-467"><a href="#cb86-467" aria-hidden="true" tabindex="-1"></a>To try out options 1 and 2, you can view or download the Tuberculosis from the <span class="co">[</span><span class="ot">lecture demo notebook</span><span class="co">](https://data100.datahub.berkeley.edu/hub/user-redirect/git-pull?repo=https%3A%2F%2Fgithub.com%2FDS-100%2Fsp25-student&amp;urlpath=lab%2Ftree%2Fsp25-student%2Flecture%2Flec05%2Flec05-part-1-eda-tuberculosis.ipynb&amp;branch=main)</span> under the <span class="in">`data`</span> folder in the left hand menu. Notice how the CSV file is a type of **rectangular data (i.e., tabular data) stored as comma-separated values**.</span>
<span id="cb86-468"><a href="#cb86-468" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-469"><a href="#cb86-469" aria-hidden="true" tabindex="-1"></a>Next, let's try out option 3 using the <span class="in">`Python`</span> file object. We'll look at the first four lines:</span>
<span id="cb86-470"><a href="#cb86-470" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-473"><a href="#cb86-473" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb86-474"><a href="#cb86-474" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: true</span></span>
<span id="cb86-475"><a href="#cb86-475" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> <span class="bu">open</span>(<span class="st">"data/cdc_tuberculosis.csv"</span>, <span class="st">"r"</span>) <span class="im">as</span> f:</span>
<span id="cb86-476"><a href="#cb86-476" aria-hidden="true" tabindex="-1"></a>    i <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb86-477"><a href="#cb86-477" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> row <span class="kw">in</span> f:</span>
<span id="cb86-478"><a href="#cb86-478" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(row)</span>
<span id="cb86-479"><a href="#cb86-479" aria-hidden="true" tabindex="-1"></a>        i <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb86-480"><a href="#cb86-480" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> i <span class="op">&gt;</span> <span class="dv">3</span>:</span>
<span id="cb86-481"><a href="#cb86-481" aria-hidden="true" tabindex="-1"></a>            <span class="cf">break</span></span>
<span id="cb86-482"><a href="#cb86-482" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb86-483"><a href="#cb86-483" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-484"><a href="#cb86-484" aria-hidden="true" tabindex="-1"></a>Whoa, why are there blank lines interspaced between the lines of the CSV?</span>
<span id="cb86-485"><a href="#cb86-485" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-486"><a href="#cb86-486" aria-hidden="true" tabindex="-1"></a>You may recall that all line breaks in text files are encoded as the special newline character <span class="in">`\n`</span>. Python's <span class="in">`print()`</span> prints each string (including the newline), and an additional newline on top of that.</span>
<span id="cb86-487"><a href="#cb86-487" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-488"><a href="#cb86-488" aria-hidden="true" tabindex="-1"></a>If you're curious, we can use the <span class="in">`repr()`</span> function to return the raw string with all special characters:</span>
<span id="cb86-489"><a href="#cb86-489" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-492"><a href="#cb86-492" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb86-493"><a href="#cb86-493" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: true</span></span>
<span id="cb86-494"><a href="#cb86-494" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> <span class="bu">open</span>(<span class="st">"data/cdc_tuberculosis.csv"</span>, <span class="st">"r"</span>) <span class="im">as</span> f:</span>
<span id="cb86-495"><a href="#cb86-495" aria-hidden="true" tabindex="-1"></a>    i <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb86-496"><a href="#cb86-496" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> row <span class="kw">in</span> f:</span>
<span id="cb86-497"><a href="#cb86-497" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="bu">repr</span>(row)) <span class="co"># print raw strings</span></span>
<span id="cb86-498"><a href="#cb86-498" aria-hidden="true" tabindex="-1"></a>        i <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb86-499"><a href="#cb86-499" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> i <span class="op">&gt;</span> <span class="dv">3</span>:</span>
<span id="cb86-500"><a href="#cb86-500" aria-hidden="true" tabindex="-1"></a>            <span class="cf">break</span></span>
<span id="cb86-501"><a href="#cb86-501" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb86-502"><a href="#cb86-502" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-503"><a href="#cb86-503" aria-hidden="true" tabindex="-1"></a>Finally, let's try option 4 and use the tried-and-true Data 100 approach: <span class="in">`pandas`</span>.</span>
<span id="cb86-504"><a href="#cb86-504" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-507"><a href="#cb86-507" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb86-508"><a href="#cb86-508" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: false</span></span>
<span id="cb86-509"><a href="#cb86-509" aria-hidden="true" tabindex="-1"></a>tb_df <span class="op">=</span> pd.read_csv(<span class="st">"data/cdc_tuberculosis.csv"</span>)</span>
<span id="cb86-510"><a href="#cb86-510" aria-hidden="true" tabindex="-1"></a>tb_df.head()</span>
<span id="cb86-511"><a href="#cb86-511" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb86-512"><a href="#cb86-512" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-513"><a href="#cb86-513" aria-hidden="true" tabindex="-1"></a>You may notice some strange things about this table: what's up with the "Unnamed" column names and the first row? </span>
<span id="cb86-514"><a href="#cb86-514" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-515"><a href="#cb86-515" aria-hidden="true" tabindex="-1"></a>Congratulations — you're ready to wrangle your data! Because of how things are stored, we'll need to clean the data a bit to name our columns better.</span>
<span id="cb86-516"><a href="#cb86-516" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-517"><a href="#cb86-517" aria-hidden="true" tabindex="-1"></a>A reasonable first step is to identify the row with the right header. The <span class="in">`pd.read_csv()`</span> function (<span class="co">[</span><span class="ot">documentation</span><span class="co">](https://pandas.pydata.org/docs/reference/api/pandas.read_csv.html)</span>) has the convenient <span class="in">`header`</span> parameter that we can set to use the elements in row 1 as the appropriate columns:</span>
<span id="cb86-518"><a href="#cb86-518" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-521"><a href="#cb86-521" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb86-522"><a href="#cb86-522" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: false</span></span>
<span id="cb86-523"><a href="#cb86-523" aria-hidden="true" tabindex="-1"></a>tb_df <span class="op">=</span> pd.read_csv(<span class="st">"data/cdc_tuberculosis.csv"</span>, header<span class="op">=</span><span class="dv">1</span>) <span class="co"># row index</span></span>
<span id="cb86-524"><a href="#cb86-524" aria-hidden="true" tabindex="-1"></a>tb_df.head(<span class="dv">5</span>)</span>
<span id="cb86-525"><a href="#cb86-525" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb86-526"><a href="#cb86-526" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-527"><a href="#cb86-527" aria-hidden="true" tabindex="-1"></a><span class="fu">### Record Granularity</span></span>
<span id="cb86-528"><a href="#cb86-528" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-529"><a href="#cb86-529" aria-hidden="true" tabindex="-1"></a>You might already be wondering: what's up with that first record?</span>
<span id="cb86-530"><a href="#cb86-530" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-531"><a href="#cb86-531" aria-hidden="true" tabindex="-1"></a>Row 0 is what we call a **rollup record**, or summary record. It's often useful when displaying tables to humans. The **granularity** of record 0 (Totals) vs the rest of the records (States) is different.</span>
<span id="cb86-532"><a href="#cb86-532" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-533"><a href="#cb86-533" aria-hidden="true" tabindex="-1"></a>Okay, EDA step two. How was the rollup record aggregated?</span>
<span id="cb86-534"><a href="#cb86-534" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-535"><a href="#cb86-535" aria-hidden="true" tabindex="-1"></a>Let's check if Total TB cases is the sum of all state TB cases. If we sum over all rows, we should get **2x** the total cases in each of our TB cases by year (why do you think this is?).</span>
<span id="cb86-536"><a href="#cb86-536" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-539"><a href="#cb86-539" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb86-540"><a href="#cb86-540" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: true</span></span>
<span id="cb86-541"><a href="#cb86-541" aria-hidden="true" tabindex="-1"></a>tb_df.<span class="bu">sum</span>(axis<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb86-542"><a href="#cb86-542" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb86-543"><a href="#cb86-543" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-544"><a href="#cb86-544" aria-hidden="true" tabindex="-1"></a>Whoa, what's going on with the TB cases in 2019, 2020, and 2021? Check out the column types:</span>
<span id="cb86-545"><a href="#cb86-545" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-548"><a href="#cb86-548" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb86-549"><a href="#cb86-549" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: true</span></span>
<span id="cb86-550"><a href="#cb86-550" aria-hidden="true" tabindex="-1"></a>tb_df.dtypes</span>
<span id="cb86-551"><a href="#cb86-551" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb86-552"><a href="#cb86-552" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-553"><a href="#cb86-553" aria-hidden="true" tabindex="-1"></a>Since there are commas in the values for TB cases, the numbers are read as the <span class="in">`object`</span> datatype, or **storage type** (close to the <span class="in">`Python`</span> string datatype), so <span class="in">`pandas`</span> is concatenating strings instead of adding integers (recall that Python can "sum", or concatenate, strings together: <span class="in">`"data" + "100"`</span> evaluates to <span class="in">`"data100"`</span>). </span>
<span id="cb86-554"><a href="#cb86-554" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-555"><a href="#cb86-555" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-556"><a href="#cb86-556" aria-hidden="true" tabindex="-1"></a>Fortunately <span class="in">`read_csv`</span> also has a <span class="in">`thousands`</span> parameter (<span class="co">[</span><span class="ot">documentation</span><span class="co">](https://pandas.pydata.org/docs/reference/api/pandas.read_csv.html)</span>):</span>
<span id="cb86-557"><a href="#cb86-557" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-560"><a href="#cb86-560" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb86-561"><a href="#cb86-561" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: false</span></span>
<span id="cb86-562"><a href="#cb86-562" aria-hidden="true" tabindex="-1"></a><span class="co"># improve readability: chaining method calls with outer parentheses/line breaks</span></span>
<span id="cb86-563"><a href="#cb86-563" aria-hidden="true" tabindex="-1"></a>tb_df <span class="op">=</span> (</span>
<span id="cb86-564"><a href="#cb86-564" aria-hidden="true" tabindex="-1"></a>    pd.read_csv(<span class="st">"data/cdc_tuberculosis.csv"</span>, header<span class="op">=</span><span class="dv">1</span>, thousands<span class="op">=</span><span class="st">','</span>)</span>
<span id="cb86-565"><a href="#cb86-565" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb86-566"><a href="#cb86-566" aria-hidden="true" tabindex="-1"></a>tb_df.head(<span class="dv">5</span>)</span>
<span id="cb86-567"><a href="#cb86-567" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb86-568"><a href="#cb86-568" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-571"><a href="#cb86-571" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb86-572"><a href="#cb86-572" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: false</span></span>
<span id="cb86-573"><a href="#cb86-573" aria-hidden="true" tabindex="-1"></a>tb_df.<span class="bu">sum</span>()</span>
<span id="cb86-574"><a href="#cb86-574" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb86-575"><a href="#cb86-575" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-576"><a href="#cb86-576" aria-hidden="true" tabindex="-1"></a>The total TB cases look right. Phew!</span>
<span id="cb86-577"><a href="#cb86-577" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-578"><a href="#cb86-578" aria-hidden="true" tabindex="-1"></a>Let's just look at the records with **state-level granularity**:</span>
<span id="cb86-579"><a href="#cb86-579" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-582"><a href="#cb86-582" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb86-583"><a href="#cb86-583" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: true</span></span>
<span id="cb86-584"><a href="#cb86-584" aria-hidden="true" tabindex="-1"></a>state_tb_df <span class="op">=</span> tb_df[<span class="dv">1</span>:]</span>
<span id="cb86-585"><a href="#cb86-585" aria-hidden="true" tabindex="-1"></a>state_tb_df.head(<span class="dv">5</span>)</span>
<span id="cb86-586"><a href="#cb86-586" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb86-587"><a href="#cb86-587" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-588"><a href="#cb86-588" aria-hidden="true" tabindex="-1"></a><span class="fu">### Gather Census Data</span></span>
<span id="cb86-589"><a href="#cb86-589" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-590"><a href="#cb86-590" aria-hidden="true" tabindex="-1"></a>U.S. Census population estimates <span class="co">[</span><span class="ot">source</span><span class="co">](https://www.census.gov/data/tables/time-series/demo/popest/2010s-state-total.html)</span> (2019), <span class="co">[</span><span class="ot">source</span><span class="co">](https://www.census.gov/data/tables/time-series/demo/popest/2020s-state-total.html)</span> (2020-2024).</span>
<span id="cb86-591"><a href="#cb86-591" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-592"><a href="#cb86-592" aria-hidden="true" tabindex="-1"></a>Running the below cells cleans the data.</span>
<span id="cb86-593"><a href="#cb86-593" aria-hidden="true" tabindex="-1"></a>There are a few new methods here:</span>
<span id="cb86-594"><a href="#cb86-594" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-595"><a href="#cb86-595" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span><span class="in">`df.convert_dtypes()`</span> (<span class="co">[</span><span class="ot">documentation</span><span class="co">](https://pandas.pydata.org/docs/reference/api/pandas.DataFrame.convert_dtypes.html)</span>) conveniently converts all float dtypes into ints and is out of scope for the class.</span>
<span id="cb86-596"><a href="#cb86-596" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span><span class="in">`df.drop_na()`</span> (<span class="co">[</span><span class="ot">documentation</span><span class="co">](https://pandas.pydata.org/docs/reference/api/pandas.DataFrame.dropna.html)</span>) will be explained in more detail next time.</span>
<span id="cb86-597"><a href="#cb86-597" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-600"><a href="#cb86-600" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb86-601"><a href="#cb86-601" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: true</span></span>
<span id="cb86-602"><a href="#cb86-602" aria-hidden="true" tabindex="-1"></a><span class="co"># 2010s census data</span></span>
<span id="cb86-603"><a href="#cb86-603" aria-hidden="true" tabindex="-1"></a>census_2010s_df <span class="op">=</span> pd.read_csv(<span class="st">"data/nst-est2019-01.csv"</span>, header<span class="op">=</span><span class="dv">3</span>, thousands<span class="op">=</span><span class="st">","</span>)</span>
<span id="cb86-604"><a href="#cb86-604" aria-hidden="true" tabindex="-1"></a>census_2010s_df <span class="op">=</span> (</span>
<span id="cb86-605"><a href="#cb86-605" aria-hidden="true" tabindex="-1"></a>    census_2010s_df</span>
<span id="cb86-606"><a href="#cb86-606" aria-hidden="true" tabindex="-1"></a>    .rename(columns<span class="op">=</span>{<span class="st">"Unnamed: 0"</span>: <span class="st">"Geographic Area"</span>})</span>
<span id="cb86-607"><a href="#cb86-607" aria-hidden="true" tabindex="-1"></a>    .drop(columns<span class="op">=</span>[<span class="st">"Census"</span>, <span class="st">"Estimates Base"</span>])</span>
<span id="cb86-608"><a href="#cb86-608" aria-hidden="true" tabindex="-1"></a>    .convert_dtypes() <span class="co"># "smart" converting of columns to int, use at your own risk</span></span>
<span id="cb86-609"><a href="#cb86-609" aria-hidden="true" tabindex="-1"></a>    .dropna()  <span class="co"># we'll introduce this very soon</span></span>
<span id="cb86-610"><a href="#cb86-610" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb86-611"><a href="#cb86-611" aria-hidden="true" tabindex="-1"></a>census_2010s_df[<span class="st">'Geographic Area'</span>] <span class="op">=</span> census_2010s_df[<span class="st">'Geographic Area'</span>].<span class="bu">str</span>.strip(<span class="st">'.'</span>)</span>
<span id="cb86-612"><a href="#cb86-612" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-613"><a href="#cb86-613" aria-hidden="true" tabindex="-1"></a><span class="co"># with pd.option_context('display.min_rows', 30): # shows more rows</span></span>
<span id="cb86-614"><a href="#cb86-614" aria-hidden="true" tabindex="-1"></a><span class="co">#     display(census_2010s_df)</span></span>
<span id="cb86-615"><a href="#cb86-615" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb86-616"><a href="#cb86-616" aria-hidden="true" tabindex="-1"></a>census_2010s_df.head(<span class="dv">5</span>)</span>
<span id="cb86-617"><a href="#cb86-617" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb86-618"><a href="#cb86-618" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-619"><a href="#cb86-619" aria-hidden="true" tabindex="-1"></a>Occasionally, you will want to modify code that you have imported.  To reimport those modifications you can either use <span class="in">`python`</span>'s <span class="in">`importlib`</span> library:</span>
<span id="cb86-620"><a href="#cb86-620" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-621"><a href="#cb86-621" aria-hidden="true" tabindex="-1"></a><span class="in">```python</span></span>
<span id="cb86-622"><a href="#cb86-622" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> importlib <span class="im">import</span> <span class="bu">reload</span></span>
<span id="cb86-623"><a href="#cb86-623" aria-hidden="true" tabindex="-1"></a><span class="bu">reload</span>(utils)</span>
<span id="cb86-624"><a href="#cb86-624" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb86-625"><a href="#cb86-625" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-626"><a href="#cb86-626" aria-hidden="true" tabindex="-1"></a>or use <span class="in">`iPython`</span> magic which will intelligently import code when files change:</span>
<span id="cb86-627"><a href="#cb86-627" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-628"><a href="#cb86-628" aria-hidden="true" tabindex="-1"></a><span class="in">```python</span></span>
<span id="cb86-629"><a href="#cb86-629" aria-hidden="true" tabindex="-1"></a><span class="op">%</span>load_ext autoreload</span>
<span id="cb86-630"><a href="#cb86-630" aria-hidden="true" tabindex="-1"></a><span class="op">%</span>autoreload <span class="dv">2</span></span>
<span id="cb86-631"><a href="#cb86-631" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb86-632"><a href="#cb86-632" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-635"><a href="#cb86-635" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb86-636"><a href="#cb86-636" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: true</span></span>
<span id="cb86-637"><a href="#cb86-637" aria-hidden="true" tabindex="-1"></a><span class="co"># census 2020s data</span></span>
<span id="cb86-638"><a href="#cb86-638" aria-hidden="true" tabindex="-1"></a>census_2020s_df <span class="op">=</span> pd.read_csv(<span class="st">"data/NST-EST2024-POP.csv"</span>, header<span class="op">=</span><span class="dv">3</span>, thousands<span class="op">=</span><span class="st">","</span>)</span>
<span id="cb86-639"><a href="#cb86-639" aria-hidden="true" tabindex="-1"></a>census_2020s_df <span class="op">=</span> (</span>
<span id="cb86-640"><a href="#cb86-640" aria-hidden="true" tabindex="-1"></a>    census_2020s_df</span>
<span id="cb86-641"><a href="#cb86-641" aria-hidden="true" tabindex="-1"></a>    .drop(columns<span class="op">=</span>[<span class="st">"Unnamed: 1"</span>])</span>
<span id="cb86-642"><a href="#cb86-642" aria-hidden="true" tabindex="-1"></a>    .rename(columns<span class="op">=</span>{<span class="st">"Unnamed: 0"</span>: <span class="st">"Geographic Area"</span>})</span>
<span id="cb86-643"><a href="#cb86-643" aria-hidden="true" tabindex="-1"></a>    .loc[:, <span class="st">"Geographic Area"</span>:<span class="st">"2024"</span>] <span class="co"># ignore all the blank extra columns</span></span>
<span id="cb86-644"><a href="#cb86-644" aria-hidden="true" tabindex="-1"></a>    .convert_dtypes()                 <span class="co"># "smart" converting of columns, use at your own risk</span></span>
<span id="cb86-645"><a href="#cb86-645" aria-hidden="true" tabindex="-1"></a>    .dropna()                         <span class="co"># we'll introduce this next ti</span></span>
<span id="cb86-646"><a href="#cb86-646" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb86-647"><a href="#cb86-647" aria-hidden="true" tabindex="-1"></a>census_2020s_df[<span class="st">'Geographic Area'</span>] <span class="op">=</span> census_2020s_df[<span class="st">'Geographic Area'</span>].<span class="bu">str</span>.strip(<span class="st">'.'</span>)</span>
<span id="cb86-648"><a href="#cb86-648" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-649"><a href="#cb86-649" aria-hidden="true" tabindex="-1"></a>census_2020s_df.head(<span class="dv">5</span>)</span>
<span id="cb86-650"><a href="#cb86-650" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb86-651"><a href="#cb86-651" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-652"><a href="#cb86-652" aria-hidden="true" tabindex="-1"></a><span class="fu">### Joining Data (Merging `DataFrame`s)</span></span>
<span id="cb86-653"><a href="#cb86-653" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-654"><a href="#cb86-654" aria-hidden="true" tabindex="-1"></a>Time to <span class="in">`merge`</span>! Here we use the <span class="in">`DataFrame`</span> method <span class="in">`df1.merge(right=df2, ...)`</span> on <span class="in">`DataFrame`</span> <span class="in">`df1`</span> (<span class="co">[</span><span class="ot">documentation</span><span class="co">](https://pandas.pydata.org/docs/reference/api/pandas.DataFrame.merge.html)</span>). Contrast this with the function <span class="in">`pd.merge(left=df1, right=df2, ...)`</span> (<span class="co">[</span><span class="ot">documentation</span><span class="co">](https://pandas.pydata.org/docs/reference/api/pandas.merge.html?highlight=pandas%20merge#pandas.merge)</span>). Feel free to use either.</span>
<span id="cb86-655"><a href="#cb86-655" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-658"><a href="#cb86-658" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb86-659"><a href="#cb86-659" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: false</span></span>
<span id="cb86-660"><a href="#cb86-660" aria-hidden="true" tabindex="-1"></a><span class="co"># merge TB DataFrame with two US census DataFrames</span></span>
<span id="cb86-661"><a href="#cb86-661" aria-hidden="true" tabindex="-1"></a>tb_census_df <span class="op">=</span> (</span>
<span id="cb86-662"><a href="#cb86-662" aria-hidden="true" tabindex="-1"></a>    tb_df</span>
<span id="cb86-663"><a href="#cb86-663" aria-hidden="true" tabindex="-1"></a>    .merge(right<span class="op">=</span>census_2010s_df,</span>
<span id="cb86-664"><a href="#cb86-664" aria-hidden="true" tabindex="-1"></a>           left_on<span class="op">=</span><span class="st">"U.S. jurisdiction"</span>, right_on<span class="op">=</span><span class="st">"Geographic Area"</span>)</span>
<span id="cb86-665"><a href="#cb86-665" aria-hidden="true" tabindex="-1"></a>    .merge(right<span class="op">=</span>census_2020s_df,</span>
<span id="cb86-666"><a href="#cb86-666" aria-hidden="true" tabindex="-1"></a>           left_on<span class="op">=</span><span class="st">"U.S. jurisdiction"</span>, right_on<span class="op">=</span><span class="st">"Geographic Area"</span>)</span>
<span id="cb86-667"><a href="#cb86-667" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb86-668"><a href="#cb86-668" aria-hidden="true" tabindex="-1"></a>tb_census_df.head(<span class="dv">5</span>)</span>
<span id="cb86-669"><a href="#cb86-669" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb86-670"><a href="#cb86-670" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-671"><a href="#cb86-671" aria-hidden="true" tabindex="-1"></a>We're only interested in the population for the years 2019, 2020, and 2021, so let's select just those columns:</span>
<span id="cb86-672"><a href="#cb86-672" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-675"><a href="#cb86-675" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb86-676"><a href="#cb86-676" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: false</span></span>
<span id="cb86-677"><a href="#cb86-677" aria-hidden="true" tabindex="-1"></a>census_2019_df <span class="op">=</span> census_2010s_df[[<span class="st">'Geographic Area'</span>, <span class="st">'2019'</span>]]</span>
<span id="cb86-678"><a href="#cb86-678" aria-hidden="true" tabindex="-1"></a>census_2020_2021_df <span class="op">=</span> census_2020s_df[[<span class="st">'Geographic Area'</span>, <span class="st">'2020'</span>, <span class="st">'2021'</span>]]</span>
<span id="cb86-679"><a href="#cb86-679" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-680"><a href="#cb86-680" aria-hidden="true" tabindex="-1"></a>display(tb_df.tail(<span class="dv">2</span>))</span>
<span id="cb86-681"><a href="#cb86-681" aria-hidden="true" tabindex="-1"></a>display(census_2019_df.tail(<span class="dv">2</span>))</span>
<span id="cb86-682"><a href="#cb86-682" aria-hidden="true" tabindex="-1"></a>display(census_2020_2021_df.tail(<span class="dv">2</span>))</span>
<span id="cb86-683"><a href="#cb86-683" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb86-684"><a href="#cb86-684" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-685"><a href="#cb86-685" aria-hidden="true" tabindex="-1"></a>All three dataframes have a column containing U.S. states, along with some other geographic areas. These columns are our **join keys**.</span>
<span id="cb86-686"><a href="#cb86-686" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-687"><a href="#cb86-687" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>Below, we use <span class="in">`df1.merge(right=df2, ...)`</span> to carry out the merge (<span class="co">[</span><span class="ot">documentation</span><span class="co">](https://pandas.pydata.org/docs/reference/api/pandas.DataFrame.merge.html)</span>).</span>
<span id="cb86-688"><a href="#cb86-688" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-689"><a href="#cb86-689" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>We could have alternatively used the function <span class="in">`pd.merge(left=df1, right=df2, ...)`</span> (<span class="co">[</span><span class="ot">documentation</span><span class="co">](https://pandas.pydata.org/docs/reference/api/pandas.merge.html#pandas.merge)</span>).</span>
<span id="cb86-690"><a href="#cb86-690" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-693"><a href="#cb86-693" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb86-694"><a href="#cb86-694" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: false</span></span>
<span id="cb86-695"><a href="#cb86-695" aria-hidden="true" tabindex="-1"></a><span class="co"># merge TB dataframe with two US census dataframes</span></span>
<span id="cb86-696"><a href="#cb86-696" aria-hidden="true" tabindex="-1"></a>tb_census_df <span class="op">=</span> (</span>
<span id="cb86-697"><a href="#cb86-697" aria-hidden="true" tabindex="-1"></a>    tb_df</span>
<span id="cb86-698"><a href="#cb86-698" aria-hidden="true" tabindex="-1"></a>    .merge(right<span class="op">=</span>census_2019_df,</span>
<span id="cb86-699"><a href="#cb86-699" aria-hidden="true" tabindex="-1"></a>           left_on<span class="op">=</span><span class="st">"U.S. jurisdiction"</span>, right_on<span class="op">=</span><span class="st">"Geographic Area"</span>)</span>
<span id="cb86-700"><a href="#cb86-700" aria-hidden="true" tabindex="-1"></a>    .merge(right<span class="op">=</span>census_2020_2021_df,</span>
<span id="cb86-701"><a href="#cb86-701" aria-hidden="true" tabindex="-1"></a>           left_on<span class="op">=</span><span class="st">"U.S. jurisdiction"</span>, right_on<span class="op">=</span><span class="st">"Geographic Area"</span>)</span>
<span id="cb86-702"><a href="#cb86-702" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb86-703"><a href="#cb86-703" aria-hidden="true" tabindex="-1"></a>tb_census_df.tail(<span class="dv">2</span>)</span>
<span id="cb86-704"><a href="#cb86-704" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb86-705"><a href="#cb86-705" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-706"><a href="#cb86-706" aria-hidden="true" tabindex="-1"></a>To see what's going on with the duplicate columns, and the <span class="in">`_x`</span> and <span class="in">`_y`</span>, let's do the just the first merge:</span>
<span id="cb86-707"><a href="#cb86-707" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-710"><a href="#cb86-710" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb86-711"><a href="#cb86-711" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: false</span></span>
<span id="cb86-712"><a href="#cb86-712" aria-hidden="true" tabindex="-1"></a>tb_df.merge(right<span class="op">=</span>census_2019_df, </span>
<span id="cb86-713"><a href="#cb86-713" aria-hidden="true" tabindex="-1"></a>            left_on<span class="op">=</span><span class="st">"U.S. jurisdiction"</span>, </span>
<span id="cb86-714"><a href="#cb86-714" aria-hidden="true" tabindex="-1"></a>            right_on<span class="op">=</span><span class="st">"Geographic Area"</span>).head()</span>
<span id="cb86-715"><a href="#cb86-715" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb86-716"><a href="#cb86-716" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-717"><a href="#cb86-717" aria-hidden="true" tabindex="-1"></a>Notice that the columns containing the **join keys** have all been retained, and all contain the same values.</span>
<span id="cb86-718"><a href="#cb86-718" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-719"><a href="#cb86-719" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>Furthermore, notice that the duplicated columns are appended with <span class="in">`_x`</span> and <span class="in">`_y`</span> to keep the column names unique.</span>
<span id="cb86-720"><a href="#cb86-720" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-721"><a href="#cb86-721" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>In the TB case count data, column <span class="in">`2019`</span> represents the number of TB cases in 2019, but in the Census data, column <span class="in">`2019`</span> represents the U.S. population.</span>
<span id="cb86-722"><a href="#cb86-722" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-723"><a href="#cb86-723" aria-hidden="true" tabindex="-1"></a>We can use the <span class="in">`suffixes`</span> argument to modify the <span class="in">`_x`</span> and <span class="in">`_y`</span> defaults to our liking (<span class="co">[</span><span class="ot">documentation</span><span class="co">](https://pandas.pydata.org/docs/reference/api/pandas.merge.html#pandas.merge)</span>).</span>
<span id="cb86-724"><a href="#cb86-724" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-727"><a href="#cb86-727" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb86-728"><a href="#cb86-728" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: false</span></span>
<span id="cb86-729"><a href="#cb86-729" aria-hidden="true" tabindex="-1"></a><span class="co"># Specify the suffixes to use for duplicated column names</span></span>
<span id="cb86-730"><a href="#cb86-730" aria-hidden="true" tabindex="-1"></a>tb_df.merge(right<span class="op">=</span>census_2019_df,</span>
<span id="cb86-731"><a href="#cb86-731" aria-hidden="true" tabindex="-1"></a>           left_on<span class="op">=</span><span class="st">"U.S. jurisdiction"</span>, </span>
<span id="cb86-732"><a href="#cb86-732" aria-hidden="true" tabindex="-1"></a>           right_on<span class="op">=</span><span class="st">"Geographic Area"</span>,</span>
<span id="cb86-733"><a href="#cb86-733" aria-hidden="true" tabindex="-1"></a>           suffixes<span class="op">=</span>(<span class="st">'_cases'</span>, <span class="st">'_population'</span>)).head()</span>
<span id="cb86-734"><a href="#cb86-734" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb86-735"><a href="#cb86-735" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-736"><a href="#cb86-736" aria-hidden="true" tabindex="-1"></a>Notice the <span class="in">`_x`</span> and <span class="in">`_y`</span> have changed to <span class="in">`_cases`</span> and <span class="in">`_population`</span>, just like we specified.</span>
<span id="cb86-737"><a href="#cb86-737" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-738"><a href="#cb86-738" aria-hidden="true" tabindex="-1"></a>Putting it all together, and dropping the duplicated <span class="in">`Geographic Area`</span> columns:</span>
<span id="cb86-739"><a href="#cb86-739" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-742"><a href="#cb86-742" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb86-743"><a href="#cb86-743" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: false</span></span>
<span id="cb86-744"><a href="#cb86-744" aria-hidden="true" tabindex="-1"></a><span class="co"># Redux: merge TB dataframe with two US census dataframes</span></span>
<span id="cb86-745"><a href="#cb86-745" aria-hidden="true" tabindex="-1"></a>tb_census_df <span class="op">=</span> (</span>
<span id="cb86-746"><a href="#cb86-746" aria-hidden="true" tabindex="-1"></a>    tb_df</span>
<span id="cb86-747"><a href="#cb86-747" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb86-748"><a href="#cb86-748" aria-hidden="true" tabindex="-1"></a>    .merge(right<span class="op">=</span>census_2019_df,</span>
<span id="cb86-749"><a href="#cb86-749" aria-hidden="true" tabindex="-1"></a>           left_on<span class="op">=</span><span class="st">"U.S. jurisdiction"</span>, right_on<span class="op">=</span><span class="st">"Geographic Area"</span>,</span>
<span id="cb86-750"><a href="#cb86-750" aria-hidden="true" tabindex="-1"></a>           suffixes<span class="op">=</span>(<span class="st">'_cases'</span>, <span class="st">'_population'</span>))</span>
<span id="cb86-751"><a href="#cb86-751" aria-hidden="true" tabindex="-1"></a>    .drop(columns<span class="op">=</span><span class="st">"Geographic Area"</span>)</span>
<span id="cb86-752"><a href="#cb86-752" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-753"><a href="#cb86-753" aria-hidden="true" tabindex="-1"></a>    .merge(right<span class="op">=</span>census_2020_2021_df,</span>
<span id="cb86-754"><a href="#cb86-754" aria-hidden="true" tabindex="-1"></a>           left_on<span class="op">=</span><span class="st">"U.S. jurisdiction"</span>, right_on<span class="op">=</span><span class="st">"Geographic Area"</span>,</span>
<span id="cb86-755"><a href="#cb86-755" aria-hidden="true" tabindex="-1"></a>           suffixes<span class="op">=</span>(<span class="st">'_cases'</span>, <span class="st">'_population'</span>))</span>
<span id="cb86-756"><a href="#cb86-756" aria-hidden="true" tabindex="-1"></a>    .drop(columns<span class="op">=</span><span class="st">"Geographic Area"</span>)</span>
<span id="cb86-757"><a href="#cb86-757" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb86-758"><a href="#cb86-758" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb86-759"><a href="#cb86-759" aria-hidden="true" tabindex="-1"></a>tb_census_df.tail(<span class="dv">2</span>)</span>
<span id="cb86-760"><a href="#cb86-760" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb86-761"><a href="#cb86-761" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-762"><a href="#cb86-762" aria-hidden="true" tabindex="-1"></a><span class="fu">### Reproducing Data: Compute Incidence</span></span>
<span id="cb86-763"><a href="#cb86-763" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-764"><a href="#cb86-764" aria-hidden="true" tabindex="-1"></a>Let's see if we can reproduce the original CDC numbers from our augmented dataset of TB case counts and state populations.</span>
<span id="cb86-765"><a href="#cb86-765" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-766"><a href="#cb86-766" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Recall that the nationwide TB incidence was **2.7 in 2019**, **2.2 in 2020**, and **2.4 in 2021**.</span>
<span id="cb86-767"><a href="#cb86-767" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-768"><a href="#cb86-768" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Along the way, we'll also compute state-level incidence.</span>
<span id="cb86-769"><a href="#cb86-769" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-770"><a href="#cb86-770" aria-hidden="true" tabindex="-1"></a>From the <span class="co">[</span><span class="ot">CDC report</span><span class="co">](https://www.cdc.gov/mmwr/volumes/71/wr/mm7112a1.htm?s_cid=mm7112a1_w#T1_down)</span>: TB incidence is computed as “Cases per 100,000 persons using mid-year population estimates from the U.S. Census Bureau.”</span>
<span id="cb86-771"><a href="#cb86-771" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-772"><a href="#cb86-772" aria-hidden="true" tabindex="-1"></a>Let's start with a simpler question: What is the per person incidence? </span>
<span id="cb86-773"><a href="#cb86-773" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-774"><a href="#cb86-774" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>In other words, what is the probability that a randomly selected person in the population had TB within a given year?</span>
<span id="cb86-775"><a href="#cb86-775" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-776"><a href="#cb86-776" aria-hidden="true" tabindex="-1"></a>$$\text{TB incidence per person} = \frac{\text{<span class="sc">\#</span> TB cases in population}}{\text{Total population size}}$$</span>
<span id="cb86-777"><a href="#cb86-777" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-778"><a href="#cb86-778" aria-hidden="true" tabindex="-1"></a>Let's calculate per person incidence for 2019:</span>
<span id="cb86-779"><a href="#cb86-779" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-782"><a href="#cb86-782" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb86-783"><a href="#cb86-783" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: false</span></span>
<span id="cb86-784"><a href="#cb86-784" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate per person incidence for 2019</span></span>
<span id="cb86-785"><a href="#cb86-785" aria-hidden="true" tabindex="-1"></a>tb_census_df[<span class="st">"per person incidence 2019"</span>] <span class="op">=</span> (</span>
<span id="cb86-786"><a href="#cb86-786" aria-hidden="true" tabindex="-1"></a>    tb_census_df[<span class="st">"2019_cases"</span>]<span class="op">/</span>tb_census_df[<span class="st">"2019_population"</span>]</span>
<span id="cb86-787"><a href="#cb86-787" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb86-788"><a href="#cb86-788" aria-hidden="true" tabindex="-1"></a>tb_census_df</span>
<span id="cb86-789"><a href="#cb86-789" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb86-790"><a href="#cb86-790" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-791"><a href="#cb86-791" aria-hidden="true" tabindex="-1"></a>TB is really rare in the United States, so per person TB incidence is really low, as expected.</span>
<span id="cb86-792"><a href="#cb86-792" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-793"><a href="#cb86-793" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>But, if we were to consider 100,000 people, the probability of seeing a TB case is higher.</span>
<span id="cb86-794"><a href="#cb86-794" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-795"><a href="#cb86-795" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>In fact, it would be 100,000 times higher!</span>
<span id="cb86-796"><a href="#cb86-796" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-797"><a href="#cb86-797" aria-hidden="true" tabindex="-1"></a>$$\text{TB incidence per 100,000} = \text{100,000} * \text{TB incidence per person}$$</span>
<span id="cb86-798"><a href="#cb86-798" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-801"><a href="#cb86-801" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb86-802"><a href="#cb86-802" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: false</span></span>
<span id="cb86-803"><a href="#cb86-803" aria-hidden="true" tabindex="-1"></a><span class="co"># To help read bigger numbers in Python, you can use _ to separate thousands,</span></span>
<span id="cb86-804"><a href="#cb86-804" aria-hidden="true" tabindex="-1"></a><span class="co"># akin to using commas. 100_000 is the same as writing 100000, but more readable.</span></span>
<span id="cb86-805"><a href="#cb86-805" aria-hidden="true" tabindex="-1"></a>tb_census_df[<span class="st">"per 100k incidence 2019"</span>] <span class="op">=</span> (</span>
<span id="cb86-806"><a href="#cb86-806" aria-hidden="true" tabindex="-1"></a>    <span class="dv">100_000</span> <span class="op">*</span> tb_census_df[<span class="st">"per person incidence 2019"</span>] </span>
<span id="cb86-807"><a href="#cb86-807" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb86-808"><a href="#cb86-808" aria-hidden="true" tabindex="-1"></a>tb_census_df</span>
<span id="cb86-809"><a href="#cb86-809" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb86-810"><a href="#cb86-810" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-811"><a href="#cb86-811" aria-hidden="true" tabindex="-1"></a>Now we're seeing more human-readable values.</span>
<span id="cb86-812"><a href="#cb86-812" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-813"><a href="#cb86-813" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>For example, there 5.3 tuberculosis cases for every 100,000 California residents in 2019.</span>
<span id="cb86-814"><a href="#cb86-814" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-815"><a href="#cb86-815" aria-hidden="true" tabindex="-1"></a>To wrap up this exercise, let's calculate the nationwide incidence of TB in 2019.</span>
<span id="cb86-816"><a href="#cb86-816" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-819"><a href="#cb86-819" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb86-820"><a href="#cb86-820" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: false</span></span>
<span id="cb86-821"><a href="#cb86-821" aria-hidden="true" tabindex="-1"></a><span class="co"># Recall that the CDC reported an incidence of 2.7 per 100,000 in 2019.</span></span>
<span id="cb86-822"><a href="#cb86-822" aria-hidden="true" tabindex="-1"></a>tot_tb_cases_50_states <span class="op">=</span> tb_census_df[<span class="st">"2019_cases"</span>].<span class="bu">sum</span>()</span>
<span id="cb86-823"><a href="#cb86-823" aria-hidden="true" tabindex="-1"></a>tot_pop_50_states <span class="op">=</span> tb_census_df[<span class="st">"2019_population"</span>].<span class="bu">sum</span>()</span>
<span id="cb86-824"><a href="#cb86-824" aria-hidden="true" tabindex="-1"></a>tb_per_100k_50_states <span class="op">=</span> <span class="dv">100_000</span> <span class="op">*</span> tot_tb_cases_50_states <span class="op">/</span> tot_pop_50_states</span>
<span id="cb86-825"><a href="#cb86-825" aria-hidden="true" tabindex="-1"></a>tb_per_100k_50_states</span>
<span id="cb86-826"><a href="#cb86-826" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb86-827"><a href="#cb86-827" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-828"><a href="#cb86-828" aria-hidden="true" tabindex="-1"></a>We can use a <span class="in">`for`</span> loop to compute the incidence for 2019, 2020, and 2021.</span>
<span id="cb86-829"><a href="#cb86-829" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-830"><a href="#cb86-830" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>You'll notice that we get the same numbers reported by the CDC!</span>
<span id="cb86-831"><a href="#cb86-831" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-834"><a href="#cb86-834" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb86-835"><a href="#cb86-835" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: false</span></span>
<span id="cb86-836"><a href="#cb86-836" aria-hidden="true" tabindex="-1"></a><span class="co"># f strings (f"...") are a handy way to pass in variables to strings.</span></span>
<span id="cb86-837"><a href="#cb86-837" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> year <span class="kw">in</span> [<span class="dv">2019</span>, <span class="dv">2020</span>, <span class="dv">2021</span>]:</span>
<span id="cb86-838"><a href="#cb86-838" aria-hidden="true" tabindex="-1"></a>  tot_tb_cases_50_states <span class="op">=</span> tb_census_df[<span class="ss">f"</span><span class="sc">{</span>year<span class="sc">}</span><span class="ss">_cases"</span>].<span class="bu">sum</span>()</span>
<span id="cb86-839"><a href="#cb86-839" aria-hidden="true" tabindex="-1"></a>  tot_pop_50_states <span class="op">=</span> tb_census_df[<span class="ss">f"</span><span class="sc">{</span>year<span class="sc">}</span><span class="ss">_population"</span>].<span class="bu">sum</span>()</span>
<span id="cb86-840"><a href="#cb86-840" aria-hidden="true" tabindex="-1"></a>  tb_per_100k_50_states <span class="op">=</span> <span class="dv">100_000</span> <span class="op">*</span> tot_tb_cases_50_states <span class="op">/</span> tot_pop_50_states</span>
<span id="cb86-841"><a href="#cb86-841" aria-hidden="true" tabindex="-1"></a>  <span class="bu">print</span>(tb_per_100k_50_states)</span>
<span id="cb86-842"><a href="#cb86-842" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb86-843"><a href="#cb86-843" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-844"><a href="#cb86-844" aria-hidden="true" tabindex="-1"></a><span class="fu">## Summary</span></span>
<span id="cb86-845"><a href="#cb86-845" aria-hidden="true" tabindex="-1"></a>We went over a lot of content this lecture; let's summarize the most important points: </span>
<span id="cb86-846"><a href="#cb86-846" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-847"><a href="#cb86-847" aria-hidden="true" tabindex="-1"></a><span class="fu">### Dealing with Missing Values</span></span>
<span id="cb86-848"><a href="#cb86-848" aria-hidden="true" tabindex="-1"></a>There are a few options we can take to deal with missing data:</span>
<span id="cb86-849"><a href="#cb86-849" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-850"><a href="#cb86-850" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>Drop missing records</span>
<span id="cb86-851"><a href="#cb86-851" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>Keep <span class="in">`NaN`</span> missing values</span>
<span id="cb86-852"><a href="#cb86-852" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>Impute using an interpolated column</span>
<span id="cb86-853"><a href="#cb86-853" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-854"><a href="#cb86-854" aria-hidden="true" tabindex="-1"></a><span class="fu">### EDA and Data Wrangling</span></span>
<span id="cb86-855"><a href="#cb86-855" aria-hidden="true" tabindex="-1"></a>There are several ways to approach EDA and Data Wrangling: </span>
<span id="cb86-856"><a href="#cb86-856" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-857"><a href="#cb86-857" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>Examine the **data and metadata**: what is the date, size, organization, and structure of the data? </span>
<span id="cb86-858"><a href="#cb86-858" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>Examine each **field/attribute/dimension** individually.</span>
<span id="cb86-859"><a href="#cb86-859" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>Examine pairs of related dimensions (e.g. breaking down grades by major).</span>
<span id="cb86-860"><a href="#cb86-860" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>Along the way, we can:</span>
<span id="cb86-861"><a href="#cb86-861" aria-hidden="true" tabindex="-1"></a><span class="ss">    * </span>**Visualize** or summarize the data.</span>
<span id="cb86-862"><a href="#cb86-862" aria-hidden="true" tabindex="-1"></a><span class="ss">    * </span>**Validate assumptions** about data and its collection process. Pay particular attention to when the data was collected. </span>
<span id="cb86-863"><a href="#cb86-863" aria-hidden="true" tabindex="-1"></a><span class="ss">    * </span>Identify and **address anomalies**.</span>
<span id="cb86-864"><a href="#cb86-864" aria-hidden="true" tabindex="-1"></a><span class="ss">    * </span>Apply data transformations and corrections (we'll cover this in the upcoming lecture).</span>
<span id="cb86-865"><a href="#cb86-865" aria-hidden="true" tabindex="-1"></a><span class="ss">    * </span>**Record everything you do!** Developing in Jupyter Notebook promotes *reproducibility* of your own work!</span>
<span id="cb86-866"><a href="#cb86-866" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-867"><a href="#cb86-867" aria-hidden="true" tabindex="-1"></a><span class="fu">## [BONUS] EDA Demo 2: Mauna Loa CO&lt;sub&gt;2&lt;/sub&gt; Data -- A Lesson in Data Faithfulness</span></span>
<span id="cb86-868"><a href="#cb86-868" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-869"><a href="#cb86-869" aria-hidden="true" tabindex="-1"></a>We no longer cover the following demo in lecture, but we provide the following section in the course notes for interested students.</span>
<span id="cb86-870"><a href="#cb86-870" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-871"><a href="#cb86-871" aria-hidden="true" tabindex="-1"></a><span class="co">[</span><span class="ot">Mauna Loa Observatory</span><span class="co">](https://gml.noaa.gov/ccgg/trends/data.html)</span> has been monitoring CO<span class="dt">&lt;</span><span class="kw">sub</span><span class="dt">&gt;</span>2<span class="dt">&lt;/</span><span class="kw">sub</span><span class="dt">&gt;</span> concentrations since 1958.</span>
<span id="cb86-872"><a href="#cb86-872" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-875"><a href="#cb86-875" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb86-876"><a href="#cb86-876" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: false</span></span>
<span id="cb86-877"><a href="#cb86-877" aria-hidden="true" tabindex="-1"></a>co2_file <span class="op">=</span> <span class="st">"data/co2_mm_mlo.txt"</span></span>
<span id="cb86-878"><a href="#cb86-878" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb86-879"><a href="#cb86-879" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-880"><a href="#cb86-880" aria-hidden="true" tabindex="-1"></a>Let's do some **EDA**!!</span>
<span id="cb86-881"><a href="#cb86-881" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-882"><a href="#cb86-882" aria-hidden="true" tabindex="-1"></a><span class="fu">### Reading this file into `Pandas`?</span></span>
<span id="cb86-883"><a href="#cb86-883" aria-hidden="true" tabindex="-1"></a>Let's instead check out this <span class="in">`.txt`</span> file. Some questions to keep in mind: Do we trust this file extension? What structure is it? </span>
<span id="cb86-884"><a href="#cb86-884" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-885"><a href="#cb86-885" aria-hidden="true" tabindex="-1"></a>Lines 71-78 (inclusive) are shown below: </span>
<span id="cb86-886"><a href="#cb86-886" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-887"><a href="#cb86-887" aria-hidden="true" tabindex="-1"></a><span class="in">    line number |                            file contents</span></span>
<span id="cb86-888"><a href="#cb86-888" aria-hidden="true" tabindex="-1"></a><span class="in">    </span></span>
<span id="cb86-889"><a href="#cb86-889" aria-hidden="true" tabindex="-1"></a><span class="in">    71          |   #            decimal     average   interpolated    trend    #days</span></span>
<span id="cb86-890"><a href="#cb86-890" aria-hidden="true" tabindex="-1"></a><span class="in">    72          |   #             date                             (season corr)</span></span>
<span id="cb86-891"><a href="#cb86-891" aria-hidden="true" tabindex="-1"></a><span class="in">    73          |   1958   3    1958.208      315.71      315.71      314.62     -1</span></span>
<span id="cb86-892"><a href="#cb86-892" aria-hidden="true" tabindex="-1"></a><span class="in">    74          |   1958   4    1958.292      317.45      317.45      315.29     -1</span></span>
<span id="cb86-893"><a href="#cb86-893" aria-hidden="true" tabindex="-1"></a><span class="in">    75          |   1958   5    1958.375      317.50      317.50      314.71     -1</span></span>
<span id="cb86-894"><a href="#cb86-894" aria-hidden="true" tabindex="-1"></a><span class="in">    76          |   1958   6    1958.458      -99.99      317.10      314.85     -1</span></span>
<span id="cb86-895"><a href="#cb86-895" aria-hidden="true" tabindex="-1"></a><span class="in">    77          |   1958   7    1958.542      315.86      315.86      314.98     -1</span></span>
<span id="cb86-896"><a href="#cb86-896" aria-hidden="true" tabindex="-1"></a><span class="in">    78          |   1958   8    1958.625      314.93      314.93      315.94     -1</span></span>
<span id="cb86-897"><a href="#cb86-897" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-898"><a href="#cb86-898" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-899"><a href="#cb86-899" aria-hidden="true" tabindex="-1"></a>Notice how: </span>
<span id="cb86-900"><a href="#cb86-900" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-901"><a href="#cb86-901" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>The values are separated by white space, possibly tabs.</span>
<span id="cb86-902"><a href="#cb86-902" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>The data line up down the rows. For example, the month appears in 7th to 8th position of each line.</span>
<span id="cb86-903"><a href="#cb86-903" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>The 71st and 72nd lines in the file contain column headings split over two lines.</span>
<span id="cb86-904"><a href="#cb86-904" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-905"><a href="#cb86-905" aria-hidden="true" tabindex="-1"></a>We can use&nbsp;<span class="in">`read_csv`</span>&nbsp;to read the data into a <span class="in">`pandas`</span> <span class="in">`DataFrame`</span>, and we provide several arguments to specify that the separators are white space, there is no header (**we will set our own column names**), and to skip the first 72 rows of the file.</span>
<span id="cb86-906"><a href="#cb86-906" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-909"><a href="#cb86-909" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb86-910"><a href="#cb86-910" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: false</span></span>
<span id="cb86-911"><a href="#cb86-911" aria-hidden="true" tabindex="-1"></a>co2 <span class="op">=</span> pd.read_csv(</span>
<span id="cb86-912"><a href="#cb86-912" aria-hidden="true" tabindex="-1"></a>    co2_file, header <span class="op">=</span> <span class="va">None</span>, skiprows <span class="op">=</span> <span class="dv">72</span>,</span>
<span id="cb86-913"><a href="#cb86-913" aria-hidden="true" tabindex="-1"></a>    sep <span class="op">=</span> <span class="vs">r'</span><span class="dv">\s</span><span class="op">+</span><span class="vs">'</span>       <span class="co">#delimiter for continuous whitespace (stay tuned for regex next lecture))</span></span>
<span id="cb86-914"><a href="#cb86-914" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb86-915"><a href="#cb86-915" aria-hidden="true" tabindex="-1"></a>co2.head()</span>
<span id="cb86-916"><a href="#cb86-916" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb86-917"><a href="#cb86-917" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-918"><a href="#cb86-918" aria-hidden="true" tabindex="-1"></a>Congratulations! You've wrangled the data!</span>
<span id="cb86-919"><a href="#cb86-919" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-920"><a href="#cb86-920" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;</span><span class="kw">br</span><span class="dt">/&gt;</span></span>
<span id="cb86-921"><a href="#cb86-921" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-922"><a href="#cb86-922" aria-hidden="true" tabindex="-1"></a>...But our columns aren't named.</span>
<span id="cb86-923"><a href="#cb86-923" aria-hidden="true" tabindex="-1"></a>**We need to do more EDA.**</span>
<span id="cb86-924"><a href="#cb86-924" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-925"><a href="#cb86-925" aria-hidden="true" tabindex="-1"></a><span class="fu">### Exploring Variable Feature Types</span></span>
<span id="cb86-926"><a href="#cb86-926" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-927"><a href="#cb86-927" aria-hidden="true" tabindex="-1"></a>The NOAA <span class="co">[</span><span class="ot">webpage</span><span class="co">](https://gml.noaa.gov/ccgg/trends/)</span> might have some useful tidbits (in this case it doesn't).</span>
<span id="cb86-928"><a href="#cb86-928" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-929"><a href="#cb86-929" aria-hidden="true" tabindex="-1"></a>Using this information, we'll rerun <span class="in">`pd.read_csv`</span>, but this time with some **custom column names.**</span>
<span id="cb86-930"><a href="#cb86-930" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-933"><a href="#cb86-933" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb86-934"><a href="#cb86-934" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: false</span></span>
<span id="cb86-935"><a href="#cb86-935" aria-hidden="true" tabindex="-1"></a>co2 <span class="op">=</span> pd.read_csv(</span>
<span id="cb86-936"><a href="#cb86-936" aria-hidden="true" tabindex="-1"></a>    co2_file, header <span class="op">=</span> <span class="va">None</span>, skiprows <span class="op">=</span> <span class="dv">72</span>,</span>
<span id="cb86-937"><a href="#cb86-937" aria-hidden="true" tabindex="-1"></a>    sep <span class="op">=</span> <span class="vs">r'</span><span class="dv">\s</span><span class="op">+</span><span class="vs">'</span>, <span class="co">#regex for continuous whitespace (next lecture)</span></span>
<span id="cb86-938"><a href="#cb86-938" aria-hidden="true" tabindex="-1"></a>    names <span class="op">=</span> [<span class="st">'Yr'</span>, <span class="st">'Mo'</span>, <span class="st">'DecDate'</span>, <span class="st">'Avg'</span>, <span class="st">'Int'</span>, <span class="st">'Trend'</span>, <span class="st">'Days'</span>]</span>
<span id="cb86-939"><a href="#cb86-939" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb86-940"><a href="#cb86-940" aria-hidden="true" tabindex="-1"></a>co2.head()</span>
<span id="cb86-941"><a href="#cb86-941" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb86-942"><a href="#cb86-942" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-943"><a href="#cb86-943" aria-hidden="true" tabindex="-1"></a><span class="fu">### Visualizing CO&lt;sub&gt;2&lt;/sub&gt;</span></span>
<span id="cb86-944"><a href="#cb86-944" aria-hidden="true" tabindex="-1"></a>Scientific studies tend to have very clean data, right...? Let's jump right in and make a time series plot of CO<span class="dt">&lt;</span><span class="kw">sub</span><span class="dt">&gt;</span>2<span class="dt">&lt;/</span><span class="kw">sub</span><span class="dt">&gt;</span> monthly averages.</span>
<span id="cb86-945"><a href="#cb86-945" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-948"><a href="#cb86-948" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb86-949"><a href="#cb86-949" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: true</span></span>
<span id="cb86-950"><a href="#cb86-950" aria-hidden="true" tabindex="-1"></a>sns.lineplot(x<span class="op">=</span><span class="st">'DecDate'</span>, y<span class="op">=</span><span class="st">'Avg'</span>, data<span class="op">=</span>co2)<span class="op">;</span></span>
<span id="cb86-951"><a href="#cb86-951" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb86-952"><a href="#cb86-952" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-953"><a href="#cb86-953" aria-hidden="true" tabindex="-1"></a>The code above uses the <span class="in">`seaborn`</span> plotting library (abbreviated <span class="in">`sns`</span>). We will cover this in the Visualization lecture, but now you don't need to worry about how it works!</span>
<span id="cb86-954"><a href="#cb86-954" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-955"><a href="#cb86-955" aria-hidden="true" tabindex="-1"></a>Yikes! Plotting the data uncovered a problem. The sharp vertical lines suggest that we have some **missing values**. What happened here?</span>
<span id="cb86-956"><a href="#cb86-956" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-959"><a href="#cb86-959" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb86-960"><a href="#cb86-960" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: false</span></span>
<span id="cb86-961"><a href="#cb86-961" aria-hidden="true" tabindex="-1"></a>co2.head()</span>
<span id="cb86-962"><a href="#cb86-962" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb86-963"><a href="#cb86-963" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-966"><a href="#cb86-966" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb86-967"><a href="#cb86-967" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: false</span></span>
<span id="cb86-968"><a href="#cb86-968" aria-hidden="true" tabindex="-1"></a>co2.tail()</span>
<span id="cb86-969"><a href="#cb86-969" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb86-970"><a href="#cb86-970" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-971"><a href="#cb86-971" aria-hidden="true" tabindex="-1"></a>Some data have unusual values like -1 and -99.99.</span>
<span id="cb86-972"><a href="#cb86-972" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-973"><a href="#cb86-973" aria-hidden="true" tabindex="-1"></a>Let's check the description at the top of the file again.</span>
<span id="cb86-974"><a href="#cb86-974" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-975"><a href="#cb86-975" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>-1 signifies a missing value for the number of days <span class="in">`Days`</span> the equipment was in operation that month.</span>
<span id="cb86-976"><a href="#cb86-976" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>-99.99 denotes a missing monthly average <span class="in">`Avg`</span></span>
<span id="cb86-977"><a href="#cb86-977" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-978"><a href="#cb86-978" aria-hidden="true" tabindex="-1"></a>How can we fix this? First, let's explore other aspects of our data. Understanding our data will help us decide what to do with the missing values.</span>
<span id="cb86-979"><a href="#cb86-979" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-980"><a href="#cb86-980" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;</span><span class="kw">br</span><span class="dt">/&gt;</span></span>
<span id="cb86-981"><a href="#cb86-981" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-982"><a href="#cb86-982" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-983"><a href="#cb86-983" aria-hidden="true" tabindex="-1"></a><span class="fu">### Sanity Checks: Reasoning about the data</span></span>
<span id="cb86-984"><a href="#cb86-984" aria-hidden="true" tabindex="-1"></a>First, we consider the shape of the data. How many rows should we have?</span>
<span id="cb86-985"><a href="#cb86-985" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-986"><a href="#cb86-986" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>If chronological order, we should have one record per month.</span>
<span id="cb86-987"><a href="#cb86-987" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>Data from March 1958 to August 2019.</span>
<span id="cb86-988"><a href="#cb86-988" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>We should have $ 12 \times (2019-1957) - 2 - 4 = 738 $ records.</span>
<span id="cb86-989"><a href="#cb86-989" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-992"><a href="#cb86-992" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb86-993"><a href="#cb86-993" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: false</span></span>
<span id="cb86-994"><a href="#cb86-994" aria-hidden="true" tabindex="-1"></a>co2.shape</span>
<span id="cb86-995"><a href="#cb86-995" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb86-996"><a href="#cb86-996" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-997"><a href="#cb86-997" aria-hidden="true" tabindex="-1"></a>Nice!! The number of rows (i.e. records) match our expectations.</span>
<span id="cb86-998"><a href="#cb86-998" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-999"><a href="#cb86-999" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-1000"><a href="#cb86-1000" aria-hidden="true" tabindex="-1"></a>Let's now check the quality of each feature.</span>
<span id="cb86-1001"><a href="#cb86-1001" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-1002"><a href="#cb86-1002" aria-hidden="true" tabindex="-1"></a><span class="fu">### Understanding Missing Value 1: `Days`</span></span>
<span id="cb86-1003"><a href="#cb86-1003" aria-hidden="true" tabindex="-1"></a><span class="in">`Days`</span> is a time field, so let's analyze other time fields to see if there is an explanation for missing values of days of operation.</span>
<span id="cb86-1004"><a href="#cb86-1004" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-1005"><a href="#cb86-1005" aria-hidden="true" tabindex="-1"></a>Let's start with **months**, <span class="in">`Mo`</span>.</span>
<span id="cb86-1006"><a href="#cb86-1006" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-1007"><a href="#cb86-1007" aria-hidden="true" tabindex="-1"></a>Are we missing any records? The number of months should have 62 or 61 instances (March 1957-August 2019).</span>
<span id="cb86-1008"><a href="#cb86-1008" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-1011"><a href="#cb86-1011" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb86-1012"><a href="#cb86-1012" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: false</span></span>
<span id="cb86-1013"><a href="#cb86-1013" aria-hidden="true" tabindex="-1"></a>co2[<span class="st">"Mo"</span>].value_counts().sort_index()</span>
<span id="cb86-1014"><a href="#cb86-1014" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb86-1015"><a href="#cb86-1015" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-1016"><a href="#cb86-1016" aria-hidden="true" tabindex="-1"></a>As expected Jan, Feb, Sep, Oct, Nov, and Dec have 61 occurrences and the rest 62.</span>
<span id="cb86-1017"><a href="#cb86-1017" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-1018"><a href="#cb86-1018" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;</span><span class="kw">br</span><span class="dt">/&gt;</span></span>
<span id="cb86-1019"><a href="#cb86-1019" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-1020"><a href="#cb86-1020" aria-hidden="true" tabindex="-1"></a>Next let's explore **days** <span class="in">`Days`</span> itself, which is the number of days that the measurement equipment worked.</span>
<span id="cb86-1021"><a href="#cb86-1021" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-1024"><a href="#cb86-1024" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb86-1025"><a href="#cb86-1025" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: true</span></span>
<span id="cb86-1026"><a href="#cb86-1026" aria-hidden="true" tabindex="-1"></a>sns.displot(co2[<span class="st">'Days'</span>])<span class="op">;</span></span>
<span id="cb86-1027"><a href="#cb86-1027" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"Distribution of days feature"</span>)<span class="op">;</span> <span class="co"># suppresses unneeded plotting output</span></span>
<span id="cb86-1028"><a href="#cb86-1028" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb86-1029"><a href="#cb86-1029" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-1030"><a href="#cb86-1030" aria-hidden="true" tabindex="-1"></a>In terms of data quality, a handful of months have averages based on measurements taken on fewer than half the days. In addition, there are nearly 200 missing values--**that's about 27% of the data**!</span>
<span id="cb86-1031"><a href="#cb86-1031" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-1032"><a href="#cb86-1032" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;</span><span class="kw">br</span><span class="dt">/&gt;</span></span>
<span id="cb86-1033"><a href="#cb86-1033" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-1034"><a href="#cb86-1034" aria-hidden="true" tabindex="-1"></a>Finally, let's check the last time feature, **year** <span class="in">`Yr`</span>.</span>
<span id="cb86-1035"><a href="#cb86-1035" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-1036"><a href="#cb86-1036" aria-hidden="true" tabindex="-1"></a>Let's check to see if there is any connection between missing-ness and the year of the recording.</span>
<span id="cb86-1037"><a href="#cb86-1037" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-1040"><a href="#cb86-1040" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb86-1041"><a href="#cb86-1041" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: true</span></span>
<span id="cb86-1042"><a href="#cb86-1042" aria-hidden="true" tabindex="-1"></a>sns.scatterplot(x<span class="op">=</span><span class="st">"Yr"</span>, y<span class="op">=</span><span class="st">"Days"</span>, data<span class="op">=</span>co2)<span class="op">;</span></span>
<span id="cb86-1043"><a href="#cb86-1043" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"Day field by Year"</span>)<span class="op">;</span> <span class="co"># the ; suppresses output</span></span>
<span id="cb86-1044"><a href="#cb86-1044" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb86-1045"><a href="#cb86-1045" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-1046"><a href="#cb86-1046" aria-hidden="true" tabindex="-1"></a>**Observations**:</span>
<span id="cb86-1047"><a href="#cb86-1047" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-1048"><a href="#cb86-1048" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>All of the missing data are in the early years of operation.</span>
<span id="cb86-1049"><a href="#cb86-1049" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>It appears there may have been problems with equipment in the mid to late 80s.</span>
<span id="cb86-1050"><a href="#cb86-1050" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-1051"><a href="#cb86-1051" aria-hidden="true" tabindex="-1"></a>**Potential Next Steps**:</span>
<span id="cb86-1052"><a href="#cb86-1052" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-1053"><a href="#cb86-1053" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>Confirm these explanations through documentation about the historical readings.</span>
<span id="cb86-1054"><a href="#cb86-1054" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>Maybe drop the earliest recordings? However, we would want to delay such action until after we have examined the time trends and assess whether there are any potential problems.</span>
<span id="cb86-1055"><a href="#cb86-1055" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-1056"><a href="#cb86-1056" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;</span><span class="kw">br</span><span class="dt">/&gt;</span></span>
<span id="cb86-1057"><a href="#cb86-1057" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-1058"><a href="#cb86-1058" aria-hidden="true" tabindex="-1"></a><span class="fu">### Understanding Missing Value 2: `Avg`</span></span>
<span id="cb86-1059"><a href="#cb86-1059" aria-hidden="true" tabindex="-1"></a>Next, let's return to the -99.99 values in <span class="in">`Avg`</span> to analyze the overall quality of the CO<span class="dt">&lt;</span><span class="kw">sub</span><span class="dt">&gt;</span>2<span class="dt">&lt;/</span><span class="kw">sub</span><span class="dt">&gt;</span> measurements. We'll plot a histogram of the average CO<span class="dt">&lt;</span><span class="kw">sub</span><span class="dt">&gt;</span>2<span class="dt">&lt;/</span><span class="kw">sub</span><span class="dt">&gt;</span> measurements</span>
<span id="cb86-1060"><a href="#cb86-1060" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-1063"><a href="#cb86-1063" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb86-1064"><a href="#cb86-1064" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: true</span></span>
<span id="cb86-1065"><a href="#cb86-1065" aria-hidden="true" tabindex="-1"></a><span class="co"># Histograms of average CO2 measurements</span></span>
<span id="cb86-1066"><a href="#cb86-1066" aria-hidden="true" tabindex="-1"></a>sns.displot(co2[<span class="st">'Avg'</span>])<span class="op">;</span></span>
<span id="cb86-1067"><a href="#cb86-1067" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb86-1068"><a href="#cb86-1068" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-1069"><a href="#cb86-1069" aria-hidden="true" tabindex="-1"></a>The non-missing values are in the 300-400 range (a regular range of CO<span class="dt">&lt;</span><span class="kw">sub</span><span class="dt">&gt;</span>2<span class="dt">&lt;/</span><span class="kw">sub</span><span class="dt">&gt;</span> levels).</span>
<span id="cb86-1070"><a href="#cb86-1070" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-1071"><a href="#cb86-1071" aria-hidden="true" tabindex="-1"></a>We also see that there are only a few missing <span class="in">`Avg`</span> values (**&lt;1% of values**). Let's examine all of them:</span>
<span id="cb86-1072"><a href="#cb86-1072" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-1075"><a href="#cb86-1075" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb86-1076"><a href="#cb86-1076" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: false</span></span>
<span id="cb86-1077"><a href="#cb86-1077" aria-hidden="true" tabindex="-1"></a>co2[co2[<span class="st">"Avg"</span>] <span class="op">&lt;</span> <span class="dv">0</span>]</span>
<span id="cb86-1078"><a href="#cb86-1078" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb86-1079"><a href="#cb86-1079" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-1080"><a href="#cb86-1080" aria-hidden="true" tabindex="-1"></a>There doesn't seem to be a pattern to these values, other than that most records also were missing <span class="in">`Days`</span> data.</span>
<span id="cb86-1081"><a href="#cb86-1081" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-1082"><a href="#cb86-1082" aria-hidden="true" tabindex="-1"></a><span class="fu">### Drop, `NaN`, or Impute Missing `Avg` Data?</span></span>
<span id="cb86-1083"><a href="#cb86-1083" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-1084"><a href="#cb86-1084" aria-hidden="true" tabindex="-1"></a>How should we address the invalid <span class="in">`Avg`</span> data?</span>
<span id="cb86-1085"><a href="#cb86-1085" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-1086"><a href="#cb86-1086" aria-hidden="true" tabindex="-1"></a><span class="ss">1. </span>Drop records</span>
<span id="cb86-1087"><a href="#cb86-1087" aria-hidden="true" tabindex="-1"></a><span class="ss">2. </span>Set to NaN</span>
<span id="cb86-1088"><a href="#cb86-1088" aria-hidden="true" tabindex="-1"></a><span class="ss">3. </span>Impute using some strategy</span>
<span id="cb86-1089"><a href="#cb86-1089" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-1090"><a href="#cb86-1090" aria-hidden="true" tabindex="-1"></a>Remember we want to fix the following plot:</span>
<span id="cb86-1091"><a href="#cb86-1091" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-1094"><a href="#cb86-1094" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb86-1095"><a href="#cb86-1095" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: true</span></span>
<span id="cb86-1096"><a href="#cb86-1096" aria-hidden="true" tabindex="-1"></a>sns.lineplot(x<span class="op">=</span><span class="st">'DecDate'</span>, y<span class="op">=</span><span class="st">'Avg'</span>, data<span class="op">=</span>co2)</span>
<span id="cb86-1097"><a href="#cb86-1097" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"CO2 Average By Month"</span>)<span class="op">;</span></span>
<span id="cb86-1098"><a href="#cb86-1098" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb86-1099"><a href="#cb86-1099" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-1100"><a href="#cb86-1100" aria-hidden="true" tabindex="-1"></a>Since we are plotting <span class="in">`Avg`</span> vs <span class="in">`DecDate`</span>, we should just focus on dealing with missing values for <span class="in">`Avg`</span>.</span>
<span id="cb86-1101"><a href="#cb86-1101" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-1102"><a href="#cb86-1102" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-1103"><a href="#cb86-1103" aria-hidden="true" tabindex="-1"></a>Let's consider a few options:</span>
<span id="cb86-1104"><a href="#cb86-1104" aria-hidden="true" tabindex="-1"></a><span class="ss">1. </span>Drop those records</span>
<span id="cb86-1105"><a href="#cb86-1105" aria-hidden="true" tabindex="-1"></a><span class="ss">2. </span>Replace -99.99 with NaN</span>
<span id="cb86-1106"><a href="#cb86-1106" aria-hidden="true" tabindex="-1"></a><span class="ss">3. </span>Substitute it with a likely value for the average CO<span class="dt">&lt;</span><span class="kw">sub</span><span class="dt">&gt;</span>2<span class="dt">&lt;/</span><span class="kw">sub</span><span class="dt">&gt;</span>?</span>
<span id="cb86-1107"><a href="#cb86-1107" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-1108"><a href="#cb86-1108" aria-hidden="true" tabindex="-1"></a>What do you think are the pros and cons of each possible action?</span>
<span id="cb86-1109"><a href="#cb86-1109" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-1110"><a href="#cb86-1110" aria-hidden="true" tabindex="-1"></a>Let's examine each of these three options.</span>
<span id="cb86-1111"><a href="#cb86-1111" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-1114"><a href="#cb86-1114" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb86-1115"><a href="#cb86-1115" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: false</span></span>
<span id="cb86-1116"><a href="#cb86-1116" aria-hidden="true" tabindex="-1"></a><span class="co"># 1. Drop missing values</span></span>
<span id="cb86-1117"><a href="#cb86-1117" aria-hidden="true" tabindex="-1"></a>co2_drop <span class="op">=</span> co2[co2[<span class="st">'Avg'</span>] <span class="op">&gt;</span> <span class="dv">0</span>]</span>
<span id="cb86-1118"><a href="#cb86-1118" aria-hidden="true" tabindex="-1"></a>co2_drop.head()</span>
<span id="cb86-1119"><a href="#cb86-1119" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb86-1120"><a href="#cb86-1120" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-1123"><a href="#cb86-1123" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb86-1124"><a href="#cb86-1124" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: false</span></span>
<span id="cb86-1125"><a href="#cb86-1125" aria-hidden="true" tabindex="-1"></a><span class="co"># 2. Replace NaN with -99.99</span></span>
<span id="cb86-1126"><a href="#cb86-1126" aria-hidden="true" tabindex="-1"></a>co2_NA <span class="op">=</span> co2.replace(<span class="op">-</span><span class="fl">99.99</span>, np.nan)</span>
<span id="cb86-1127"><a href="#cb86-1127" aria-hidden="true" tabindex="-1"></a>co2_NA.head()</span>
<span id="cb86-1128"><a href="#cb86-1128" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb86-1129"><a href="#cb86-1129" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-1130"><a href="#cb86-1130" aria-hidden="true" tabindex="-1"></a>We'll also use a third version of the data.</span>
<span id="cb86-1131"><a href="#cb86-1131" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-1132"><a href="#cb86-1132" aria-hidden="true" tabindex="-1"></a>First, we note that the dataset already comes with a **substitute value** for the -99.99.</span>
<span id="cb86-1133"><a href="#cb86-1133" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-1134"><a href="#cb86-1134" aria-hidden="true" tabindex="-1"></a>From the file description:</span>
<span id="cb86-1135"><a href="#cb86-1135" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-1136"><a href="#cb86-1136" aria-hidden="true" tabindex="-1"></a><span class="at">&gt;  The </span><span class="in">`interpolated`</span><span class="at"> column includes average values from the preceding column (</span><span class="in">`average`</span><span class="at">)</span></span>
<span id="cb86-1137"><a href="#cb86-1137" aria-hidden="true" tabindex="-1"></a><span class="at">and **interpolated values** where data are missing.  Interpolated values are</span></span>
<span id="cb86-1138"><a href="#cb86-1138" aria-hidden="true" tabindex="-1"></a><span class="at">computed in two steps...</span></span>
<span id="cb86-1139"><a href="#cb86-1139" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-1140"><a href="#cb86-1140" aria-hidden="true" tabindex="-1"></a>The <span class="in">`Int`</span> feature has values that exactly match those in <span class="in">`Avg`</span>, except when <span class="in">`Avg`</span> is -99.99, and then a **reasonable** estimate is used instead.</span>
<span id="cb86-1141"><a href="#cb86-1141" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-1142"><a href="#cb86-1142" aria-hidden="true" tabindex="-1"></a>So, the third version of our data will use the <span class="in">`Int`</span> feature instead of <span class="in">`Avg`</span>.</span>
<span id="cb86-1143"><a href="#cb86-1143" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-1146"><a href="#cb86-1146" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb86-1147"><a href="#cb86-1147" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: false</span></span>
<span id="cb86-1148"><a href="#cb86-1148" aria-hidden="true" tabindex="-1"></a><span class="co"># 3. Use interpolated column which estimates missing Avg values</span></span>
<span id="cb86-1149"><a href="#cb86-1149" aria-hidden="true" tabindex="-1"></a>co2_impute <span class="op">=</span> co2.copy()</span>
<span id="cb86-1150"><a href="#cb86-1150" aria-hidden="true" tabindex="-1"></a>co2_impute[<span class="st">'Avg'</span>] <span class="op">=</span> co2[<span class="st">'Int'</span>]</span>
<span id="cb86-1151"><a href="#cb86-1151" aria-hidden="true" tabindex="-1"></a>co2_impute.head()</span>
<span id="cb86-1152"><a href="#cb86-1152" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb86-1153"><a href="#cb86-1153" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-1154"><a href="#cb86-1154" aria-hidden="true" tabindex="-1"></a>What's a **reasonable** estimate?</span>
<span id="cb86-1155"><a href="#cb86-1155" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-1156"><a href="#cb86-1156" aria-hidden="true" tabindex="-1"></a>To answer this question, let's zoom in on a short time period, say the measurements in 1958 (where we know we have two missing values).</span>
<span id="cb86-1157"><a href="#cb86-1157" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-1160"><a href="#cb86-1160" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb86-1161"><a href="#cb86-1161" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: true</span></span>
<span id="cb86-1162"><a href="#cb86-1162" aria-hidden="true" tabindex="-1"></a><span class="co"># results of plotting data in 1958</span></span>
<span id="cb86-1163"><a href="#cb86-1163" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-1164"><a href="#cb86-1164" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> line_and_points(data, ax, title):</span>
<span id="cb86-1165"><a href="#cb86-1165" aria-hidden="true" tabindex="-1"></a>    <span class="co"># assumes single year, hence Mo</span></span>
<span id="cb86-1166"><a href="#cb86-1166" aria-hidden="true" tabindex="-1"></a>    ax.plot(<span class="st">'Mo'</span>, <span class="st">'Avg'</span>, data<span class="op">=</span>data)</span>
<span id="cb86-1167"><a href="#cb86-1167" aria-hidden="true" tabindex="-1"></a>    ax.scatter(<span class="st">'Mo'</span>, <span class="st">'Avg'</span>, data<span class="op">=</span>data)</span>
<span id="cb86-1168"><a href="#cb86-1168" aria-hidden="true" tabindex="-1"></a>    ax.set_xlim(<span class="dv">2</span>, <span class="dv">13</span>)</span>
<span id="cb86-1169"><a href="#cb86-1169" aria-hidden="true" tabindex="-1"></a>    ax.set_title(title)</span>
<span id="cb86-1170"><a href="#cb86-1170" aria-hidden="true" tabindex="-1"></a>    ax.set_xticks(np.arange(<span class="dv">3</span>, <span class="dv">13</span>))</span>
<span id="cb86-1171"><a href="#cb86-1171" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-1172"><a href="#cb86-1172" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> data_year(data, year):</span>
<span id="cb86-1173"><a href="#cb86-1173" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> data[data[<span class="st">"Yr"</span>] <span class="op">==</span> <span class="dv">1958</span>]</span>
<span id="cb86-1174"><a href="#cb86-1174" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb86-1175"><a href="#cb86-1175" aria-hidden="true" tabindex="-1"></a><span class="co"># uses matplotlib subplots</span></span>
<span id="cb86-1176"><a href="#cb86-1176" aria-hidden="true" tabindex="-1"></a><span class="co"># you may see more next week; focus on output for now</span></span>
<span id="cb86-1177"><a href="#cb86-1177" aria-hidden="true" tabindex="-1"></a>fig, axes <span class="op">=</span> plt.subplots(ncols <span class="op">=</span> <span class="dv">3</span>, figsize<span class="op">=</span>(<span class="dv">12</span>, <span class="dv">4</span>), sharey<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb86-1178"><a href="#cb86-1178" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-1179"><a href="#cb86-1179" aria-hidden="true" tabindex="-1"></a>year <span class="op">=</span> <span class="dv">1958</span></span>
<span id="cb86-1180"><a href="#cb86-1180" aria-hidden="true" tabindex="-1"></a>line_and_points(data_year(co2_drop, year), axes[<span class="dv">0</span>], title<span class="op">=</span><span class="st">"1. Drop Missing"</span>)</span>
<span id="cb86-1181"><a href="#cb86-1181" aria-hidden="true" tabindex="-1"></a>line_and_points(data_year(co2_NA, year), axes[<span class="dv">1</span>], title<span class="op">=</span><span class="st">"2. Missing Set to NaN"</span>)</span>
<span id="cb86-1182"><a href="#cb86-1182" aria-hidden="true" tabindex="-1"></a>line_and_points(data_year(co2_impute, year), axes[<span class="dv">2</span>], title<span class="op">=</span><span class="st">"3. Missing Interpolated"</span>)</span>
<span id="cb86-1183"><a href="#cb86-1183" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-1184"><a href="#cb86-1184" aria-hidden="true" tabindex="-1"></a>fig.suptitle(<span class="ss">f"Monthly Averages for </span><span class="sc">{</span>year<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb86-1185"><a href="#cb86-1185" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb86-1186"><a href="#cb86-1186" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb86-1187"><a href="#cb86-1187" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-1188"><a href="#cb86-1188" aria-hidden="true" tabindex="-1"></a>In the big picture since there are only 7 <span class="in">`Avg`</span> values missing (**&lt;1%** of 738 months), any of these approaches would work.</span>
<span id="cb86-1189"><a href="#cb86-1189" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-1190"><a href="#cb86-1190" aria-hidden="true" tabindex="-1"></a>However there is some appeal to **option C, Imputing**:</span>
<span id="cb86-1191"><a href="#cb86-1191" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-1192"><a href="#cb86-1192" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>Shows seasonal trends for CO<span class="dt">&lt;</span><span class="kw">sub</span><span class="dt">&gt;</span>2<span class="dt">&lt;/</span><span class="kw">sub</span><span class="dt">&gt;</span></span>
<span id="cb86-1193"><a href="#cb86-1193" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>We are plotting all months in our data as a line plot</span>
<span id="cb86-1194"><a href="#cb86-1194" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-1195"><a href="#cb86-1195" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-1196"><a href="#cb86-1196" aria-hidden="true" tabindex="-1"></a>Let's replot our original figure with option 3:</span>
<span id="cb86-1197"><a href="#cb86-1197" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-1200"><a href="#cb86-1200" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb86-1201"><a href="#cb86-1201" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: true</span></span>
<span id="cb86-1202"><a href="#cb86-1202" aria-hidden="true" tabindex="-1"></a>sns.lineplot(x<span class="op">=</span><span class="st">'DecDate'</span>, y<span class="op">=</span><span class="st">'Avg'</span>, data<span class="op">=</span>co2_impute)</span>
<span id="cb86-1203"><a href="#cb86-1203" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"CO2 Average By Month, Imputed"</span>)<span class="op">;</span></span>
<span id="cb86-1204"><a href="#cb86-1204" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb86-1205"><a href="#cb86-1205" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-1206"><a href="#cb86-1206" aria-hidden="true" tabindex="-1"></a>Looks pretty close to what we see on the NOAA <span class="co">[</span><span class="ot">website</span><span class="co">](https://gml.noaa.gov/ccgg/trends/)</span>!</span>
<span id="cb86-1207"><a href="#cb86-1207" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-1208"><a href="#cb86-1208" aria-hidden="true" tabindex="-1"></a><span class="fu">### Presenting the Data: A Discussion on Data Granularity</span></span>
<span id="cb86-1209"><a href="#cb86-1209" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-1210"><a href="#cb86-1210" aria-hidden="true" tabindex="-1"></a>From the description:</span>
<span id="cb86-1211"><a href="#cb86-1211" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-1212"><a href="#cb86-1212" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>Monthly measurements are averages of average day measurements.</span>
<span id="cb86-1213"><a href="#cb86-1213" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>The NOAA GML website has datasets for daily/hourly measurements too.</span>
<span id="cb86-1214"><a href="#cb86-1214" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-1215"><a href="#cb86-1215" aria-hidden="true" tabindex="-1"></a>The data you present depends on your research question.</span>
<span id="cb86-1216"><a href="#cb86-1216" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-1217"><a href="#cb86-1217" aria-hidden="true" tabindex="-1"></a>**How do CO&lt;sub&gt;2&lt;/sub&gt; levels vary by season?**</span>
<span id="cb86-1218"><a href="#cb86-1218" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-1219"><a href="#cb86-1219" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>You might want to keep average monthly data.</span>
<span id="cb86-1220"><a href="#cb86-1220" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-1221"><a href="#cb86-1221" aria-hidden="true" tabindex="-1"></a>**Are CO&lt;sub&gt;2&lt;/sub&gt; levels rising over the past 50+ years, consistent with global warming predictions?**</span>
<span id="cb86-1222"><a href="#cb86-1222" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-1223"><a href="#cb86-1223" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>You might be happier with a **coarser granularity** of average year data!</span>
<span id="cb86-1224"><a href="#cb86-1224" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-1227"><a href="#cb86-1227" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb86-1228"><a href="#cb86-1228" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: true</span></span>
<span id="cb86-1229"><a href="#cb86-1229" aria-hidden="true" tabindex="-1"></a>co2_year <span class="op">=</span> co2_impute.groupby(<span class="st">'Yr'</span>).mean()</span>
<span id="cb86-1230"><a href="#cb86-1230" aria-hidden="true" tabindex="-1"></a>sns.lineplot(x<span class="op">=</span><span class="st">'Yr'</span>, y<span class="op">=</span><span class="st">'Avg'</span>, data<span class="op">=</span>co2_year)</span>
<span id="cb86-1231"><a href="#cb86-1231" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"CO2 Average By Year"</span>)<span class="op">;</span></span>
<span id="cb86-1232"><a href="#cb86-1232" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb86-1233"><a href="#cb86-1233" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-1234"><a href="#cb86-1234" aria-hidden="true" tabindex="-1"></a>Indeed, we see a rise by nearly 100 ppm of CO<span class="dt">&lt;</span><span class="kw">sub</span><span class="dt">&gt;</span>2<span class="dt">&lt;/</span><span class="kw">sub</span><span class="dt">&gt;</span> since Mauna Loa began recording in 1958.</span>
</code></pre></div><button title="Copy to Clipboard" class="code-copy-button" data-in-quarto-modal=""><i class="bi"></i></button></div>
</div></div></div></div></div>
</div> <!-- /content -->




</body></html>
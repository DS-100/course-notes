<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.2.313">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Principles and Techniques of Data Science - 5&nbsp; Data Cleaning and EDA</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<link href="../regex/regex.html" rel="next">
<link href="../pandas_3/pandas_3.html" rel="prev">
<link href="../data100_logo.png" rel="icon" type="image/png">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script>
<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>

  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
    <div class="container-fluid d-flex justify-content-between">
      <h1 class="quarto-secondary-nav-title"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Data Cleaning and EDA</span></h1>
      <button type="button" class="quarto-btn-toggle btn" aria-label="Show secondary navigation">
        <i class="bi bi-chevron-right"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-full">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header sidebar-header-stacked">
      <a href="../index.html" class="sidebar-logo-link">
      <img src="../data100_logo.png" alt="" class="sidebar-logo py-0 d-lg-inline d-none">
      </a>
    <div class="sidebar-title mb-0 py-0">
      <a href="../">Principles and Techniques of Data Science</a> 
        <div class="sidebar-tools-main">
    <a href="https://github.com/DS-100/course-notes" title="Source Code" class="sidebar-tool px-1"><i class="bi bi-github"></i></a>
    <a href="../Principles-and-Techniques-of-Data-Science.pdf" title="Download PDF" class="sidebar-tool px-1"><i class="bi bi-file-pdf"></i></a>
</div>
    </div>
      </div>
      <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
      </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../index.html" class="sidebar-item-text sidebar-link">Welcome</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../intro_lec/introduction.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Introduction</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../pandas_1/pandas_1.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Pandas I</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../pandas_2/pandas_2.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Pandas II</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../pandas_3/pandas_3.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Pandas III</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../eda/eda.html" class="sidebar-item-text sidebar-link active"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Data Cleaning and EDA</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../regex/regex.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Regular Expressions</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../visualization_1/visualization_1.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Visualization I</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../visualization_2/visualization_2.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Visualization II</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../sampling/sampling.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Sampling</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../intro_to_modeling/intro_to_modeling.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Introduction to Modeling</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../constant_model_loss_transformations/loss_transformations.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Constant Model, Loss, and Transformations</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../ols/ols.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Ordinary Least Squares</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Data Cleaning and EDA</h2>
   
  <ul>
  <li><a href="#structure" id="toc-structure" class="nav-link active" data-scroll-target="#structure"><span class="toc-section-number">5.1</span>  Structure</a>
  <ul>
  <li><a href="#file-format" id="toc-file-format" class="nav-link" data-scroll-target="#file-format"><span class="toc-section-number">5.1.1</span>  File Format</a></li>
  <li><a href="#variable-types" id="toc-variable-types" class="nav-link" data-scroll-target="#variable-types"><span class="toc-section-number">5.1.2</span>  Variable Types</a></li>
  <li><a href="#primary-and-foreign-keys" id="toc-primary-and-foreign-keys" class="nav-link" data-scroll-target="#primary-and-foreign-keys"><span class="toc-section-number">5.1.3</span>  Primary and Foreign Keys</a></li>
  </ul></li>
  <li><a href="#granularity-scope-and-temporality" id="toc-granularity-scope-and-temporality" class="nav-link" data-scroll-target="#granularity-scope-and-temporality"><span class="toc-section-number">5.2</span>  Granularity, Scope, and Temporality</a></li>
  <li><a href="#faithfulness" id="toc-faithfulness" class="nav-link" data-scroll-target="#faithfulness"><span class="toc-section-number">5.3</span>  Faithfulness</a></li>
  <li><a href="#eda-demo-tuberculosis-in-the-united-states" id="toc-eda-demo-tuberculosis-in-the-united-states" class="nav-link" data-scroll-target="#eda-demo-tuberculosis-in-the-united-states"><span class="toc-section-number">6</span>  EDA Demo: Tuberculosis in the United States</a>
  <ul>
  <li><a href="#csvs-and-field-names" id="toc-csvs-and-field-names" class="nav-link" data-scroll-target="#csvs-and-field-names"><span class="toc-section-number">6.1</span>  CSVs and Field Names</a></li>
  <li><a href="#record-granularity" id="toc-record-granularity" class="nav-link" data-scroll-target="#record-granularity"><span class="toc-section-number">6.2</span>  Record Granularity</a></li>
  <li><a href="#gather-more-data-census" id="toc-gather-more-data-census" class="nav-link" data-scroll-target="#gather-more-data-census"><span class="toc-section-number">6.3</span>  Gather More Data: Census</a></li>
  <li><a href="#joining-data-on-primary-keys" id="toc-joining-data-on-primary-keys" class="nav-link" data-scroll-target="#joining-data-on-primary-keys"><span class="toc-section-number">6.4</span>  Joining Data on Primary Keys</a></li>
  <li><a href="#reproducing-data-compute-incidence" id="toc-reproducing-data-compute-incidence" class="nav-link" data-scroll-target="#reproducing-data-compute-incidence"><span class="toc-section-number">6.5</span>  Reproducing Data: Compute Incidence</a></li>
  <li><a href="#bonus-eda-reproducing-the-reported-statistic" id="toc-bonus-eda-reproducing-the-reported-statistic" class="nav-link" data-scroll-target="#bonus-eda-reproducing-the-reported-statistic"><span class="toc-section-number">6.6</span>  Bonus EDA: Reproducing the reported statistic</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content column-body" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title d-none d-lg-block"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Data Cleaning and EDA</span></h1><button type="button" class="btn code-tools-button dropdown-toggle" id="quarto-code-tools-menu" data-bs-toggle="dropdown" aria-expanded="false"><i class="bi"></i> Code</button><ul class="dropdown-menu dropdown-menu-end" aria-labelelledby="quarto-code-tools-menu"><li><a id="quarto-show-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Show All Code</a></li><li><a id="quarto-hide-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Hide All Code</a></li><li><hr class="dropdown-divider"></li><li><a id="quarto-view-source" class="dropdown-item" href="javascript:void(0)" role="button">View Source</a></li></ul></div></div>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<div class="callout-note callout callout-style-default no-icon callout-captioned">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-1-contents" aria-controls="callout-1" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Learning Outcomes
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-1" class="callout-1-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<ul>
<li>Recognize common file formats</li>
<li>Categorize data by its variable type</li>
<li>Build awareness of issues with data faithfulness and develop targeted solutions</li>
</ul>
</div>
</div>
</div>
<p>In the past few lectures, we’ve learned that <code>pandas</code> is a toolkit to restructure, modify, and explore a dataset. What we haven’t yet touched on is <em>how</em> to make these data transformation decisions. When we receive a new set of data from the “real world,” how do we know what processing we should do to convert this data into a usable form?</p>
<p><strong>Data cleaning</strong>, also called <strong>data wrangling</strong>, is the process of transforming raw data to facilitate subsequent analysis. It is often used to address issues like:</p>
<ul>
<li>Unclear structure or formatting</li>
<li>Missing or corrupted values</li>
<li>Unit conversions</li>
<li>…and so on</li>
</ul>
<p><strong>Exploratory Data Analysis (EDA)</strong> is the process of understanding a new dataset. It is an open-ended, informal analysis that involves familiarizing ourselves with the variables present in the data, discovering potential hypotheses, and identifying potential issues with the data. This last point can often motivate further data cleaning to address any problems with the dataset’s format; because of this, EDA and data cleaning are often thought of as an “infinite loop,” with each process driving the other.</p>
<p>In this lecture, we will consider the key properties of data to consider when performing data cleaning and EDA. In doing so, we’ll develop a “checklist” of sorts for you to consider when approaching a new dataset. Throughout this process, we’ll build a deeper understanding of this early (but very important!) stage of the data science lifecycle.</p>
<section id="structure" class="level2" data-number="5.1">
<h2 data-number="5.1" class="anchored" data-anchor-id="structure"><span class="header-section-number">5.1</span> Structure</h2>
<section id="file-format" class="level3" data-number="5.1.1">
<h3 data-number="5.1.1" class="anchored" data-anchor-id="file-format"><span class="header-section-number">5.1.1</span> File Format</h3>
<p>In the past two <code>pandas</code> lectures, we briefly touched on the idea of file format: the way data is encoded in a file for storage. Specifically, our <code>elections</code> and <code>babynames</code> datasets were stored and loaded as CSVs:</p>
<div class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>pd.read_csv(<span class="st">"data/elections.csv"</span>).head(<span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>Year</th>
      <th>Candidate</th>
      <th>Party</th>
      <th>Popular vote</th>
      <th>Result</th>
      <th>%</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1824</td>
      <td>Andrew Jackson</td>
      <td>Democratic-Republican</td>
      <td>151271</td>
      <td>loss</td>
      <td>57.210122</td>
    </tr>
    <tr>
      <th>1</th>
      <td>1824</td>
      <td>John Quincy Adams</td>
      <td>Democratic-Republican</td>
      <td>113142</td>
      <td>win</td>
      <td>42.789878</td>
    </tr>
    <tr>
      <th>2</th>
      <td>1828</td>
      <td>Andrew Jackson</td>
      <td>Democratic</td>
      <td>642806</td>
      <td>win</td>
      <td>56.203927</td>
    </tr>
    <tr>
      <th>3</th>
      <td>1828</td>
      <td>John Quincy Adams</td>
      <td>National Republican</td>
      <td>500897</td>
      <td>loss</td>
      <td>43.796073</td>
    </tr>
    <tr>
      <th>4</th>
      <td>1832</td>
      <td>Andrew Jackson</td>
      <td>Democratic</td>
      <td>702735</td>
      <td>win</td>
      <td>54.574789</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<p>CSVs, which stand for <strong>Comma-Separated Values</strong>, are a common tabular data format. To better understand the properties of a CSV, let’s take a look at the first few rows of the raw data file to see what it looks like before being loaded into a DataFrame.</p>
<div class="cell" data-execution_count="2">
<div class="cell-output cell-output-stdout">
<pre><code>Year,Candidate,Party,Popular vote,Result,%

1824,Andrew Jackson,Democratic-Republican,151271,loss,57.21012204

1824,John Quincy Adams,Democratic-Republican,113142,win,42.78987796

1828,Andrew Jackson,Democratic,642806,win,56.20392707
</code></pre>
</div>
</div>
<p>Each row, or <strong>record</strong>, in the data is delimited by a newline. Each column, or <strong>field</strong>, in the data is delimited by a comma (hence, comma-separated!).</p>
<p>Another common file type is the <strong>TSV (Tab-Separated Values)</strong>. In a TSV, records are still delimited by a newline, while fields are delimited by <code>\t</code> tab character. A TSV can be loaded into <code>pandas</code> using <code>pd.read_csv()</code> with the <code>delimiter</code> parameter: <code>pd.read_csv("file_name.tsv", delimiter="\t")</code>. A raw TSV file is shown below.</p>
<div class="cell" data-execution_count="3">
<div class="cell-output cell-output-stdout">
<pre><code>﻿Year   Candidate   Party   Popular vote    Result  %

1824    Andrew Jackson  Democratic-Republican   151271  loss    57.21012204

1824    John Quincy Adams   Democratic-Republican   113142  win 42.78987796

1828    Andrew Jackson  Democratic  642806  win 56.20392707
</code></pre>
</div>
</div>
<p><strong>JSON (JavaScript Object Notation)</strong> files behave similarly to Python dictionaries. They can be loaded into <code>pandas</code> using <code>pd.read_json</code>. A raw JSON is shown below.</p>
<div class="cell" data-execution_count="4">
<div class="cell-output cell-output-stdout">
<pre><code>[

 {

   "Year": 1824,

   "Candidate": "Andrew Jackson",

   "Party": "Democratic-Republican",

   "Popular vote": 151271,

   "Result": "loss",

   "%": 57.21012204

 },
</code></pre>
</div>
</div>
</section>
<section id="variable-types" class="level3" data-number="5.1.2">
<h3 data-number="5.1.2" class="anchored" data-anchor-id="variable-types"><span class="header-section-number">5.1.2</span> Variable Types</h3>
<p>After loading data into a file, it’s a good idea to take the time to understand what pieces of information are encoded in the dataset. In particular, we want to identify what variable types are present in our data. Broadly speaking, we can categorize variables into one of two overarching types.</p>
<p><strong>Quantitative variables</strong> describe some numeric quantity or amount. We can sub-divide quantitative data into:</p>
<ul>
<li><strong>Continuous quantitative variables</strong>: numeric data that can be measured on a continuous scale to arbitrary precision. Continuous variables do not have a strict set of possible values – they can be recorded to any number of decimal places. For example, weights, GPA, or CO<sub>2</sub> concentrations</li>
<li><strong>Discrete quantitative variables</strong>: numeric data that can only take on a finite set of possible values. For example, someone’s age or number of siblings.</li>
</ul>
<p><strong>Qualitative variables</strong>, also known as <strong>categorical variables</strong>, describe data that isn’t measuring some quantity or amount. The sub-categories of categorical data are:</p>
<ul>
<li><strong>Ordinal qualitative variables</strong>: categories with ordered levels. Specifically, ordinal variables are those where the difference between levels has no consistent, quantifiable meaning. For example, a Yelp rating or set of income brackets.</li>
<li><strong>Nominal qualitative variables</strong>: categories with no specific order. For example, someone’s political affiliation or Cal ID number.</li>
</ul>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/variable.png" class="img-fluid figure-img"></p>
<p></p><figcaption class="figure-caption">Classification of variable types</figcaption><p></p>
</figure>
</div>
</section>
<section id="primary-and-foreign-keys" class="level3" data-number="5.1.3">
<h3 data-number="5.1.3" class="anchored" data-anchor-id="primary-and-foreign-keys"><span class="header-section-number">5.1.3</span> Primary and Foreign Keys</h3>
<p>Last time, we introduced <code>.merge</code> as the <code>pandas</code> method for joining multiple DataFrames together. In our discussion of joins, we touched on the idea of using a “key” to determine what rows should be merged from each table. Let’s take a moment to examine this idea more closely.</p>
<p>The <strong>primary key</strong> is the column or set of columns in a table that determine the values of the remaining columns. It can be thought of as the unique identifier for each individual row in the table. For example, a table of Data 100 students might use each student’s Cal ID as the primary key.</p>
<div class="cell" data-execution_count="5">
<div class="cell-output cell-output-display" data-execution_count="5">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>Cal ID</th>
      <th>Name</th>
      <th>Major</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>3034619471</td>
      <td>Oski</td>
      <td>Data Science</td>
    </tr>
    <tr>
      <th>1</th>
      <td>3035619472</td>
      <td>Ollie</td>
      <td>Computer Science</td>
    </tr>
    <tr>
      <th>2</th>
      <td>3025619473</td>
      <td>Orrie</td>
      <td>Data Science</td>
    </tr>
    <tr>
      <th>3</th>
      <td>3046789372</td>
      <td>Ollie</td>
      <td>Economics</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<p>The <strong>foreign key</strong> is the column or set of columns in a table that reference primary keys in other tables. Knowing a dataset’s foreign keys can be useful when assigning the <code>left_on</code> and <code>right_on</code> parameters of <code>.merge</code>. In the table of office hour tickets below, <code>"Cal ID"</code> is a foreign key referencing the previous table.</p>
<div class="cell" data-execution_count="6">
<div class="cell-output cell-output-display" data-execution_count="6">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>OH Request</th>
      <th>Cal ID</th>
      <th>Question</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1</td>
      <td>3034619471</td>
      <td>HW 2 Q1</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2</td>
      <td>3035619472</td>
      <td>HW 2 Q3</td>
    </tr>
    <tr>
      <th>2</th>
      <td>3</td>
      <td>3025619473</td>
      <td>Lab 3 Q4</td>
    </tr>
    <tr>
      <th>3</th>
      <td>4</td>
      <td>3035619472</td>
      <td>HW 2 Q7</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
</section>
</section>
<section id="granularity-scope-and-temporality" class="level2" data-number="5.2">
<h2 data-number="5.2" class="anchored" data-anchor-id="granularity-scope-and-temporality"><span class="header-section-number">5.2</span> Granularity, Scope, and Temporality</h2>
<p>After understanding the structure of the dataset, the next task is to determine what exactly the data represents. We’ll do so by considering the data’s granularity, scope, and temporality.</p>
<p>The <strong>granularity</strong> of a dataset is the level of detail included in the data. To determine the data’s granularity, ask: what does each row in the dataset represent? Fine-grained data contains a high level of detail, with a single row representing a small individual unit. For example, each record may represent one person. Coarse-grained data is encoded such that a single row represents a large individual unit – for example, each record may represent a group of people.</p>
<p>The <strong>scope</strong> of a dataset is the subset of the population covered by the data. If we were investigating student performance in Data Science courses, a dataset with narrow scope might encompass all students enrolled in Data 100; a dataset with expansive scope might encompass all students in California.</p>
<p>The <strong>temporality</strong> of a dataset describes the time period over which the data was collected. To fully understand the temporality of the data, it may be necessary to standardize timezones or inspect recurring time-based trends in the data (Do patterns recur in 24-hour patterns? Over the course of a month? Seasonally?).</p>
</section>
<section id="faithfulness" class="level2" data-number="5.3">
<h2 data-number="5.3" class="anchored" data-anchor-id="faithfulness"><span class="header-section-number">5.3</span> Faithfulness</h2>
<p>At this stage in our data cleaning and EDA workflow, we’ve achieved quite a lot: we’ve identified how our data is structured, come to terms with what information it encodes, and gained insight as to how it was generated. Throughout this process, we should always recall the original intent of our work in Data Science – to use data to better understand and model the real world. To achieve this goal, we need to ensure that the data we use is faithful to reality; that is, that our data accurately captures the “real world.”</p>
<p>Data used in research or industry is often “messy” – there may be errors or inaccuracies that impact the faithfulness of the dataset. Signs that data may not be faithful include:</p>
<ul>
<li>Unrealistic or “incorrect” values, such as negative counts, locations that don’t exist, or dates set in the future</li>
<li>Violations of obvious dependencies, like an age that does not match a birthday</li>
<li>Clear signs that data was entered by hand, which can lead to spelling errors or fields that are incorrectly shifted</li>
<li>Signs of data falsification, such as fake email addresses or repeated use of the same names</li>
<li>Duplicated records or fields containing the same information</li>
</ul>
<p>A common issue encountered with real-world datasets is that of missing data. One strategy to resolve this is to simply drop any records with missing values from the dataset. This does, however, introduce the risk of inducing biases – it is possible that the missing or corrupt records may be systemically related to some feature of interest in the data.</p>
<p>Another method to address missing data is to perform <strong>imputation</strong>: infer the missing values using other data available in the dataset. There is a wide variety of imputation techniques that can be implemented; some of the most common are listed below.</p>
<ul>
<li>Average imputation: replace missing values with the average value for that field</li>
<li>Hot deck imputation: replace missing values with some random value</li>
<li>Regression imputation: develop a model to predict missing values</li>
<li>Multiple imputation: replace missing values with multiple random values</li>
</ul>
<p>Regardless of the strategy used to deal with missing data, we should think carefully about <em>why</em> particular records or fields may be missing – this can help inform whether or not the absence of these values is signficant in some meaningful way.</p>
</section>
<section id="eda-demo-tuberculosis-in-the-united-states" class="level1" data-number="6">
<h1 data-number="6"><span class="header-section-number">6</span> EDA Demo: Tuberculosis in the United States</h1>
<p>Now, let’s follow this data-cleaning and EDA workflow to see what can we say about the presence of Tuberculosis in the United States!</p>
<p>We will examine the data included in the <a href="https://www.cdc.gov/mmwr/volumes/71/wr/mm7112a1.htm?s_cid=mm7112a1_w#T1_down">original CDC article</a> published in 2021.</p>
<section id="csvs-and-field-names" class="level2" data-number="6.1">
<h2 data-number="6.1" class="anchored" data-anchor-id="csvs-and-field-names"><span class="header-section-number">6.1</span> CSVs and Field Names</h2>
<p>Suppose Table 1 was saved as a CSV file located in <code>data/cdc_tuberculosis.csv</code>.</p>
<p>We can then explore the CSV (which is a text file, and does not contain binary-encoded data) in many ways: 1. Using a text editor like emacs, vim, VSCode, etc. 2. Opening the CSV directly in DataHub (read-only), Excel, Google Sheets, etc. 3. The Python file object 4. pandas, using <code>pd.read_csv()</code></p>
<p>1, 2. Let’s start with the first two so we really solidify the idea of a CSV as <strong>rectangular data (i.e., tabular data) stored as comma-separated values</strong>.</p>
<ol start="3" type="1">
<li>Next, let’s try using the Python file object. Let’s check out the first three lines:</li>
</ol>
<div class="cell" data-execution_count="7">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> <span class="bu">open</span>(<span class="st">"data/cdc_tuberculosis.csv"</span>, <span class="st">"r"</span>) <span class="im">as</span> f:</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>    i <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> row <span class="kw">in</span> f:</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(row)</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>        i <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> i <span class="op">&gt;</span> <span class="dv">3</span>:</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>            <span class="cf">break</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>,No. of TB cases,,,TB incidence,,

U.S. jurisdiction,2019,2020,2021,2019,2020,2021

Total,"8,900","7,173","7,860",2.71,2.16,2.37

Alabama,87,72,92,1.77,1.43,1.83
</code></pre>
</div>
</div>
<p>Whoa, why are there blank lines interspaced between the lines of the CSV?</p>
<p>You may recall that all line breaks in text files are encoded as the special newline character <code>\n</code>. Python’s <code>print()</code> prints each string (including the newline), and an additional newline on top of that.</p>
<p>If you’re curious, we can use the <code>repr()</code> function to return the raw string with all special characters:</p>
<div class="cell" data-execution_count="8">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> <span class="bu">open</span>(<span class="st">"data/cdc_tuberculosis.csv"</span>, <span class="st">"r"</span>) <span class="im">as</span> f:</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>    i <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> row <span class="kw">in</span> f:</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="bu">repr</span>(row)) <span class="co"># print raw strings</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>        i <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> i <span class="op">&gt;</span> <span class="dv">3</span>:</span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>            <span class="cf">break</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>',No. of TB cases,,,TB incidence,,\n'
'U.S. jurisdiction,2019,2020,2021,2019,2020,2021\n'
'Total,"8,900","7,173","7,860",2.71,2.16,2.37\n'
'Alabama,87,72,92,1.77,1.43,1.83\n'</code></pre>
</div>
</div>
<ol start="4" type="1">
<li>Finally, let’s see the tried-and-true Data 100 approach: pandas.</li>
</ol>
<div class="cell" data-execution_count="9">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>tb_df <span class="op">=</span> pd.read_csv(<span class="st">"data/cdc_tuberculosis.csv"</span>)</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>tb_df</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="9">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>Unnamed: 0</th>
      <th>No. of TB cases</th>
      <th>Unnamed: 2</th>
      <th>Unnamed: 3</th>
      <th>TB incidence</th>
      <th>Unnamed: 5</th>
      <th>Unnamed: 6</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>U.S. jurisdiction</td>
      <td>2019</td>
      <td>2020</td>
      <td>2021</td>
      <td>2019.00</td>
      <td>2020.00</td>
      <td>2021.00</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Total</td>
      <td>8,900</td>
      <td>7,173</td>
      <td>7,860</td>
      <td>2.71</td>
      <td>2.16</td>
      <td>2.37</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Alabama</td>
      <td>87</td>
      <td>72</td>
      <td>92</td>
      <td>1.77</td>
      <td>1.43</td>
      <td>1.83</td>
    </tr>
    <tr>
      <th>3</th>
      <td>Alaska</td>
      <td>58</td>
      <td>58</td>
      <td>58</td>
      <td>7.91</td>
      <td>7.92</td>
      <td>7.92</td>
    </tr>
    <tr>
      <th>4</th>
      <td>Arizona</td>
      <td>183</td>
      <td>136</td>
      <td>129</td>
      <td>2.51</td>
      <td>1.89</td>
      <td>1.77</td>
    </tr>
    <tr>
      <th>5</th>
      <td>Arkansas</td>
      <td>64</td>
      <td>59</td>
      <td>69</td>
      <td>2.12</td>
      <td>1.96</td>
      <td>2.28</td>
    </tr>
    <tr>
      <th>6</th>
      <td>California</td>
      <td>2,111</td>
      <td>1,706</td>
      <td>1,750</td>
      <td>5.35</td>
      <td>4.32</td>
      <td>4.46</td>
    </tr>
    <tr>
      <th>7</th>
      <td>Colorado</td>
      <td>66</td>
      <td>52</td>
      <td>58</td>
      <td>1.15</td>
      <td>0.90</td>
      <td>1.00</td>
    </tr>
    <tr>
      <th>8</th>
      <td>Connecticut</td>
      <td>67</td>
      <td>54</td>
      <td>54</td>
      <td>1.88</td>
      <td>1.50</td>
      <td>1.50</td>
    </tr>
    <tr>
      <th>9</th>
      <td>Delaware</td>
      <td>18</td>
      <td>17</td>
      <td>43</td>
      <td>1.84</td>
      <td>1.71</td>
      <td>4.29</td>
    </tr>
    <tr>
      <th>10</th>
      <td>District of Columbia</td>
      <td>24</td>
      <td>19</td>
      <td>19</td>
      <td>3.39</td>
      <td>2.75</td>
      <td>2.84</td>
    </tr>
    <tr>
      <th>11</th>
      <td>Florida</td>
      <td>558</td>
      <td>412</td>
      <td>499</td>
      <td>2.60</td>
      <td>1.91</td>
      <td>2.29</td>
    </tr>
    <tr>
      <th>12</th>
      <td>Georgia</td>
      <td>302</td>
      <td>221</td>
      <td>228</td>
      <td>2.84</td>
      <td>2.06</td>
      <td>2.11</td>
    </tr>
    <tr>
      <th>13</th>
      <td>Hawaii</td>
      <td>99</td>
      <td>92</td>
      <td>106</td>
      <td>6.99</td>
      <td>6.34</td>
      <td>7.35</td>
    </tr>
    <tr>
      <th>14</th>
      <td>Idaho</td>
      <td>7</td>
      <td>8</td>
      <td>4</td>
      <td>0.39</td>
      <td>0.43</td>
      <td>0.21</td>
    </tr>
    <tr>
      <th>15</th>
      <td>Illinois</td>
      <td>326</td>
      <td>216</td>
      <td>255</td>
      <td>2.57</td>
      <td>1.69</td>
      <td>2.01</td>
    </tr>
    <tr>
      <th>16</th>
      <td>Indiana</td>
      <td>108</td>
      <td>92</td>
      <td>127</td>
      <td>1.60</td>
      <td>1.36</td>
      <td>1.87</td>
    </tr>
    <tr>
      <th>17</th>
      <td>Iowa</td>
      <td>52</td>
      <td>39</td>
      <td>49</td>
      <td>1.65</td>
      <td>1.22</td>
      <td>1.53</td>
    </tr>
    <tr>
      <th>18</th>
      <td>Kansas</td>
      <td>37</td>
      <td>37</td>
      <td>43</td>
      <td>1.27</td>
      <td>1.26</td>
      <td>1.47</td>
    </tr>
    <tr>
      <th>19</th>
      <td>Kentucky</td>
      <td>66</td>
      <td>67</td>
      <td>57</td>
      <td>1.48</td>
      <td>1.49</td>
      <td>1.26</td>
    </tr>
    <tr>
      <th>20</th>
      <td>Louisiana</td>
      <td>88</td>
      <td>99</td>
      <td>86</td>
      <td>1.89</td>
      <td>2.13</td>
      <td>1.86</td>
    </tr>
    <tr>
      <th>21</th>
      <td>Maine</td>
      <td>18</td>
      <td>17</td>
      <td>14</td>
      <td>1.34</td>
      <td>1.25</td>
      <td>1.02</td>
    </tr>
    <tr>
      <th>22</th>
      <td>Maryland</td>
      <td>209</td>
      <td>148</td>
      <td>192</td>
      <td>3.45</td>
      <td>2.40</td>
      <td>3.11</td>
    </tr>
    <tr>
      <th>23</th>
      <td>Massachusetts</td>
      <td>178</td>
      <td>142</td>
      <td>151</td>
      <td>2.58</td>
      <td>2.02</td>
      <td>2.16</td>
    </tr>
    <tr>
      <th>24</th>
      <td>Michigan</td>
      <td>131</td>
      <td>101</td>
      <td>136</td>
      <td>1.31</td>
      <td>1.00</td>
      <td>1.35</td>
    </tr>
    <tr>
      <th>25</th>
      <td>Minnesota</td>
      <td>148</td>
      <td>117</td>
      <td>134</td>
      <td>2.62</td>
      <td>2.05</td>
      <td>2.35</td>
    </tr>
    <tr>
      <th>26</th>
      <td>Mississippi</td>
      <td>58</td>
      <td>41</td>
      <td>45</td>
      <td>1.95</td>
      <td>1.39</td>
      <td>1.53</td>
    </tr>
    <tr>
      <th>27</th>
      <td>Missouri</td>
      <td>70</td>
      <td>79</td>
      <td>77</td>
      <td>1.14</td>
      <td>1.28</td>
      <td>1.25</td>
    </tr>
    <tr>
      <th>28</th>
      <td>Montana</td>
      <td>2</td>
      <td>4</td>
      <td>3</td>
      <td>0.19</td>
      <td>0.37</td>
      <td>0.27</td>
    </tr>
    <tr>
      <th>29</th>
      <td>Nebraska</td>
      <td>17</td>
      <td>33</td>
      <td>22</td>
      <td>0.88</td>
      <td>1.68</td>
      <td>1.12</td>
    </tr>
    <tr>
      <th>30</th>
      <td>Nevada</td>
      <td>53</td>
      <td>57</td>
      <td>61</td>
      <td>1.71</td>
      <td>1.83</td>
      <td>1.94</td>
    </tr>
    <tr>
      <th>31</th>
      <td>New Hampshire</td>
      <td>6</td>
      <td>12</td>
      <td>12</td>
      <td>0.44</td>
      <td>0.87</td>
      <td>0.86</td>
    </tr>
    <tr>
      <th>32</th>
      <td>New Jersey</td>
      <td>310</td>
      <td>245</td>
      <td>279</td>
      <td>3.49</td>
      <td>2.64</td>
      <td>3.01</td>
    </tr>
    <tr>
      <th>33</th>
      <td>New Mexico</td>
      <td>41</td>
      <td>29</td>
      <td>24</td>
      <td>1.95</td>
      <td>1.37</td>
      <td>1.13</td>
    </tr>
    <tr>
      <th>34</th>
      <td>New York</td>
      <td>746</td>
      <td>605</td>
      <td>681</td>
      <td>3.83</td>
      <td>3.00</td>
      <td>3.43</td>
    </tr>
    <tr>
      <th>35</th>
      <td>North Carolina</td>
      <td>185</td>
      <td>159</td>
      <td>178</td>
      <td>1.76</td>
      <td>1.52</td>
      <td>1.69</td>
    </tr>
    <tr>
      <th>36</th>
      <td>North Dakota</td>
      <td>18</td>
      <td>10</td>
      <td>15</td>
      <td>2.36</td>
      <td>1.28</td>
      <td>1.94</td>
    </tr>
    <tr>
      <th>37</th>
      <td>Ohio</td>
      <td>150</td>
      <td>130</td>
      <td>149</td>
      <td>1.28</td>
      <td>1.10</td>
      <td>1.26</td>
    </tr>
    <tr>
      <th>38</th>
      <td>Oklahoma</td>
      <td>73</td>
      <td>67</td>
      <td>69</td>
      <td>1.84</td>
      <td>1.69</td>
      <td>1.73</td>
    </tr>
    <tr>
      <th>39</th>
      <td>Oregon</td>
      <td>70</td>
      <td>67</td>
      <td>78</td>
      <td>1.66</td>
      <td>1.58</td>
      <td>1.84</td>
    </tr>
    <tr>
      <th>40</th>
      <td>Pennsylvania</td>
      <td>199</td>
      <td>156</td>
      <td>166</td>
      <td>1.55</td>
      <td>1.20</td>
      <td>1.28</td>
    </tr>
    <tr>
      <th>41</th>
      <td>Rhode Island</td>
      <td>14</td>
      <td>7</td>
      <td>17</td>
      <td>1.32</td>
      <td>0.64</td>
      <td>1.55</td>
    </tr>
    <tr>
      <th>42</th>
      <td>South Carolina</td>
      <td>80</td>
      <td>67</td>
      <td>88</td>
      <td>1.55</td>
      <td>1.31</td>
      <td>1.70</td>
    </tr>
    <tr>
      <th>43</th>
      <td>South Dakota</td>
      <td>16</td>
      <td>16</td>
      <td>12</td>
      <td>1.80</td>
      <td>1.80</td>
      <td>1.34</td>
    </tr>
    <tr>
      <th>44</th>
      <td>Tennessee</td>
      <td>129</td>
      <td>113</td>
      <td>85</td>
      <td>1.89</td>
      <td>1.63</td>
      <td>1.22</td>
    </tr>
    <tr>
      <th>45</th>
      <td>Texas</td>
      <td>1,154</td>
      <td>883</td>
      <td>991</td>
      <td>3.98</td>
      <td>3.02</td>
      <td>3.36</td>
    </tr>
    <tr>
      <th>46</th>
      <td>Utah</td>
      <td>27</td>
      <td>29</td>
      <td>17</td>
      <td>0.84</td>
      <td>0.88</td>
      <td>0.51</td>
    </tr>
    <tr>
      <th>47</th>
      <td>Vermont</td>
      <td>4</td>
      <td>3</td>
      <td>2</td>
      <td>0.64</td>
      <td>0.47</td>
      <td>0.31</td>
    </tr>
    <tr>
      <th>48</th>
      <td>Virginia</td>
      <td>191</td>
      <td>169</td>
      <td>161</td>
      <td>2.23</td>
      <td>1.96</td>
      <td>1.86</td>
    </tr>
    <tr>
      <th>49</th>
      <td>Washington</td>
      <td>221</td>
      <td>163</td>
      <td>199</td>
      <td>2.90</td>
      <td>2.11</td>
      <td>2.57</td>
    </tr>
    <tr>
      <th>50</th>
      <td>West Virginia</td>
      <td>9</td>
      <td>13</td>
      <td>7</td>
      <td>0.50</td>
      <td>0.73</td>
      <td>0.39</td>
    </tr>
    <tr>
      <th>51</th>
      <td>Wisconsin</td>
      <td>51</td>
      <td>35</td>
      <td>66</td>
      <td>0.88</td>
      <td>0.59</td>
      <td>1.12</td>
    </tr>
    <tr>
      <th>52</th>
      <td>Wyoming</td>
      <td>1</td>
      <td>0</td>
      <td>3</td>
      <td>0.17</td>
      <td>0.00</td>
      <td>0.52</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<p>Wait, what’s up with the “Unnamed” column names? And the first row, for that matter?</p>
<p>Congratulations – you’re ready to wrangle your data. Because of how things are stored, we’ll need to clean the data a bit to name our columns better.</p>
<p>A reasonable first step is to identify the row with the right header. The <code>pd.read_csv()</code> function (<a href="https://pandas.pydata.org/docs/reference/api/pandas.read_csv.html">documentation</a>) has the convenient <code>header</code> parameter:</p>
<div class="cell" data-execution_count="10">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>tb_df <span class="op">=</span> pd.read_csv(<span class="st">"data/cdc_tuberculosis.csv"</span>, header<span class="op">=</span><span class="dv">1</span>) <span class="co"># row index</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>tb_df.head(<span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="10">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>U.S. jurisdiction</th>
      <th>2019</th>
      <th>2020</th>
      <th>2021</th>
      <th>2019.1</th>
      <th>2020.1</th>
      <th>2021.1</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Total</td>
      <td>8,900</td>
      <td>7,173</td>
      <td>7,860</td>
      <td>2.71</td>
      <td>2.16</td>
      <td>2.37</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Alabama</td>
      <td>87</td>
      <td>72</td>
      <td>92</td>
      <td>1.77</td>
      <td>1.43</td>
      <td>1.83</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Alaska</td>
      <td>58</td>
      <td>58</td>
      <td>58</td>
      <td>7.91</td>
      <td>7.92</td>
      <td>7.92</td>
    </tr>
    <tr>
      <th>3</th>
      <td>Arizona</td>
      <td>183</td>
      <td>136</td>
      <td>129</td>
      <td>2.51</td>
      <td>1.89</td>
      <td>1.77</td>
    </tr>
    <tr>
      <th>4</th>
      <td>Arkansas</td>
      <td>64</td>
      <td>59</td>
      <td>69</td>
      <td>2.12</td>
      <td>1.96</td>
      <td>2.28</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<p>Wait…but now we can’t differentiate betwen the “Number of TB cases” and “TB incidence” year columns. pandas has tried to make our lives easier by automatically adding “.1” to the latter columns, but this doesn’t help us as humans understand the data.</p>
<p>We can do this manually with <code>df.rename()</code> (<a href="https://pandas.pydata.org/docs/reference/api/pandas.DataFrame.rename.html?highlight=rename#pandas.DataFrame.rename">documentation</a>):</p>
<div class="cell" data-execution_count="11">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>rename_dict <span class="op">=</span> {<span class="st">'2019'</span>: <span class="st">'TB cases 2019'</span>,</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>               <span class="st">'2020'</span>: <span class="st">'TB cases 2020'</span>,</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>               <span class="st">'2021'</span>: <span class="st">'TB cases 2021'</span>,</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>               <span class="st">'2019.1'</span>: <span class="st">'TB incidence 2019'</span>,</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>               <span class="st">'2020.1'</span>: <span class="st">'TB incidence 2020'</span>,</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>               <span class="st">'2021.1'</span>: <span class="st">'TB incidence 2021'</span>}</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>tb_df <span class="op">=</span> tb_df.rename(columns<span class="op">=</span>rename_dict)</span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>tb_df.head(<span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="11">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>U.S. jurisdiction</th>
      <th>TB cases 2019</th>
      <th>TB cases 2020</th>
      <th>TB cases 2021</th>
      <th>TB incidence 2019</th>
      <th>TB incidence 2020</th>
      <th>TB incidence 2021</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Total</td>
      <td>8,900</td>
      <td>7,173</td>
      <td>7,860</td>
      <td>2.71</td>
      <td>2.16</td>
      <td>2.37</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Alabama</td>
      <td>87</td>
      <td>72</td>
      <td>92</td>
      <td>1.77</td>
      <td>1.43</td>
      <td>1.83</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Alaska</td>
      <td>58</td>
      <td>58</td>
      <td>58</td>
      <td>7.91</td>
      <td>7.92</td>
      <td>7.92</td>
    </tr>
    <tr>
      <th>3</th>
      <td>Arizona</td>
      <td>183</td>
      <td>136</td>
      <td>129</td>
      <td>2.51</td>
      <td>1.89</td>
      <td>1.77</td>
    </tr>
    <tr>
      <th>4</th>
      <td>Arkansas</td>
      <td>64</td>
      <td>59</td>
      <td>69</td>
      <td>2.12</td>
      <td>1.96</td>
      <td>2.28</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
</section>
<section id="record-granularity" class="level2" data-number="6.2">
<h2 data-number="6.2" class="anchored" data-anchor-id="record-granularity"><span class="header-section-number">6.2</span> Record Granularity</h2>
<p>You might already be wondering: What’s up with that first record?</p>
<p>Row 0 is what we call a <strong>rollup record</strong>, or summary record. It’s often useful when displaying tables to humans. The <strong>granularity</strong> of record 0 (Totals) vs the rest of the records (States) is different.</p>
<p>Okay, EDA step two. How was the rollup record aggregated?</p>
<p>Let’s check if Total TB cases is the sum of all state TB cases. If we sum over all rows, we should get <strong>2x</strong> the total cases in each of our TB cases by year (why?).</p>
<div class="cell" data-execution_count="12">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>tb_df.<span class="bu">sum</span>(axis<span class="op">=</span><span class="dv">0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="12">
<pre><code>U.S. jurisdiction    TotalAlabamaAlaskaArizonaArkansasCaliforniaCol...
TB cases 2019        8,9008758183642,111666718245583029973261085237...
TB cases 2020        7,1737258136591,706525417194122219282169239376...
TB cases 2021        7,8609258129691,750585443194992281064255127494...
TB incidence 2019                                               109.94
TB incidence 2020                                                93.09
TB incidence 2021                                               102.94
dtype: object</code></pre>
</div>
</div>
<p>Whoa, what’s going on? Check out the column types:</p>
<div class="cell" data-execution_count="13">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>tb_df.dtypes</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="13">
<pre><code>U.S. jurisdiction     object
TB cases 2019         object
TB cases 2020         object
TB cases 2021         object
TB incidence 2019    float64
TB incidence 2020    float64
TB incidence 2021    float64
dtype: object</code></pre>
</div>
</div>
<p>Looks like those commas are causing all TB cases to be read as the <code>object</code> datatype, or <strong>storage type</strong> (close to the Python string datatype), so pandas is concatenating strings instead of adding integers.</p>
<p>Fortunately <code>read_csv</code> also has a <code>thousands</code> parameter (https://pandas.pydata.org/docs/reference/api/pandas.read_csv.html):</p>
<div class="cell" data-execution_count="14">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="co"># improve readability: chaining method calls with outer parentheses/line breaks</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>tb_df <span class="op">=</span> (</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>    pd.read_csv(<span class="st">"data/cdc_tuberculosis.csv"</span>, header<span class="op">=</span><span class="dv">1</span>, thousands<span class="op">=</span><span class="st">','</span>)</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>    .rename(columns<span class="op">=</span>rename_dict)</span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>tb_df.head(<span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="14">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>U.S. jurisdiction</th>
      <th>TB cases 2019</th>
      <th>TB cases 2020</th>
      <th>TB cases 2021</th>
      <th>TB incidence 2019</th>
      <th>TB incidence 2020</th>
      <th>TB incidence 2021</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Total</td>
      <td>8900</td>
      <td>7173</td>
      <td>7860</td>
      <td>2.71</td>
      <td>2.16</td>
      <td>2.37</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Alabama</td>
      <td>87</td>
      <td>72</td>
      <td>92</td>
      <td>1.77</td>
      <td>1.43</td>
      <td>1.83</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Alaska</td>
      <td>58</td>
      <td>58</td>
      <td>58</td>
      <td>7.91</td>
      <td>7.92</td>
      <td>7.92</td>
    </tr>
    <tr>
      <th>3</th>
      <td>Arizona</td>
      <td>183</td>
      <td>136</td>
      <td>129</td>
      <td>2.51</td>
      <td>1.89</td>
      <td>1.77</td>
    </tr>
    <tr>
      <th>4</th>
      <td>Arkansas</td>
      <td>64</td>
      <td>59</td>
      <td>69</td>
      <td>2.12</td>
      <td>1.96</td>
      <td>2.28</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<div class="cell" data-execution_count="15">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>tb_df.<span class="bu">sum</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="15">
<pre><code>U.S. jurisdiction    TotalAlabamaAlaskaArizonaArkansasCaliforniaCol...
TB cases 2019                                                    17800
TB cases 2020                                                    14346
TB cases 2021                                                    15720
TB incidence 2019                                               109.94
TB incidence 2020                                                93.09
TB incidence 2021                                               102.94
dtype: object</code></pre>
</div>
</div>
<p>The Total TB cases look right. Phew!</p>
<p>Let’s just look at the records with <strong>state-level granularity</strong>:</p>
<div class="cell" data-execution_count="16">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>state_tb_df <span class="op">=</span> tb_df[<span class="dv">1</span>:]</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>state_tb_df.head(<span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="16">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>U.S. jurisdiction</th>
      <th>TB cases 2019</th>
      <th>TB cases 2020</th>
      <th>TB cases 2021</th>
      <th>TB incidence 2019</th>
      <th>TB incidence 2020</th>
      <th>TB incidence 2021</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>1</th>
      <td>Alabama</td>
      <td>87</td>
      <td>72</td>
      <td>92</td>
      <td>1.77</td>
      <td>1.43</td>
      <td>1.83</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Alaska</td>
      <td>58</td>
      <td>58</td>
      <td>58</td>
      <td>7.91</td>
      <td>7.92</td>
      <td>7.92</td>
    </tr>
    <tr>
      <th>3</th>
      <td>Arizona</td>
      <td>183</td>
      <td>136</td>
      <td>129</td>
      <td>2.51</td>
      <td>1.89</td>
      <td>1.77</td>
    </tr>
    <tr>
      <th>4</th>
      <td>Arkansas</td>
      <td>64</td>
      <td>59</td>
      <td>69</td>
      <td>2.12</td>
      <td>1.96</td>
      <td>2.28</td>
    </tr>
    <tr>
      <th>5</th>
      <td>California</td>
      <td>2111</td>
      <td>1706</td>
      <td>1750</td>
      <td>5.35</td>
      <td>4.32</td>
      <td>4.46</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
</section>
<section id="gather-more-data-census" class="level2" data-number="6.3">
<h2 data-number="6.3" class="anchored" data-anchor-id="gather-more-data-census"><span class="header-section-number">6.3</span> Gather More Data: Census</h2>
<p>U.S. Census population estimates <a href="https://www.census.gov/data/tables/time-series/demo/popest/2010s-state-total.html">source</a> (2019), <a href="https://www.census.gov/data/tables/time-series/demo/popest/2020s-state-total.html">source</a> (2020-2021).</p>
<p>Running the below cells cleans the data. There are a few new methods here: * <code>df.convert_dtypes()</code> (<a href="https://pandas.pydata.org/docs/reference/api/pandas.DataFrame.convert_dtypes.html">documentation</a>) conveniently converts all float dtypes into ints and is out of scope for the class. * <code>df.drop_na()</code> (<a href="https://pandas.pydata.org/docs/reference/api/pandas.DataFrame.dropna.html">documentation</a>) will be explained in more detail next time.</p>
<div class="cell" data-execution_count="17">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 2010s census data</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>census_2010s_df <span class="op">=</span> pd.read_csv(<span class="st">"data/nst-est2019-01.csv"</span>, header<span class="op">=</span><span class="dv">3</span>, thousands<span class="op">=</span><span class="st">","</span>)</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>census_2010s_df <span class="op">=</span> (</span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>    census_2010s_df</span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>    .reset_index()</span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>    .drop(columns<span class="op">=</span>[<span class="st">"index"</span>, <span class="st">"Census"</span>, <span class="st">"Estimates Base"</span>])</span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a>    .rename(columns<span class="op">=</span>{<span class="st">"Unnamed: 0"</span>: <span class="st">"Geographic Area"</span>})</span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a>    .convert_dtypes()                 <span class="co"># "smart" converting of columns, use at your own risk</span></span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a>    .dropna()                         <span class="co"># we'll introduce this next time</span></span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a>census_2010s_df[<span class="st">'Geographic Area'</span>] <span class="op">=</span> census_2010s_df[<span class="st">'Geographic Area'</span>].<span class="bu">str</span>.strip(<span class="st">'.'</span>)</span>
<span id="cb20-12"><a href="#cb20-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-13"><a href="#cb20-13" aria-hidden="true" tabindex="-1"></a><span class="co"># with pd.option_context('display.min_rows', 30): # shows more rows</span></span>
<span id="cb20-14"><a href="#cb20-14" aria-hidden="true" tabindex="-1"></a><span class="co">#     display(census_2010s_df)</span></span>
<span id="cb20-15"><a href="#cb20-15" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb20-16"><a href="#cb20-16" aria-hidden="true" tabindex="-1"></a>census_2010s_df.head(<span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="17">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>Geographic Area</th>
      <th>2010</th>
      <th>2011</th>
      <th>2012</th>
      <th>2013</th>
      <th>2014</th>
      <th>2015</th>
      <th>2016</th>
      <th>2017</th>
      <th>2018</th>
      <th>2019</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>United States</td>
      <td>309321666</td>
      <td>311556874</td>
      <td>313830990</td>
      <td>315993715</td>
      <td>318301008</td>
      <td>320635163</td>
      <td>322941311</td>
      <td>324985539</td>
      <td>326687501</td>
      <td>328239523</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Northeast</td>
      <td>55380134</td>
      <td>55604223</td>
      <td>55775216</td>
      <td>55901806</td>
      <td>56006011</td>
      <td>56034684</td>
      <td>56042330</td>
      <td>56059240</td>
      <td>56046620</td>
      <td>55982803</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Midwest</td>
      <td>66974416</td>
      <td>67157800</td>
      <td>67336743</td>
      <td>67560379</td>
      <td>67745167</td>
      <td>67860583</td>
      <td>67987540</td>
      <td>68126781</td>
      <td>68236628</td>
      <td>68329004</td>
    </tr>
    <tr>
      <th>3</th>
      <td>South</td>
      <td>114866680</td>
      <td>116006522</td>
      <td>117241208</td>
      <td>118364400</td>
      <td>119624037</td>
      <td>120997341</td>
      <td>122351760</td>
      <td>123542189</td>
      <td>124569433</td>
      <td>125580448</td>
    </tr>
    <tr>
      <th>4</th>
      <td>West</td>
      <td>72100436</td>
      <td>72788329</td>
      <td>73477823</td>
      <td>74167130</td>
      <td>74925793</td>
      <td>75742555</td>
      <td>76559681</td>
      <td>77257329</td>
      <td>77834820</td>
      <td>78347268</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<p>Occasionally, you will want to modify code that you have imported. To reimport those modifications you can either use the python importlib library:</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> importlib <span class="im">import</span> <span class="bu">reload</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="bu">reload</span>(utils)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>or use iPython magic which will intelligently import code when files change:</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="op">%</span>load_ext autoreload</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a><span class="op">%</span>autoreload <span class="dv">2</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell" data-execution_count="18">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="co"># census 2020s data</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>census_2020s_df <span class="op">=</span> pd.read_csv(<span class="st">"data/NST-EST2022-POP.csv"</span>, header<span class="op">=</span><span class="dv">3</span>, thousands<span class="op">=</span><span class="st">","</span>)</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>census_2020s_df <span class="op">=</span> (</span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>    census_2020s_df</span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>    .reset_index()</span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>    .drop(columns<span class="op">=</span>[<span class="st">"index"</span>, <span class="st">"Unnamed: 1"</span>])</span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a>    .rename(columns<span class="op">=</span>{<span class="st">"Unnamed: 0"</span>: <span class="st">"Geographic Area"</span>})</span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a>    .convert_dtypes()                 <span class="co"># "smart" converting of columns, use at your own risk</span></span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a>    .dropna()                         <span class="co"># we'll introduce this next time</span></span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb23-11"><a href="#cb23-11" aria-hidden="true" tabindex="-1"></a>census_2020s_df[<span class="st">'Geographic Area'</span>] <span class="op">=</span> census_2020s_df[<span class="st">'Geographic Area'</span>].<span class="bu">str</span>.strip(<span class="st">'.'</span>)</span>
<span id="cb23-12"><a href="#cb23-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-13"><a href="#cb23-13" aria-hidden="true" tabindex="-1"></a>census_2020s_df.head(<span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="18">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>Geographic Area</th>
      <th>2020</th>
      <th>2021</th>
      <th>2022</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>United States</td>
      <td>331511512</td>
      <td>332031554</td>
      <td>333287557</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Northeast</td>
      <td>57448898</td>
      <td>57259257</td>
      <td>57040406</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Midwest</td>
      <td>68961043</td>
      <td>68836505</td>
      <td>68787595</td>
    </tr>
    <tr>
      <th>3</th>
      <td>South</td>
      <td>126450613</td>
      <td>127346029</td>
      <td>128716192</td>
    </tr>
    <tr>
      <th>4</th>
      <td>West</td>
      <td>78650958</td>
      <td>78589763</td>
      <td>78743364</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
</section>
<section id="joining-data-on-primary-keys" class="level2" data-number="6.4">
<h2 data-number="6.4" class="anchored" data-anchor-id="joining-data-on-primary-keys"><span class="header-section-number">6.4</span> Joining Data on Primary Keys</h2>
<p>Time to <code>merge</code>! Here we use the DataFrame method <code>df1.merge(right=df2, ...)</code> on DataFrame <code>df1</code> (<a href="https://pandas.pydata.org/docs/reference/api/pandas.DataFrame.merge.html">documentation</a>). Contrast this with the function <code>pd.merge(left=df1, right=df2, ...)</code> (<a href="https://pandas.pydata.org/docs/reference/api/pandas.merge.html?highlight=pandas%20merge#pandas.merge">documentation</a>). Feel free to use either.</p>
<div class="cell" data-execution_count="19">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="co"># merge TB dataframe with two US census dataframes</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>tb_census_df <span class="op">=</span> (</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>    tb_df</span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>    .merge(right<span class="op">=</span>census_2010s_df,</span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>           left_on<span class="op">=</span><span class="st">"U.S. jurisdiction"</span>, right_on<span class="op">=</span><span class="st">"Geographic Area"</span>)</span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>    .merge(right<span class="op">=</span>census_2020s_df,</span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a>           left_on<span class="op">=</span><span class="st">"U.S. jurisdiction"</span>, right_on<span class="op">=</span><span class="st">"Geographic Area"</span>)</span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a>tb_census_df.head(<span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="19">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>U.S. jurisdiction</th>
      <th>TB cases 2019</th>
      <th>TB cases 2020</th>
      <th>TB cases 2021</th>
      <th>TB incidence 2019</th>
      <th>TB incidence 2020</th>
      <th>TB incidence 2021</th>
      <th>Geographic Area_x</th>
      <th>2010</th>
      <th>2011</th>
      <th>...</th>
      <th>2014</th>
      <th>2015</th>
      <th>2016</th>
      <th>2017</th>
      <th>2018</th>
      <th>2019</th>
      <th>Geographic Area_y</th>
      <th>2020</th>
      <th>2021</th>
      <th>2022</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Alabama</td>
      <td>87</td>
      <td>72</td>
      <td>92</td>
      <td>1.77</td>
      <td>1.43</td>
      <td>1.83</td>
      <td>Alabama</td>
      <td>4785437</td>
      <td>4799069</td>
      <td>...</td>
      <td>4841799</td>
      <td>4852347</td>
      <td>4863525</td>
      <td>4874486</td>
      <td>4887681</td>
      <td>4903185</td>
      <td>Alabama</td>
      <td>5031362</td>
      <td>5049846</td>
      <td>5074296</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Alaska</td>
      <td>58</td>
      <td>58</td>
      <td>58</td>
      <td>7.91</td>
      <td>7.92</td>
      <td>7.92</td>
      <td>Alaska</td>
      <td>713910</td>
      <td>722128</td>
      <td>...</td>
      <td>736283</td>
      <td>737498</td>
      <td>741456</td>
      <td>739700</td>
      <td>735139</td>
      <td>731545</td>
      <td>Alaska</td>
      <td>732923</td>
      <td>734182</td>
      <td>733583</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Arizona</td>
      <td>183</td>
      <td>136</td>
      <td>129</td>
      <td>2.51</td>
      <td>1.89</td>
      <td>1.77</td>
      <td>Arizona</td>
      <td>6407172</td>
      <td>6472643</td>
      <td>...</td>
      <td>6730413</td>
      <td>6829676</td>
      <td>6941072</td>
      <td>7044008</td>
      <td>7158024</td>
      <td>7278717</td>
      <td>Arizona</td>
      <td>7179943</td>
      <td>7264877</td>
      <td>7359197</td>
    </tr>
    <tr>
      <th>3</th>
      <td>Arkansas</td>
      <td>64</td>
      <td>59</td>
      <td>69</td>
      <td>2.12</td>
      <td>1.96</td>
      <td>2.28</td>
      <td>Arkansas</td>
      <td>2921964</td>
      <td>2940667</td>
      <td>...</td>
      <td>2967392</td>
      <td>2978048</td>
      <td>2989918</td>
      <td>3001345</td>
      <td>3009733</td>
      <td>3017804</td>
      <td>Arkansas</td>
      <td>3014195</td>
      <td>3028122</td>
      <td>3045637</td>
    </tr>
    <tr>
      <th>4</th>
      <td>California</td>
      <td>2111</td>
      <td>1706</td>
      <td>1750</td>
      <td>5.35</td>
      <td>4.32</td>
      <td>4.46</td>
      <td>California</td>
      <td>37319502</td>
      <td>37638369</td>
      <td>...</td>
      <td>38596972</td>
      <td>38918045</td>
      <td>39167117</td>
      <td>39358497</td>
      <td>39461588</td>
      <td>39512223</td>
      <td>California</td>
      <td>39501653</td>
      <td>39142991</td>
      <td>39029342</td>
    </tr>
  </tbody>
</table>
<p>5 rows × 22 columns</p>
</div>
</div>
</div>
<p>This is a little unwieldy. We could either drop the unneeded columns now, or just merge on smaller census DataFrames. Let’s do the latter.</p>
<div class="cell" data-execution_count="20">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="co"># try merging again, but cleaner this time</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>tb_census_df <span class="op">=</span> (</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>    tb_df</span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>    .merge(right<span class="op">=</span>census_2010s_df[[<span class="st">"Geographic Area"</span>, <span class="st">"2019"</span>]],</span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a>           left_on<span class="op">=</span><span class="st">"U.S. jurisdiction"</span>, right_on<span class="op">=</span><span class="st">"Geographic Area"</span>)</span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a>    .drop(columns<span class="op">=</span><span class="st">"Geographic Area"</span>)</span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a>    .merge(right<span class="op">=</span>census_2020s_df[[<span class="st">"Geographic Area"</span>, <span class="st">"2020"</span>, <span class="st">"2021"</span>]],</span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a>           left_on<span class="op">=</span><span class="st">"U.S. jurisdiction"</span>, right_on<span class="op">=</span><span class="st">"Geographic Area"</span>)</span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a>    .drop(columns<span class="op">=</span><span class="st">"Geographic Area"</span>)</span>
<span id="cb25-10"><a href="#cb25-10" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb25-11"><a href="#cb25-11" aria-hidden="true" tabindex="-1"></a>tb_census_df.head(<span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="20">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>U.S. jurisdiction</th>
      <th>TB cases 2019</th>
      <th>TB cases 2020</th>
      <th>TB cases 2021</th>
      <th>TB incidence 2019</th>
      <th>TB incidence 2020</th>
      <th>TB incidence 2021</th>
      <th>2019</th>
      <th>2020</th>
      <th>2021</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Alabama</td>
      <td>87</td>
      <td>72</td>
      <td>92</td>
      <td>1.77</td>
      <td>1.43</td>
      <td>1.83</td>
      <td>4903185</td>
      <td>5031362</td>
      <td>5049846</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Alaska</td>
      <td>58</td>
      <td>58</td>
      <td>58</td>
      <td>7.91</td>
      <td>7.92</td>
      <td>7.92</td>
      <td>731545</td>
      <td>732923</td>
      <td>734182</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Arizona</td>
      <td>183</td>
      <td>136</td>
      <td>129</td>
      <td>2.51</td>
      <td>1.89</td>
      <td>1.77</td>
      <td>7278717</td>
      <td>7179943</td>
      <td>7264877</td>
    </tr>
    <tr>
      <th>3</th>
      <td>Arkansas</td>
      <td>64</td>
      <td>59</td>
      <td>69</td>
      <td>2.12</td>
      <td>1.96</td>
      <td>2.28</td>
      <td>3017804</td>
      <td>3014195</td>
      <td>3028122</td>
    </tr>
    <tr>
      <th>4</th>
      <td>California</td>
      <td>2111</td>
      <td>1706</td>
      <td>1750</td>
      <td>5.35</td>
      <td>4.32</td>
      <td>4.46</td>
      <td>39512223</td>
      <td>39501653</td>
      <td>39142991</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
</section>
<section id="reproducing-data-compute-incidence" class="level2" data-number="6.5">
<h2 data-number="6.5" class="anchored" data-anchor-id="reproducing-data-compute-incidence"><span class="header-section-number">6.5</span> Reproducing Data: Compute Incidence</h2>
<p>Let’s recompute incidence to make sure we know where the original CDC numbers came from.</p>
<p>From the <a href="https://www.cdc.gov/mmwr/volumes/71/wr/mm7112a1.htm?s_cid=mm7112a1_w#T1_down">CDC report</a>: TB incidence is computed as “Cases per 100,000 persons using mid-year population estimates from the U.S. Census Bureau.”</p>
<p>If we define a group as 100,000 people, then we can compute the TB incidence for a given state population as</p>
<p><span class="math display">\[\text{TB incidence} = \frac{\text{TB cases in population}}{\text{groups in population}} = \frac{\text{TB cases in population}}{\text{population}/100000} \]</span></p>
<p><span class="math display">\[= \frac{\text{TB cases in population}}{\text{population}} \times 100000\]</span></p>
<p>Let’s try this for 2019:</p>
<div class="cell" data-execution_count="21">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>tb_census_df[<span class="st">"recompute incidence 2019"</span>] <span class="op">=</span> tb_census_df[<span class="st">"TB cases 2019"</span>]<span class="op">/</span>tb_census_df[<span class="st">"2019"</span>]<span class="op">*</span><span class="dv">100000</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>tb_census_df.head(<span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="21">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>U.S. jurisdiction</th>
      <th>TB cases 2019</th>
      <th>TB cases 2020</th>
      <th>TB cases 2021</th>
      <th>TB incidence 2019</th>
      <th>TB incidence 2020</th>
      <th>TB incidence 2021</th>
      <th>2019</th>
      <th>2020</th>
      <th>2021</th>
      <th>recompute incidence 2019</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Alabama</td>
      <td>87</td>
      <td>72</td>
      <td>92</td>
      <td>1.77</td>
      <td>1.43</td>
      <td>1.83</td>
      <td>4903185</td>
      <td>5031362</td>
      <td>5049846</td>
      <td>1.774357</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Alaska</td>
      <td>58</td>
      <td>58</td>
      <td>58</td>
      <td>7.91</td>
      <td>7.92</td>
      <td>7.92</td>
      <td>731545</td>
      <td>732923</td>
      <td>734182</td>
      <td>7.928425</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Arizona</td>
      <td>183</td>
      <td>136</td>
      <td>129</td>
      <td>2.51</td>
      <td>1.89</td>
      <td>1.77</td>
      <td>7278717</td>
      <td>7179943</td>
      <td>7264877</td>
      <td>2.514179</td>
    </tr>
    <tr>
      <th>3</th>
      <td>Arkansas</td>
      <td>64</td>
      <td>59</td>
      <td>69</td>
      <td>2.12</td>
      <td>1.96</td>
      <td>2.28</td>
      <td>3017804</td>
      <td>3014195</td>
      <td>3028122</td>
      <td>2.120747</td>
    </tr>
    <tr>
      <th>4</th>
      <td>California</td>
      <td>2111</td>
      <td>1706</td>
      <td>1750</td>
      <td>5.35</td>
      <td>4.32</td>
      <td>4.46</td>
      <td>39512223</td>
      <td>39501653</td>
      <td>39142991</td>
      <td>5.342651</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<p>Awesome!!!</p>
<p>Let’s use a for-loop and Python format strings to compute TB incidence for all years. Python f-strings are just used for the purposes of this demo, but they’re handy to know when you explore data beyond this course (<a href="https://docs.python.org/3/tutorial/inputoutput.html">Python documentation</a>).</p>
<div class="cell" data-execution_count="22">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="co"># recompute incidence for all years</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> year <span class="kw">in</span> [<span class="dv">2019</span>, <span class="dv">2020</span>, <span class="dv">2021</span>]:</span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>    tb_census_df[<span class="ss">f"recompute incidence </span><span class="sc">{</span>year<span class="sc">}</span><span class="ss">"</span>] <span class="op">=</span> tb_census_df[<span class="ss">f"TB cases </span><span class="sc">{</span>year<span class="sc">}</span><span class="ss">"</span>]<span class="op">/</span>tb_census_df[<span class="ss">f"</span><span class="sc">{</span>year<span class="sc">}</span><span class="ss">"</span>]<span class="op">*</span><span class="dv">100000</span></span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>tb_census_df.head(<span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="22">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>U.S. jurisdiction</th>
      <th>TB cases 2019</th>
      <th>TB cases 2020</th>
      <th>TB cases 2021</th>
      <th>TB incidence 2019</th>
      <th>TB incidence 2020</th>
      <th>TB incidence 2021</th>
      <th>2019</th>
      <th>2020</th>
      <th>2021</th>
      <th>recompute incidence 2019</th>
      <th>recompute incidence 2020</th>
      <th>recompute incidence 2021</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Alabama</td>
      <td>87</td>
      <td>72</td>
      <td>92</td>
      <td>1.77</td>
      <td>1.43</td>
      <td>1.83</td>
      <td>4903185</td>
      <td>5031362</td>
      <td>5049846</td>
      <td>1.774357</td>
      <td>1.431024</td>
      <td>1.821838</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Alaska</td>
      <td>58</td>
      <td>58</td>
      <td>58</td>
      <td>7.91</td>
      <td>7.92</td>
      <td>7.92</td>
      <td>731545</td>
      <td>732923</td>
      <td>734182</td>
      <td>7.928425</td>
      <td>7.913519</td>
      <td>7.899949</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Arizona</td>
      <td>183</td>
      <td>136</td>
      <td>129</td>
      <td>2.51</td>
      <td>1.89</td>
      <td>1.77</td>
      <td>7278717</td>
      <td>7179943</td>
      <td>7264877</td>
      <td>2.514179</td>
      <td>1.894165</td>
      <td>1.775667</td>
    </tr>
    <tr>
      <th>3</th>
      <td>Arkansas</td>
      <td>64</td>
      <td>59</td>
      <td>69</td>
      <td>2.12</td>
      <td>1.96</td>
      <td>2.28</td>
      <td>3017804</td>
      <td>3014195</td>
      <td>3028122</td>
      <td>2.120747</td>
      <td>1.957405</td>
      <td>2.27864</td>
    </tr>
    <tr>
      <th>4</th>
      <td>California</td>
      <td>2111</td>
      <td>1706</td>
      <td>1750</td>
      <td>5.35</td>
      <td>4.32</td>
      <td>4.46</td>
      <td>39512223</td>
      <td>39501653</td>
      <td>39142991</td>
      <td>5.342651</td>
      <td>4.318807</td>
      <td>4.470788</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<p>These numbers look pretty close!!! There are a few errors in the hundredths place, particularly in 2021. It may be useful to further explore reasons behind this discrepancy.</p>
<div class="cell" data-execution_count="23">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>tb_census_df.describe()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="23">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>TB cases 2019</th>
      <th>TB cases 2020</th>
      <th>TB cases 2021</th>
      <th>TB incidence 2019</th>
      <th>TB incidence 2020</th>
      <th>TB incidence 2021</th>
      <th>2019</th>
      <th>2020</th>
      <th>2021</th>
      <th>recompute incidence 2019</th>
      <th>recompute incidence 2020</th>
      <th>recompute incidence 2021</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>count</th>
      <td>51.000000</td>
      <td>51.000000</td>
      <td>51.000000</td>
      <td>51.000000</td>
      <td>51.000000</td>
      <td>51.000000</td>
      <td>5.100000e+01</td>
      <td>5.100000e+01</td>
      <td>5.100000e+01</td>
      <td>51.000000</td>
      <td>51.000000</td>
      <td>51.000000</td>
    </tr>
    <tr>
      <th>mean</th>
      <td>174.509804</td>
      <td>140.647059</td>
      <td>154.117647</td>
      <td>2.102549</td>
      <td>1.782941</td>
      <td>1.971961</td>
      <td>6.436069e+06</td>
      <td>6.500226e+06</td>
      <td>6.510423e+06</td>
      <td>2.104969</td>
      <td>1.784655</td>
      <td>1.969928</td>
    </tr>
    <tr>
      <th>std</th>
      <td>341.738752</td>
      <td>271.055775</td>
      <td>286.781007</td>
      <td>1.498745</td>
      <td>1.337414</td>
      <td>1.478468</td>
      <td>7.360660e+06</td>
      <td>7.408168e+06</td>
      <td>7.394300e+06</td>
      <td>1.500236</td>
      <td>1.338263</td>
      <td>1.474929</td>
    </tr>
    <tr>
      <th>min</th>
      <td>1.000000</td>
      <td>0.000000</td>
      <td>2.000000</td>
      <td>0.170000</td>
      <td>0.000000</td>
      <td>0.210000</td>
      <td>5.787590e+05</td>
      <td>5.776050e+05</td>
      <td>5.794830e+05</td>
      <td>0.172783</td>
      <td>0.000000</td>
      <td>0.210049</td>
    </tr>
    <tr>
      <th>25%</th>
      <td>25.500000</td>
      <td>29.000000</td>
      <td>23.000000</td>
      <td>1.295000</td>
      <td>1.210000</td>
      <td>1.235000</td>
      <td>1.789606e+06</td>
      <td>1.820311e+06</td>
      <td>1.844920e+06</td>
      <td>1.297485</td>
      <td>1.211433</td>
      <td>1.233905</td>
    </tr>
    <tr>
      <th>50%</th>
      <td>70.000000</td>
      <td>67.000000</td>
      <td>69.000000</td>
      <td>1.800000</td>
      <td>1.520000</td>
      <td>1.700000</td>
      <td>4.467673e+06</td>
      <td>4.507445e+06</td>
      <td>4.506589e+06</td>
      <td>1.808606</td>
      <td>1.521612</td>
      <td>1.694502</td>
    </tr>
    <tr>
      <th>75%</th>
      <td>180.500000</td>
      <td>139.000000</td>
      <td>150.000000</td>
      <td>2.575000</td>
      <td>1.990000</td>
      <td>2.220000</td>
      <td>7.446805e+06</td>
      <td>7.451987e+06</td>
      <td>7.502811e+06</td>
      <td>2.577577</td>
      <td>1.993607</td>
      <td>2.219482</td>
    </tr>
    <tr>
      <th>max</th>
      <td>2111.000000</td>
      <td>1706.000000</td>
      <td>1750.000000</td>
      <td>7.910000</td>
      <td>7.920000</td>
      <td>7.920000</td>
      <td>3.951222e+07</td>
      <td>3.950165e+07</td>
      <td>3.914299e+07</td>
      <td>7.928425</td>
      <td>7.913519</td>
      <td>7.899949</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
</section>
<section id="bonus-eda-reproducing-the-reported-statistic" class="level2" data-number="6.6">
<h2 data-number="6.6" class="anchored" data-anchor-id="bonus-eda-reproducing-the-reported-statistic"><span class="header-section-number">6.6</span> Bonus EDA: Reproducing the reported statistic</h2>
<p><strong>How do we reproduce that reported statistic in the original <a href="https://www.cdc.gov/mmwr/volumes/71/wr/mm7112a1.htm?s_cid=mm7112a1_w">CDC report</a>?</strong></p>
<blockquote class="blockquote">
<p>Reported TB incidence (cases per 100,000 persons) increased <strong>9.4%</strong>, from <strong>2.2</strong> during 2020 to <strong>2.4</strong> during 2021 but was lower than incidence during 2019 (2.7). Increases occurred among both U.S.-born and non–U.S.-born persons.</p>
</blockquote>
<p>This is TB incidence computed across the entire U.S. population! How do we reproduce this * We need to reproduce the “Total” TB incidences in our rolled record. * But our current <code>tb_census_df</code> only has 51 entries (50 states plus Washington, D.C.). There is no rolled record. * What happened…?</p>
<p>Let’s get exploring!</p>
<p>Before we keep exploring, we’ll set all indexes to more meaningful values, instead of just numbers that pertained to some row at some point. This will make our cleaning slightly easier.</p>
<div class="cell" data-execution_count="24">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>tb_df <span class="op">=</span> tb_df.set_index(<span class="st">"U.S. jurisdiction"</span>)</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>tb_df.head(<span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="24">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>TB cases 2019</th>
      <th>TB cases 2020</th>
      <th>TB cases 2021</th>
      <th>TB incidence 2019</th>
      <th>TB incidence 2020</th>
      <th>TB incidence 2021</th>
    </tr>
    <tr>
      <th>U.S. jurisdiction</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>Total</th>
      <td>8900</td>
      <td>7173</td>
      <td>7860</td>
      <td>2.71</td>
      <td>2.16</td>
      <td>2.37</td>
    </tr>
    <tr>
      <th>Alabama</th>
      <td>87</td>
      <td>72</td>
      <td>92</td>
      <td>1.77</td>
      <td>1.43</td>
      <td>1.83</td>
    </tr>
    <tr>
      <th>Alaska</th>
      <td>58</td>
      <td>58</td>
      <td>58</td>
      <td>7.91</td>
      <td>7.92</td>
      <td>7.92</td>
    </tr>
    <tr>
      <th>Arizona</th>
      <td>183</td>
      <td>136</td>
      <td>129</td>
      <td>2.51</td>
      <td>1.89</td>
      <td>1.77</td>
    </tr>
    <tr>
      <th>Arkansas</th>
      <td>64</td>
      <td>59</td>
      <td>69</td>
      <td>2.12</td>
      <td>1.96</td>
      <td>2.28</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<div class="cell" data-execution_count="25">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>census_2010s_df <span class="op">=</span> census_2010s_df.set_index(<span class="st">"Geographic Area"</span>)</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>census_2010s_df.head(<span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="25">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>2010</th>
      <th>2011</th>
      <th>2012</th>
      <th>2013</th>
      <th>2014</th>
      <th>2015</th>
      <th>2016</th>
      <th>2017</th>
      <th>2018</th>
      <th>2019</th>
    </tr>
    <tr>
      <th>Geographic Area</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>United States</th>
      <td>309321666</td>
      <td>311556874</td>
      <td>313830990</td>
      <td>315993715</td>
      <td>318301008</td>
      <td>320635163</td>
      <td>322941311</td>
      <td>324985539</td>
      <td>326687501</td>
      <td>328239523</td>
    </tr>
    <tr>
      <th>Northeast</th>
      <td>55380134</td>
      <td>55604223</td>
      <td>55775216</td>
      <td>55901806</td>
      <td>56006011</td>
      <td>56034684</td>
      <td>56042330</td>
      <td>56059240</td>
      <td>56046620</td>
      <td>55982803</td>
    </tr>
    <tr>
      <th>Midwest</th>
      <td>66974416</td>
      <td>67157800</td>
      <td>67336743</td>
      <td>67560379</td>
      <td>67745167</td>
      <td>67860583</td>
      <td>67987540</td>
      <td>68126781</td>
      <td>68236628</td>
      <td>68329004</td>
    </tr>
    <tr>
      <th>South</th>
      <td>114866680</td>
      <td>116006522</td>
      <td>117241208</td>
      <td>118364400</td>
      <td>119624037</td>
      <td>120997341</td>
      <td>122351760</td>
      <td>123542189</td>
      <td>124569433</td>
      <td>125580448</td>
    </tr>
    <tr>
      <th>West</th>
      <td>72100436</td>
      <td>72788329</td>
      <td>73477823</td>
      <td>74167130</td>
      <td>74925793</td>
      <td>75742555</td>
      <td>76559681</td>
      <td>77257329</td>
      <td>77834820</td>
      <td>78347268</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<div class="cell" data-execution_count="26">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>census_2020s_df <span class="op">=</span> census_2020s_df.set_index(<span class="st">"Geographic Area"</span>)</span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>census_2020s_df.head(<span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="26">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>2020</th>
      <th>2021</th>
      <th>2022</th>
    </tr>
    <tr>
      <th>Geographic Area</th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>United States</th>
      <td>331511512</td>
      <td>332031554</td>
      <td>333287557</td>
    </tr>
    <tr>
      <th>Northeast</th>
      <td>57448898</td>
      <td>57259257</td>
      <td>57040406</td>
    </tr>
    <tr>
      <th>Midwest</th>
      <td>68961043</td>
      <td>68836505</td>
      <td>68787595</td>
    </tr>
    <tr>
      <th>South</th>
      <td>126450613</td>
      <td>127346029</td>
      <td>128716192</td>
    </tr>
    <tr>
      <th>West</th>
      <td>78650958</td>
      <td>78589763</td>
      <td>78743364</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<p>It turns out that our merge above only kept state records, even though our original <code>tb_df</code> had the “Total” rolled record:</p>
<div class="cell" data-execution_count="27">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>tb_df.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="27">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>TB cases 2019</th>
      <th>TB cases 2020</th>
      <th>TB cases 2021</th>
      <th>TB incidence 2019</th>
      <th>TB incidence 2020</th>
      <th>TB incidence 2021</th>
    </tr>
    <tr>
      <th>U.S. jurisdiction</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>Total</th>
      <td>8900</td>
      <td>7173</td>
      <td>7860</td>
      <td>2.71</td>
      <td>2.16</td>
      <td>2.37</td>
    </tr>
    <tr>
      <th>Alabama</th>
      <td>87</td>
      <td>72</td>
      <td>92</td>
      <td>1.77</td>
      <td>1.43</td>
      <td>1.83</td>
    </tr>
    <tr>
      <th>Alaska</th>
      <td>58</td>
      <td>58</td>
      <td>58</td>
      <td>7.91</td>
      <td>7.92</td>
      <td>7.92</td>
    </tr>
    <tr>
      <th>Arizona</th>
      <td>183</td>
      <td>136</td>
      <td>129</td>
      <td>2.51</td>
      <td>1.89</td>
      <td>1.77</td>
    </tr>
    <tr>
      <th>Arkansas</th>
      <td>64</td>
      <td>59</td>
      <td>69</td>
      <td>2.12</td>
      <td>1.96</td>
      <td>2.28</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<p>Recall that merge by default does an <strong>inner</strong> merge by default, meaning that it only preserves keys that are present in <strong>both</strong> DataFrames.</p>
<p>The rolled records in our census dataframes have different <code>Geographic Area</code> fields, which was the key we merged on:</p>
<div class="cell" data-execution_count="28">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>census_2010s_df.head(<span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="28">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>2010</th>
      <th>2011</th>
      <th>2012</th>
      <th>2013</th>
      <th>2014</th>
      <th>2015</th>
      <th>2016</th>
      <th>2017</th>
      <th>2018</th>
      <th>2019</th>
    </tr>
    <tr>
      <th>Geographic Area</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>United States</th>
      <td>309321666</td>
      <td>311556874</td>
      <td>313830990</td>
      <td>315993715</td>
      <td>318301008</td>
      <td>320635163</td>
      <td>322941311</td>
      <td>324985539</td>
      <td>326687501</td>
      <td>328239523</td>
    </tr>
    <tr>
      <th>Northeast</th>
      <td>55380134</td>
      <td>55604223</td>
      <td>55775216</td>
      <td>55901806</td>
      <td>56006011</td>
      <td>56034684</td>
      <td>56042330</td>
      <td>56059240</td>
      <td>56046620</td>
      <td>55982803</td>
    </tr>
    <tr>
      <th>Midwest</th>
      <td>66974416</td>
      <td>67157800</td>
      <td>67336743</td>
      <td>67560379</td>
      <td>67745167</td>
      <td>67860583</td>
      <td>67987540</td>
      <td>68126781</td>
      <td>68236628</td>
      <td>68329004</td>
    </tr>
    <tr>
      <th>South</th>
      <td>114866680</td>
      <td>116006522</td>
      <td>117241208</td>
      <td>118364400</td>
      <td>119624037</td>
      <td>120997341</td>
      <td>122351760</td>
      <td>123542189</td>
      <td>124569433</td>
      <td>125580448</td>
    </tr>
    <tr>
      <th>West</th>
      <td>72100436</td>
      <td>72788329</td>
      <td>73477823</td>
      <td>74167130</td>
      <td>74925793</td>
      <td>75742555</td>
      <td>76559681</td>
      <td>77257329</td>
      <td>77834820</td>
      <td>78347268</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<p>The Census DataFrame has several rolled records. The aggregate record we are looking for actually has the Geographic Area named “United States”.</p>
<p>One straightforward way to get the right merge is to rename the value itself. Because we now have the Geographic Area index, we’ll use <code>df.rename()</code> (<a href="https://pandas.pydata.org/docs/reference/api/pandas.DataFrame.rename.html">documentation</a>):</p>
<div class="cell" data-execution_count="29">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="co"># rename rolled record for 2010s</span></span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>census_2010s_df.rename(index<span class="op">=</span>{<span class="st">'United States'</span>:<span class="st">'Total'</span>}, inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>census_2010s_df.head(<span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="29">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>2010</th>
      <th>2011</th>
      <th>2012</th>
      <th>2013</th>
      <th>2014</th>
      <th>2015</th>
      <th>2016</th>
      <th>2017</th>
      <th>2018</th>
      <th>2019</th>
    </tr>
    <tr>
      <th>Geographic Area</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>Total</th>
      <td>309321666</td>
      <td>311556874</td>
      <td>313830990</td>
      <td>315993715</td>
      <td>318301008</td>
      <td>320635163</td>
      <td>322941311</td>
      <td>324985539</td>
      <td>326687501</td>
      <td>328239523</td>
    </tr>
    <tr>
      <th>Northeast</th>
      <td>55380134</td>
      <td>55604223</td>
      <td>55775216</td>
      <td>55901806</td>
      <td>56006011</td>
      <td>56034684</td>
      <td>56042330</td>
      <td>56059240</td>
      <td>56046620</td>
      <td>55982803</td>
    </tr>
    <tr>
      <th>Midwest</th>
      <td>66974416</td>
      <td>67157800</td>
      <td>67336743</td>
      <td>67560379</td>
      <td>67745167</td>
      <td>67860583</td>
      <td>67987540</td>
      <td>68126781</td>
      <td>68236628</td>
      <td>68329004</td>
    </tr>
    <tr>
      <th>South</th>
      <td>114866680</td>
      <td>116006522</td>
      <td>117241208</td>
      <td>118364400</td>
      <td>119624037</td>
      <td>120997341</td>
      <td>122351760</td>
      <td>123542189</td>
      <td>124569433</td>
      <td>125580448</td>
    </tr>
    <tr>
      <th>West</th>
      <td>72100436</td>
      <td>72788329</td>
      <td>73477823</td>
      <td>74167130</td>
      <td>74925793</td>
      <td>75742555</td>
      <td>76559681</td>
      <td>77257329</td>
      <td>77834820</td>
      <td>78347268</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<div class="cell" data-execution_count="30">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="co"># same, but for 2020s rename rolled record</span></span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>census_2020s_df.rename(index<span class="op">=</span>{<span class="st">'United States'</span>:<span class="st">'Total'</span>}, inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a>census_2020s_df.head(<span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="30">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>2020</th>
      <th>2021</th>
      <th>2022</th>
    </tr>
    <tr>
      <th>Geographic Area</th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>Total</th>
      <td>331511512</td>
      <td>332031554</td>
      <td>333287557</td>
    </tr>
    <tr>
      <th>Northeast</th>
      <td>57448898</td>
      <td>57259257</td>
      <td>57040406</td>
    </tr>
    <tr>
      <th>Midwest</th>
      <td>68961043</td>
      <td>68836505</td>
      <td>68787595</td>
    </tr>
    <tr>
      <th>South</th>
      <td>126450613</td>
      <td>127346029</td>
      <td>128716192</td>
    </tr>
    <tr>
      <th>West</th>
      <td>78650958</td>
      <td>78589763</td>
      <td>78743364</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<p><br></p>
<p>Next let’s rerun our merge. Note the different chaining, because we are now merging on indexes (<code>df.merge()</code> <a href="https://pandas.pydata.org/docs/reference/api/pandas.DataFrame.merge.html">documentation</a>).</p>
<div class="cell" data-execution_count="31">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>tb_census_df <span class="op">=</span> (</span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>    tb_df</span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>    .merge(right<span class="op">=</span>census_2010s_df[[<span class="st">"2019"</span>]],</span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a>           left_index<span class="op">=</span><span class="va">True</span>, right_index<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a>    .merge(right<span class="op">=</span>census_2020s_df[[<span class="st">"2020"</span>, <span class="st">"2021"</span>]],</span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a>           left_index<span class="op">=</span><span class="va">True</span>, right_index<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb36-7"><a href="#cb36-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb36-8"><a href="#cb36-8" aria-hidden="true" tabindex="-1"></a>tb_census_df.head(<span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="31">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>TB cases 2019</th>
      <th>TB cases 2020</th>
      <th>TB cases 2021</th>
      <th>TB incidence 2019</th>
      <th>TB incidence 2020</th>
      <th>TB incidence 2021</th>
      <th>2019</th>
      <th>2020</th>
      <th>2021</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>Total</th>
      <td>8900</td>
      <td>7173</td>
      <td>7860</td>
      <td>2.71</td>
      <td>2.16</td>
      <td>2.37</td>
      <td>328239523</td>
      <td>331511512</td>
      <td>332031554</td>
    </tr>
    <tr>
      <th>Alabama</th>
      <td>87</td>
      <td>72</td>
      <td>92</td>
      <td>1.77</td>
      <td>1.43</td>
      <td>1.83</td>
      <td>4903185</td>
      <td>5031362</td>
      <td>5049846</td>
    </tr>
    <tr>
      <th>Alaska</th>
      <td>58</td>
      <td>58</td>
      <td>58</td>
      <td>7.91</td>
      <td>7.92</td>
      <td>7.92</td>
      <td>731545</td>
      <td>732923</td>
      <td>734182</td>
    </tr>
    <tr>
      <th>Arizona</th>
      <td>183</td>
      <td>136</td>
      <td>129</td>
      <td>2.51</td>
      <td>1.89</td>
      <td>1.77</td>
      <td>7278717</td>
      <td>7179943</td>
      <td>7264877</td>
    </tr>
    <tr>
      <th>Arkansas</th>
      <td>64</td>
      <td>59</td>
      <td>69</td>
      <td>2.12</td>
      <td>1.96</td>
      <td>2.28</td>
      <td>3017804</td>
      <td>3014195</td>
      <td>3028122</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<p><br></p>
<p>Finally, let’s recompute our incidences:</p>
<div class="cell" data-execution_count="32">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="co"># recompute incidence for all years</span></span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> year <span class="kw">in</span> [<span class="dv">2019</span>, <span class="dv">2020</span>, <span class="dv">2021</span>]:</span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a>    tb_census_df[<span class="ss">f"recompute incidence </span><span class="sc">{</span>year<span class="sc">}</span><span class="ss">"</span>] <span class="op">=</span> tb_census_df[<span class="ss">f"TB cases </span><span class="sc">{</span>year<span class="sc">}</span><span class="ss">"</span>]<span class="op">/</span>tb_census_df[<span class="ss">f"</span><span class="sc">{</span>year<span class="sc">}</span><span class="ss">"</span>]<span class="op">*</span><span class="dv">100000</span></span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a>tb_census_df.head(<span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="32">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>TB cases 2019</th>
      <th>TB cases 2020</th>
      <th>TB cases 2021</th>
      <th>TB incidence 2019</th>
      <th>TB incidence 2020</th>
      <th>TB incidence 2021</th>
      <th>2019</th>
      <th>2020</th>
      <th>2021</th>
      <th>recompute incidence 2019</th>
      <th>recompute incidence 2020</th>
      <th>recompute incidence 2021</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>Total</th>
      <td>8900</td>
      <td>7173</td>
      <td>7860</td>
      <td>2.71</td>
      <td>2.16</td>
      <td>2.37</td>
      <td>328239523</td>
      <td>331511512</td>
      <td>332031554</td>
      <td>2.711435</td>
      <td>2.163726</td>
      <td>2.367245</td>
    </tr>
    <tr>
      <th>Alabama</th>
      <td>87</td>
      <td>72</td>
      <td>92</td>
      <td>1.77</td>
      <td>1.43</td>
      <td>1.83</td>
      <td>4903185</td>
      <td>5031362</td>
      <td>5049846</td>
      <td>1.774357</td>
      <td>1.431024</td>
      <td>1.821838</td>
    </tr>
    <tr>
      <th>Alaska</th>
      <td>58</td>
      <td>58</td>
      <td>58</td>
      <td>7.91</td>
      <td>7.92</td>
      <td>7.92</td>
      <td>731545</td>
      <td>732923</td>
      <td>734182</td>
      <td>7.928425</td>
      <td>7.913519</td>
      <td>7.899949</td>
    </tr>
    <tr>
      <th>Arizona</th>
      <td>183</td>
      <td>136</td>
      <td>129</td>
      <td>2.51</td>
      <td>1.89</td>
      <td>1.77</td>
      <td>7278717</td>
      <td>7179943</td>
      <td>7264877</td>
      <td>2.514179</td>
      <td>1.894165</td>
      <td>1.775667</td>
    </tr>
    <tr>
      <th>Arkansas</th>
      <td>64</td>
      <td>59</td>
      <td>69</td>
      <td>2.12</td>
      <td>1.96</td>
      <td>2.28</td>
      <td>3017804</td>
      <td>3014195</td>
      <td>3028122</td>
      <td>2.120747</td>
      <td>1.957405</td>
      <td>2.27864</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<p>We reproduced the total U.S. incidences correctly!</p>
<p>We’re almost there. Let’s revisit the quote:</p>
<blockquote class="blockquote">
<p>Reported TB incidence (cases per 100,000 persons) increased <strong>9.4%</strong>, from <strong>2.2</strong> during 2020 to <strong>2.4</strong> during 2021 but was lower than incidence during 2019 (2.7). Increases occurred among both U.S.-born and non–U.S.-born persons.</p>
</blockquote>
<p>Recall that percent change from <span class="math inline">\(A\)</span> to <span class="math inline">\(B\)</span> is computed as <span class="math inline">\(\text{percent change} = \frac{B - A}{A} \times 100\)</span>.</p>
<div class="cell" data-tags="[]" data-execution_count="33">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>incidence_2020 <span class="op">=</span> tb_census_df.loc[<span class="st">'Total'</span>, <span class="st">'recompute incidence 2020'</span>]</span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>incidence_2020</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="33">
<pre><code>2.1637257652759883</code></pre>
</div>
</div>
<div class="cell" data-tags="[]" data-execution_count="34">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>incidence_2021 <span class="op">=</span> tb_census_df.loc[<span class="st">'Total'</span>, <span class="st">'recompute incidence 2021'</span>]</span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>incidence_2021</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="34">
<pre><code>2.3672448914298068</code></pre>
</div>
</div>
<div class="cell" data-tags="[]" data-execution_count="35">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>difference <span class="op">=</span> (incidence_2021 <span class="op">-</span> incidence_2020)<span class="op">/</span>incidence_2020 <span class="op">*</span> <span class="dv">100</span></span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a>difference</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="35">
<pre><code>9.405957511804143</code></pre>
</div>
</div>


<!-- -->

</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation column-body">
  <div class="nav-page nav-page-previous">
      <a href="../pandas_3/pandas_3.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Pandas III</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="../regex/regex.html" class="pagination-link">
        <span class="nav-page-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Regular Expressions</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb44" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a><span class="an">title:</span><span class="co"> Data Cleaning and EDA</span></span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a><span class="an">execute:</span></span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a><span class="co">  echo: true</span></span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true" tabindex="-1"></a><span class="an">format:</span></span>
<span id="cb44-6"><a href="#cb44-6" aria-hidden="true" tabindex="-1"></a><span class="co">  html:</span></span>
<span id="cb44-7"><a href="#cb44-7" aria-hidden="true" tabindex="-1"></a><span class="co">    code-fold: true</span></span>
<span id="cb44-8"><a href="#cb44-8" aria-hidden="true" tabindex="-1"></a><span class="co">    code-tools: true</span></span>
<span id="cb44-9"><a href="#cb44-9" aria-hidden="true" tabindex="-1"></a><span class="co">    toc: true</span></span>
<span id="cb44-10"><a href="#cb44-10" aria-hidden="true" tabindex="-1"></a><span class="co">    toc-title: Data Cleaning and EDA</span></span>
<span id="cb44-11"><a href="#cb44-11" aria-hidden="true" tabindex="-1"></a><span class="co">    page-layout: full</span></span>
<span id="cb44-12"><a href="#cb44-12" aria-hidden="true" tabindex="-1"></a><span class="co">    theme:</span></span>
<span id="cb44-13"><a href="#cb44-13" aria-hidden="true" tabindex="-1"></a><span class="co">      - cosmo</span></span>
<span id="cb44-14"><a href="#cb44-14" aria-hidden="true" tabindex="-1"></a><span class="co">      - cerulean</span></span>
<span id="cb44-15"><a href="#cb44-15" aria-hidden="true" tabindex="-1"></a><span class="co">    callout-icon: false</span></span>
<span id="cb44-16"><a href="#cb44-16" aria-hidden="true" tabindex="-1"></a><span class="an">jupyter:</span><span class="co"> python3</span></span>
<span id="cb44-17"><a href="#cb44-17" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb44-18"><a href="#cb44-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-19"><a href="#cb44-19" aria-hidden="true" tabindex="-1"></a>::: {.callout-note collapse="true"}</span>
<span id="cb44-20"><a href="#cb44-20" aria-hidden="true" tabindex="-1"></a><span class="fu">## Learning Outcomes</span></span>
<span id="cb44-21"><a href="#cb44-21" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>Recognize common file formats</span>
<span id="cb44-22"><a href="#cb44-22" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>Categorize data by its variable type</span>
<span id="cb44-23"><a href="#cb44-23" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>Build awareness of issues with data faithfulness and develop targeted solutions</span>
<span id="cb44-24"><a href="#cb44-24" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb44-25"><a href="#cb44-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-26"><a href="#cb44-26" aria-hidden="true" tabindex="-1"></a>In the past few lectures, we've learned that <span class="in">`pandas`</span> is a toolkit to restructure, modify, and explore a dataset. What we haven't yet touched on is *how* to make these data transformation decisions. When we receive a new set of data from the "real world," how do we know what processing we should do to convert this data into a usable form?</span>
<span id="cb44-27"><a href="#cb44-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-28"><a href="#cb44-28" aria-hidden="true" tabindex="-1"></a>**Data cleaning**, also called **data wrangling**, is the process of transforming raw data to facilitate subsequent analysis. It is often used to address issues like:</span>
<span id="cb44-29"><a href="#cb44-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-30"><a href="#cb44-30" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>Unclear structure or formatting</span>
<span id="cb44-31"><a href="#cb44-31" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>Missing or corrupted values</span>
<span id="cb44-32"><a href="#cb44-32" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>Unit conversions</span>
<span id="cb44-33"><a href="#cb44-33" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>...and so on</span>
<span id="cb44-34"><a href="#cb44-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-35"><a href="#cb44-35" aria-hidden="true" tabindex="-1"></a>**Exploratory Data Analysis (EDA)** is the process of understanding a new dataset. It is an open-ended, informal analysis that involves familiarizing ourselves with the variables present in the data, discovering potential hypotheses, and identifying potential issues with the data. This last point can often motivate further data cleaning to address any problems with the dataset's format; because of this, EDA and data cleaning are often thought of as an "infinite loop," with each process driving the other.</span>
<span id="cb44-36"><a href="#cb44-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-37"><a href="#cb44-37" aria-hidden="true" tabindex="-1"></a>In this lecture, we will consider the key properties of data to consider when performing data cleaning and EDA. In doing so, we'll develop a "checklist" of sorts for you to consider when approaching a new dataset. Throughout this process, we'll build a deeper understanding of this early (but very important!) stage of the data science lifecycle.</span>
<span id="cb44-38"><a href="#cb44-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-39"><a href="#cb44-39" aria-hidden="true" tabindex="-1"></a><span class="fu">## Structure</span></span>
<span id="cb44-40"><a href="#cb44-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-41"><a href="#cb44-41" aria-hidden="true" tabindex="-1"></a><span class="fu">### File Format</span></span>
<span id="cb44-42"><a href="#cb44-42" aria-hidden="true" tabindex="-1"></a>In the past two <span class="in">`pandas`</span> lectures, we briefly touched on the idea of file format: the way data is encoded in a file for storage. Specifically, our <span class="in">`elections`</span> and <span class="in">`babynames`</span> datasets were stored and loaded as CSVs:</span>
<span id="cb44-43"><a href="#cb44-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-46"><a href="#cb44-46" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb44-47"><a href="#cb44-47" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: false</span></span>
<span id="cb44-48"><a href="#cb44-48" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb44-49"><a href="#cb44-49" aria-hidden="true" tabindex="-1"></a>pd.read_csv(<span class="st">"data/elections.csv"</span>).head(<span class="dv">5</span>)</span>
<span id="cb44-50"><a href="#cb44-50" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb44-51"><a href="#cb44-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-52"><a href="#cb44-52" aria-hidden="true" tabindex="-1"></a>CSVs, which stand for **Comma-Separated Values**, are a common tabular data format. To better understand the properties of a CSV, let's take a look at the first few rows of the raw data file to see what it looks like before being loaded into a DataFrame. </span>
<span id="cb44-53"><a href="#cb44-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-56"><a href="#cb44-56" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb44-57"><a href="#cb44-57" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false</span></span>
<span id="cb44-58"><a href="#cb44-58" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> <span class="bu">open</span>(<span class="st">"data/elections.csv"</span>, <span class="st">"r"</span>) <span class="im">as</span> table:</span>
<span id="cb44-59"><a href="#cb44-59" aria-hidden="true" tabindex="-1"></a>    i <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb44-60"><a href="#cb44-60" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> row <span class="kw">in</span> table:</span>
<span id="cb44-61"><a href="#cb44-61" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(row)</span>
<span id="cb44-62"><a href="#cb44-62" aria-hidden="true" tabindex="-1"></a>        i <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb44-63"><a href="#cb44-63" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> i <span class="op">&gt;</span> <span class="dv">3</span>:</span>
<span id="cb44-64"><a href="#cb44-64" aria-hidden="true" tabindex="-1"></a>            <span class="cf">break</span></span>
<span id="cb44-65"><a href="#cb44-65" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb44-66"><a href="#cb44-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-67"><a href="#cb44-67" aria-hidden="true" tabindex="-1"></a>Each row, or **record**, in the data is delimited by a newline. Each column, or **field**, in the data is delimited by a comma (hence, comma-separated!). </span>
<span id="cb44-68"><a href="#cb44-68" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-69"><a href="#cb44-69" aria-hidden="true" tabindex="-1"></a>Another common file type is the **TSV (Tab-Separated Values)**. In a TSV, records are still delimited by a newline, while fields are delimited by <span class="in">`\t`</span> tab character. A TSV can be loaded into <span class="in">`pandas`</span> using <span class="in">`pd.read_csv()`</span> with the <span class="in">`delimiter`</span> parameter: <span class="in">`pd.read_csv("file_name.tsv", delimiter="\t")`</span>. A raw TSV file is shown below.</span>
<span id="cb44-70"><a href="#cb44-70" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-73"><a href="#cb44-73" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb44-74"><a href="#cb44-74" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false</span></span>
<span id="cb44-75"><a href="#cb44-75" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> <span class="bu">open</span>(<span class="st">"data/elections.txt"</span>, <span class="st">"r"</span>) <span class="im">as</span> table:</span>
<span id="cb44-76"><a href="#cb44-76" aria-hidden="true" tabindex="-1"></a>    i <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb44-77"><a href="#cb44-77" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> row <span class="kw">in</span> table:</span>
<span id="cb44-78"><a href="#cb44-78" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(row)</span>
<span id="cb44-79"><a href="#cb44-79" aria-hidden="true" tabindex="-1"></a>        i <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb44-80"><a href="#cb44-80" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> i <span class="op">&gt;</span> <span class="dv">3</span>:</span>
<span id="cb44-81"><a href="#cb44-81" aria-hidden="true" tabindex="-1"></a>            <span class="cf">break</span></span>
<span id="cb44-82"><a href="#cb44-82" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb44-83"><a href="#cb44-83" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-84"><a href="#cb44-84" aria-hidden="true" tabindex="-1"></a>**JSON (JavaScript Object Notation)** files behave similarly to Python dictionaries. They can be loaded into <span class="in">`pandas`</span> using <span class="in">`pd.read_json`</span>. A raw JSON is shown below.</span>
<span id="cb44-85"><a href="#cb44-85" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-88"><a href="#cb44-88" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb44-89"><a href="#cb44-89" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false</span></span>
<span id="cb44-90"><a href="#cb44-90" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> <span class="bu">open</span>(<span class="st">"data/elections.json"</span>, <span class="st">"r"</span>) <span class="im">as</span> table:</span>
<span id="cb44-91"><a href="#cb44-91" aria-hidden="true" tabindex="-1"></a>    i <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb44-92"><a href="#cb44-92" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> row <span class="kw">in</span> table:</span>
<span id="cb44-93"><a href="#cb44-93" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(row)</span>
<span id="cb44-94"><a href="#cb44-94" aria-hidden="true" tabindex="-1"></a>        i <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb44-95"><a href="#cb44-95" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> i <span class="op">&gt;</span> <span class="dv">8</span>:</span>
<span id="cb44-96"><a href="#cb44-96" aria-hidden="true" tabindex="-1"></a>            <span class="cf">break</span></span>
<span id="cb44-97"><a href="#cb44-97" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb44-98"><a href="#cb44-98" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-99"><a href="#cb44-99" aria-hidden="true" tabindex="-1"></a><span class="fu">### Variable Types</span></span>
<span id="cb44-100"><a href="#cb44-100" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-101"><a href="#cb44-101" aria-hidden="true" tabindex="-1"></a>After loading data into a file, it's a good idea to take the time to understand what pieces of information are encoded in the dataset. In particular, we want to identify what variable types are present in our data. Broadly speaking, we can categorize variables into one of two overarching types. </span>
<span id="cb44-102"><a href="#cb44-102" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-103"><a href="#cb44-103" aria-hidden="true" tabindex="-1"></a>**Quantitative variables** describe some numeric quantity or amount. We can sub-divide quantitative data into:</span>
<span id="cb44-104"><a href="#cb44-104" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-105"><a href="#cb44-105" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>**Continuous quantitative variables**: numeric data that can be measured on a continuous scale to arbitrary precision. Continuous variables do not have a strict set of possible values – they can be recorded to any number of decimal places. For example, weights, GPA, or CO<span class="kw">&lt;sub&gt;</span>2<span class="kw">&lt;/sub&gt;</span> concentrations</span>
<span id="cb44-106"><a href="#cb44-106" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>**Discrete quantitative variables**: numeric data that can only take on a finite set of possible values. For example, someone's age or number of siblings.</span>
<span id="cb44-107"><a href="#cb44-107" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-108"><a href="#cb44-108" aria-hidden="true" tabindex="-1"></a>**Qualitative variables**, also known as **categorical variables**, describe data that isn't measuring some quantity or amount. The sub-categories of categorical data are:</span>
<span id="cb44-109"><a href="#cb44-109" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-110"><a href="#cb44-110" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>**Ordinal qualitative variables**: categories with ordered levels. Specifically, ordinal variables are those where the difference between levels has no consistent, quantifiable meaning. For example, a Yelp rating or set of income brackets. </span>
<span id="cb44-111"><a href="#cb44-111" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>**Nominal qualitative variables**: categories with no specific order. For example, someone's political affiliation or Cal ID number.</span>
<span id="cb44-112"><a href="#cb44-112" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-113"><a href="#cb44-113" aria-hidden="true" tabindex="-1"></a><span class="al">![Classification of variable types](images/variable.png)</span></span>
<span id="cb44-114"><a href="#cb44-114" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-115"><a href="#cb44-115" aria-hidden="true" tabindex="-1"></a><span class="fu">### Primary and Foreign Keys</span></span>
<span id="cb44-116"><a href="#cb44-116" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-117"><a href="#cb44-117" aria-hidden="true" tabindex="-1"></a>Last time, we introduced <span class="in">`.merge`</span> as the <span class="in">`pandas`</span> method for joining multiple DataFrames together. In our discussion of joins, we touched on the idea of using a "key" to determine what rows should be merged from each table. Let's take a moment to examine this idea more closely.</span>
<span id="cb44-118"><a href="#cb44-118" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-119"><a href="#cb44-119" aria-hidden="true" tabindex="-1"></a>The **primary key** is the column or set of columns in a table that determine the values of the remaining columns. It can be thought of as the unique identifier for each individual row in the table. For example, a table of Data 100 students might use each student's Cal ID as the primary key. </span>
<span id="cb44-120"><a href="#cb44-120" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-123"><a href="#cb44-123" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb44-124"><a href="#cb44-124" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false</span></span>
<span id="cb44-125"><a href="#cb44-125" aria-hidden="true" tabindex="-1"></a>pd.DataFrame({<span class="st">"Cal ID"</span>:[<span class="dv">3034619471</span>, <span class="dv">3035619472</span>, <span class="dv">3025619473</span>, <span class="dv">3046789372</span>], <span class="op">\</span></span>
<span id="cb44-126"><a href="#cb44-126" aria-hidden="true" tabindex="-1"></a>             <span class="st">"Name"</span>:[<span class="st">"Oski"</span>, <span class="st">"Ollie"</span>, <span class="st">"Orrie"</span>, <span class="st">"Ollie"</span>], <span class="op">\</span></span>
<span id="cb44-127"><a href="#cb44-127" aria-hidden="true" tabindex="-1"></a>             <span class="st">"Major"</span>:[<span class="st">"Data Science"</span>, <span class="st">"Computer Science"</span>, <span class="st">"Data Science"</span>, <span class="st">"Economics"</span>]})</span>
<span id="cb44-128"><a href="#cb44-128" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb44-129"><a href="#cb44-129" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-130"><a href="#cb44-130" aria-hidden="true" tabindex="-1"></a>The **foreign key** is the column or set of columns in a table that reference primary keys in other tables. Knowing a dataset's foreign keys can be useful when assigning the <span class="in">`left_on`</span> and <span class="in">`right_on`</span> parameters of <span class="in">`.merge`</span>. In the table of office hour tickets below, <span class="in">`"Cal ID"`</span> is a foreign key referencing the previous table.</span>
<span id="cb44-131"><a href="#cb44-131" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-134"><a href="#cb44-134" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb44-135"><a href="#cb44-135" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false</span></span>
<span id="cb44-136"><a href="#cb44-136" aria-hidden="true" tabindex="-1"></a>pd.DataFrame({<span class="st">"OH Request"</span>:[<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>], <span class="op">\</span></span>
<span id="cb44-137"><a href="#cb44-137" aria-hidden="true" tabindex="-1"></a>             <span class="st">"Cal ID"</span>:[<span class="dv">3034619471</span>, <span class="dv">3035619472</span>, <span class="dv">3025619473</span>, <span class="dv">3035619472</span>], <span class="op">\</span></span>
<span id="cb44-138"><a href="#cb44-138" aria-hidden="true" tabindex="-1"></a>             <span class="st">"Question"</span>:[<span class="st">"HW 2 Q1"</span>, <span class="st">"HW 2 Q3"</span>, <span class="st">"Lab 3 Q4"</span>, <span class="st">"HW 2 Q7"</span>]})</span>
<span id="cb44-139"><a href="#cb44-139" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb44-140"><a href="#cb44-140" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-141"><a href="#cb44-141" aria-hidden="true" tabindex="-1"></a><span class="fu">## Granularity, Scope, and Temporality</span></span>
<span id="cb44-142"><a href="#cb44-142" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-143"><a href="#cb44-143" aria-hidden="true" tabindex="-1"></a>After understanding the structure of the dataset, the next task is to determine what exactly the data represents. We'll do so by considering the data's granularity, scope, and temporality.</span>
<span id="cb44-144"><a href="#cb44-144" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-145"><a href="#cb44-145" aria-hidden="true" tabindex="-1"></a>The **granularity** of a dataset is the level of detail included in the data. To determine the data's granularity, ask: what does each row in the dataset represent? Fine-grained data contains a high level of detail, with a single row representing a small individual unit. For example, each record may represent one person. Coarse-grained data is encoded such that a single row represents a large individual unit – for example, each record may represent a group of people.</span>
<span id="cb44-146"><a href="#cb44-146" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-147"><a href="#cb44-147" aria-hidden="true" tabindex="-1"></a>The **scope** of a dataset is the subset of the population covered by the data. If we were investigating student performance in Data Science courses, a dataset with narrow scope might encompass all students enrolled in Data 100; a dataset with expansive scope might encompass all students in California. </span>
<span id="cb44-148"><a href="#cb44-148" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-149"><a href="#cb44-149" aria-hidden="true" tabindex="-1"></a>The **temporality** of a dataset describes the time period over which the data was collected. To fully understand the temporality of the data, it may be necessary to standardize timezones or inspect recurring time-based trends in the data (Do patterns recur in 24-hour patterns? Over the course of a month? Seasonally?).</span>
<span id="cb44-150"><a href="#cb44-150" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-151"><a href="#cb44-151" aria-hidden="true" tabindex="-1"></a><span class="fu">## Faithfulness</span></span>
<span id="cb44-152"><a href="#cb44-152" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-153"><a href="#cb44-153" aria-hidden="true" tabindex="-1"></a>At this stage in our data cleaning and EDA workflow, we've achieved quite a lot: we've identified how our data is structured, come to terms with what information it encodes, and gained insight as to how it was generated. Throughout this process, we should always recall the original intent of our work in Data Science – to use data to better understand and model the real world. To achieve this goal, we need to ensure that the data we use is faithful to reality; that is, that our data accurately captures the "real world."</span>
<span id="cb44-154"><a href="#cb44-154" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-155"><a href="#cb44-155" aria-hidden="true" tabindex="-1"></a>Data used in research or industry is often "messy" – there may be errors or inaccuracies that impact the faithfulness of the dataset. Signs that data may not be faithful include:</span>
<span id="cb44-156"><a href="#cb44-156" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-157"><a href="#cb44-157" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>Unrealistic or "incorrect" values, such as negative counts, locations that don't exist, or dates set in the future</span>
<span id="cb44-158"><a href="#cb44-158" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>Violations of obvious dependencies, like an age that does not match a birthday</span>
<span id="cb44-159"><a href="#cb44-159" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>Clear signs that data was entered by hand, which can lead to spelling errors or fields that are incorrectly shifted</span>
<span id="cb44-160"><a href="#cb44-160" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>Signs of data falsification, such as fake email addresses or repeated use of the same names</span>
<span id="cb44-161"><a href="#cb44-161" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>Duplicated records or fields containing the same information</span>
<span id="cb44-162"><a href="#cb44-162" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-163"><a href="#cb44-163" aria-hidden="true" tabindex="-1"></a>A common issue encountered with real-world datasets is that of missing data. One strategy to resolve this is to simply drop any records with missing values from the dataset. This does, however, introduce the risk of inducing biases – it is possible that the missing or corrupt records may be systemically related to some feature of interest in the data.</span>
<span id="cb44-164"><a href="#cb44-164" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-165"><a href="#cb44-165" aria-hidden="true" tabindex="-1"></a>Another method to address missing data is to perform **imputation**: infer the missing values using other data available in the dataset. There is a wide variety of imputation techniques that can be implemented; some of the most common are listed below.</span>
<span id="cb44-166"><a href="#cb44-166" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-167"><a href="#cb44-167" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>Average imputation: replace missing values with the average value for that field</span>
<span id="cb44-168"><a href="#cb44-168" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>Hot deck imputation: replace missing values with some random value</span>
<span id="cb44-169"><a href="#cb44-169" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>Regression imputation: develop a model to predict missing values</span>
<span id="cb44-170"><a href="#cb44-170" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>Multiple imputation: replace missing values with multiple random values</span>
<span id="cb44-171"><a href="#cb44-171" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-172"><a href="#cb44-172" aria-hidden="true" tabindex="-1"></a>Regardless of the strategy used to deal with missing data, we should think carefully about *why* particular records or fields may be missing – this can help inform whether or not the absence of these values is signficant in some meaningful way.</span>
<span id="cb44-173"><a href="#cb44-173" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-174"><a href="#cb44-174" aria-hidden="true" tabindex="-1"></a><span class="fu"># EDA Demo: Tuberculosis in the United States</span></span>
<span id="cb44-175"><a href="#cb44-175" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-176"><a href="#cb44-176" aria-hidden="true" tabindex="-1"></a>Now, let's follow this data-cleaning and EDA workflow to see what can we say about the presence of Tuberculosis in the United States!</span>
<span id="cb44-177"><a href="#cb44-177" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-178"><a href="#cb44-178" aria-hidden="true" tabindex="-1"></a>We will examine the data included in the <span class="co">[</span><span class="ot">original CDC article</span><span class="co">](https://www.cdc.gov/mmwr/volumes/71/wr/mm7112a1.htm?s_cid=mm7112a1_w#T1_down)</span> published in 2021.</span>
<span id="cb44-179"><a href="#cb44-179" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-180"><a href="#cb44-180" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-181"><a href="#cb44-181" aria-hidden="true" tabindex="-1"></a><span class="fu">## CSVs and Field Names</span></span>
<span id="cb44-182"><a href="#cb44-182" aria-hidden="true" tabindex="-1"></a>Suppose Table 1 was saved as a CSV file located in <span class="in">`data/cdc_tuberculosis.csv`</span>.</span>
<span id="cb44-183"><a href="#cb44-183" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-184"><a href="#cb44-184" aria-hidden="true" tabindex="-1"></a>We can then explore the CSV (which is a text file, and does not contain binary-encoded data) in many ways:</span>
<span id="cb44-185"><a href="#cb44-185" aria-hidden="true" tabindex="-1"></a><span class="ss">1. </span>Using a text editor like emacs, vim, VSCode, etc.</span>
<span id="cb44-186"><a href="#cb44-186" aria-hidden="true" tabindex="-1"></a><span class="ss">2. </span>Opening the CSV directly in DataHub (read-only), Excel, Google Sheets, etc.</span>
<span id="cb44-187"><a href="#cb44-187" aria-hidden="true" tabindex="-1"></a><span class="ss">3. </span>The Python file object</span>
<span id="cb44-188"><a href="#cb44-188" aria-hidden="true" tabindex="-1"></a><span class="ss">4. </span>pandas, using <span class="in">`pd.read_csv()`</span></span>
<span id="cb44-189"><a href="#cb44-189" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-190"><a href="#cb44-190" aria-hidden="true" tabindex="-1"></a>1, 2. Let's start with the first two so we really solidify the idea of a CSV as **rectangular data (i.e., tabular data) stored as comma-separated values**.</span>
<span id="cb44-191"><a href="#cb44-191" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-192"><a href="#cb44-192" aria-hidden="true" tabindex="-1"></a><span class="ss">3. </span>Next, let's try using the Python file object. Let's check out the first three lines:</span>
<span id="cb44-193"><a href="#cb44-193" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-196"><a href="#cb44-196" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb44-197"><a href="#cb44-197" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> <span class="bu">open</span>(<span class="st">"data/cdc_tuberculosis.csv"</span>, <span class="st">"r"</span>) <span class="im">as</span> f:</span>
<span id="cb44-198"><a href="#cb44-198" aria-hidden="true" tabindex="-1"></a>    i <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb44-199"><a href="#cb44-199" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> row <span class="kw">in</span> f:</span>
<span id="cb44-200"><a href="#cb44-200" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(row)</span>
<span id="cb44-201"><a href="#cb44-201" aria-hidden="true" tabindex="-1"></a>        i <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb44-202"><a href="#cb44-202" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> i <span class="op">&gt;</span> <span class="dv">3</span>:</span>
<span id="cb44-203"><a href="#cb44-203" aria-hidden="true" tabindex="-1"></a>            <span class="cf">break</span></span>
<span id="cb44-204"><a href="#cb44-204" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb44-205"><a href="#cb44-205" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-206"><a href="#cb44-206" aria-hidden="true" tabindex="-1"></a>Whoa, why are there blank lines interspaced between the lines of the CSV?</span>
<span id="cb44-207"><a href="#cb44-207" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-208"><a href="#cb44-208" aria-hidden="true" tabindex="-1"></a>You may recall that all line breaks in text files are encoded as the special newline character <span class="in">`\n`</span>. Python's <span class="in">`print()`</span> prints each string (including the newline), and an additional newline on top of that.</span>
<span id="cb44-209"><a href="#cb44-209" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-210"><a href="#cb44-210" aria-hidden="true" tabindex="-1"></a>If you're curious, we can use the <span class="in">`repr()`</span> function to return the raw string with all special characters:</span>
<span id="cb44-211"><a href="#cb44-211" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-214"><a href="#cb44-214" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb44-215"><a href="#cb44-215" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> <span class="bu">open</span>(<span class="st">"data/cdc_tuberculosis.csv"</span>, <span class="st">"r"</span>) <span class="im">as</span> f:</span>
<span id="cb44-216"><a href="#cb44-216" aria-hidden="true" tabindex="-1"></a>    i <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb44-217"><a href="#cb44-217" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> row <span class="kw">in</span> f:</span>
<span id="cb44-218"><a href="#cb44-218" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="bu">repr</span>(row)) <span class="co"># print raw strings</span></span>
<span id="cb44-219"><a href="#cb44-219" aria-hidden="true" tabindex="-1"></a>        i <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb44-220"><a href="#cb44-220" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> i <span class="op">&gt;</span> <span class="dv">3</span>:</span>
<span id="cb44-221"><a href="#cb44-221" aria-hidden="true" tabindex="-1"></a>            <span class="cf">break</span></span>
<span id="cb44-222"><a href="#cb44-222" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb44-223"><a href="#cb44-223" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-224"><a href="#cb44-224" aria-hidden="true" tabindex="-1"></a><span class="ss">4. </span>Finally, let's see the tried-and-true Data 100 approach: pandas.</span>
<span id="cb44-225"><a href="#cb44-225" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-228"><a href="#cb44-228" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb44-229"><a href="#cb44-229" aria-hidden="true" tabindex="-1"></a>tb_df <span class="op">=</span> pd.read_csv(<span class="st">"data/cdc_tuberculosis.csv"</span>)</span>
<span id="cb44-230"><a href="#cb44-230" aria-hidden="true" tabindex="-1"></a>tb_df</span>
<span id="cb44-231"><a href="#cb44-231" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb44-232"><a href="#cb44-232" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-233"><a href="#cb44-233" aria-hidden="true" tabindex="-1"></a>Wait, what's up with the "Unnamed" column names? And the first row, for that matter?</span>
<span id="cb44-234"><a href="#cb44-234" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-235"><a href="#cb44-235" aria-hidden="true" tabindex="-1"></a>Congratulations -- you're ready to wrangle your data. Because of how things are stored, we'll need to clean the data a bit to name our columns better.</span>
<span id="cb44-236"><a href="#cb44-236" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-237"><a href="#cb44-237" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-238"><a href="#cb44-238" aria-hidden="true" tabindex="-1"></a>A reasonable first step is to identify the row with the right header. The <span class="in">`pd.read_csv()`</span> function (<span class="co">[</span><span class="ot">documentation</span><span class="co">](https://pandas.pydata.org/docs/reference/api/pandas.read_csv.html)</span>) has the convenient <span class="in">`header`</span> parameter:</span>
<span id="cb44-239"><a href="#cb44-239" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-242"><a href="#cb44-242" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb44-243"><a href="#cb44-243" aria-hidden="true" tabindex="-1"></a>tb_df <span class="op">=</span> pd.read_csv(<span class="st">"data/cdc_tuberculosis.csv"</span>, header<span class="op">=</span><span class="dv">1</span>) <span class="co"># row index</span></span>
<span id="cb44-244"><a href="#cb44-244" aria-hidden="true" tabindex="-1"></a>tb_df.head(<span class="dv">5</span>)</span>
<span id="cb44-245"><a href="#cb44-245" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb44-246"><a href="#cb44-246" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-247"><a href="#cb44-247" aria-hidden="true" tabindex="-1"></a>Wait...but now we can't differentiate betwen the "Number of TB cases" and "TB incidence" year columns. pandas has tried to make our lives easier by automatically adding ".1" to the latter columns, but this doesn't help us as humans understand the data.</span>
<span id="cb44-248"><a href="#cb44-248" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-249"><a href="#cb44-249" aria-hidden="true" tabindex="-1"></a>We can do this manually with <span class="in">`df.rename()`</span> (<span class="co">[</span><span class="ot">documentation</span><span class="co">](https://pandas.pydata.org/docs/reference/api/pandas.DataFrame.rename.html?highlight=rename#pandas.DataFrame.rename)</span>):</span>
<span id="cb44-250"><a href="#cb44-250" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-253"><a href="#cb44-253" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb44-254"><a href="#cb44-254" aria-hidden="true" tabindex="-1"></a>rename_dict <span class="op">=</span> {<span class="st">'2019'</span>: <span class="st">'TB cases 2019'</span>,</span>
<span id="cb44-255"><a href="#cb44-255" aria-hidden="true" tabindex="-1"></a>               <span class="st">'2020'</span>: <span class="st">'TB cases 2020'</span>,</span>
<span id="cb44-256"><a href="#cb44-256" aria-hidden="true" tabindex="-1"></a>               <span class="st">'2021'</span>: <span class="st">'TB cases 2021'</span>,</span>
<span id="cb44-257"><a href="#cb44-257" aria-hidden="true" tabindex="-1"></a>               <span class="st">'2019.1'</span>: <span class="st">'TB incidence 2019'</span>,</span>
<span id="cb44-258"><a href="#cb44-258" aria-hidden="true" tabindex="-1"></a>               <span class="st">'2020.1'</span>: <span class="st">'TB incidence 2020'</span>,</span>
<span id="cb44-259"><a href="#cb44-259" aria-hidden="true" tabindex="-1"></a>               <span class="st">'2021.1'</span>: <span class="st">'TB incidence 2021'</span>}</span>
<span id="cb44-260"><a href="#cb44-260" aria-hidden="true" tabindex="-1"></a>tb_df <span class="op">=</span> tb_df.rename(columns<span class="op">=</span>rename_dict)</span>
<span id="cb44-261"><a href="#cb44-261" aria-hidden="true" tabindex="-1"></a>tb_df.head(<span class="dv">5</span>)</span>
<span id="cb44-262"><a href="#cb44-262" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb44-263"><a href="#cb44-263" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-264"><a href="#cb44-264" aria-hidden="true" tabindex="-1"></a><span class="fu">## Record Granularity</span></span>
<span id="cb44-265"><a href="#cb44-265" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-266"><a href="#cb44-266" aria-hidden="true" tabindex="-1"></a>You might already be wondering: What's up with that first record?</span>
<span id="cb44-267"><a href="#cb44-267" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-268"><a href="#cb44-268" aria-hidden="true" tabindex="-1"></a>Row 0 is what we call a **rollup record**, or summary record. It's often useful when displaying tables to humans. The **granularity** of record 0 (Totals) vs the rest of the records (States) is different.</span>
<span id="cb44-269"><a href="#cb44-269" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-270"><a href="#cb44-270" aria-hidden="true" tabindex="-1"></a>Okay, EDA step two. How was the rollup record aggregated?</span>
<span id="cb44-271"><a href="#cb44-271" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-272"><a href="#cb44-272" aria-hidden="true" tabindex="-1"></a>Let's check if Total TB cases is the sum of all state TB cases. If we sum over all rows, we should get **2x** the total cases in each of our TB cases by year (why?).</span>
<span id="cb44-273"><a href="#cb44-273" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-276"><a href="#cb44-276" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb44-277"><a href="#cb44-277" aria-hidden="true" tabindex="-1"></a>tb_df.<span class="bu">sum</span>(axis<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb44-278"><a href="#cb44-278" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb44-279"><a href="#cb44-279" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-280"><a href="#cb44-280" aria-hidden="true" tabindex="-1"></a>Whoa, what's going on? Check out the column types:</span>
<span id="cb44-281"><a href="#cb44-281" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-284"><a href="#cb44-284" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb44-285"><a href="#cb44-285" aria-hidden="true" tabindex="-1"></a>tb_df.dtypes</span>
<span id="cb44-286"><a href="#cb44-286" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb44-287"><a href="#cb44-287" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-288"><a href="#cb44-288" aria-hidden="true" tabindex="-1"></a>Looks like those commas are causing all TB cases to be read as the <span class="in">`object`</span> datatype, or **storage type** (close to the Python string datatype), so pandas is concatenating strings instead of adding integers.</span>
<span id="cb44-289"><a href="#cb44-289" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-290"><a href="#cb44-290" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-291"><a href="#cb44-291" aria-hidden="true" tabindex="-1"></a>Fortunately <span class="in">`read_csv`</span> also has a <span class="in">`thousands`</span> parameter (https://pandas.pydata.org/docs/reference/api/pandas.read_csv.html):</span>
<span id="cb44-292"><a href="#cb44-292" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-295"><a href="#cb44-295" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb44-296"><a href="#cb44-296" aria-hidden="true" tabindex="-1"></a><span class="co"># improve readability: chaining method calls with outer parentheses/line breaks</span></span>
<span id="cb44-297"><a href="#cb44-297" aria-hidden="true" tabindex="-1"></a>tb_df <span class="op">=</span> (</span>
<span id="cb44-298"><a href="#cb44-298" aria-hidden="true" tabindex="-1"></a>    pd.read_csv(<span class="st">"data/cdc_tuberculosis.csv"</span>, header<span class="op">=</span><span class="dv">1</span>, thousands<span class="op">=</span><span class="st">','</span>)</span>
<span id="cb44-299"><a href="#cb44-299" aria-hidden="true" tabindex="-1"></a>    .rename(columns<span class="op">=</span>rename_dict)</span>
<span id="cb44-300"><a href="#cb44-300" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb44-301"><a href="#cb44-301" aria-hidden="true" tabindex="-1"></a>tb_df.head(<span class="dv">5</span>)</span>
<span id="cb44-302"><a href="#cb44-302" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb44-303"><a href="#cb44-303" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-306"><a href="#cb44-306" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb44-307"><a href="#cb44-307" aria-hidden="true" tabindex="-1"></a>tb_df.<span class="bu">sum</span>()</span>
<span id="cb44-308"><a href="#cb44-308" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb44-309"><a href="#cb44-309" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-310"><a href="#cb44-310" aria-hidden="true" tabindex="-1"></a>The Total TB cases look right. Phew!</span>
<span id="cb44-311"><a href="#cb44-311" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-312"><a href="#cb44-312" aria-hidden="true" tabindex="-1"></a>Let's just look at the records with **state-level granularity**:</span>
<span id="cb44-313"><a href="#cb44-313" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-316"><a href="#cb44-316" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb44-317"><a href="#cb44-317" aria-hidden="true" tabindex="-1"></a>state_tb_df <span class="op">=</span> tb_df[<span class="dv">1</span>:]</span>
<span id="cb44-318"><a href="#cb44-318" aria-hidden="true" tabindex="-1"></a>state_tb_df.head(<span class="dv">5</span>)</span>
<span id="cb44-319"><a href="#cb44-319" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb44-320"><a href="#cb44-320" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-321"><a href="#cb44-321" aria-hidden="true" tabindex="-1"></a><span class="fu">## Gather More Data: Census</span></span>
<span id="cb44-322"><a href="#cb44-322" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-323"><a href="#cb44-323" aria-hidden="true" tabindex="-1"></a>U.S. Census population estimates <span class="co">[</span><span class="ot">source</span><span class="co">](https://www.census.gov/data/tables/time-series/demo/popest/2010s-state-total.html)</span> (2019), <span class="co">[</span><span class="ot">source</span><span class="co">](https://www.census.gov/data/tables/time-series/demo/popest/2020s-state-total.html)</span> (2020-2021).</span>
<span id="cb44-324"><a href="#cb44-324" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-325"><a href="#cb44-325" aria-hidden="true" tabindex="-1"></a>Running the below cells cleans the data.</span>
<span id="cb44-326"><a href="#cb44-326" aria-hidden="true" tabindex="-1"></a>There are a few new methods here:</span>
<span id="cb44-327"><a href="#cb44-327" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span><span class="in">`df.convert_dtypes()`</span> (<span class="co">[</span><span class="ot">documentation</span><span class="co">](https://pandas.pydata.org/docs/reference/api/pandas.DataFrame.convert_dtypes.html)</span>) conveniently converts all float dtypes into ints and is out of scope for the class.</span>
<span id="cb44-328"><a href="#cb44-328" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span><span class="in">`df.drop_na()`</span> (<span class="co">[</span><span class="ot">documentation</span><span class="co">](https://pandas.pydata.org/docs/reference/api/pandas.DataFrame.dropna.html)</span>) will be explained in more detail next time.</span>
<span id="cb44-329"><a href="#cb44-329" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-332"><a href="#cb44-332" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb44-333"><a href="#cb44-333" aria-hidden="true" tabindex="-1"></a><span class="co"># 2010s census data</span></span>
<span id="cb44-334"><a href="#cb44-334" aria-hidden="true" tabindex="-1"></a>census_2010s_df <span class="op">=</span> pd.read_csv(<span class="st">"data/nst-est2019-01.csv"</span>, header<span class="op">=</span><span class="dv">3</span>, thousands<span class="op">=</span><span class="st">","</span>)</span>
<span id="cb44-335"><a href="#cb44-335" aria-hidden="true" tabindex="-1"></a>census_2010s_df <span class="op">=</span> (</span>
<span id="cb44-336"><a href="#cb44-336" aria-hidden="true" tabindex="-1"></a>    census_2010s_df</span>
<span id="cb44-337"><a href="#cb44-337" aria-hidden="true" tabindex="-1"></a>    .reset_index()</span>
<span id="cb44-338"><a href="#cb44-338" aria-hidden="true" tabindex="-1"></a>    .drop(columns<span class="op">=</span>[<span class="st">"index"</span>, <span class="st">"Census"</span>, <span class="st">"Estimates Base"</span>])</span>
<span id="cb44-339"><a href="#cb44-339" aria-hidden="true" tabindex="-1"></a>    .rename(columns<span class="op">=</span>{<span class="st">"Unnamed: 0"</span>: <span class="st">"Geographic Area"</span>})</span>
<span id="cb44-340"><a href="#cb44-340" aria-hidden="true" tabindex="-1"></a>    .convert_dtypes()                 <span class="co"># "smart" converting of columns, use at your own risk</span></span>
<span id="cb44-341"><a href="#cb44-341" aria-hidden="true" tabindex="-1"></a>    .dropna()                         <span class="co"># we'll introduce this next time</span></span>
<span id="cb44-342"><a href="#cb44-342" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb44-343"><a href="#cb44-343" aria-hidden="true" tabindex="-1"></a>census_2010s_df[<span class="st">'Geographic Area'</span>] <span class="op">=</span> census_2010s_df[<span class="st">'Geographic Area'</span>].<span class="bu">str</span>.strip(<span class="st">'.'</span>)</span>
<span id="cb44-344"><a href="#cb44-344" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-345"><a href="#cb44-345" aria-hidden="true" tabindex="-1"></a><span class="co"># with pd.option_context('display.min_rows', 30): # shows more rows</span></span>
<span id="cb44-346"><a href="#cb44-346" aria-hidden="true" tabindex="-1"></a><span class="co">#     display(census_2010s_df)</span></span>
<span id="cb44-347"><a href="#cb44-347" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb44-348"><a href="#cb44-348" aria-hidden="true" tabindex="-1"></a>census_2010s_df.head(<span class="dv">5</span>)</span>
<span id="cb44-349"><a href="#cb44-349" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb44-350"><a href="#cb44-350" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-351"><a href="#cb44-351" aria-hidden="true" tabindex="-1"></a>Occasionally, you will want to modify code that you have imported.  To reimport those modifications you can either use the python importlib library:</span>
<span id="cb44-352"><a href="#cb44-352" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-353"><a href="#cb44-353" aria-hidden="true" tabindex="-1"></a><span class="in">```python</span></span>
<span id="cb44-354"><a href="#cb44-354" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> importlib <span class="im">import</span> <span class="bu">reload</span></span>
<span id="cb44-355"><a href="#cb44-355" aria-hidden="true" tabindex="-1"></a><span class="bu">reload</span>(utils)</span>
<span id="cb44-356"><a href="#cb44-356" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb44-357"><a href="#cb44-357" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-358"><a href="#cb44-358" aria-hidden="true" tabindex="-1"></a>or use iPython magic which will intelligently import code when files change:</span>
<span id="cb44-359"><a href="#cb44-359" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-360"><a href="#cb44-360" aria-hidden="true" tabindex="-1"></a><span class="in">```python</span></span>
<span id="cb44-361"><a href="#cb44-361" aria-hidden="true" tabindex="-1"></a><span class="op">%</span>load_ext autoreload</span>
<span id="cb44-362"><a href="#cb44-362" aria-hidden="true" tabindex="-1"></a><span class="op">%</span>autoreload <span class="dv">2</span></span>
<span id="cb44-363"><a href="#cb44-363" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb44-364"><a href="#cb44-364" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-367"><a href="#cb44-367" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb44-368"><a href="#cb44-368" aria-hidden="true" tabindex="-1"></a><span class="co"># census 2020s data</span></span>
<span id="cb44-369"><a href="#cb44-369" aria-hidden="true" tabindex="-1"></a>census_2020s_df <span class="op">=</span> pd.read_csv(<span class="st">"data/NST-EST2022-POP.csv"</span>, header<span class="op">=</span><span class="dv">3</span>, thousands<span class="op">=</span><span class="st">","</span>)</span>
<span id="cb44-370"><a href="#cb44-370" aria-hidden="true" tabindex="-1"></a>census_2020s_df <span class="op">=</span> (</span>
<span id="cb44-371"><a href="#cb44-371" aria-hidden="true" tabindex="-1"></a>    census_2020s_df</span>
<span id="cb44-372"><a href="#cb44-372" aria-hidden="true" tabindex="-1"></a>    .reset_index()</span>
<span id="cb44-373"><a href="#cb44-373" aria-hidden="true" tabindex="-1"></a>    .drop(columns<span class="op">=</span>[<span class="st">"index"</span>, <span class="st">"Unnamed: 1"</span>])</span>
<span id="cb44-374"><a href="#cb44-374" aria-hidden="true" tabindex="-1"></a>    .rename(columns<span class="op">=</span>{<span class="st">"Unnamed: 0"</span>: <span class="st">"Geographic Area"</span>})</span>
<span id="cb44-375"><a href="#cb44-375" aria-hidden="true" tabindex="-1"></a>    .convert_dtypes()                 <span class="co"># "smart" converting of columns, use at your own risk</span></span>
<span id="cb44-376"><a href="#cb44-376" aria-hidden="true" tabindex="-1"></a>    .dropna()                         <span class="co"># we'll introduce this next time</span></span>
<span id="cb44-377"><a href="#cb44-377" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb44-378"><a href="#cb44-378" aria-hidden="true" tabindex="-1"></a>census_2020s_df[<span class="st">'Geographic Area'</span>] <span class="op">=</span> census_2020s_df[<span class="st">'Geographic Area'</span>].<span class="bu">str</span>.strip(<span class="st">'.'</span>)</span>
<span id="cb44-379"><a href="#cb44-379" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-380"><a href="#cb44-380" aria-hidden="true" tabindex="-1"></a>census_2020s_df.head(<span class="dv">5</span>)</span>
<span id="cb44-381"><a href="#cb44-381" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb44-382"><a href="#cb44-382" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-383"><a href="#cb44-383" aria-hidden="true" tabindex="-1"></a><span class="fu">## Joining Data on Primary Keys</span></span>
<span id="cb44-384"><a href="#cb44-384" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-385"><a href="#cb44-385" aria-hidden="true" tabindex="-1"></a>Time to <span class="in">`merge`</span>! Here we use the DataFrame method <span class="in">`df1.merge(right=df2, ...)`</span> on DataFrame <span class="in">`df1`</span> (<span class="co">[</span><span class="ot">documentation</span><span class="co">](https://pandas.pydata.org/docs/reference/api/pandas.DataFrame.merge.html)</span>). Contrast this with the function <span class="in">`pd.merge(left=df1, right=df2, ...)`</span> (<span class="co">[</span><span class="ot">documentation</span><span class="co">](https://pandas.pydata.org/docs/reference/api/pandas.merge.html?highlight=pandas%20merge#pandas.merge)</span>). Feel free to use either.</span>
<span id="cb44-386"><a href="#cb44-386" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-389"><a href="#cb44-389" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb44-390"><a href="#cb44-390" aria-hidden="true" tabindex="-1"></a><span class="co"># merge TB dataframe with two US census dataframes</span></span>
<span id="cb44-391"><a href="#cb44-391" aria-hidden="true" tabindex="-1"></a>tb_census_df <span class="op">=</span> (</span>
<span id="cb44-392"><a href="#cb44-392" aria-hidden="true" tabindex="-1"></a>    tb_df</span>
<span id="cb44-393"><a href="#cb44-393" aria-hidden="true" tabindex="-1"></a>    .merge(right<span class="op">=</span>census_2010s_df,</span>
<span id="cb44-394"><a href="#cb44-394" aria-hidden="true" tabindex="-1"></a>           left_on<span class="op">=</span><span class="st">"U.S. jurisdiction"</span>, right_on<span class="op">=</span><span class="st">"Geographic Area"</span>)</span>
<span id="cb44-395"><a href="#cb44-395" aria-hidden="true" tabindex="-1"></a>    .merge(right<span class="op">=</span>census_2020s_df,</span>
<span id="cb44-396"><a href="#cb44-396" aria-hidden="true" tabindex="-1"></a>           left_on<span class="op">=</span><span class="st">"U.S. jurisdiction"</span>, right_on<span class="op">=</span><span class="st">"Geographic Area"</span>)</span>
<span id="cb44-397"><a href="#cb44-397" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb44-398"><a href="#cb44-398" aria-hidden="true" tabindex="-1"></a>tb_census_df.head(<span class="dv">5</span>)</span>
<span id="cb44-399"><a href="#cb44-399" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb44-400"><a href="#cb44-400" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-401"><a href="#cb44-401" aria-hidden="true" tabindex="-1"></a>This is a little unwieldy. We could either drop the unneeded columns now, or just merge on smaller census DataFrames. Let's do the latter.</span>
<span id="cb44-402"><a href="#cb44-402" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-405"><a href="#cb44-405" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb44-406"><a href="#cb44-406" aria-hidden="true" tabindex="-1"></a><span class="co"># try merging again, but cleaner this time</span></span>
<span id="cb44-407"><a href="#cb44-407" aria-hidden="true" tabindex="-1"></a>tb_census_df <span class="op">=</span> (</span>
<span id="cb44-408"><a href="#cb44-408" aria-hidden="true" tabindex="-1"></a>    tb_df</span>
<span id="cb44-409"><a href="#cb44-409" aria-hidden="true" tabindex="-1"></a>    .merge(right<span class="op">=</span>census_2010s_df[[<span class="st">"Geographic Area"</span>, <span class="st">"2019"</span>]],</span>
<span id="cb44-410"><a href="#cb44-410" aria-hidden="true" tabindex="-1"></a>           left_on<span class="op">=</span><span class="st">"U.S. jurisdiction"</span>, right_on<span class="op">=</span><span class="st">"Geographic Area"</span>)</span>
<span id="cb44-411"><a href="#cb44-411" aria-hidden="true" tabindex="-1"></a>    .drop(columns<span class="op">=</span><span class="st">"Geographic Area"</span>)</span>
<span id="cb44-412"><a href="#cb44-412" aria-hidden="true" tabindex="-1"></a>    .merge(right<span class="op">=</span>census_2020s_df[[<span class="st">"Geographic Area"</span>, <span class="st">"2020"</span>, <span class="st">"2021"</span>]],</span>
<span id="cb44-413"><a href="#cb44-413" aria-hidden="true" tabindex="-1"></a>           left_on<span class="op">=</span><span class="st">"U.S. jurisdiction"</span>, right_on<span class="op">=</span><span class="st">"Geographic Area"</span>)</span>
<span id="cb44-414"><a href="#cb44-414" aria-hidden="true" tabindex="-1"></a>    .drop(columns<span class="op">=</span><span class="st">"Geographic Area"</span>)</span>
<span id="cb44-415"><a href="#cb44-415" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb44-416"><a href="#cb44-416" aria-hidden="true" tabindex="-1"></a>tb_census_df.head(<span class="dv">5</span>)</span>
<span id="cb44-417"><a href="#cb44-417" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb44-418"><a href="#cb44-418" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-419"><a href="#cb44-419" aria-hidden="true" tabindex="-1"></a><span class="fu">## Reproducing Data: Compute Incidence</span></span>
<span id="cb44-420"><a href="#cb44-420" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-421"><a href="#cb44-421" aria-hidden="true" tabindex="-1"></a>Let's recompute incidence to make sure we know where the original CDC numbers came from.</span>
<span id="cb44-422"><a href="#cb44-422" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-423"><a href="#cb44-423" aria-hidden="true" tabindex="-1"></a>From the <span class="co">[</span><span class="ot">CDC report</span><span class="co">](https://www.cdc.gov/mmwr/volumes/71/wr/mm7112a1.htm?s_cid=mm7112a1_w#T1_down)</span>: TB incidence is computed as “Cases per 100,000 persons using mid-year population estimates from the U.S. Census Bureau.”</span>
<span id="cb44-424"><a href="#cb44-424" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-425"><a href="#cb44-425" aria-hidden="true" tabindex="-1"></a>If we define a group as 100,000 people, then we can compute the TB incidence for a given state population as</span>
<span id="cb44-426"><a href="#cb44-426" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-427"><a href="#cb44-427" aria-hidden="true" tabindex="-1"></a>$$\text{TB incidence} = \frac{\text{TB cases in population}}{\text{groups in population}} = \frac{\text{TB cases in population}}{\text{population}/100000} $$</span>
<span id="cb44-428"><a href="#cb44-428" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-429"><a href="#cb44-429" aria-hidden="true" tabindex="-1"></a>$$= \frac{\text{TB cases in population}}{\text{population}} \times 100000$$</span>
<span id="cb44-430"><a href="#cb44-430" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-431"><a href="#cb44-431" aria-hidden="true" tabindex="-1"></a>Let's try this for 2019:</span>
<span id="cb44-432"><a href="#cb44-432" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-435"><a href="#cb44-435" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb44-436"><a href="#cb44-436" aria-hidden="true" tabindex="-1"></a>tb_census_df[<span class="st">"recompute incidence 2019"</span>] <span class="op">=</span> tb_census_df[<span class="st">"TB cases 2019"</span>]<span class="op">/</span>tb_census_df[<span class="st">"2019"</span>]<span class="op">*</span><span class="dv">100000</span></span>
<span id="cb44-437"><a href="#cb44-437" aria-hidden="true" tabindex="-1"></a>tb_census_df.head(<span class="dv">5</span>)</span>
<span id="cb44-438"><a href="#cb44-438" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb44-439"><a href="#cb44-439" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-440"><a href="#cb44-440" aria-hidden="true" tabindex="-1"></a>Awesome!!!</span>
<span id="cb44-441"><a href="#cb44-441" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-442"><a href="#cb44-442" aria-hidden="true" tabindex="-1"></a>Let's use a for-loop and Python format strings to compute TB incidence for all years. Python f-strings are just used for the purposes of this demo, but they're handy to know when you explore data beyond this course (<span class="co">[</span><span class="ot">Python documentation</span><span class="co">](https://docs.python.org/3/tutorial/inputoutput.html)</span>).</span>
<span id="cb44-443"><a href="#cb44-443" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-446"><a href="#cb44-446" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb44-447"><a href="#cb44-447" aria-hidden="true" tabindex="-1"></a><span class="co"># recompute incidence for all years</span></span>
<span id="cb44-448"><a href="#cb44-448" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> year <span class="kw">in</span> [<span class="dv">2019</span>, <span class="dv">2020</span>, <span class="dv">2021</span>]:</span>
<span id="cb44-449"><a href="#cb44-449" aria-hidden="true" tabindex="-1"></a>    tb_census_df[<span class="ss">f"recompute incidence </span><span class="sc">{</span>year<span class="sc">}</span><span class="ss">"</span>] <span class="op">=</span> tb_census_df[<span class="ss">f"TB cases </span><span class="sc">{</span>year<span class="sc">}</span><span class="ss">"</span>]<span class="op">/</span>tb_census_df[<span class="ss">f"</span><span class="sc">{</span>year<span class="sc">}</span><span class="ss">"</span>]<span class="op">*</span><span class="dv">100000</span></span>
<span id="cb44-450"><a href="#cb44-450" aria-hidden="true" tabindex="-1"></a>tb_census_df.head(<span class="dv">5</span>)</span>
<span id="cb44-451"><a href="#cb44-451" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb44-452"><a href="#cb44-452" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-453"><a href="#cb44-453" aria-hidden="true" tabindex="-1"></a>These numbers look pretty close!!! There are a few errors in the hundredths place, particularly in 2021. It may be useful to further explore reasons behind this discrepancy. </span>
<span id="cb44-454"><a href="#cb44-454" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-457"><a href="#cb44-457" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb44-458"><a href="#cb44-458" aria-hidden="true" tabindex="-1"></a>tb_census_df.describe()</span>
<span id="cb44-459"><a href="#cb44-459" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb44-460"><a href="#cb44-460" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-461"><a href="#cb44-461" aria-hidden="true" tabindex="-1"></a><span class="fu">## Bonus EDA: Reproducing the reported statistic</span></span>
<span id="cb44-462"><a href="#cb44-462" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-463"><a href="#cb44-463" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-464"><a href="#cb44-464" aria-hidden="true" tabindex="-1"></a>**How do we reproduce that reported statistic in the original [CDC report](https://www.cdc.gov/mmwr/volumes/71/wr/mm7112a1.htm?s_cid=mm7112a1_w)?**</span>
<span id="cb44-465"><a href="#cb44-465" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-466"><a href="#cb44-466" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; Reported TB incidence (cases per 100,000 persons) increased **9.4%**, from **2.2** during 2020 to **2.4** during 2021 but was lower than incidence during 2019 (2.7). Increases occurred among both U.S.-born and non–U.S.-born persons.</span></span>
<span id="cb44-467"><a href="#cb44-467" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-468"><a href="#cb44-468" aria-hidden="true" tabindex="-1"></a>This is TB incidence computed across the entire U.S. population! How do we reproduce this</span>
<span id="cb44-469"><a href="#cb44-469" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>We need to reproduce the "Total" TB incidences in our rolled record.</span>
<span id="cb44-470"><a href="#cb44-470" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>But our current <span class="in">`tb_census_df`</span> only has 51 entries (50 states plus Washington, D.C.). There is no rolled record.</span>
<span id="cb44-471"><a href="#cb44-471" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>What happened...?</span>
<span id="cb44-472"><a href="#cb44-472" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-473"><a href="#cb44-473" aria-hidden="true" tabindex="-1"></a>Let's get exploring!</span>
<span id="cb44-474"><a href="#cb44-474" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-475"><a href="#cb44-475" aria-hidden="true" tabindex="-1"></a>Before we keep exploring, we'll set all indexes to more meaningful values, instead of just numbers that pertained to some row at some point. This will make our cleaning slightly easier.</span>
<span id="cb44-476"><a href="#cb44-476" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-479"><a href="#cb44-479" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb44-480"><a href="#cb44-480" aria-hidden="true" tabindex="-1"></a>tb_df <span class="op">=</span> tb_df.set_index(<span class="st">"U.S. jurisdiction"</span>)</span>
<span id="cb44-481"><a href="#cb44-481" aria-hidden="true" tabindex="-1"></a>tb_df.head(<span class="dv">5</span>)</span>
<span id="cb44-482"><a href="#cb44-482" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb44-483"><a href="#cb44-483" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-486"><a href="#cb44-486" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb44-487"><a href="#cb44-487" aria-hidden="true" tabindex="-1"></a>census_2010s_df <span class="op">=</span> census_2010s_df.set_index(<span class="st">"Geographic Area"</span>)</span>
<span id="cb44-488"><a href="#cb44-488" aria-hidden="true" tabindex="-1"></a>census_2010s_df.head(<span class="dv">5</span>)</span>
<span id="cb44-489"><a href="#cb44-489" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb44-490"><a href="#cb44-490" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-493"><a href="#cb44-493" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb44-494"><a href="#cb44-494" aria-hidden="true" tabindex="-1"></a>census_2020s_df <span class="op">=</span> census_2020s_df.set_index(<span class="st">"Geographic Area"</span>)</span>
<span id="cb44-495"><a href="#cb44-495" aria-hidden="true" tabindex="-1"></a>census_2020s_df.head(<span class="dv">5</span>)</span>
<span id="cb44-496"><a href="#cb44-496" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb44-497"><a href="#cb44-497" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-498"><a href="#cb44-498" aria-hidden="true" tabindex="-1"></a>It turns out that our merge above only kept state records, even though our original <span class="in">`tb_df`</span> had the "Total" rolled record:</span>
<span id="cb44-499"><a href="#cb44-499" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-502"><a href="#cb44-502" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb44-503"><a href="#cb44-503" aria-hidden="true" tabindex="-1"></a>tb_df.head()</span>
<span id="cb44-504"><a href="#cb44-504" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb44-505"><a href="#cb44-505" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-506"><a href="#cb44-506" aria-hidden="true" tabindex="-1"></a>Recall that merge by default does an **inner** merge by default, meaning that it only preserves keys that are present in **both** DataFrames.</span>
<span id="cb44-507"><a href="#cb44-507" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-508"><a href="#cb44-508" aria-hidden="true" tabindex="-1"></a>The rolled records in our census dataframes have different <span class="in">`Geographic Area`</span> fields, which was the key we merged on:</span>
<span id="cb44-509"><a href="#cb44-509" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-512"><a href="#cb44-512" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb44-513"><a href="#cb44-513" aria-hidden="true" tabindex="-1"></a>census_2010s_df.head(<span class="dv">5</span>)</span>
<span id="cb44-514"><a href="#cb44-514" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb44-515"><a href="#cb44-515" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-516"><a href="#cb44-516" aria-hidden="true" tabindex="-1"></a>The Census DataFrame has several rolled records. The aggregate record we are looking for actually has the Geographic Area named "United States".</span>
<span id="cb44-517"><a href="#cb44-517" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-518"><a href="#cb44-518" aria-hidden="true" tabindex="-1"></a>One straightforward way to get the right merge is to rename the value itself. Because we now have the Geographic Area index, we'll use <span class="in">`df.rename()`</span> (<span class="co">[</span><span class="ot">documentation</span><span class="co">](https://pandas.pydata.org/docs/reference/api/pandas.DataFrame.rename.html)</span>):</span>
<span id="cb44-519"><a href="#cb44-519" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-522"><a href="#cb44-522" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb44-523"><a href="#cb44-523" aria-hidden="true" tabindex="-1"></a><span class="co"># rename rolled record for 2010s</span></span>
<span id="cb44-524"><a href="#cb44-524" aria-hidden="true" tabindex="-1"></a>census_2010s_df.rename(index<span class="op">=</span>{<span class="st">'United States'</span>:<span class="st">'Total'</span>}, inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb44-525"><a href="#cb44-525" aria-hidden="true" tabindex="-1"></a>census_2010s_df.head(<span class="dv">5</span>)</span>
<span id="cb44-526"><a href="#cb44-526" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb44-527"><a href="#cb44-527" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-530"><a href="#cb44-530" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb44-531"><a href="#cb44-531" aria-hidden="true" tabindex="-1"></a><span class="co"># same, but for 2020s rename rolled record</span></span>
<span id="cb44-532"><a href="#cb44-532" aria-hidden="true" tabindex="-1"></a>census_2020s_df.rename(index<span class="op">=</span>{<span class="st">'United States'</span>:<span class="st">'Total'</span>}, inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb44-533"><a href="#cb44-533" aria-hidden="true" tabindex="-1"></a>census_2020s_df.head(<span class="dv">5</span>)</span>
<span id="cb44-534"><a href="#cb44-534" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb44-535"><a href="#cb44-535" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-536"><a href="#cb44-536" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;br/&gt;</span></span>
<span id="cb44-537"><a href="#cb44-537" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-538"><a href="#cb44-538" aria-hidden="true" tabindex="-1"></a>Next let's rerun our merge. Note the different chaining, because we are now merging on indexes (<span class="in">`df.merge()`</span> <span class="co">[</span><span class="ot">documentation</span><span class="co">](https://pandas.pydata.org/docs/reference/api/pandas.DataFrame.merge.html)</span>).</span>
<span id="cb44-539"><a href="#cb44-539" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-542"><a href="#cb44-542" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb44-543"><a href="#cb44-543" aria-hidden="true" tabindex="-1"></a>tb_census_df <span class="op">=</span> (</span>
<span id="cb44-544"><a href="#cb44-544" aria-hidden="true" tabindex="-1"></a>    tb_df</span>
<span id="cb44-545"><a href="#cb44-545" aria-hidden="true" tabindex="-1"></a>    .merge(right<span class="op">=</span>census_2010s_df[[<span class="st">"2019"</span>]],</span>
<span id="cb44-546"><a href="#cb44-546" aria-hidden="true" tabindex="-1"></a>           left_index<span class="op">=</span><span class="va">True</span>, right_index<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb44-547"><a href="#cb44-547" aria-hidden="true" tabindex="-1"></a>    .merge(right<span class="op">=</span>census_2020s_df[[<span class="st">"2020"</span>, <span class="st">"2021"</span>]],</span>
<span id="cb44-548"><a href="#cb44-548" aria-hidden="true" tabindex="-1"></a>           left_index<span class="op">=</span><span class="va">True</span>, right_index<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb44-549"><a href="#cb44-549" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb44-550"><a href="#cb44-550" aria-hidden="true" tabindex="-1"></a>tb_census_df.head(<span class="dv">5</span>)</span>
<span id="cb44-551"><a href="#cb44-551" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb44-552"><a href="#cb44-552" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-553"><a href="#cb44-553" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;br/&gt;</span></span>
<span id="cb44-554"><a href="#cb44-554" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-555"><a href="#cb44-555" aria-hidden="true" tabindex="-1"></a>Finally, let's recompute our incidences:</span>
<span id="cb44-556"><a href="#cb44-556" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-559"><a href="#cb44-559" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb44-560"><a href="#cb44-560" aria-hidden="true" tabindex="-1"></a><span class="co"># recompute incidence for all years</span></span>
<span id="cb44-561"><a href="#cb44-561" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> year <span class="kw">in</span> [<span class="dv">2019</span>, <span class="dv">2020</span>, <span class="dv">2021</span>]:</span>
<span id="cb44-562"><a href="#cb44-562" aria-hidden="true" tabindex="-1"></a>    tb_census_df[<span class="ss">f"recompute incidence </span><span class="sc">{</span>year<span class="sc">}</span><span class="ss">"</span>] <span class="op">=</span> tb_census_df[<span class="ss">f"TB cases </span><span class="sc">{</span>year<span class="sc">}</span><span class="ss">"</span>]<span class="op">/</span>tb_census_df[<span class="ss">f"</span><span class="sc">{</span>year<span class="sc">}</span><span class="ss">"</span>]<span class="op">*</span><span class="dv">100000</span></span>
<span id="cb44-563"><a href="#cb44-563" aria-hidden="true" tabindex="-1"></a>tb_census_df.head(<span class="dv">5</span>)</span>
<span id="cb44-564"><a href="#cb44-564" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb44-565"><a href="#cb44-565" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-566"><a href="#cb44-566" aria-hidden="true" tabindex="-1"></a>We reproduced the total U.S. incidences correctly!</span>
<span id="cb44-567"><a href="#cb44-567" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-568"><a href="#cb44-568" aria-hidden="true" tabindex="-1"></a>We're almost there. Let's revisit the quote:</span>
<span id="cb44-569"><a href="#cb44-569" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-570"><a href="#cb44-570" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; Reported TB incidence (cases per 100,000 persons) increased **9.4%**, from **2.2** during 2020 to **2.4** during 2021 but was lower than incidence during 2019 (2.7). Increases occurred among both U.S.-born and non–U.S.-born persons.</span></span>
<span id="cb44-571"><a href="#cb44-571" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-572"><a href="#cb44-572" aria-hidden="true" tabindex="-1"></a>Recall that percent change from $A$ to $B$ is computed as</span>
<span id="cb44-573"><a href="#cb44-573" aria-hidden="true" tabindex="-1"></a>$\text{percent change} = \frac{B - A}{A} \times 100$.</span>
<span id="cb44-574"><a href="#cb44-574" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-577"><a href="#cb44-577" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb44-578"><a href="#cb44-578" aria-hidden="true" tabindex="-1"></a><span class="co">#| tags: []</span></span>
<span id="cb44-579"><a href="#cb44-579" aria-hidden="true" tabindex="-1"></a>incidence_2020 <span class="op">=</span> tb_census_df.loc[<span class="st">'Total'</span>, <span class="st">'recompute incidence 2020'</span>]</span>
<span id="cb44-580"><a href="#cb44-580" aria-hidden="true" tabindex="-1"></a>incidence_2020</span>
<span id="cb44-581"><a href="#cb44-581" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb44-582"><a href="#cb44-582" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-585"><a href="#cb44-585" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb44-586"><a href="#cb44-586" aria-hidden="true" tabindex="-1"></a><span class="co">#| tags: []</span></span>
<span id="cb44-587"><a href="#cb44-587" aria-hidden="true" tabindex="-1"></a>incidence_2021 <span class="op">=</span> tb_census_df.loc[<span class="st">'Total'</span>, <span class="st">'recompute incidence 2021'</span>]</span>
<span id="cb44-588"><a href="#cb44-588" aria-hidden="true" tabindex="-1"></a>incidence_2021</span>
<span id="cb44-589"><a href="#cb44-589" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb44-590"><a href="#cb44-590" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-593"><a href="#cb44-593" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb44-594"><a href="#cb44-594" aria-hidden="true" tabindex="-1"></a><span class="co">#| tags: []</span></span>
<span id="cb44-595"><a href="#cb44-595" aria-hidden="true" tabindex="-1"></a>difference <span class="op">=</span> (incidence_2021 <span class="op">-</span> incidence_2020)<span class="op">/</span>incidence_2020 <span class="op">*</span> <span class="dv">100</span></span>
<span id="cb44-596"><a href="#cb44-596" aria-hidden="true" tabindex="-1"></a>difference</span>
<span id="cb44-597"><a href="#cb44-597" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
</code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->



</body></html>
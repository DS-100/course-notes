<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.2.313">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Case Study in Human Contexts and Ethics</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
</style>


<script src="case_study_HCE_files/libs/clipboard/clipboard.min.js"></script>
<script src="case_study_HCE_files/libs/quarto-html/quarto.js"></script>
<script src="case_study_HCE_files/libs/quarto-html/popper.min.js"></script>
<script src="case_study_HCE_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="case_study_HCE_files/libs/quarto-html/anchor.min.js"></script>
<link href="case_study_HCE_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="case_study_HCE_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="case_study_HCE_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="case_study_HCE_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="case_study_HCE_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">


</head>

<body>

<div id="quarto-content" class="page-columns page-rows-contents page-layout-full">
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
  <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Case Study in Human Contexts and Ethics</h2>
   
  <ul>
  <li><a href="#the-problem" id="toc-the-problem" class="nav-link active" data-scroll-target="#the-problem">The Problem</a>
  <ul class="collapse">
  <li><a href="#spotlight-appeals" id="toc-spotlight-appeals" class="nav-link" data-scroll-target="#spotlight-appeals">Spotlight: Appeals</a></li>
  <li><a href="#human-impacts" id="toc-human-impacts" class="nav-link" data-scroll-target="#human-impacts">Human Impacts</a></li>
  <li><a href="#spotlight-intersection-of-real-estate-and-race" id="toc-spotlight-intersection-of-real-estate-and-race" class="nav-link" data-scroll-target="#spotlight-intersection-of-real-estate-and-race">Spotlight: Intersection of Real Estate and Race</a></li>
  </ul></li>
  <li><a href="#the-response-cook-county-open-data-initiative" id="toc-the-response-cook-county-open-data-initiative" class="nav-link" data-scroll-target="#the-response-cook-county-open-data-initiative">The Response: Cook County Open Data Initiative</a>
  <ul class="collapse">
  <li><a href="#questionproblem-formulation" id="toc-questionproblem-formulation" class="nav-link" data-scroll-target="#questionproblem-formulation">Question/Problem Formulation</a></li>
  <li><a href="#data-acquisition-and-cleaning" id="toc-data-acquisition-and-cleaning" class="nav-link" data-scroll-target="#data-acquisition-and-cleaning">Data Acquisition and Cleaning</a></li>
  <li><a href="#exploratory-data-analysis" id="toc-exploratory-data-analysis" class="nav-link" data-scroll-target="#exploratory-data-analysis">Exploratory Data Analysis</a></li>
  <li><a href="#prediction-and-inference" id="toc-prediction-and-inference" class="nav-link" data-scroll-target="#prediction-and-inference">Prediction and Inference</a></li>
  <li><a href="#reports-decisions-and-conclusions" id="toc-reports-decisions-and-conclusions" class="nav-link" data-scroll-target="#reports-decisions-and-conclusions">Reports Decisions, and Conclusions</a></li>
  </ul></li>
  <li><a href="#key-takeaways" id="toc-key-takeaways" class="nav-link" data-scroll-target="#key-takeaways">Key Takeaways</a></li>
  <li><a href="#lessons-for-data-science-practice" id="toc-lessons-for-data-science-practice" class="nav-link" data-scroll-target="#lessons-for-data-science-practice">Lessons for Data Science Practice</a></li>
  </ul>
</nav>
</div>
<main class="content column-page-left" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Case Study in Human Contexts and Ethics</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<div class="callout-note callout callout-style-default no-icon callout-captioned">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-1-contents" aria-controls="callout-1" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Learning Outcomes
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-1" class="callout-1-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<ul>
<li>Learn about the ethical dilemmas that data scientists face.</li>
<li>Know how critique models using contextual knowledge about data.</li>
</ul>
</div>
</div>
</div>
<div class="callout-DISCLAIMER callout callout-style-default no-icon callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
DISCLAIMER
</div>
</div>
<div class="callout-body-container callout-body">
<p>The following chapter discusses issues of structural racism. Some of the items in the chapter may be sensitive and may or may not be the opinions, ideas, and beliefs of students who collected the materials. The Data 100 course staff tries its best to only present information that is relevant for teaching the lessons at hand.</p>
</div>
</div>
<p>Let’s immerse ourselves in the real world story of data scientists working for an organization called the Cook County Assessor’s Office (CCAO). Their job is to <strong>estimate the values of houses</strong> in order to <strong>assign property taxes</strong>. This is because tax burden in this area is determined by the estimated <strong>value</strong> of a house, which is different from its price. Since values change over time and there is no obvious indicators of value, they created a <strong>model</strong> to estimate the values of houses. In this chapter, we will dig deep into what problems that biased the models, the consequences to human lives, and how we can learn from this example to do better.</p>
<section id="the-problem" class="level2">
<h2 class="anchored" data-anchor-id="the-problem">The Problem</h2>
<p>In a <a href="https://apps.chicagotribune.com/news/watchdog/cook-county-property-tax-divide/assessments.html">report</a> by the Chicago Tribune uncovered a major scandal. The team showed that the model perpetuated a highly regressive tax system which disproportionately burdened African American and Latinx homeowners in Cook County. How did they know?</p>
<p><a href="https://apps.chicagotribune.com/news/watchdog/cook-county-property-tax-divide/assessments.html"> <img src="images/vis_1.png"></a></p>
<p>In the field of housing assessment, there are standard metrics that assessors use across the world to estimate the fairness of assessments: <a href="https://www.realestateagent.com/real-estate-glossary/real-estate/coefficient-of-dispersion.html">coefficient of dispersion</a> and <a href="https://leg.wa.gov/House/Committees/FIN/Documents/2009/RatioText.pdf">price-related differential</a>. These metrics have been rigorously tested by experts in the field, and are out of scope for our class. Calculating these metrics for the Cook County prices and found that the pricing created by the CCAO did not fall in acceptable ranges (See figure above). This by itself is <strong>not the end</strong> of the story, but a good indicator that <strong>something fishy was going on</strong>.</p>
<p><a href="https://apps.chicagotribune.com/news/watchdog/cook-county-property-tax-divide/assessments.html"> <img src="images/vis_2.png" width="300"></a></p>
<p>This then prompted them to investigate if the model itself was producing fair tax rates. Evidently, when accounting for the home owner’s income they found that the model actually produced a <strong>regressive</strong> tax rate (See figure above).</p>
<div class="callout-Definition callout callout-style-default no-icon callout-captioned">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-3-contents" aria-controls="callout-3" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Definition
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-3" class="callout-3-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>Regressive (tax): A tax rate is regressive if the percentage tax rate is higher for individuals with lower net income.</p>
<p>Progressive (tax): A tax rate is progressive if the percentage tax rate is higher for individuals with higher net income.</p>
</div>
</div>
</div>
<p><a href="https://www.clccrul.org/bpnc-v-berrios-facts?rq=berrios"> <img src="images/vis_3.jpg" width="600"> </a></p>
<p>Digging further shows that not only was the system unfair to people across the axis of income, it was also unfair across the axis of race(See figure above). The likelihood that your home was under or over assessed was highly dependent on your race did not sit will with many home owners.</p>
<section id="spotlight-appeals" class="level3">
<h3 class="anchored" data-anchor-id="spotlight-appeals">Spotlight: Appeals</h3>
<p>What actually caused this to come about? The whole answer is a lot bigger than just models. At the end of the day, these are real systems that have a lot of moving parts. One of those moving parts was the <strong>appeals system</strong>. Homeowners are mailed the value their home is assess for by CCAO, and the homeowner can choose to appeal to a board of elected officials to try and change the listed value of their home, and thus how much they are taxed. In theory, this sounds like a very fair system: there is a human that oversees the final pricing of houses rather than just an algorithm. However, it ended up exacerbating the problems.</p>
<p>“Appeals are a good thing,” Thomas Jaconetty, deputy assessor for valuation and appeals, said in an interview. “The goal here is fairness. We made the numbers. We can change them.”</p>
<p><a href="https://apps.chicagotribune.com/news/watchdog/cook-county-property-tax-divide/appeals.html"> <img src="images/vis_4.png"> </a></p>
<p>Here we can borrow lessons from <a href="https://www.britannica.com/topic/critical-race-theory">Critical Race Theory</a>. On the surface, everyone having the legal right to try and appeal is undeniable. However, not everyone has an equal ability to. Those who have the money to hire tax lawyers to appeal for them have a drastically higher chance trying and succeeding (See above figure). This model is part of a deeper institutional pattern rife with potential corruption.</p>
<p><a href="https://apps.chicagotribune.com/news/watchdog/cook-county-property-tax-divide/appeals.html"> <img src="images/vis_5.png"> </a></p>
<p>Homeowners who appealed were generally underassessed relative to other homeowners (See above figure). Those with higher incomes pay less in property tax, tax lawyers are able to grow their business due to their role in appeals, and politicians are commonly socially connected to the aforementioned tax lawyers and wealthy homeowners. All these stakeholders have reasons to advertise the model as a integral part of a fair system. Here lies the value in asking questions. A system that seems fair on the surface may in actuality be unfair upon taking a closer look.</p>
</section>
<section id="human-impacts" class="level3">
<h3 class="anchored" data-anchor-id="human-impacts">Human Impacts</h3>
<p><a href="https://apps.chicagotribune.com/news/watchdog/cook-county-property-tax-divide/assessments.html"> <img src="images/vis_6.png"> </a></p>
<p>The impact of the housing model extends beyond the realm of home ownership and taxation. Discriminatory practices have a long history within the United States, and the model served to perpetuate this fact. To this day, Chicago is one of the most segregated cities in the United States (<a href="https://fivethirtyeight.com/features/the-most-diverse-cities-are-often-the-most-segregated/">source</a>). These factors are central to informing us, as data scientists, about what is at stake.</p>
</section>
<section id="spotlight-intersection-of-real-estate-and-race" class="level3">
<h3 class="anchored" data-anchor-id="spotlight-intersection-of-real-estate-and-race">Spotlight: Intersection of Real Estate and Race</h3>
<p>Housing has been a persistent source of racial inequality throughout US History, amongst other factors. It is one of the main areas where inequalities are created and reproduced. In the beginning, <a href="https://www.history.com/topics/early-20th-century-us/jim-crow-laws">Jim Crow</a> laws were explicit in forbidding Persons of Color from Schools, public utilities, etc.</p>
<p><a href="https://dsl.richmond.edu/panorama/redlining/#loc=11/41.84/-87.674"><img src="images/vis_7.png"></a></p>
<p>Today, while advancements in Civil Rights have been made, the spirit of the laws are alive in many parts of the US. The real estate industry was “professionalized” in the 1920’s and 1930’s by aspiring to become a science guided by strict methods and principles:</p>
<ul>
<li>Redlining: making it difficult or impossible to get a federally-backed mortgage to buy a house in specific neighborhoods coded as “risky” (red).
<ul>
<li>What made them “risky” according to the makers of these was racial composition.</li>
<li>Segregation was not only a result of federal policy, but developed by real estate professionals.</li>
</ul></li>
<li>The methods centered on creating objective rating systems (information technologies) for the appraisal of property values which encoded <strong>race</strong> as a factor of valuation (See figure below)
<ul>
<li>This, in turn, influenced federal policy and practice</li>
</ul></li>
</ul>
<p><img src="images/vis_8.png"></p>
<p>Source: Colin Koopman, How We Became Our Data (2019) p.&nbsp;137</p>
</section>
</section>
<section id="the-response-cook-county-open-data-initiative" class="level2">
<h2 class="anchored" data-anchor-id="the-response-cook-county-open-data-initiative">The Response: Cook County Open Data Initiative</h2>
<p>The response started in politics. A new assessor, Fritz Kaegi, was elected and created a new mandate with two goals:</p>
<ul>
<li>Distributional equity in property taxation = properties of same value treated alike during assessments</li>
<li>Creates new Office of Data Science</li>
</ul>
<p><img src="images/vis_9.png"></p>
<section id="questionproblem-formulation" class="level3">
<h3 class="anchored" data-anchor-id="questionproblem-formulation">Question/Problem Formulation</h3>
<ul>
<li>What do we want to know?</li>
<li>What problems are we trying to solve?</li>
<li>What are the hypotheses we want to test?</li>
<li>What are our metrics for success?</li>
</ul>
<p>The new Office of Data Science started by redefining their goals.</p>
<ol type="1">
<li><p>Accurately, uniformly, and impartially assess the value of a home.</p>
<ul>
<li>Following international standards (coefficient of dispersion)</li>
<li>Predicting value of all homes with as little total error as possible.</li>
</ul></li>
<li><p>Create a system that assesses house values that is fair to all people, across perceived racial and income differences.</p>
<ul>
<li>Disrupts the circuit of corruption (Board of Review appeals process)</li>
<li>Eliminates regressivity</li>
<li>Engenders trust in the system among all stakeholders</li>
</ul></li>
</ol>
<div class="callout-definitions callout callout-style-default no-icon callout-captioned">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-4-contents" aria-controls="callout-4" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Definitions
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-4" class="callout-4-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p><strong>Definitions</strong>: Fairness and Transparency</p>
<p>Fairness: The ability of our pipeline to accurately assess property values, accounting for disparities in geography, information, etc.</p>
<p>Transparency: The ability of the data science department to share and explain pipeline results and decisions to both internal and external stakeholders</p>
</div>
</div>
</div>
</section>
<section id="data-acquisition-and-cleaning" class="level3">
<h3 class="anchored" data-anchor-id="data-acquisition-and-cleaning">Data Acquisition and Cleaning</h3>
<ul>
<li>What data do we have and what data do we need?</li>
<li>How will we sample more data?</li>
<li>Is our data representative of the population we want to study?</li>
</ul>
<p>Example: Sales data</p>
<p><img src="images/vis_10.png"></p>
<p>They also critically examined their original sales data:</p>
<ol type="1">
<li>How was this data collected?</li>
<li>When was this data collected?</li>
<li>Who collected this data?</li>
<li>For what purposes was the data collected?</li>
<li>How and why were particular categories created?</li>
</ol>
<p>For example, attributes can affect likelihood of appearing in the data. For example, housing data in the floodplains geographic region of Chicago were less represented than other regions.</p>
<p>The features can even be reported at different rates. Improvements in homes, which tend to increase property value, were unlikely to be reported by the homeowners.</p>
<p>Additionally, they found that there was simply more missing data in lower income neighborhoods.</p>
</section>
<section id="exploratory-data-analysis" class="level3">
<h3 class="anchored" data-anchor-id="exploratory-data-analysis">Exploratory Data Analysis</h3>
<ul>
<li>How is our data organized and what does it contain?</li>
<li>Do we already have relevant data?</li>
<li>What are the biases, anomalies, or other issues with the data?</li>
<li>How do we transform the data to enable effective analysis?</li>
</ul>
<p>Before the modeling step, they investigated a multitude of crucial questions:</p>
<ol type="1">
<li>Which attributes are most predictive of sales price?</li>
<li>Is the data uniformly distributed?</li>
<li>Do all neighborhoods have up to date data? Do all neighborhoods have the same granularity?<br>
</li>
<li>Do some neighborhoods have missing or outdated data?</li>
</ol>
<p>Firstly, they found that the impact of certain features, such as bedroom number, were much more impactful in determining house value inside certain neighborhoods more than others. This informed them that different models should be used depending on the neighborhood.</p>
<p>They also noticed that low income neighborhoods had disproportionately spottier data. This informed them that they needed to develop new data collection practices–including finding new sources of data.</p>
</section>
<section id="prediction-and-inference" class="level3">
<h3 class="anchored" data-anchor-id="prediction-and-inference">Prediction and Inference</h3>
<ul>
<li>What does the data say about the world?</li>
<li>Does it answer our questions or accurately solve the problem?</li>
<li>How robust are our conclusions and can we trust the predictions?</li>
</ul>
<p>Rather than using a singular model to predict sale prices (“fair market value”) of unsold properties, the CCAO fit machine learning models that discover patterns using known sale prices and characteristics of <strong>similar and nearby properties</strong>. It uses different model weights for each township.</p>
<p>Compared to traditional mass appraisal, the CCAO’s new approach is more granular and more sensitive to neighborhood variations.</p>
</section>
<section id="reports-decisions-and-conclusions" class="level3">
<h3 class="anchored" data-anchor-id="reports-decisions-and-conclusions">Reports Decisions, and Conclusions</h3>
<ul>
<li>How successful is the system for each goal?
<ul>
<li>accuracy/uniformity of the model.</li>
<li>fairness and transparency that eliminates regressivity and engenders trust.</li>
</ul></li>
<li>How do you know?</li>
</ul>
<p>The model is not the end of the road. The new Office still sends homeowners their house evaluations, but now the data that they get sent back from the homeowners is taken into account. More detailed reports are being written by the office itself to democratize the information. Town halls and other public facing outreach helps involves the whole community in the process of housing evaluations, rather than limiting participation to a select few.</p>
</section>
</section>
<section id="key-takeaways" class="level2">
<h2 class="anchored" data-anchor-id="key-takeaways">Key Takeaways</h2>
<ol type="1">
<li><p>Accuracy is a necessary, but not sufficient, condition of a fair system.</p></li>
<li><p>Fairness and transparency are context-dependent and sociotechnical concepts</p></li>
<li><p>Learn to work with contexts, and consider how your data analysis will reshape them</p></li>
<li><p>Keep in mind the power, and limits, of data analysis</p></li>
</ol>
</section>
<section id="lessons-for-data-science-practice" class="level2">
<h2 class="anchored" data-anchor-id="lessons-for-data-science-practice">Lessons for Data Science Practice</h2>
<ol type="1">
<li><p>Question/Problem formulation</p>
<ul>
<li>Who is responsible for framing the problem?</li>
<li>Who are the stakeholders? How are they involved in the problem framing?</li>
<li>What do you bring to the table? How does your positionality affect your understanding of the problem?</li>
<li>What are the narratives that you’re tapping into?</li>
</ul></li>
<li><p>Data Acquisition and Cleaning</p>
<ul>
<li>Where does the data come from?</li>
<li>Who collected it? For what purpose?</li>
<li>What kinds of collecting and recording systems and techniques were used?</li>
<li>How has this data been used in the past?</li>
<li>What restrictions are there on access to the data, and what enables you to have access?</li>
</ul></li>
<li><p>Exploratory Data Analysis &amp; Visualization</p>
<ul>
<li>What kind of personal or group identities have become salient in this data?</li>
<li>Which variables became salient, and what kinds of relationship obtain between them?</li>
<li>Do any of the relationships made visible lend themselves to arguments that might be potentially harmful to a particular community?</li>
</ul></li>
<li><p>Prediction and Inference</p>
<ul>
<li>What does the prediction or inference do in the world?</li>
<li>Are the results useful for the intended purposes?</li>
<li>Are there benchmarks to compare the results?</li>
<li>How are your predictions and inferences dependent upon the larger system in which your model works?</li>
</ul></li>
<li><p>Reports, Decisions, and Solutions</p>
<ul>
<li>How do we know if we have accomplished our goals?</li>
<li>How does your work fit in the broader literature?</li>
<li>Where does your work agree or disagree with the status quo?</li>
<li>Do your conclusions make sense?</li>
</ul></li>
</ol>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>
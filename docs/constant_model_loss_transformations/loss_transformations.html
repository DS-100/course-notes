<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Principles and Techniques of Data Science - 11&nbsp; Constant Model, Loss, and Transformations</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<link href="../ols/ols.html" rel="next">
<link href="../intro_to_modeling/intro_to_modeling.html" rel="prev">
<link href="../data100_logo.png" rel="icon" type="image/png">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
      <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../constant_model_loss_transformations/loss_transformations.html"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Constant Model, Loss, and Transformations</span></a></li></ol></nav>
      <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
      </a>
      <button type="button" class="btn quarto-search-button" aria-label="" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-full">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header sidebar-header-stacked">
      <a href="../index.html" class="sidebar-logo-link">
      <img src="../data100_logo.png" alt="" class="sidebar-logo py-0 d-lg-inline d-none">
      </a>
    <div class="sidebar-title mb-0 py-0">
      <a href="../">Principles and Techniques of Data Science</a> 
        <div class="sidebar-tools-main">
    <a href="https://github.com/DS-100/course-notes" rel="" title="Source Code" class="quarto-navigation-tool px-1" aria-label="Source Code"><i class="bi bi-github"></i></a>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Welcome</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../intro_lec/introduction.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Introduction</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../pandas_1/pandas_1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Pandas I</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../pandas_2/pandas_2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Pandas II</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../pandas_3/pandas_3.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Pandas III</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../eda/eda.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Data Cleaning and EDA</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../regex/regex.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Regular Expressions</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../visualization_1/visualization_1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Visualization I</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../visualization_2/visualization_2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Visualization II</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../sampling/sampling.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Sampling</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../intro_to_modeling/intro_to_modeling.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Introduction to Modeling</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../constant_model_loss_transformations/loss_transformations.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Constant Model, Loss, and Transformations</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../ols/ols.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Ordinary Least Squares</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../gradient_descent/gradient_descent.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">sklearn and Gradient Descent</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../feature_engineering/feature_engineering.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Feature Engineering</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../case_study_HCE/case_study_HCE.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">Case Study in Human Contexts and Ethics</span></span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Constant Model, Loss, and Transformations</h2>
   
  <ul>
  <li><a href="#prediction-vs.-estimation" id="toc-prediction-vs.-estimation" class="nav-link active" data-scroll-target="#prediction-vs.-estimation"><span class="header-section-number">11.0.1</span> Prediction vs.&nbsp;Estimation</a></li>
  <li><a href="#step-4-evaluating-the-slr-model" id="toc-step-4-evaluating-the-slr-model" class="nav-link" data-scroll-target="#step-4-evaluating-the-slr-model"><span class="header-section-number">11.1</span> Step 4: Evaluating the SLR Model</a>
  <ul>
  <li><a href="#four-mysterious-datasets-anscombes-quartet" id="toc-four-mysterious-datasets-anscombes-quartet" class="nav-link" data-scroll-target="#four-mysterious-datasets-anscombes-quartet"><span class="header-section-number">11.1.1</span> Four Mysterious Datasets (Anscombe’s quartet)</a></li>
  </ul></li>
  <li><a href="#constant-model-mse" id="toc-constant-model-mse" class="nav-link" data-scroll-target="#constant-model-mse"><span class="header-section-number">11.2</span> Constant Model + MSE</a>
  <ul>
  <li><a href="#deriving-the-optimal-theta_0" id="toc-deriving-the-optimal-theta_0" class="nav-link" data-scroll-target="#deriving-the-optimal-theta_0"><span class="header-section-number">11.2.1</span> Deriving the optimal <span class="math inline">\(\theta_0\)</span></a></li>
  <li><a href="#comparing-two-different-models-both-fit-with-mse" id="toc-comparing-two-different-models-both-fit-with-mse" class="nav-link" data-scroll-target="#comparing-two-different-models-both-fit-with-mse"><span class="header-section-number">11.2.2</span> Comparing Two Different Models, Both Fit with MSE</a></li>
  </ul></li>
  <li><a href="#constant-model-mae" id="toc-constant-model-mae" class="nav-link" data-scroll-target="#constant-model-mae"><span class="header-section-number">11.3</span> Constant Model + MAE</a>
  <ul>
  <li><a href="#deriving-the-optimal-theta_0-1" id="toc-deriving-the-optimal-theta_0-1" class="nav-link" data-scroll-target="#deriving-the-optimal-theta_0-1"><span class="header-section-number">11.3.1</span> Deriving the optimal <span class="math inline">\(\theta_0\)</span></a></li>
  </ul></li>
  <li><a href="#summary-loss-optimization-calculus-and-critical-points" id="toc-summary-loss-optimization-calculus-and-critical-points" class="nav-link" data-scroll-target="#summary-loss-optimization-calculus-and-critical-points"><span class="header-section-number">11.4</span> Summary: Loss Optimization, Calculus, and Critical Points</a></li>
  <li><a href="#comparing-loss-functions" id="toc-comparing-loss-functions" class="nav-link" data-scroll-target="#comparing-loss-functions"><span class="header-section-number">11.5</span> Comparing Loss Functions</a></li>
  <li><a href="#transformations-to-fit-linear-models" id="toc-transformations-to-fit-linear-models" class="nav-link" data-scroll-target="#transformations-to-fit-linear-models"><span class="header-section-number">11.6</span> Transformations to fit Linear Models</a></li>
  <li><a href="#multiple-linear-regression" id="toc-multiple-linear-regression" class="nav-link" data-scroll-target="#multiple-linear-regression"><span class="header-section-number">11.7</span> Multiple Linear Regression</a></li>
  <li><a href="#bonus-calculating-constant-model-mse-using-an-algebraic-trick" id="toc-bonus-calculating-constant-model-mse-using-an-algebraic-trick" class="nav-link" data-scroll-target="#bonus-calculating-constant-model-mse-using-an-algebraic-trick"><span class="header-section-number">11.8</span> Bonus: Calculating Constant Model MSE Using an Algebraic Trick</a>
  <ul>
  <li><a href="#note" id="toc-note" class="nav-link" data-scroll-target="#note"><span class="header-section-number">11.8.0.0.1</span> Note</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content column-body" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Constant Model, Loss, and Transformations</span></h1><button type="button" class="btn code-tools-button dropdown-toggle" id="quarto-code-tools-menu" data-bs-toggle="dropdown" aria-expanded="false"><i class="bi"></i> Code</button><ul class="dropdown-menu dropdown-menu-end" aria-labelelledby="quarto-code-tools-menu"><li><a id="quarto-show-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Show All Code</a></li><li><a id="quarto-hide-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Hide All Code</a></li><li><hr class="dropdown-divider"></li><li><a id="quarto-view-source" class="dropdown-item" href="javascript:void(0)" role="button">View Source</a></li></ul></div></div>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<div class="callout callout-style-default callout-note no-icon callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-1-contents" aria-controls="callout-1" aria-expanded="true" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Learning Outcomes
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-1" class="callout-1-contents callout-collapse collapse show">
<div class="callout-body-container callout-body">
<ul>
<li>Derive the optimal model parameters for the constant model under MSE and MAE cost functions.</li>
<li>Evaluate the differences between MSE and MAE risk.</li>
<li>Understand the need for linearization of variables and apply the Tukey-Mosteller bulge diagram for transformations.</li>
</ul>
</div>
</div>
</div>
<p>Last time, we introduced the modeling process. We set up a framework to predict target variables as functions of our features, following a set workflow:</p>
<ol type="1">
<li>Choose a model - how should we represent the world?</li>
<li>Choose a loss function - how do we quantify prediction error?</li>
<li>Fit the model - how do we choose the best parameter of our model given our data?</li>
<li>Evaluate model performance - how do we evaluate whether this process gave rise to a good model?</li>
</ol>
<p>To illustrate this process, we derived the optimal model parameters under simple linear regression (SLR) with mean squared error (MSE) as the cost function. A summary of the SLR modeling process is shown below:</p>
<div data-align="middle">
<p><img src="images/slr_modeling.png" alt="modeling" width="600"></p>
</div>
<p>In this lecture, we’ll dive deeper into step 4 - evaluating model performance - using SLR as an example. Additionally, we’ll also explore the modeling process with new models, continue familiarizing ourselves with the modeling process by finding the best model parameters under a new model, the constant model, and test out two different loss functions to understand how our choice of loss influences model design. Later on, we’ll consider what happens when a linear model isn’t the best choice to capture trends in our data and what solutions there are to create better models.</p>
<p>Before we get into Step 4, let’s quickly review some important terminology.</p>
<section id="prediction-vs.-estimation" class="level3" data-number="11.0.1">
<h3 data-number="11.0.1" class="anchored" data-anchor-id="prediction-vs.-estimation"><span class="header-section-number">11.0.1</span> Prediction vs.&nbsp;Estimation</h3>
<p>The terms prediction and estimation are often used somewhat interchangeably, but there is a subtle difference between them. <strong>Estimation</strong> is the task of using data to calculate model parameters. <strong>Prediction</strong> is the task of using a model to predict outputs for unseen data. In our simple linear regression model,</p>
<p><span class="math display">\[\hat{y} = \hat{\theta_0} + \hat{\theta_1}\]</span></p>
<p>we <strong>estimate</strong> the parameters by minimizing average loss; then, we <strong>predict</strong> using these estimations. <strong>Least Squares Estimation</strong> is when we choose the parameters that minimize MSE.</p>
</section>
<section id="step-4-evaluating-the-slr-model" class="level2" data-number="11.1">
<h2 data-number="11.1" class="anchored" data-anchor-id="step-4-evaluating-the-slr-model"><span class="header-section-number">11.1</span> Step 4: Evaluating the SLR Model</h2>
<p>Now that we’ve explored the mathematics behind (1) choosing a model, (2) choosing a loss function, and (3) fitting the model, we’re left with one final question – how “good” are the predictions made by this “best” fitted model? To determine this, we can:</p>
<ol type="1">
<li><p>Visualize data and compute statistics:</p>
<ul>
<li>Plot the original data.</li>
<li>Compute each column’s mean and standard deviation. If the mean and standard deviation of our predictions are close to those of the original observed <span class="math inline">\(y_i\)</span>’s, we might be inclined to say that our model has done well.</li>
<li>(If we’re fitting a linear model) Compute the correlation <span class="math inline">\(r\)</span>. A large magnitude for the correlation coefficient between the feature and response variables could also indicate that our model has done well.</li>
</ul></li>
<li><p>Performance metrics:</p>
<ul>
<li>We can take the <strong>Root Mean Squared Error (RMSE)</strong>.
<ul>
<li>It’s the square root of the mean squared error (MSE), which is the average loss that we’ve been minimizing to determine optimal model parameters.</li>
<li>RMSE is in the same units as <span class="math inline">\(y\)</span>.</li>
<li>A lower RMSE indicates more “accurate” predictions, as we have a lower “average loss” across the data.</li>
</ul></li>
</ul>
<p><span class="math display">\[\text{RMSE} = \sqrt{\frac{1}{n} \sum_{i=1}^n (y_i - \hat{y}_i)^2}\]</span></p></li>
<li><p>Visualization:</p>
<ul>
<li>Look at the residual plot of <span class="math inline">\(e_i = y_i - \hat{y_i}\)</span> to visualize the difference between actual and predicted values. The good residual plot should not show any pattern between input/features <span class="math inline">\(x_i\)</span> and residual values <span class="math inline">\(e_i\)</span>.</li>
</ul></li>
</ol>
<p>To illustrate this process, let’s take a look at <strong>Anscombe’s quartet</strong>.</p>
<section id="four-mysterious-datasets-anscombes-quartet" class="level3" data-number="11.1.1">
<h3 data-number="11.1.1" class="anchored" data-anchor-id="four-mysterious-datasets-anscombes-quartet"><span class="header-section-number">11.1.1</span> Four Mysterious Datasets (Anscombe’s quartet)</h3>
<p>Let’s take a look at four different datasets.</p>
<div class="cell" data-vscode="{&quot;languageId&quot;:&quot;python&quot;}" data-execution_count="1">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="op">%</span>matplotlib inline</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> seaborn <span class="im">as</span> sns</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> itertools</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> mpl_toolkits.mplot3d <span class="im">import</span> Axes3D</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell" data-vscode="{&quot;languageId&quot;:&quot;python&quot;}" data-execution_count="2">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Big font helper</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> adjust_fontsize(size<span class="op">=</span><span class="va">None</span>):</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>    SMALL_SIZE <span class="op">=</span> <span class="dv">8</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>    MEDIUM_SIZE <span class="op">=</span> <span class="dv">10</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>    BIGGER_SIZE <span class="op">=</span> <span class="dv">12</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> size <span class="op">!=</span> <span class="va">None</span>:</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>        SMALL_SIZE <span class="op">=</span> MEDIUM_SIZE <span class="op">=</span> BIGGER_SIZE <span class="op">=</span> size</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>    plt.rc(<span class="st">"font"</span>, size<span class="op">=</span>SMALL_SIZE)  <span class="co"># controls default text sizes</span></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>    plt.rc(<span class="st">"axes"</span>, titlesize<span class="op">=</span>SMALL_SIZE)  <span class="co"># fontsize of the axes title</span></span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>    plt.rc(<span class="st">"axes"</span>, labelsize<span class="op">=</span>MEDIUM_SIZE)  <span class="co"># fontsize of the x and y labels</span></span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>    plt.rc(<span class="st">"xtick"</span>, labelsize<span class="op">=</span>SMALL_SIZE)  <span class="co"># fontsize of the tick labels</span></span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>    plt.rc(<span class="st">"ytick"</span>, labelsize<span class="op">=</span>SMALL_SIZE)  <span class="co"># fontsize of the tick labels</span></span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a>    plt.rc(<span class="st">"legend"</span>, fontsize<span class="op">=</span>SMALL_SIZE)  <span class="co"># legend fontsize</span></span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a>    plt.rc(<span class="st">"figure"</span>, titlesize<span class="op">=</span>BIGGER_SIZE)  <span class="co"># fontsize of the figure title</span></span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Helper functions</span></span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> standard_units(x):</span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> (x <span class="op">-</span> np.mean(x)) <span class="op">/</span> np.std(x)</span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-22"><a href="#cb2-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-23"><a href="#cb2-23" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> correlation(x, y):</span>
<span id="cb2-24"><a href="#cb2-24" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> np.mean(standard_units(x) <span class="op">*</span> standard_units(y))</span>
<span id="cb2-25"><a href="#cb2-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-26"><a href="#cb2-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-27"><a href="#cb2-27" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> slope(x, y):</span>
<span id="cb2-28"><a href="#cb2-28" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> correlation(x, y) <span class="op">*</span> np.std(y) <span class="op">/</span> np.std(x)</span>
<span id="cb2-29"><a href="#cb2-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-30"><a href="#cb2-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-31"><a href="#cb2-31" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> intercept(x, y):</span>
<span id="cb2-32"><a href="#cb2-32" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> np.mean(y) <span class="op">-</span> slope(x, y) <span class="op">*</span> np.mean(x)</span>
<span id="cb2-33"><a href="#cb2-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-34"><a href="#cb2-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-35"><a href="#cb2-35" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> fit_least_squares(x, y):</span>
<span id="cb2-36"><a href="#cb2-36" aria-hidden="true" tabindex="-1"></a>    theta_0 <span class="op">=</span> intercept(x, y)</span>
<span id="cb2-37"><a href="#cb2-37" aria-hidden="true" tabindex="-1"></a>    theta_1 <span class="op">=</span> slope(x, y)</span>
<span id="cb2-38"><a href="#cb2-38" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> theta_0, theta_1</span>
<span id="cb2-39"><a href="#cb2-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-40"><a href="#cb2-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-41"><a href="#cb2-41" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> predict(x, theta_0, theta_1):</span>
<span id="cb2-42"><a href="#cb2-42" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> theta_0 <span class="op">+</span> theta_1 <span class="op">*</span> x</span>
<span id="cb2-43"><a href="#cb2-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-44"><a href="#cb2-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-45"><a href="#cb2-45" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> compute_mse(y, yhat):</span>
<span id="cb2-46"><a href="#cb2-46" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> np.mean((y <span class="op">-</span> yhat) <span class="op">**</span> <span class="dv">2</span>)</span>
<span id="cb2-47"><a href="#cb2-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-48"><a href="#cb2-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-49"><a href="#cb2-49" aria-hidden="true" tabindex="-1"></a>plt.style.use(<span class="st">"default"</span>)  <span class="co"># Revert style to default mpl</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell" data-vscode="{&quot;languageId&quot;:&quot;python&quot;}" data-execution_count="3">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>plt.style.use(<span class="st">"default"</span>)  <span class="co"># Revert style to default mpl</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>NO_VIZ, RESID, RESID_SCATTER <span class="op">=</span> <span class="bu">range</span>(<span class="dv">3</span>)</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> least_squares_evaluation(x, y, visualize<span class="op">=</span>NO_VIZ):</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>    <span class="co"># statistics</span></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"x_mean : </span><span class="sc">{</span>np<span class="sc">.</span>mean(x)<span class="sc">:.2f}</span><span class="ss">, y_mean : </span><span class="sc">{</span>np<span class="sc">.</span>mean(y)<span class="sc">:.2f}</span><span class="ss">"</span>)</span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"x_stdev: </span><span class="sc">{</span>np<span class="sc">.</span>std(x)<span class="sc">:.2f}</span><span class="ss">, y_stdev: </span><span class="sc">{</span>np<span class="sc">.</span>std(y)<span class="sc">:.2f}</span><span class="ss">"</span>)</span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"r = Correlation(x, y): </span><span class="sc">{</span>correlation(x, y)<span class="sc">:.3f}</span><span class="ss">"</span>)</span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Performance metrics</span></span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>    ahat, bhat <span class="op">=</span> fit_least_squares(x, y)</span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>    yhat <span class="op">=</span> predict(x, ahat, bhat)</span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\t</span><span class="ss">heta_0: </span><span class="sc">{</span>ahat<span class="sc">:.2f}</span><span class="ss">, </span><span class="ch">\t</span><span class="ss">heta_1: </span><span class="sc">{</span>bhat<span class="sc">:.2f}</span><span class="ss">"</span>)</span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"RMSE: </span><span class="sc">{</span>np<span class="sc">.</span>sqrt(compute_mse(y, yhat))<span class="sc">:.3f}</span><span class="ss">"</span>)</span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a>    <span class="co"># visualization</span></span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a>    fig, ax_resid <span class="op">=</span> <span class="va">None</span>, <span class="va">None</span></span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> visualize <span class="op">==</span> RESID_SCATTER:</span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a>        fig, axs <span class="op">=</span> plt.subplots(<span class="dv">1</span>, <span class="dv">2</span>, figsize<span class="op">=</span>(<span class="dv">8</span>, <span class="dv">3</span>))</span>
<span id="cb3-21"><a href="#cb3-21" aria-hidden="true" tabindex="-1"></a>        axs[<span class="dv">0</span>].scatter(x, y)</span>
<span id="cb3-22"><a href="#cb3-22" aria-hidden="true" tabindex="-1"></a>        axs[<span class="dv">0</span>].plot(x, yhat)</span>
<span id="cb3-23"><a href="#cb3-23" aria-hidden="true" tabindex="-1"></a>        axs[<span class="dv">0</span>].set_title(<span class="st">"LS fit"</span>)</span>
<span id="cb3-24"><a href="#cb3-24" aria-hidden="true" tabindex="-1"></a>        ax_resid <span class="op">=</span> axs[<span class="dv">1</span>]</span>
<span id="cb3-25"><a href="#cb3-25" aria-hidden="true" tabindex="-1"></a>    <span class="cf">elif</span> visualize <span class="op">==</span> RESID:</span>
<span id="cb3-26"><a href="#cb3-26" aria-hidden="true" tabindex="-1"></a>        fig <span class="op">=</span> plt.figure(figsize<span class="op">=</span>(<span class="dv">4</span>, <span class="dv">3</span>))</span>
<span id="cb3-27"><a href="#cb3-27" aria-hidden="true" tabindex="-1"></a>        ax_resid <span class="op">=</span> plt.gca()</span>
<span id="cb3-28"><a href="#cb3-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-29"><a href="#cb3-29" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> ax_resid <span class="kw">is</span> <span class="kw">not</span> <span class="va">None</span>:</span>
<span id="cb3-30"><a href="#cb3-30" aria-hidden="true" tabindex="-1"></a>        ax_resid.scatter(x, y <span class="op">-</span> yhat, color<span class="op">=</span><span class="st">"red"</span>)</span>
<span id="cb3-31"><a href="#cb3-31" aria-hidden="true" tabindex="-1"></a>        ax_resid.plot([<span class="dv">4</span>, <span class="dv">14</span>], [<span class="dv">0</span>, <span class="dv">0</span>], color<span class="op">=</span><span class="st">"black"</span>)</span>
<span id="cb3-32"><a href="#cb3-32" aria-hidden="true" tabindex="-1"></a>        ax_resid.set_title(<span class="st">"Residuals"</span>)</span>
<span id="cb3-33"><a href="#cb3-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-34"><a href="#cb3-34" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> fig</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell" data-vscode="{&quot;languageId&quot;:&quot;python&quot;}" data-execution_count="4">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Load in four different datasets: I, II, III, IV</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>x <span class="op">=</span> [<span class="dv">10</span>, <span class="dv">8</span>, <span class="dv">13</span>, <span class="dv">9</span>, <span class="dv">11</span>, <span class="dv">14</span>, <span class="dv">6</span>, <span class="dv">4</span>, <span class="dv">12</span>, <span class="dv">7</span>, <span class="dv">5</span>]</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>y1 <span class="op">=</span> [<span class="fl">8.04</span>, <span class="fl">6.95</span>, <span class="fl">7.58</span>, <span class="fl">8.81</span>, <span class="fl">8.33</span>, <span class="fl">9.96</span>, <span class="fl">7.24</span>, <span class="fl">4.26</span>, <span class="fl">10.84</span>, <span class="fl">4.82</span>, <span class="fl">5.68</span>]</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>y2 <span class="op">=</span> [<span class="fl">9.14</span>, <span class="fl">8.14</span>, <span class="fl">8.74</span>, <span class="fl">8.77</span>, <span class="fl">9.26</span>, <span class="fl">8.10</span>, <span class="fl">6.13</span>, <span class="fl">3.10</span>, <span class="fl">9.13</span>, <span class="fl">7.26</span>, <span class="fl">4.74</span>]</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>y3 <span class="op">=</span> [<span class="fl">7.46</span>, <span class="fl">6.77</span>, <span class="fl">12.74</span>, <span class="fl">7.11</span>, <span class="fl">7.81</span>, <span class="fl">8.84</span>, <span class="fl">6.08</span>, <span class="fl">5.39</span>, <span class="fl">8.15</span>, <span class="fl">6.42</span>, <span class="fl">5.73</span>]</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>x4 <span class="op">=</span> [<span class="dv">8</span>, <span class="dv">8</span>, <span class="dv">8</span>, <span class="dv">8</span>, <span class="dv">8</span>, <span class="dv">8</span>, <span class="dv">8</span>, <span class="dv">19</span>, <span class="dv">8</span>, <span class="dv">8</span>, <span class="dv">8</span>]</span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>y4 <span class="op">=</span> [<span class="fl">6.58</span>, <span class="fl">5.76</span>, <span class="fl">7.71</span>, <span class="fl">8.84</span>, <span class="fl">8.47</span>, <span class="fl">7.04</span>, <span class="fl">5.25</span>, <span class="fl">12.50</span>, <span class="fl">5.56</span>, <span class="fl">7.91</span>, <span class="fl">6.89</span>]</span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>anscombe <span class="op">=</span> {</span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>    <span class="st">"I"</span>: pd.DataFrame(<span class="bu">list</span>(<span class="bu">zip</span>(x, y1)), columns<span class="op">=</span>[<span class="st">"x"</span>, <span class="st">"y"</span>]),</span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a>    <span class="st">"II"</span>: pd.DataFrame(<span class="bu">list</span>(<span class="bu">zip</span>(x, y2)), columns<span class="op">=</span>[<span class="st">"x"</span>, <span class="st">"y"</span>]),</span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a>    <span class="st">"III"</span>: pd.DataFrame(<span class="bu">list</span>(<span class="bu">zip</span>(x, y3)), columns<span class="op">=</span>[<span class="st">"x"</span>, <span class="st">"y"</span>]),</span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a>    <span class="st">"IV"</span>: pd.DataFrame(<span class="bu">list</span>(<span class="bu">zip</span>(x4, y4)), columns<span class="op">=</span>[<span class="st">"x"</span>, <span class="st">"y"</span>]),</span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot the scatter plot and line of best fit</span></span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a>fig, axs <span class="op">=</span> plt.subplots(<span class="dv">2</span>, <span class="dv">2</span>, figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">10</span>))</span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i, dataset <span class="kw">in</span> <span class="bu">enumerate</span>([<span class="st">"I"</span>, <span class="st">"II"</span>, <span class="st">"III"</span>, <span class="st">"IV"</span>]):</span>
<span id="cb4-20"><a href="#cb4-20" aria-hidden="true" tabindex="-1"></a>    ans <span class="op">=</span> anscombe[dataset]</span>
<span id="cb4-21"><a href="#cb4-21" aria-hidden="true" tabindex="-1"></a>    x, y <span class="op">=</span> ans[<span class="st">"x"</span>], ans[<span class="st">"y"</span>]</span>
<span id="cb4-22"><a href="#cb4-22" aria-hidden="true" tabindex="-1"></a>    ahat, bhat <span class="op">=</span> fit_least_squares(x, y)</span>
<span id="cb4-23"><a href="#cb4-23" aria-hidden="true" tabindex="-1"></a>    yhat <span class="op">=</span> predict(x, ahat, bhat)</span>
<span id="cb4-24"><a href="#cb4-24" aria-hidden="true" tabindex="-1"></a>    axs[i <span class="op">//</span> <span class="dv">2</span>, i <span class="op">%</span> <span class="dv">2</span>].scatter(x, y, alpha<span class="op">=</span><span class="fl">0.6</span>, color<span class="op">=</span><span class="st">"red"</span>)  <span class="co"># plot the x, y points</span></span>
<span id="cb4-25"><a href="#cb4-25" aria-hidden="true" tabindex="-1"></a>    axs[i <span class="op">//</span> <span class="dv">2</span>, i <span class="op">%</span> <span class="dv">2</span>].plot(x, yhat)  <span class="co"># plot the line of best fit</span></span>
<span id="cb4-26"><a href="#cb4-26" aria-hidden="true" tabindex="-1"></a>    axs[i <span class="op">//</span> <span class="dv">2</span>, i <span class="op">%</span> <span class="dv">2</span>].set_xlabel(<span class="ss">f"$x_</span><span class="sc">{</span>i<span class="op">+</span><span class="dv">1</span><span class="sc">}</span><span class="ss">$"</span>)</span>
<span id="cb4-27"><a href="#cb4-27" aria-hidden="true" tabindex="-1"></a>    axs[i <span class="op">//</span> <span class="dv">2</span>, i <span class="op">%</span> <span class="dv">2</span>].set_ylabel(<span class="ss">f"$y_</span><span class="sc">{</span>i<span class="op">+</span><span class="dv">1</span><span class="sc">}</span><span class="ss">$"</span>)</span>
<span id="cb4-28"><a href="#cb4-28" aria-hidden="true" tabindex="-1"></a>    axs[i <span class="op">//</span> <span class="dv">2</span>, i <span class="op">%</span> <span class="dv">2</span>].set_title(<span class="ss">f"Dataset </span><span class="sc">{</span>dataset<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb4-29"><a href="#cb4-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-30"><a href="#cb4-30" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<p><img src="loss_transformations_files/figure-html/cell-5-output-1.png" class="img-fluid"></p>
</div>
</div>
<p>While these four sets of datapoints look very different, they actually all have identical means <span class="math inline">\(\bar x\)</span>, <span class="math inline">\(\bar y\)</span>, standard deviations <span class="math inline">\(\sigma_x\)</span>, <span class="math inline">\(\sigma_y\)</span>, correlation <span class="math inline">\(r\)</span>, and RMSE! If we only look at these statistics, we would probably be inclined to say that these datasets are similar.</p>
<div class="cell" data-vscode="{&quot;languageId&quot;:&quot;python&quot;}" data-execution_count="5">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> dataset <span class="kw">in</span> [<span class="st">"I"</span>, <span class="st">"II"</span>, <span class="st">"III"</span>, <span class="st">"IV"</span>]:</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"&gt;&gt;&gt; Dataset </span><span class="sc">{</span>dataset<span class="sc">}</span><span class="ss">:"</span>)</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>    ans <span class="op">=</span> anscombe[dataset]</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>    fig <span class="op">=</span> least_squares_evaluation(ans[<span class="st">"x"</span>], ans[<span class="st">"y"</span>], visualize<span class="op">=</span>NO_VIZ)</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>()</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>&gt;&gt;&gt; Dataset I:
x_mean : 9.00, y_mean : 7.50
x_stdev: 3.16, y_stdev: 1.94
r = Correlation(x, y): 0.816
    heta_0: 3.00,   heta_1: 0.50
RMSE: 1.119


&gt;&gt;&gt; Dataset II:
x_mean : 9.00, y_mean : 7.50
x_stdev: 3.16, y_stdev: 1.94
r = Correlation(x, y): 0.816
    heta_0: 3.00,   heta_1: 0.50
RMSE: 1.119


&gt;&gt;&gt; Dataset III:
x_mean : 9.00, y_mean : 7.50
x_stdev: 3.16, y_stdev: 1.94
r = Correlation(x, y): 0.816
    heta_0: 3.00,   heta_1: 0.50
RMSE: 1.118


&gt;&gt;&gt; Dataset IV:
x_mean : 9.00, y_mean : 7.50
x_stdev: 3.16, y_stdev: 1.94
r = Correlation(x, y): 0.817
    heta_0: 3.00,   heta_1: 0.50
RMSE: 1.118

</code></pre>
</div>
</div>
<p>We may also wish to visualize the model’s <strong>residuals</strong>, defined as the difference between the observed and predicted <span class="math inline">\(y_i\)</span> value (<span class="math inline">\(e_i = y_i - \hat{y}_i\)</span>). This gives a high-level view of how “off” each prediction is from the true observed value. Recall that you explored this concept in <a href="https://inferentialthinking.com/chapters/15/5/Visual_Diagnostics.html?highlight=heteroscedasticity#detecting-heteroscedasticity">Data 8</a>: a good regression fit should display no clear pattern in its plot of residuals. The residual plots for Anscombe’s quartet are displayed below. Note how only the first plot shows no clear pattern to the magnitude of residuals. This is an indication that SLR is not the best choice of model for the remaining three sets of points.</p>
<!-- <img src="images/residual.png" alt='residual' width='600'> -->
<div class="cell" data-vscode="{&quot;languageId&quot;:&quot;python&quot;}" data-execution_count="6">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Residual visualization</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>fig, axs <span class="op">=</span> plt.subplots(<span class="dv">2</span>, <span class="dv">2</span>, figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">10</span>))</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i, dataset <span class="kw">in</span> <span class="bu">enumerate</span>([<span class="st">"I"</span>, <span class="st">"II"</span>, <span class="st">"III"</span>, <span class="st">"IV"</span>]):</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>    ans <span class="op">=</span> anscombe[dataset]</span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>    x, y <span class="op">=</span> ans[<span class="st">"x"</span>], ans[<span class="st">"y"</span>]</span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>    ahat, bhat <span class="op">=</span> fit_least_squares(x, y)</span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>    yhat <span class="op">=</span> predict(x, ahat, bhat)</span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>    axs[i <span class="op">//</span> <span class="dv">2</span>, i <span class="op">%</span> <span class="dv">2</span>].scatter(</span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>        x, y <span class="op">-</span> yhat, alpha<span class="op">=</span><span class="fl">0.6</span>, color<span class="op">=</span><span class="st">"red"</span></span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>    )  <span class="co"># plot the x, y points</span></span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>    axs[i <span class="op">//</span> <span class="dv">2</span>, i <span class="op">%</span> <span class="dv">2</span>].plot(</span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a>        x, np.zeros_like(x), color<span class="op">=</span><span class="st">"black"</span></span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a>    )  <span class="co"># plot the residual line</span></span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a>    axs[i <span class="op">//</span> <span class="dv">2</span>, i <span class="op">%</span> <span class="dv">2</span>].set_xlabel(<span class="ss">f"$x_</span><span class="sc">{</span>i<span class="op">+</span><span class="dv">1</span><span class="sc">}</span><span class="ss">$"</span>)</span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a>    axs[i <span class="op">//</span> <span class="dv">2</span>, i <span class="op">%</span> <span class="dv">2</span>].set_ylabel(<span class="ss">f"$e_</span><span class="sc">{</span>i<span class="op">+</span><span class="dv">1</span><span class="sc">}</span><span class="ss">$"</span>)</span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a>    axs[i <span class="op">//</span> <span class="dv">2</span>, i <span class="op">%</span> <span class="dv">2</span>].set_title(<span class="ss">f"Dataset </span><span class="sc">{</span>dataset<span class="sc">}</span><span class="ss"> Residuals"</span>)</span>
<span id="cb7-18"><a href="#cb7-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-19"><a href="#cb7-19" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<p><img src="loss_transformations_files/figure-html/cell-7-output-1.png" class="img-fluid"></p>
</div>
</div>
</section>
</section>
<section id="constant-model-mse" class="level2" data-number="11.2">
<h2 data-number="11.2" class="anchored" data-anchor-id="constant-model-mse"><span class="header-section-number">11.2</span> Constant Model + MSE</h2>
<p>Now, we’ll shift from the SLR model to the <strong>constant model</strong>, also known as a summary statistic. The constant model is slightly different from the simple linear regression model we’ve explored previously. Rather than generating predictions from an inputted feature variable, the constant model always <em>predicts the same constant number</em>. This ignores any relationships between variables. For example, let’s say we want to predict the number of drinks a boba shop sells in a day. Boba tea sales likely depend on the time of year, the weather, how the customers feel, whether school is in session, etc., but the constant model ignores these factors in favor of a simpler model. In other words, the constant model employs a <strong>simplifying assumption</strong>.</p>
<p>It is also a parametric, statistical model:</p>
<p><span class="math display">\[\hat{y} = \theta_0\]</span></p>
<p><span class="math inline">\(\theta_0\)</span> is the parameter of the constant model, just as <span class="math inline">\(\theta_0\)</span> and <span class="math inline">\(\theta_1\)</span> were the parameters in SLR. Since our parameter <span class="math inline">\(\theta_0\)</span> is 1-dimensional (<span class="math inline">\(\theta_0 \in \mathbb{R}\)</span>), we now have no input to our model and will always predict <span class="math inline">\(\hat{y} = \theta_0\)</span>.</p>
<section id="deriving-the-optimal-theta_0" class="level3" data-number="11.2.1">
<h3 data-number="11.2.1" class="anchored" data-anchor-id="deriving-the-optimal-theta_0"><span class="header-section-number">11.2.1</span> Deriving the optimal <span class="math inline">\(\theta_0\)</span></h3>
<p>Our task now is to determine what value of <span class="math inline">\(\theta_0\)</span> best represents the optimal model – in other words, what number should we guess each time to have the lowest possible <strong>average loss</strong> on our data?</p>
<p>Like before, we’ll use Mean Squared Error (MSE). Recall that the MSE is average squared loss (L2 loss) over the data <span class="math inline">\(D = \{y_1, y_2, ..., y_n\}\)</span>.</p>
<p><span class="math display">\[\hat{R}(\theta) = \frac{1}{n}\sum^{n}_{i=1} (y_i - \hat{y_i})^2 \]</span></p>
<p>Our modeling process now looks like this:</p>
<ol type="1">
<li>Choose a model: constant model</li>
<li>Choose a loss function: L2 loss</li>
<li>Fit the model</li>
<li>Evaluate model performance</li>
</ol>
<p>Given the <strong>constant model</strong> <span class="math inline">\(\hat{y} = \theta_0\)</span>, we can rewrite the MSE equation as</p>
<p><span class="math display">\[\hat{R}(\theta) = \frac{1}{n}\sum^{n}_{i=1} (y_i - \theta_0)^2 \]</span></p>
<p>We can fit <strong>the model</strong> by finding the optimal <span class="math inline">\(\hat{\theta_0}\)</span> that minimizes the MSE using a calculus approach.</p>
<ol type="1">
<li>Differentiate with respect to <span class="math inline">\(\theta_0\)</span>:</li>
</ol>
<p><span class="math display">\[
\begin{align}
\frac{d}{d\theta_0}\text{R}(\theta) &amp; = \frac{d}{d\theta_0}(\frac{1}{n}\sum^{n}_{i=1} (y_i - \theta_0)^2)
\\ &amp;= \frac{1}{n}\sum^{n}_{i=1} \frac{d}{d\theta_0}  (y_i - \theta_0)^2 \quad \quad \text{a derivative of sums is a sum of derivatives}
\\ &amp;= \frac{1}{n}\sum^{n}_{i=1} 2 (y_i - \theta_0) (-1) \quad \quad \text{chain rule}
\\ &amp;= {\frac{-2}{n}}\sum^{n}_{i=1} (y_i - \theta_0) \quad \quad \text{simply constants}
\end{align}
\]</span></p>
<ol start="2" type="1">
<li><p>Set the derivative equation equal to 0:</p>
<p><span class="math display">\[
0 = {\frac{-2}{n}}\sum^{n}_{i=1} (y_i - \hat{\theta_0})
\]</span></p></li>
<li><p>Solve for <span class="math inline">\(\hat{\theta_0}\)</span></p></li>
</ol>
<p><span class="math display">\[
\begin{align}
0 &amp;= {\frac{-2}{n}}\sum^{n}_{i=1} (y_i - \hat{\theta_0})
\\ &amp;= \sum^{n}_{i=1} (y_i - \hat{\theta_0}) \quad \quad \text{divide both sides by} \frac{-2}{n}
\\ &amp;= \left(\sum^{n}_{i=1} y_i\right) - \left(\sum^{n}_{i=1} \theta_0\right) \quad \quad \text{separate sums}
\\ &amp;= \left(\sum^{n}_{i=1} y_i\right) - (n \cdot \hat{\theta_0}) \quad \quad  \text{c + c + … + c = nc}
\\ n \cdot \hat{\theta_0} &amp;= \sum^{n}_{i=1} y_i
\\ \hat{\theta_0} &amp;= \frac{1}{n} \sum^{n}_{i=1} y_i
\\ \hat{\theta_0} &amp;= \bar{y}
\end{align}
\]</span></p>
<p>Let’s take a moment to interpret this result. <span class="math inline">\(\hat{\theta_0} = \bar{y}\)</span> is the optimal parameter for constant model + MSE. It holds true regardless of what data sample you have, and it provides some formal reasoning as to why the mean is such a common summary statistic.</p>
<p>Our optimal model parameter is the value of the parameter that minimizes the cost function. This minimum value of the cost function can be expressed:</p>
<p><span class="math display">\[R(\hat{\theta_0}) = \min_{\theta_0} R(\theta_0)\]</span></p>
<p>To restate the above in plain English: we are looking at the value of the cost function when it takes the best parameter as input. This optimal model parameter, <span class="math inline">\(\hat{\theta_0}\)</span>, is the value of <span class="math inline">\(\theta_0\)</span> that minimizes the cost <span class="math inline">\(R\)</span>.</p>
<p>For modeling purposes, we care less about the minimum value of cost, <span class="math inline">\(R(\hat{\theta_0})\)</span>, and more about the <em>value of <span class="math inline">\(\theta\)</span></em> that results in this lowest average loss. In other words, we concern ourselves with finding the best parameter value such that:</p>
<p><span class="math display">\[\hat{\theta} = \underset{\theta}{\operatorname{\arg\min}}\:R(\theta)\]</span></p>
<p>That is, we want to find the <strong>arg</strong>ument <span class="math inline">\(\theta\)</span> that <strong>min</strong>imizes the cost function.</p>
</section>
<section id="comparing-two-different-models-both-fit-with-mse" class="level3" data-number="11.2.2">
<h3 data-number="11.2.2" class="anchored" data-anchor-id="comparing-two-different-models-both-fit-with-mse"><span class="header-section-number">11.2.2</span> Comparing Two Different Models, Both Fit with MSE</h3>
<p>Now that we’ve explored the constant model with an L2 loss, we can compare it to the SLR model that we learned last lecture. Consider the dataset below, which contains information about the ages and lengths of dugongs. Supposed we wanted to predict dugong ages:</p>
<table class="table">
<colgroup>
<col style="width: 13%">
<col style="width: 38%">
<col style="width: 47%">
</colgroup>
<thead>
<tr class="header">
<th></th>
<th>Constant Model</th>
<th>Simple Linear Regression</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>model</td>
<td><span class="math inline">\(\hat{y} = \theta_0\)</span></td>
<td><span class="math inline">\(\hat{y} = \theta_0 + \theta_1 x\)</span></td>
</tr>
<tr class="even">
<td>data</td>
<td>sample of ages <span class="math inline">\(D = \{y_1, y_2, ..., y_n\}\)</span></td>
<td>sample of ages <span class="math inline">\(D = \{(x_1, y_1), (x_2, y_2), ..., (x_n, y_n)\}\)</span></td>
</tr>
<tr class="odd">
<td>dimensions</td>
<td><span class="math inline">\(\hat{\theta_0}\)</span> is 1-D</td>
<td><span class="math inline">\(\hat{\theta} = [\hat{\theta_0}, \hat{\theta_1}]\)</span> is 2-D</td>
</tr>
<tr class="even">
<td>loss surface</td>
<td>2-D <img src="images/constant_loss_surface.png" class="img-fluid"></td>
<td>3-D <img src="images/slr_loss_surface.png" class="img-fluid"></td>
</tr>
<tr class="odd">
<td>loss model</td>
<td><span class="math inline">\(\hat{R}(\theta) = \frac{1}{n}\sum^{n}_{i=1} (y_i - \theta_0)^2\)</span></td>
<td><span class="math inline">\(\hat{R}(\theta_0, \theta_1) = \frac{1}{n}\sum^{n}_{i=1} (y_i - (\theta_0 + \theta_1 x))^2\)</span></td>
</tr>
<tr class="even">
<td>RMSE</td>
<td>7.72</td>
<td>4.31</td>
</tr>
<tr class="odd">
<td>predictions visualized</td>
<td>rug plot <img src="images/dugong_rug.png" class="img-fluid"></td>
<td>scatter plot <img src="images/dugong_scatter.png" class="img-fluid"></td>
</tr>
</tbody>
</table>
<p>(Notice how the points for our SLR scatter plot are visually not a great linear fit. We’ll come back to this).</p>
<p>The code for generating the graphs and models is included below, but we won’t go over it in too much depth.</p>
<div class="cell" data-vscode="{&quot;languageId&quot;:&quot;python&quot;}" data-execution_count="7">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>dugongs <span class="op">=</span> pd.read_csv(<span class="st">"data/dugongs.csv"</span>)</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>data_constant <span class="op">=</span> dugongs[<span class="st">"Age"</span>]</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>data_linear <span class="op">=</span> dugongs[[<span class="st">"Length"</span>, <span class="st">"Age"</span>]]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell" data-vscode="{&quot;languageId&quot;:&quot;python&quot;}" data-execution_count="8">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Constant Model + MSE</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>plt.style.use(<span class="st">'default'</span>) <span class="co"># Revert style to default mpl</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>adjust_fontsize(size<span class="op">=</span><span class="dv">16</span>)</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a><span class="op">%</span>matplotlib inline</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> mse_constant(theta, data):</span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> np.mean(np.array([(y_obs <span class="op">-</span> theta) <span class="op">**</span> <span class="dv">2</span> <span class="cf">for</span> y_obs <span class="kw">in</span> data]), axis<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>thetas <span class="op">=</span> np.linspace(<span class="op">-</span><span class="dv">20</span>, <span class="dv">42</span>, <span class="dv">1000</span>)</span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>l2_loss_thetas <span class="op">=</span> mse_constant(thetas, data_constant)</span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Plotting the loss surface</span></span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a>plt.plot(thetas, l2_loss_thetas)</span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="vs">r'$\theta_0$'</span>)</span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="vs">r'MSE'</span>)</span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-17"><a href="#cb9-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Optimal point</span></span>
<span id="cb9-18"><a href="#cb9-18" aria-hidden="true" tabindex="-1"></a>thetahat <span class="op">=</span> np.mean(data_constant)</span>
<span id="cb9-19"><a href="#cb9-19" aria-hidden="true" tabindex="-1"></a>plt.scatter([thetahat], [mse_constant(thetahat, data_constant)], s<span class="op">=</span><span class="dv">50</span>, label <span class="op">=</span> <span class="vs">r"$\hat{\theta}_0$"</span>)</span>
<span id="cb9-20"><a href="#cb9-20" aria-hidden="true" tabindex="-1"></a>plt.legend()<span class="op">;</span></span>
<span id="cb9-21"><a href="#cb9-21" aria-hidden="true" tabindex="-1"></a><span class="co"># plt.show()</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<p><img src="loss_transformations_files/figure-html/cell-9-output-1.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-vscode="{&quot;languageId&quot;:&quot;python&quot;}" data-execution_count="9">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co"># SLR + MSE</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> mse_linear(theta_0, theta_1, data_linear):</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>    data_x, data_y <span class="op">=</span> data_linear.iloc[:, <span class="dv">0</span>], data_linear.iloc[:, <span class="dv">1</span>]</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> np.mean(</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>        np.array([(y <span class="op">-</span> (theta_0 <span class="op">+</span> theta_1 <span class="op">*</span> x)) <span class="op">**</span> <span class="dv">2</span> <span class="cf">for</span> x, y <span class="kw">in</span> <span class="bu">zip</span>(data_x, data_y)]),</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>        axis<span class="op">=</span><span class="dv">0</span>,</span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a><span class="co"># plotting the loss surface</span></span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>theta_0_values <span class="op">=</span> np.linspace(<span class="op">-</span><span class="dv">80</span>, <span class="dv">20</span>, <span class="dv">80</span>)</span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>theta_1_values <span class="op">=</span> np.linspace(<span class="op">-</span><span class="dv">10</span>, <span class="dv">30</span>, <span class="dv">80</span>)</span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a>mse_values <span class="op">=</span> np.array(</span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a>    [[mse_linear(x, y, data_linear) <span class="cf">for</span> x <span class="kw">in</span> theta_0_values] <span class="cf">for</span> y <span class="kw">in</span> theta_1_values]</span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb10-16"><a href="#cb10-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-17"><a href="#cb10-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Optimal point</span></span>
<span id="cb10-18"><a href="#cb10-18" aria-hidden="true" tabindex="-1"></a>data_x, data_y <span class="op">=</span> data_linear.iloc[:, <span class="dv">0</span>], data_linear.iloc[:, <span class="dv">1</span>]</span>
<span id="cb10-19"><a href="#cb10-19" aria-hidden="true" tabindex="-1"></a>theta_1_hat <span class="op">=</span> np.corrcoef(data_x, data_y)[<span class="dv">0</span>, <span class="dv">1</span>] <span class="op">*</span> np.std(data_y) <span class="op">/</span> np.std(data_x)</span>
<span id="cb10-20"><a href="#cb10-20" aria-hidden="true" tabindex="-1"></a>theta_0_hat <span class="op">=</span> np.mean(data_y) <span class="op">-</span> theta_1_hat <span class="op">*</span> np.mean(data_x)</span>
<span id="cb10-21"><a href="#cb10-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-22"><a href="#cb10-22" aria-hidden="true" tabindex="-1"></a><span class="co"># Create the 3D plot</span></span>
<span id="cb10-23"><a href="#cb10-23" aria-hidden="true" tabindex="-1"></a>fig <span class="op">=</span> plt.figure(figsize<span class="op">=</span>(<span class="dv">7</span>, <span class="dv">5</span>))</span>
<span id="cb10-24"><a href="#cb10-24" aria-hidden="true" tabindex="-1"></a>ax <span class="op">=</span> fig.add_subplot(<span class="dv">111</span>, projection<span class="op">=</span><span class="st">"3d"</span>)</span>
<span id="cb10-25"><a href="#cb10-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-26"><a href="#cb10-26" aria-hidden="true" tabindex="-1"></a>X, Y <span class="op">=</span> np.meshgrid(theta_0_values, theta_1_values)</span>
<span id="cb10-27"><a href="#cb10-27" aria-hidden="true" tabindex="-1"></a>surf <span class="op">=</span> ax.plot_surface(</span>
<span id="cb10-28"><a href="#cb10-28" aria-hidden="true" tabindex="-1"></a>    X, Y, mse_values, cmap<span class="op">=</span><span class="st">"viridis"</span>, alpha<span class="op">=</span><span class="fl">0.6</span></span>
<span id="cb10-29"><a href="#cb10-29" aria-hidden="true" tabindex="-1"></a>)  <span class="co"># Use alpha to make it slightly transparent</span></span>
<span id="cb10-30"><a href="#cb10-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-31"><a href="#cb10-31" aria-hidden="true" tabindex="-1"></a><span class="co"># Scatter point using matplotlib</span></span>
<span id="cb10-32"><a href="#cb10-32" aria-hidden="true" tabindex="-1"></a>sc <span class="op">=</span> ax.scatter(</span>
<span id="cb10-33"><a href="#cb10-33" aria-hidden="true" tabindex="-1"></a>    [theta_0_hat],</span>
<span id="cb10-34"><a href="#cb10-34" aria-hidden="true" tabindex="-1"></a>    [theta_1_hat],</span>
<span id="cb10-35"><a href="#cb10-35" aria-hidden="true" tabindex="-1"></a>    [mse_linear(theta_0_hat, theta_1_hat, data_linear)],</span>
<span id="cb10-36"><a href="#cb10-36" aria-hidden="true" tabindex="-1"></a>    marker<span class="op">=</span><span class="st">"o"</span>,</span>
<span id="cb10-37"><a href="#cb10-37" aria-hidden="true" tabindex="-1"></a>    color<span class="op">=</span><span class="st">"red"</span>,</span>
<span id="cb10-38"><a href="#cb10-38" aria-hidden="true" tabindex="-1"></a>    s<span class="op">=</span><span class="dv">100</span>,</span>
<span id="cb10-39"><a href="#cb10-39" aria-hidden="true" tabindex="-1"></a>    label<span class="op">=</span><span class="st">"theta hat"</span>,</span>
<span id="cb10-40"><a href="#cb10-40" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb10-41"><a href="#cb10-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-42"><a href="#cb10-42" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a colorbar</span></span>
<span id="cb10-43"><a href="#cb10-43" aria-hidden="true" tabindex="-1"></a>cbar <span class="op">=</span> fig.colorbar(surf, ax<span class="op">=</span>ax, shrink<span class="op">=</span><span class="fl">0.5</span>, aspect<span class="op">=</span><span class="dv">10</span>)</span>
<span id="cb10-44"><a href="#cb10-44" aria-hidden="true" tabindex="-1"></a>cbar.set_label(<span class="st">"Cost Value"</span>)</span>
<span id="cb10-45"><a href="#cb10-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-46"><a href="#cb10-46" aria-hidden="true" tabindex="-1"></a>ax.set_title(<span class="st">"MSE for different $</span><span class="ch">\\</span><span class="st">theta_0, </span><span class="ch">\\</span><span class="st">theta_1$"</span>)</span>
<span id="cb10-47"><a href="#cb10-47" aria-hidden="true" tabindex="-1"></a>ax.set_xlabel(<span class="st">"$</span><span class="ch">\\</span><span class="st">theta_0$"</span>)</span>
<span id="cb10-48"><a href="#cb10-48" aria-hidden="true" tabindex="-1"></a>ax.set_ylabel(<span class="st">"$</span><span class="ch">\\</span><span class="st">theta_1$"</span>)</span>
<span id="cb10-49"><a href="#cb10-49" aria-hidden="true" tabindex="-1"></a>ax.set_zlabel(<span class="st">"MSE"</span>)</span>
<span id="cb10-50"><a href="#cb10-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-51"><a href="#cb10-51" aria-hidden="true" tabindex="-1"></a><span class="co"># plt.show()</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="9">
<pre><code>Text(0.5, 0, 'MSE')</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="loss_transformations_files/figure-html/cell-10-output-2.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-vscode="{&quot;languageId&quot;:&quot;python&quot;}" data-execution_count="10">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Predictions</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>yobs <span class="op">=</span> data_linear[<span class="st">"Age"</span>]  <span class="co"># The true observations y</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>xs <span class="op">=</span> data_linear[<span class="st">"Length"</span>]  <span class="co"># Needed for linear predictions</span></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>n <span class="op">=</span> <span class="bu">len</span>(yobs)  <span class="co"># Predictions</span></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>yhats_constant <span class="op">=</span> [thetahat <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(n)]  <span class="co"># Not used, but food for thought</span></span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>yhats_linear <span class="op">=</span> [theta_0_hat <span class="op">+</span> theta_1_hat <span class="op">*</span> x <span class="cf">for</span> x <span class="kw">in</span> xs]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell" data-vscode="{&quot;languageId&quot;:&quot;python&quot;}" data-execution_count="11">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Constant Model Rug Plot</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="co"># In case we're in a weird style state</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>sns.set_theme()</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>adjust_fontsize(size<span class="op">=</span><span class="dv">16</span>)</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a><span class="op">%</span>matplotlib inline</span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>fig <span class="op">=</span> plt.figure(figsize<span class="op">=</span>(<span class="dv">8</span>, <span class="fl">1.5</span>))</span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>sns.rugplot(yobs, height<span class="op">=</span><span class="fl">0.25</span>, lw<span class="op">=</span><span class="dv">2</span>) <span class="op">;</span></span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>plt.axvline(thetahat, color<span class="op">=</span><span class="st">'red'</span>, lw<span class="op">=</span><span class="dv">4</span>, label<span class="op">=</span><span class="vs">r"$\hat{\theta}_0$"</span>)<span class="op">;</span></span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>plt.legend()</span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a>plt.yticks([])<span class="op">;</span></span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a><span class="co"># plt.show()</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<p><img src="loss_transformations_files/figure-html/cell-12-output-1.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-vscode="{&quot;languageId&quot;:&quot;python&quot;}" data-execution_count="12">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co"># SLR model scatter plot </span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="co"># In case we're in a weird style state</span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>sns.set_theme()</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>adjust_fontsize(size<span class="op">=</span><span class="dv">16</span>)</span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a><span class="op">%</span>matplotlib inline</span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>sns.scatterplot(x<span class="op">=</span>xs, y<span class="op">=</span>yobs)</span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>plt.plot(xs, yhats_linear, color<span class="op">=</span><span class="st">'red'</span>, lw<span class="op">=</span><span class="dv">4</span>)<span class="op">;</span></span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a><span class="co"># plt.savefig('dugong_line.png', bbox_inches = 'tight');</span></span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a><span class="co"># plt.show()</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<p><img src="loss_transformations_files/figure-html/cell-13-output-1.png" class="img-fluid"></p>
</div>
</div>
<p>Interpreting the RMSE (Root Mean Squared Error):</p>
<ul>
<li>Because the constant error is <strong>HIGHER</strong> than the linear error,</li>
<li>The constant model is <strong>WORSE</strong> than the linear model (at least for this metric).</li>
</ul>
</section>
</section>
<section id="constant-model-mae" class="level2" data-number="11.3">
<h2 data-number="11.3" class="anchored" data-anchor-id="constant-model-mae"><span class="header-section-number">11.3</span> Constant Model + MAE</h2>
<p>We see now that changing the model used for prediction leads to a wildly different result for the optimal model parameter. What happens if we instead change the loss function used in model evaluation?</p>
<p>This time, we will consider the constant model with L1 (absolute loss) as the loss function. This means that the average loss will be expressed as the <strong>Mean Absolute Error (MAE)</strong>.</p>
<ol type="1">
<li>Choose a model: constant model</li>
<li>Choose a loss function: L1 loss</li>
<li>Fit the model</li>
<li>Evaluate model performance</li>
</ol>
<section id="deriving-the-optimal-theta_0-1" class="level3" data-number="11.3.1">
<h3 data-number="11.3.1" class="anchored" data-anchor-id="deriving-the-optimal-theta_0-1"><span class="header-section-number">11.3.1</span> Deriving the optimal <span class="math inline">\(\theta_0\)</span></h3>
<p>Recall that the MAE is average <strong>absolute</strong> loss (L1 loss) over the data <span class="math inline">\(D = \{y_1, y_2, ..., y_n\}\)</span>.</p>
<p><span class="math display">\[\hat{R}(\theta_0) = \frac{1}{n}\sum^{n}_{i=1} |y_i - \hat{y_i}| \]</span></p>
<p>Given the constant model <span class="math inline">\(\hat{y} = \theta_0\)</span>, we can write the MAE as:</p>
<p><span class="math display">\[\hat{R}(\theta_0) = \frac{1}{n}\sum^{n}_{i=1} |y_i - \theta_0| \]</span></p>
<p>To fit the model, we find the optimal parameter value <span class="math inline">\(\hat{\theta_0}\)</span> that minimizes the MAE by differentiating using a calculus approach:</p>
<ol type="1">
<li>Differentiate with respect to <span class="math inline">\(\hat{\theta_0}\)</span>:</li>
</ol>
<p><span class="math display">\[
\begin{align}
\hat{R}(\theta_0) &amp;= \frac{1}{n}\sum^{n}_{i=1} |y_i - \theta_0| \\
\frac{d}{d\theta_0} R(\theta_0) &amp;= \frac{d}{d\theta_0} \left(\frac{1}{n} \sum^{n}_{i=1} |y_i - \theta_0| \right) \\
&amp;= \frac{1}{n} \sum^{n}_{i=1} \frac{d}{d\theta_0} |y_i - \theta_0|
\end{align}
\]</span></p>
<ul>
<li>Here, we seem to have run into a problem: the derivative of an absolute value is undefined when the argument is 0 (i.e.&nbsp;when <span class="math inline">\(y_i = \theta_0\)</span>). For now, we’ll ignore this issue. It turns out that disregarding this case doesn’t influence our final result.</li>
<li>To perform the derivative, consider two cases. When <span class="math inline">\(\theta_0\)</span> is <em>less than or equal to</em> <span class="math inline">\(y_i\)</span>, the term <span class="math inline">\(y_i - \theta_0\)</span> will be positive and the absolute value has no impact. When <span class="math inline">\(\theta_0\)</span> is <em>greater than</em> <span class="math inline">\(y_i\)</span>, the term <span class="math inline">\(y_i - \theta_0\)</span> will be negative. Applying the absolute value will convert this to a positive value, which we can express by saying <span class="math inline">\(-(y_i - \theta_0) = \theta_0 - y_i\)</span>.</li>
</ul>
<p><span class="math display">\[|y_i - \theta_0| = \begin{cases} y_i - \theta_0 \quad \text{ if } \theta_0 \le y_i \\ \theta_0 - y_i \quad \text{if }\theta_0 &gt; y_i \end{cases}\]</span></p>
<ul>
<li>Taking derivatives:</li>
</ul>
<p><span class="math display">\[\frac{d}{d\theta_0} |y_i - \theta_0| = \begin{cases} \frac{d}{d\theta_0} (y_i - \theta_0) = -1 \quad \text{if }\theta_0 &lt; y_i \\ \frac{d}{d\theta_0} (\theta_0 - y_i) = 1 \quad \text{if }\theta_0 &gt; y_i \end{cases}\]</span></p>
<ul>
<li>This means that we obtain a different value for the derivative for data points where <span class="math inline">\(\theta_0 &lt; y_i\)</span> and where <span class="math inline">\(\theta_0 &gt; y_i\)</span>. We can summarize this by saying:</li>
</ul>
<p><span class="math display">\[
\frac{d}{d\theta_0} R(\theta_0) = \frac{1}{n} \sum^{n}_{i=1} \frac{d}{d\theta_0} |y_i - \theta_0| \\
= \frac{1}{n} \left[\sum_{\theta_0 &lt; y_i} (-1) + \sum_{\theta_0 &gt; y_i} (+1) \right]
\]</span></p>
<ul>
<li>In other words, we take the sum of values for <span class="math inline">\(i = 1, 2, ..., n\)</span>:
<ul>
<li><span class="math inline">\(-1\)</span> if our observation <span class="math inline">\(y_i\)</span> is <em>greater than</em> our prediction <span class="math inline">\(\hat{\theta_0}\)</span></li>
<li><span class="math inline">\(+1\)</span> if our observation <span class="math inline">\(y_i\)</span> is <em>smaller than</em> our prediction <span class="math inline">\(\hat{\theta_0}\)</span></li>
</ul></li>
</ul>
<ol start="2" type="1">
<li><p>Set the derivative equation equal to 0: <span class="math display">\[ 0 = \frac{1}{n}\sum_{\hat{\theta_0} &lt; y_i} (-1) + \frac{1}{n}\sum_{\hat{\theta_0} &gt; y_i} (+1) \]</span></p></li>
<li><p>Solve for <span class="math inline">\(\hat{\theta_0}\)</span>: <span class="math display">\[ 0 = -\frac{1}{n}\sum_{\hat{\theta_0} &lt; y_i} (1) + \frac{1}{n}\sum_{\hat{\theta_0} &gt; y_i} (1)\]</span></p></li>
</ol>
<p><span class="math display">\[\sum_{\hat{\theta_0} &lt; y_i} (1) = \sum_{\hat{\theta_0} &gt; y_i} (1) \]</span></p>
<p>Thus, the constant model parameter <span class="math inline">\(\theta = \hat{\theta_0}\)</span> that minimizes MAE must satisfy:</p>
<p><span class="math display">\[ \sum_{\hat{\theta_0} &lt; y_i} (1) = \sum_{\hat{\theta_0} &gt; y_i} (1) \]</span></p>
<p>In other words, the number of observations greater than <span class="math inline">\(\theta_0\)</span> must be equal to the number of observations less than <span class="math inline">\(\theta_0\)</span>; there must be an equal number of points on the left and right sides of the equation. This is the definition of median, so our optimal value is <span class="math display">\[ \hat{\theta_0} = median(y) \]</span></p>
</section>
</section>
<section id="summary-loss-optimization-calculus-and-critical-points" class="level2" data-number="11.4">
<h2 data-number="11.4" class="anchored" data-anchor-id="summary-loss-optimization-calculus-and-critical-points"><span class="header-section-number">11.4</span> Summary: Loss Optimization, Calculus, and Critical Points</h2>
<p>First, define the <strong>objective function</strong> as average loss.</p>
<ul>
<li>Plug in L1 or L2 loss.</li>
<li>Plug in the model so that the resulting expression is a function of <span class="math inline">\(\theta\)</span>.</li>
</ul>
<p>Then, find the minimum of the objective function:</p>
<ol type="1">
<li>Differentiate with respect to <span class="math inline">\(\theta\)</span>.</li>
<li>Set equal to 0.</li>
<li>Solve for <span class="math inline">\(\hat{\theta}\)</span>.</li>
<li>(If we have multiple parameters) repeat steps 1-3 with partial derivatives.</li>
</ol>
<p>Recall critical points from calculus: <span class="math inline">\(R(\hat{\theta})\)</span> could be a minimum, maximum, or saddle point!</p>
<ul>
<li>We should technically also perform the second derivative test, i.e., show <span class="math inline">\(R''(\hat{\theta}) &gt; 0\)</span>.</li>
<li>MSE has a property—<strong>convexity</strong>—that guarantees that <span class="math inline">\(R(\hat{\theta})\)</span> is a global minimum.</li>
<li>The proof of convexity for MAE is beyond this course.</li>
</ul>
</section>
<section id="comparing-loss-functions" class="level2" data-number="11.5">
<h2 data-number="11.5" class="anchored" data-anchor-id="comparing-loss-functions"><span class="header-section-number">11.5</span> Comparing Loss Functions</h2>
<p>We’ve now tried our hand at fitting a model under both MSE and MAE cost functions. How do the two results compare?</p>
<p>Let’s consider a dataset where each entry represents the number of drinks sold at a bubble tea store each day. We’ll fit a constant model to predict the number of drinks that will be sold tomorrow.</p>
<div class="cell" data-vscode="{&quot;languageId&quot;:&quot;python&quot;}" data-execution_count="13">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>drinks <span class="op">=</span> np.array([<span class="dv">20</span>, <span class="dv">21</span>, <span class="dv">22</span>, <span class="dv">29</span>, <span class="dv">33</span>])</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>drinks</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="13">
<pre><code>array([20, 21, 22, 29, 33])</code></pre>
</div>
</div>
<p>From our derivations above, we know that the optimal model parameter under MSE cost is the mean of the dataset. Under MAE cost, the optimal parameter is the median of the dataset.</p>
<div class="cell" data-vscode="{&quot;languageId&quot;:&quot;python&quot;}" data-execution_count="14">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>np.mean(drinks), np.median(drinks)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="14">
<pre><code>(25.0, 22.0)</code></pre>
</div>
</div>
<p>If we plot each empirical risk function across several possible values of <span class="math inline">\(\theta\)</span>, we find that each <span class="math inline">\(\hat{\theta}\)</span> does indeed correspond to the lowest value of error:</p>
<p><img src="images/error.png" alt="error" width="600"></p>
<p>Notice that the MSE above is a <strong>smooth</strong> function – it is differentiable at all points, making it easy to minimize using numerical methods. The MAE, in contrast, is not differentiable at each of its “kinks.” We’ll explore how the smoothness of the cost function can impact our ability to apply numerical optimization in a few weeks.</p>
<p>How do outliers affect each cost function? Imagine we replace the largest value in the dataset with 1000. The mean of the data increases substantially, while the median is nearly unaffected.</p>
<div class="cell" data-vscode="{&quot;languageId&quot;:&quot;python&quot;}" data-execution_count="15">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>drinks_with_outlier <span class="op">=</span> np.append(drinks, <span class="dv">1033</span>)</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>display(drinks_with_outlier)</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>np.mean(drinks_with_outlier), np.median(drinks_with_outlier)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>array([  20,   21,   22,   29,   33, 1033])</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="15">
<pre><code>(193.0, 25.5)</code></pre>
</div>
</div>
<p><img src="images/outliers.png" alt="outliers" width="700"></p>
<p>This means that under the MSE, the optimal model parameter <span class="math inline">\(\hat{\theta}\)</span> is strongly affected by the presence of outliers. Under the MAE, the optimal parameter is not as influenced by outlying data. We can generalize this by saying that the MSE is <strong>sensitive</strong> to outliers, while the MAE is <strong>robust</strong> to outliers.</p>
<p>Let’s try another experiment. This time, we’ll add an additional, non-outlying datapoint to the data.</p>
<div class="cell" data-vscode="{&quot;languageId&quot;:&quot;python&quot;}" data-execution_count="16">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>drinks_with_additional_observation <span class="op">=</span> np.append(drinks, <span class="dv">35</span>)</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>drinks_with_additional_observation</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="16">
<pre><code>array([20, 21, 22, 29, 33, 35])</code></pre>
</div>
</div>
<p>When we again visualize the cost functions, we find that the MAE now plots a horizontal line between 22 and 29. This means that there are <em>infinitely</em> many optimal values for the model parameter: any value <span class="math inline">\(\hat{\theta} \in [22, 29]\)</span> will minimize the MAE. In contrast, the MSE still has a single best value for <span class="math inline">\(\hat{\theta}\)</span>. In other words, the MSE has a <strong>unique</strong> solution for <span class="math inline">\(\hat{\theta}\)</span>; the MAE is not guaranteed to have a single unique solution.</p>
<p><img src="images/mse_loss_26.png" width="350"> <img src="images/mae_loss_infinite.png" width="350"></p>
<p>To summarize our example,</p>
<table class="table">
<colgroup>
<col style="width: 13%">
<col style="width: 38%">
<col style="width: 47%">
</colgroup>
<thead>
<tr class="header">
<th></th>
<th>MSE (Mean Squared Loss)</th>
<th>MAE (Mean Absolute Loss)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Loss Function</td>
<td><span class="math inline">\(\hat{R}(\theta) = \frac{1}{n}\sum^{n}_{i=1} (y_i - \theta_0)^2\)</span></td>
<td><span class="math inline">\(\hat{R}(\theta) = \frac{1}{n}\sum^{n}_{i=1} |y_i - \theta_0|\)</span></td>
</tr>
<tr class="even">
<td>Optimal <span class="math inline">\(\hat{\theta_0}\)</span></td>
<td><span class="math inline">\(\hat{\theta_0} = mean(y) = \bar{y}\)</span></td>
<td><span class="math inline">\(\hat{\theta_0} = median(y)\)</span></td>
</tr>
<tr class="odd">
<td>Loss Surface</td>
<td><img src="images/mse_loss_26.png" width="250"></td>
<td><img src="images/mae_loss_infinite.png" width="250"></td>
</tr>
<tr class="even">
<td>Shape</td>
<td><strong>Smooth</strong> - easy to minimize using numerical methods (in a few weeks)</td>
<td><strong>Piecewise</strong> - at each of the “kinks,” it’s not differentiable. Harder to minimize.</td>
</tr>
<tr class="odd">
<td>Outliers</td>
<td><strong>Sensitive</strong> to outliers (since they change mean substantially). Sensitivity also depends on the dataset size.</td>
<td><strong>More robust</strong> to outliers.</td>
</tr>
<tr class="even">
<td><span class="math inline">\(\hat{\theta_0}\)</span> Uniqueness</td>
<td><strong>Unique</strong> <span class="math inline">\(\hat{\theta_0}\)</span></td>
<td><strong>Infinitely many</strong> <span class="math inline">\(\hat{\theta_0}\)</span>s</td>
</tr>
</tbody>
</table>
</section>
<section id="transformations-to-fit-linear-models" class="level2" data-number="11.6">
<h2 data-number="11.6" class="anchored" data-anchor-id="transformations-to-fit-linear-models"><span class="header-section-number">11.6</span> Transformations to fit Linear Models</h2>
<p>At this point, we have an effective method of fitting models to predict linear relationships. Given a feature variable and target, we can apply our four-step process to find the optimal model parameters.</p>
<p>A key word above is <em>linear</em>. When we computed parameter estimates earlier, we assumed that <span class="math inline">\(x_i\)</span> and <span class="math inline">\(y_i\)</span> shared a roughly linear relationship. Data in the real world isn’t always so straightforward, but we can transform the data to try and obtain linearity.</p>
<p>The <strong>Tukey-Mosteller Bulge Diagram</strong> is a useful tool for summarizing what transformations can linearize the relationship between two variables. To determine what transformations might be appropriate, trace the shape of the “bulge” made by your data. Find the quadrant of the diagram that matches this bulge. The transformations shown on the vertical and horizontal axes of this quadrant can help improve the fit between the variables.</p>
<p><img src="images/bulge.png" alt="bulge" width="600"></p>
<p>Note that:</p>
<ul>
<li>There are multiple solutions. Some will fit better than others.</li>
<li>sqrt and log make a value “smaller.”</li>
<li>Raising to a power makes a value “bigger.”</li>
<li>Each of these transformations equates to increasing or decreasing the scale of an axis.</li>
</ul>
<p>Other goals in addition to linearity are possible, for example, making data appear more symmetric. Linearity allows us to fit lines to the transformed data.</p>
<p>Let’s revisit our dugongs example. The lengths and ages are plotted below:</p>
<div class="cell" data-vscode="{&quot;languageId&quot;:&quot;python&quot;}" data-execution_count="17">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="co"># `corrcoef` computes the correlation coefficient between two variables</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a><span class="co"># `std` finds the standard deviation</span></span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>x <span class="op">=</span> dugongs[<span class="st">"Length"</span>]</span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>y <span class="op">=</span> dugongs[<span class="st">"Age"</span>]</span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>r <span class="op">=</span> np.corrcoef(x, y)[<span class="dv">0</span>, <span class="dv">1</span>]</span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>theta_1 <span class="op">=</span> r <span class="op">*</span> np.std(y) <span class="op">/</span> np.std(x)</span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a>theta_0 <span class="op">=</span> np.mean(y) <span class="op">-</span> theta_1 <span class="op">*</span> np.mean(x)</span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(<span class="dv">1</span>, <span class="dv">2</span>, dpi<span class="op">=</span><span class="dv">200</span>, figsize<span class="op">=</span>(<span class="dv">8</span>, <span class="dv">3</span>))</span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">0</span>].scatter(x, y)</span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">0</span>].set_xlabel(<span class="st">"Length"</span>)</span>
<span id="cb24-12"><a href="#cb24-12" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">0</span>].set_ylabel(<span class="st">"Age"</span>)</span>
<span id="cb24-13"><a href="#cb24-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-14"><a href="#cb24-14" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">1</span>].scatter(x, y)</span>
<span id="cb24-15"><a href="#cb24-15" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">1</span>].plot(x, theta_0 <span class="op">+</span> theta_1 <span class="op">*</span> x, <span class="st">"tab:red"</span>)</span>
<span id="cb24-16"><a href="#cb24-16" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">1</span>].set_xlabel(<span class="st">"Length"</span>)</span>
<span id="cb24-17"><a href="#cb24-17" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">1</span>].set_ylabel(<span class="st">"Age"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="17">
<pre><code>Text(0, 0.5, 'Age')</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="loss_transformations_files/figure-html/cell-18-output-2.png" class="img-fluid"></p>
</div>
</div>
<p>Looking at the plot on the left, we see that there is a slight curvature to the data points. Plotting the SLR curve on the right results in a poor fit.</p>
<p>For SLR to perform well, we’d like there to be a rough linear trend relating <code>"Age"</code> and <code>"Length"</code>. What is making the raw data deviate from a linear relationship? Notice that the data points with <code>"Length"</code> greater than 2.6 have disproportionately high values of <code>"Age"</code> relative to the rest of the data. If we could manipulate these data points to have lower <code>"Age"</code> values, we’d “shift” these points downwards and reduce the curvature in the data. Applying a logarithmic transformation to <span class="math inline">\(y_i\)</span> (that is, taking <span class="math inline">\(\log(\)</span> <code>"Age"</code> <span class="math inline">\()\)</span> ) would achieve just that.</p>
<p>An important word on <span class="math inline">\(\log\)</span>: in Data 100 (and most upper-division STEM courses), <span class="math inline">\(\log\)</span> denotes the natural logarithm with base <span class="math inline">\(e\)</span>. The base-10 logarithm, where relevant, is indicated by <span class="math inline">\(\log_{10}\)</span>.</p>
<div class="cell" data-vscode="{&quot;languageId&quot;:&quot;python&quot;}" data-execution_count="18">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>z <span class="op">=</span> np.log(y)</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>r <span class="op">=</span> np.corrcoef(x, z)[<span class="dv">0</span>, <span class="dv">1</span>]</span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>theta_1 <span class="op">=</span> r <span class="op">*</span> np.std(z) <span class="op">/</span> np.std(x)</span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a>theta_0 <span class="op">=</span> np.mean(z) <span class="op">-</span> theta_1 <span class="op">*</span> np.mean(x)</span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(<span class="dv">1</span>, <span class="dv">2</span>, dpi<span class="op">=</span><span class="dv">200</span>, figsize<span class="op">=</span>(<span class="dv">8</span>, <span class="dv">3</span>))</span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">0</span>].scatter(x, z)</span>
<span id="cb26-9"><a href="#cb26-9" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">0</span>].set_xlabel(<span class="st">"Length"</span>)</span>
<span id="cb26-10"><a href="#cb26-10" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">0</span>].set_ylabel(<span class="vs">r"$\log{(Age)}$"</span>)</span>
<span id="cb26-11"><a href="#cb26-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-12"><a href="#cb26-12" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">1</span>].scatter(x, z)</span>
<span id="cb26-13"><a href="#cb26-13" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">1</span>].plot(x, theta_0 <span class="op">+</span> theta_1 <span class="op">*</span> x, <span class="st">"tab:red"</span>)</span>
<span id="cb26-14"><a href="#cb26-14" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">1</span>].set_xlabel(<span class="st">"Length"</span>)</span>
<span id="cb26-15"><a href="#cb26-15" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">1</span>].set_ylabel(<span class="vs">r"$\log{(Age)}$"</span>)</span>
<span id="cb26-16"><a href="#cb26-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-17"><a href="#cb26-17" aria-hidden="true" tabindex="-1"></a>plt.subplots_adjust(wspace<span class="op">=</span><span class="fl">0.3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<p><img src="loss_transformations_files/figure-html/cell-19-output-1.png" class="img-fluid"></p>
</div>
</div>
<p>Our SLR fit looks a lot better! We now have a new target variable: the SLR model is now trying to predict the <em>log</em> of <code>"Age"</code>, rather than the untransformed <code>"Age"</code>. In other words, we are applying the transformation <span class="math inline">\(z_i = \log{(y_i)}\)</span>. Notice that the resulting model is still <strong>linear in the parameters</strong> <span class="math inline">\(\theta = [\theta_0, \theta_1]\)</span>. The SLR model becomes:</p>
<p><span class="math display">\[\hat{\log{y}} = \theta_0 + \theta_1 x\]</span> <span class="math display">\[\hat{z} = \theta_0 + \theta_1 x\]</span></p>
<p>It turns out that this linearized relationship can help us understand the underlying relationship between <span class="math inline">\(x\)</span> and <span class="math inline">\(y\)</span>. If we rearrange the relationship above, we find:</p>
<p><span class="math display">\[
\log{(y)} = \theta_0 + \theta_1 x \\
y = e^{\theta_0 + \theta_1 x} \\
y = (e^{\theta_0})e^{\theta_1 x} \\
y_i = C e^{k x}
\]</span></p>
<p>For some constants <span class="math inline">\(C\)</span> and <span class="math inline">\(k\)</span>.</p>
<p><span class="math inline">\(y\)</span> is an <em>exponential</em> function of <span class="math inline">\(x\)</span>. Applying an exponential fit to the untransformed variables corroborates this finding.</p>
<div class="cell" data-vscode="{&quot;languageId&quot;:&quot;python&quot;}" data-execution_count="19">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>plt.figure(dpi<span class="op">=</span><span class="dv">120</span>, figsize<span class="op">=</span>(<span class="dv">4</span>, <span class="dv">3</span>))</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>plt.scatter(x, y)</span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>plt.plot(x, np.exp(theta_0) <span class="op">*</span> np.exp(theta_1 <span class="op">*</span> x), <span class="st">"tab:red"</span>)</span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">"Length"</span>)</span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">"Age"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="19">
<pre><code>Text(0, 0.5, 'Age')</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="loss_transformations_files/figure-html/cell-20-output-2.png" class="img-fluid"></p>
</div>
</div>
<p>You may wonder: why did we choose to apply a log transformation specifically? Why not some other function to linearize the data?</p>
<p>Practically, many other mathematical operations that modify the relative scales of <code>"Age"</code> and <code>"Length"</code> could have worked here.</p>
</section>
<section id="multiple-linear-regression" class="level2" data-number="11.7">
<h2 data-number="11.7" class="anchored" data-anchor-id="multiple-linear-regression"><span class="header-section-number">11.7</span> Multiple Linear Regression</h2>
<p>Multiple linear regression is an extension of simple linear regression that adds additional features to the model. The multiple linear regression model takes the form:</p>
<p><span class="math display">\[\hat{y} = \theta_0\:+\:\theta_1x_{1}\:+\:\theta_2 x_{2}\:+\:...\:+\:\theta_p x_{p}\]</span></p>
<p>Our predicted value of <span class="math inline">\(y\)</span>, <span class="math inline">\(\hat{y}\)</span>, is a linear combination of the single <strong>observations</strong> (features), <span class="math inline">\(x_i\)</span>, and the parameters, <span class="math inline">\(\theta_i\)</span>.</p>
<p>We’ll dive deeper into Multiple Linear Regression in the next lecture.</p>
</section>
<section id="bonus-calculating-constant-model-mse-using-an-algebraic-trick" class="level2" data-number="11.8">
<h2 data-number="11.8" class="anchored" data-anchor-id="bonus-calculating-constant-model-mse-using-an-algebraic-trick"><span class="header-section-number">11.8</span> Bonus: Calculating Constant Model MSE Using an Algebraic Trick</h2>
<p>Earlier, we calculated the constant model MSE using calculus. It turns out that there is a much more elegant way of performing this same minimization algebraically, without using calculus at all.</p>
<p>In this calculation, we use the fact that the <strong>sum of deviations from the mean is <span class="math inline">\(0\)</span></strong> or that <span class="math inline">\(\sum_{i=1}^{n} (y_i - \bar{y}) = 0\)</span>.</p>
<p>Let’s quickly walk through the proof for this: <span class="math display">\[
\begin{align}
\sum_{i=1}^{n} (y_i - \bar{y}) &amp;= \sum_{i=1}^{n} y_i - \sum_{i=1}^{n} \bar{y} \\
&amp;= \sum_{i=1}^{n} y_i - n\bar{y} \\
&amp;= \sum_{i=1}^{n} y_i - n\frac{1}{n}\sum_{i=1}^{n}y_i \\
&amp;= \sum_{i=1}^{n} y_i - \sum_{i=1}^{n}y_i \\
&amp; = 0
\end{align}
\]</span></p>
<p>In our calculations, we’ll also be using the definition of the variance as a sample. As a refresher:</p>
<p><span class="math display">\[\sigma_y^2 = \frac{1}{n}\sum_{i=1}^{n} (y_i - \bar{y})^2\]</span></p>
<p>Getting into our calculation for MSE minimization:</p>
<p><span class="math display">\[
\begin{align}
R(\theta) &amp;= {\frac{1}{n}}\sum^{n}_{i=1} (y_i - \theta)^2
\\ &amp;= \frac{1}{n}\sum^{n}_{i=1} [(y_i - \bar{y}) + (\bar{y} - \theta)]^2\quad \quad \text{using trick that a-b can be written as (a-c) + (c-b) } \\
&amp;\quad \quad \quad \quad \quad \quad \quad \quad \quad \quad \quad \quad \quad \quad \space \space \text{where a, b, and c are any numbers}
\\ &amp;= \frac{1}{n}\sum^{n}_{i=1} [(y_i - \bar{y})^2 + 2(y_i - \bar{y})(\bar{y} - \theta) + (\bar{y} - \theta)^2]
\\ &amp;= \frac{1}{n}[\sum^{n}_{i=1}(y_i - \bar{y})^2 + 2(\bar{y} - \theta)\sum^{n}_{i=1}(y_i - \bar{y}) + n(\bar{y} - \theta)^2] \quad \quad  \text{distribute sum to individual terms}
\\ &amp;= \frac{1}{n}\sum^{n}_{i=1}(y_i - \bar{y})^2 + \frac{2}{n}(\bar{y} - \theta)\cdot0 + (\bar{y} - \theta)^2 \quad \quad  \text{sum of deviations from mean is 0}
\\ &amp;= \sigma_y^2 + (\bar{y} - \theta)^2
\end{align}
\]</span></p>
<p>Since variance can’t be negative, we know that our first term, <span class="math inline">\(\sigma_y^2\)</span> is greater than or equal to <span class="math inline">\(0\)</span>. Also note, that <strong>the first term doesn’t involve <span class="math inline">\(\theta\)</span> at all</strong>, meaning changing our model won’t change this value. For the purposes of determining $#, we can then essentially ignore this term.</p>
<p>Looking at the second term, <span class="math inline">\((\bar{y} - \theta)^2\)</span>, since it is squared, we know it must be greater than or equal to <span class="math inline">\(0\)</span>. As this term does involve <span class="math inline">\(\theta\)</span>, picking the value of <span class="math inline">\(\theta\)</span> that minimizes this term will allow us to minimize our average loss. For the second term to equal <span class="math inline">\(0\)</span>, <span class="math inline">\(\theta = \bar{y}\)</span>, or in other words, <span class="math inline">\(\hat{\theta} = \bar{y} = mean(y)\)</span>.</p>
<section id="note" class="level5" data-number="11.8.0.0.1">
<h5 data-number="11.8.0.0.1" class="anchored" data-anchor-id="note"><span class="header-section-number">11.8.0.0.1</span> Note</h5>
<p>In the derivation above, we decompose the expected loss, <span class="math inline">\(R(\theta)\)</span>, into two key components: the variance of the data, <span class="math inline">\(\sigma_y^2\)</span>, and the square of the bias, <span class="math inline">\((\bar{y} - \theta)^2\)</span>. This decomposition is insightful for understanding the behavior of estimators in statistical models.</p>
<ul>
<li><p><strong>Variance, <span class="math inline">\(\sigma_y^2\)</span></strong>: This term represents the spread of the data points around their mean, <span class="math inline">\(\bar{y}\)</span>, and is a measure of the data’s inherent variability. Importantly, it does not depend on the choice of <span class="math inline">\(\theta\)</span>, meaning it’s a fixed property of the data. Variance serves as an indicator of the data’s dispersion and is crucial in understanding the dataset’s structure, but it remains constant regardless of how we adjust our model parameter <span class="math inline">\(\theta\)</span>.</p></li>
<li><p><strong>Bias Squared, <span class="math inline">\((\bar{y} - \theta)^2\)</span></strong>: This term captures the bias of the estimator, defined as the square of the difference between the mean of the data points, <span class="math inline">\(\bar{y}\)</span>, and the parameter <span class="math inline">\(\theta\)</span>. The bias quantifies the systematic error introduced when estimating <span class="math inline">\(\theta\)</span>. Minimizing this term is essential for improving the accuracy of the estimator. When <span class="math inline">\(\theta = \bar{y}\)</span>, the bias is <span class="math inline">\(0\)</span>, indicating that the estimator is unbiased for the parameter it estimates. This highlights a critical principle in statistical estimation: choosing <span class="math inline">\(\theta\)</span> to be the sample mean, <span class="math inline">\(\bar{y}\)</span>, minimizes the average loss, rendering the estimator both efficient and unbiased for the population mean.</p></li>
</ul>


<!-- -->

</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation column-body">
  <div class="nav-page nav-page-previous">
      <a href="../intro_to_modeling/intro_to_modeling.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Introduction to Modeling</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="../ols/ols.html" class="pagination-link">
        <span class="nav-page-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Ordinary Least Squares</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb29" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a><span class="an">title:</span><span class="co"> 'Constant Model, Loss, and Transformations'</span></span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a><span class="an">execute:</span></span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a><span class="co">  echo: true</span></span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a><span class="an">format:</span></span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a><span class="co">  html:</span></span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a><span class="co">    code-fold: true</span></span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a><span class="co">    code-tools: true</span></span>
<span id="cb29-9"><a href="#cb29-9" aria-hidden="true" tabindex="-1"></a><span class="co">    toc: true</span></span>
<span id="cb29-10"><a href="#cb29-10" aria-hidden="true" tabindex="-1"></a><span class="co">    toc-title: 'Constant Model, Loss, and Transformations'</span></span>
<span id="cb29-11"><a href="#cb29-11" aria-hidden="true" tabindex="-1"></a><span class="co">    page-layout: full</span></span>
<span id="cb29-12"><a href="#cb29-12" aria-hidden="true" tabindex="-1"></a><span class="co">    theme:</span></span>
<span id="cb29-13"><a href="#cb29-13" aria-hidden="true" tabindex="-1"></a><span class="co">      - cosmo</span></span>
<span id="cb29-14"><a href="#cb29-14" aria-hidden="true" tabindex="-1"></a><span class="co">      - cerulean</span></span>
<span id="cb29-15"><a href="#cb29-15" aria-hidden="true" tabindex="-1"></a><span class="co">    callout-icon: false</span></span>
<span id="cb29-16"><a href="#cb29-16" aria-hidden="true" tabindex="-1"></a><span class="an">jupyter:</span></span>
<span id="cb29-17"><a href="#cb29-17" aria-hidden="true" tabindex="-1"></a><span class="co">  jupytext:</span></span>
<span id="cb29-18"><a href="#cb29-18" aria-hidden="true" tabindex="-1"></a><span class="co">    text_representation:</span></span>
<span id="cb29-19"><a href="#cb29-19" aria-hidden="true" tabindex="-1"></a><span class="co">      extension: .qmd</span></span>
<span id="cb29-20"><a href="#cb29-20" aria-hidden="true" tabindex="-1"></a><span class="co">      format_name: quarto</span></span>
<span id="cb29-21"><a href="#cb29-21" aria-hidden="true" tabindex="-1"></a><span class="co">      format_version: '1.0'</span></span>
<span id="cb29-22"><a href="#cb29-22" aria-hidden="true" tabindex="-1"></a><span class="co">      jupytext_version: 1.16.1</span></span>
<span id="cb29-23"><a href="#cb29-23" aria-hidden="true" tabindex="-1"></a><span class="co">  kernelspec:</span></span>
<span id="cb29-24"><a href="#cb29-24" aria-hidden="true" tabindex="-1"></a><span class="co">    display_name: Python 3 (ipykernel)</span></span>
<span id="cb29-25"><a href="#cb29-25" aria-hidden="true" tabindex="-1"></a><span class="co">    language: python</span></span>
<span id="cb29-26"><a href="#cb29-26" aria-hidden="true" tabindex="-1"></a><span class="co">    name: python3</span></span>
<span id="cb29-27"><a href="#cb29-27" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb29-28"><a href="#cb29-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-29"><a href="#cb29-29" aria-hidden="true" tabindex="-1"></a>::: {.callout-note collapse="false"}</span>
<span id="cb29-30"><a href="#cb29-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-31"><a href="#cb29-31" aria-hidden="true" tabindex="-1"></a><span class="fu">## Learning Outcomes</span></span>
<span id="cb29-32"><a href="#cb29-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-33"><a href="#cb29-33" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Derive the optimal model parameters for the constant model under MSE and MAE cost functions.</span>
<span id="cb29-34"><a href="#cb29-34" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Evaluate the differences between MSE and MAE risk.</span>
<span id="cb29-35"><a href="#cb29-35" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Understand the need for linearization of variables and apply the Tukey-Mosteller bulge diagram for transformations.</span>
<span id="cb29-36"><a href="#cb29-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-37"><a href="#cb29-37" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb29-38"><a href="#cb29-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-39"><a href="#cb29-39" aria-hidden="true" tabindex="-1"></a>Last time, we introduced the modeling process. We set up a framework to predict target variables as functions of our features, following a set workflow:</span>
<span id="cb29-40"><a href="#cb29-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-41"><a href="#cb29-41" aria-hidden="true" tabindex="-1"></a><span class="ss">1. </span>Choose a model - how should we represent the world?</span>
<span id="cb29-42"><a href="#cb29-42" aria-hidden="true" tabindex="-1"></a><span class="ss">2. </span>Choose a loss function - how do we quantify prediction error?</span>
<span id="cb29-43"><a href="#cb29-43" aria-hidden="true" tabindex="-1"></a><span class="ss">3. </span>Fit the model - how do we choose the best parameter of our model given our data?</span>
<span id="cb29-44"><a href="#cb29-44" aria-hidden="true" tabindex="-1"></a><span class="ss">4. </span>Evaluate model performance - how do we evaluate whether this process gave rise to a good model?</span>
<span id="cb29-45"><a href="#cb29-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-46"><a href="#cb29-46" aria-hidden="true" tabindex="-1"></a>To illustrate this process, we derived the optimal model parameters under simple linear regression (SLR) with mean squared error (MSE) as the cost function. A summary of the SLR modeling process is shown below:</span>
<span id="cb29-47"><a href="#cb29-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-48"><a href="#cb29-48" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;div</span> <span class="er">align</span><span class="ot">=</span><span class="st">"middle"</span><span class="kw">&gt;</span></span>
<span id="cb29-49"><a href="#cb29-49" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;img</span> <span class="er">src</span><span class="ot">=</span><span class="st">"images/slr_modeling.png"</span> <span class="er">alt</span><span class="ot">=</span><span class="st">'modeling'</span> <span class="er">width</span><span class="ot">=</span><span class="st">'600'</span><span class="kw">&gt;</span></span>
<span id="cb29-50"><a href="#cb29-50" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;/div&gt;</span></span>
<span id="cb29-51"><a href="#cb29-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-52"><a href="#cb29-52" aria-hidden="true" tabindex="-1"></a>In this lecture, we'll dive deeper into step 4 - evaluating model performance - using SLR as an example. Additionally, we'll also explore the modeling process with new models, continue familiarizing ourselves with the modeling process by finding the best model parameters under a new model, the constant model, and test out two different loss functions to understand how our choice of loss influences model design. Later on, we'll consider what happens when a linear model isn't the best choice to capture trends in our data and what solutions there are to create better models.</span>
<span id="cb29-53"><a href="#cb29-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-54"><a href="#cb29-54" aria-hidden="true" tabindex="-1"></a>Before we get into Step 4, let's quickly review some important terminology.</span>
<span id="cb29-55"><a href="#cb29-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-56"><a href="#cb29-56" aria-hidden="true" tabindex="-1"></a><span class="fu">### Prediction vs. Estimation</span></span>
<span id="cb29-57"><a href="#cb29-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-58"><a href="#cb29-58" aria-hidden="true" tabindex="-1"></a>The terms prediction and estimation are often used somewhat interchangeably, but there is a subtle difference between them. **Estimation** is the task of using data to calculate model parameters. **Prediction** is the task of using a model to predict outputs for unseen data. In our simple linear regression model,</span>
<span id="cb29-59"><a href="#cb29-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-60"><a href="#cb29-60" aria-hidden="true" tabindex="-1"></a>$$\hat{y} = \hat{\theta_0} + \hat{\theta_1}$$</span>
<span id="cb29-61"><a href="#cb29-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-62"><a href="#cb29-62" aria-hidden="true" tabindex="-1"></a>we **estimate** the parameters by minimizing average loss; then, we **predict** using these estimations. **Least Squares Estimation** is when we choose the parameters that minimize MSE.</span>
<span id="cb29-63"><a href="#cb29-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-64"><a href="#cb29-64" aria-hidden="true" tabindex="-1"></a><span class="fu">## Step 4: Evaluating the SLR Model</span></span>
<span id="cb29-65"><a href="#cb29-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-66"><a href="#cb29-66" aria-hidden="true" tabindex="-1"></a>Now that we've explored the mathematics behind (1) choosing a model, (2) choosing a loss function, and (3) fitting the model, we're left with one final question – how "good" are the predictions made by this "best" fitted model? To determine this, we can:</span>
<span id="cb29-67"><a href="#cb29-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-68"><a href="#cb29-68" aria-hidden="true" tabindex="-1"></a><span class="ss">1. </span>Visualize data and compute statistics:</span>
<span id="cb29-69"><a href="#cb29-69" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>Plot the original data.</span>
<span id="cb29-70"><a href="#cb29-70" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>Compute each column's mean and standard deviation. If the mean and standard deviation of our predictions are close to those of the original observed $y_i$'s, we might be inclined to say that our model has done well.</span>
<span id="cb29-71"><a href="#cb29-71" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>(If we're fitting a linear model) Compute the correlation $r$. A large magnitude for the correlation coefficient between the feature and response variables could also indicate that our model has done well.    </span>
<span id="cb29-72"><a href="#cb29-72" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-73"><a href="#cb29-73" aria-hidden="true" tabindex="-1"></a><span class="ss">2. </span>Performance metrics:</span>
<span id="cb29-74"><a href="#cb29-74" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-75"><a href="#cb29-75" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>We can take the **Root Mean Squared Error (RMSE)**.</span>
<span id="cb29-76"><a href="#cb29-76" aria-hidden="true" tabindex="-1"></a><span class="ss">     - </span>It's the square root of the mean squared error (MSE), which is the average loss that we've been minimizing to determine optimal model parameters.</span>
<span id="cb29-77"><a href="#cb29-77" aria-hidden="true" tabindex="-1"></a><span class="ss">     - </span>RMSE is in the same units as $y$.</span>
<span id="cb29-78"><a href="#cb29-78" aria-hidden="true" tabindex="-1"></a><span class="ss">     - </span>A lower RMSE indicates more "accurate" predictions, as we have a lower "average loss" across the data.</span>
<span id="cb29-79"><a href="#cb29-79" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-80"><a href="#cb29-80" aria-hidden="true" tabindex="-1"></a>   $$\text{RMSE} = \sqrt{\frac{1}{n} \sum_{i=1}^n (y_i - \hat{y}_i)^2}$$</span>
<span id="cb29-81"><a href="#cb29-81" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-82"><a href="#cb29-82" aria-hidden="true" tabindex="-1"></a><span class="ss">3. </span>Visualization:</span>
<span id="cb29-83"><a href="#cb29-83" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>Look at the residual plot of $e_i = y_i - \hat{y_i}$ to visualize the difference between actual and predicted values. The good residual plot should not show any pattern between input/features $x_i$ and residual values $e_i$.</span>
<span id="cb29-84"><a href="#cb29-84" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-85"><a href="#cb29-85" aria-hidden="true" tabindex="-1"></a>To illustrate this process, let's take a look at **Anscombe's quartet**.</span>
<span id="cb29-86"><a href="#cb29-86" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-87"><a href="#cb29-87" aria-hidden="true" tabindex="-1"></a><span class="fu">### Four Mysterious Datasets (Anscombe’s quartet)</span></span>
<span id="cb29-88"><a href="#cb29-88" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-89"><a href="#cb29-89" aria-hidden="true" tabindex="-1"></a>Let's take a look at four different datasets.</span>
<span id="cb29-90"><a href="#cb29-90" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-93"><a href="#cb29-93" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb29-94"><a href="#cb29-94" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: true</span></span>
<span id="cb29-95"><a href="#cb29-95" aria-hidden="true" tabindex="-1"></a><span class="co">#| vscode: {languageId: python}</span></span>
<span id="cb29-96"><a href="#cb29-96" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb29-97"><a href="#cb29-97" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb29-98"><a href="#cb29-98" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb29-99"><a href="#cb29-99" aria-hidden="true" tabindex="-1"></a><span class="op">%</span>matplotlib inline</span>
<span id="cb29-100"><a href="#cb29-100" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> seaborn <span class="im">as</span> sns</span>
<span id="cb29-101"><a href="#cb29-101" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> itertools</span>
<span id="cb29-102"><a href="#cb29-102" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> mpl_toolkits.mplot3d <span class="im">import</span> Axes3D</span>
<span id="cb29-103"><a href="#cb29-103" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb29-104"><a href="#cb29-104" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-107"><a href="#cb29-107" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb29-108"><a href="#cb29-108" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: true</span></span>
<span id="cb29-109"><a href="#cb29-109" aria-hidden="true" tabindex="-1"></a><span class="co">#| vscode: {languageId: python}</span></span>
<span id="cb29-110"><a href="#cb29-110" aria-hidden="true" tabindex="-1"></a><span class="co"># Big font helper</span></span>
<span id="cb29-111"><a href="#cb29-111" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> adjust_fontsize(size<span class="op">=</span><span class="va">None</span>):</span>
<span id="cb29-112"><a href="#cb29-112" aria-hidden="true" tabindex="-1"></a>    SMALL_SIZE <span class="op">=</span> <span class="dv">8</span></span>
<span id="cb29-113"><a href="#cb29-113" aria-hidden="true" tabindex="-1"></a>    MEDIUM_SIZE <span class="op">=</span> <span class="dv">10</span></span>
<span id="cb29-114"><a href="#cb29-114" aria-hidden="true" tabindex="-1"></a>    BIGGER_SIZE <span class="op">=</span> <span class="dv">12</span></span>
<span id="cb29-115"><a href="#cb29-115" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> size <span class="op">!=</span> <span class="va">None</span>:</span>
<span id="cb29-116"><a href="#cb29-116" aria-hidden="true" tabindex="-1"></a>        SMALL_SIZE <span class="op">=</span> MEDIUM_SIZE <span class="op">=</span> BIGGER_SIZE <span class="op">=</span> size</span>
<span id="cb29-117"><a href="#cb29-117" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-118"><a href="#cb29-118" aria-hidden="true" tabindex="-1"></a>    plt.rc(<span class="st">"font"</span>, size<span class="op">=</span>SMALL_SIZE)  <span class="co"># controls default text sizes</span></span>
<span id="cb29-119"><a href="#cb29-119" aria-hidden="true" tabindex="-1"></a>    plt.rc(<span class="st">"axes"</span>, titlesize<span class="op">=</span>SMALL_SIZE)  <span class="co"># fontsize of the axes title</span></span>
<span id="cb29-120"><a href="#cb29-120" aria-hidden="true" tabindex="-1"></a>    plt.rc(<span class="st">"axes"</span>, labelsize<span class="op">=</span>MEDIUM_SIZE)  <span class="co"># fontsize of the x and y labels</span></span>
<span id="cb29-121"><a href="#cb29-121" aria-hidden="true" tabindex="-1"></a>    plt.rc(<span class="st">"xtick"</span>, labelsize<span class="op">=</span>SMALL_SIZE)  <span class="co"># fontsize of the tick labels</span></span>
<span id="cb29-122"><a href="#cb29-122" aria-hidden="true" tabindex="-1"></a>    plt.rc(<span class="st">"ytick"</span>, labelsize<span class="op">=</span>SMALL_SIZE)  <span class="co"># fontsize of the tick labels</span></span>
<span id="cb29-123"><a href="#cb29-123" aria-hidden="true" tabindex="-1"></a>    plt.rc(<span class="st">"legend"</span>, fontsize<span class="op">=</span>SMALL_SIZE)  <span class="co"># legend fontsize</span></span>
<span id="cb29-124"><a href="#cb29-124" aria-hidden="true" tabindex="-1"></a>    plt.rc(<span class="st">"figure"</span>, titlesize<span class="op">=</span>BIGGER_SIZE)  <span class="co"># fontsize of the figure title</span></span>
<span id="cb29-125"><a href="#cb29-125" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-126"><a href="#cb29-126" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-127"><a href="#cb29-127" aria-hidden="true" tabindex="-1"></a><span class="co"># Helper functions</span></span>
<span id="cb29-128"><a href="#cb29-128" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> standard_units(x):</span>
<span id="cb29-129"><a href="#cb29-129" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> (x <span class="op">-</span> np.mean(x)) <span class="op">/</span> np.std(x)</span>
<span id="cb29-130"><a href="#cb29-130" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-131"><a href="#cb29-131" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-132"><a href="#cb29-132" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> correlation(x, y):</span>
<span id="cb29-133"><a href="#cb29-133" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> np.mean(standard_units(x) <span class="op">*</span> standard_units(y))</span>
<span id="cb29-134"><a href="#cb29-134" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-135"><a href="#cb29-135" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-136"><a href="#cb29-136" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> slope(x, y):</span>
<span id="cb29-137"><a href="#cb29-137" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> correlation(x, y) <span class="op">*</span> np.std(y) <span class="op">/</span> np.std(x)</span>
<span id="cb29-138"><a href="#cb29-138" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-139"><a href="#cb29-139" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-140"><a href="#cb29-140" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> intercept(x, y):</span>
<span id="cb29-141"><a href="#cb29-141" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> np.mean(y) <span class="op">-</span> slope(x, y) <span class="op">*</span> np.mean(x)</span>
<span id="cb29-142"><a href="#cb29-142" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-143"><a href="#cb29-143" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-144"><a href="#cb29-144" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> fit_least_squares(x, y):</span>
<span id="cb29-145"><a href="#cb29-145" aria-hidden="true" tabindex="-1"></a>    theta_0 <span class="op">=</span> intercept(x, y)</span>
<span id="cb29-146"><a href="#cb29-146" aria-hidden="true" tabindex="-1"></a>    theta_1 <span class="op">=</span> slope(x, y)</span>
<span id="cb29-147"><a href="#cb29-147" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> theta_0, theta_1</span>
<span id="cb29-148"><a href="#cb29-148" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-149"><a href="#cb29-149" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-150"><a href="#cb29-150" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> predict(x, theta_0, theta_1):</span>
<span id="cb29-151"><a href="#cb29-151" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> theta_0 <span class="op">+</span> theta_1 <span class="op">*</span> x</span>
<span id="cb29-152"><a href="#cb29-152" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-153"><a href="#cb29-153" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-154"><a href="#cb29-154" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> compute_mse(y, yhat):</span>
<span id="cb29-155"><a href="#cb29-155" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> np.mean((y <span class="op">-</span> yhat) <span class="op">**</span> <span class="dv">2</span>)</span>
<span id="cb29-156"><a href="#cb29-156" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-157"><a href="#cb29-157" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-158"><a href="#cb29-158" aria-hidden="true" tabindex="-1"></a>plt.style.use(<span class="st">"default"</span>)  <span class="co"># Revert style to default mpl</span></span>
<span id="cb29-159"><a href="#cb29-159" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb29-160"><a href="#cb29-160" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-163"><a href="#cb29-163" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb29-164"><a href="#cb29-164" aria-hidden="true" tabindex="-1"></a><span class="co">#| vscode: {languageId: python}</span></span>
<span id="cb29-165"><a href="#cb29-165" aria-hidden="true" tabindex="-1"></a>plt.style.use(<span class="st">"default"</span>)  <span class="co"># Revert style to default mpl</span></span>
<span id="cb29-166"><a href="#cb29-166" aria-hidden="true" tabindex="-1"></a>NO_VIZ, RESID, RESID_SCATTER <span class="op">=</span> <span class="bu">range</span>(<span class="dv">3</span>)</span>
<span id="cb29-167"><a href="#cb29-167" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-168"><a href="#cb29-168" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-169"><a href="#cb29-169" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> least_squares_evaluation(x, y, visualize<span class="op">=</span>NO_VIZ):</span>
<span id="cb29-170"><a href="#cb29-170" aria-hidden="true" tabindex="-1"></a>    <span class="co"># statistics</span></span>
<span id="cb29-171"><a href="#cb29-171" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"x_mean : </span><span class="sc">{</span>np<span class="sc">.</span>mean(x)<span class="sc">:.2f}</span><span class="ss">, y_mean : </span><span class="sc">{</span>np<span class="sc">.</span>mean(y)<span class="sc">:.2f}</span><span class="ss">"</span>)</span>
<span id="cb29-172"><a href="#cb29-172" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"x_stdev: </span><span class="sc">{</span>np<span class="sc">.</span>std(x)<span class="sc">:.2f}</span><span class="ss">, y_stdev: </span><span class="sc">{</span>np<span class="sc">.</span>std(y)<span class="sc">:.2f}</span><span class="ss">"</span>)</span>
<span id="cb29-173"><a href="#cb29-173" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"r = Correlation(x, y): </span><span class="sc">{</span>correlation(x, y)<span class="sc">:.3f}</span><span class="ss">"</span>)</span>
<span id="cb29-174"><a href="#cb29-174" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-175"><a href="#cb29-175" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Performance metrics</span></span>
<span id="cb29-176"><a href="#cb29-176" aria-hidden="true" tabindex="-1"></a>    ahat, bhat <span class="op">=</span> fit_least_squares(x, y)</span>
<span id="cb29-177"><a href="#cb29-177" aria-hidden="true" tabindex="-1"></a>    yhat <span class="op">=</span> predict(x, ahat, bhat)</span>
<span id="cb29-178"><a href="#cb29-178" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\t</span><span class="ss">heta_0: </span><span class="sc">{</span>ahat<span class="sc">:.2f}</span><span class="ss">, </span><span class="ch">\t</span><span class="ss">heta_1: </span><span class="sc">{</span>bhat<span class="sc">:.2f}</span><span class="ss">"</span>)</span>
<span id="cb29-179"><a href="#cb29-179" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"RMSE: </span><span class="sc">{</span>np<span class="sc">.</span>sqrt(compute_mse(y, yhat))<span class="sc">:.3f}</span><span class="ss">"</span>)</span>
<span id="cb29-180"><a href="#cb29-180" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-181"><a href="#cb29-181" aria-hidden="true" tabindex="-1"></a>    <span class="co"># visualization</span></span>
<span id="cb29-182"><a href="#cb29-182" aria-hidden="true" tabindex="-1"></a>    fig, ax_resid <span class="op">=</span> <span class="va">None</span>, <span class="va">None</span></span>
<span id="cb29-183"><a href="#cb29-183" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> visualize <span class="op">==</span> RESID_SCATTER:</span>
<span id="cb29-184"><a href="#cb29-184" aria-hidden="true" tabindex="-1"></a>        fig, axs <span class="op">=</span> plt.subplots(<span class="dv">1</span>, <span class="dv">2</span>, figsize<span class="op">=</span>(<span class="dv">8</span>, <span class="dv">3</span>))</span>
<span id="cb29-185"><a href="#cb29-185" aria-hidden="true" tabindex="-1"></a>        axs[<span class="dv">0</span>].scatter(x, y)</span>
<span id="cb29-186"><a href="#cb29-186" aria-hidden="true" tabindex="-1"></a>        axs[<span class="dv">0</span>].plot(x, yhat)</span>
<span id="cb29-187"><a href="#cb29-187" aria-hidden="true" tabindex="-1"></a>        axs[<span class="dv">0</span>].set_title(<span class="st">"LS fit"</span>)</span>
<span id="cb29-188"><a href="#cb29-188" aria-hidden="true" tabindex="-1"></a>        ax_resid <span class="op">=</span> axs[<span class="dv">1</span>]</span>
<span id="cb29-189"><a href="#cb29-189" aria-hidden="true" tabindex="-1"></a>    <span class="cf">elif</span> visualize <span class="op">==</span> RESID:</span>
<span id="cb29-190"><a href="#cb29-190" aria-hidden="true" tabindex="-1"></a>        fig <span class="op">=</span> plt.figure(figsize<span class="op">=</span>(<span class="dv">4</span>, <span class="dv">3</span>))</span>
<span id="cb29-191"><a href="#cb29-191" aria-hidden="true" tabindex="-1"></a>        ax_resid <span class="op">=</span> plt.gca()</span>
<span id="cb29-192"><a href="#cb29-192" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-193"><a href="#cb29-193" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> ax_resid <span class="kw">is</span> <span class="kw">not</span> <span class="va">None</span>:</span>
<span id="cb29-194"><a href="#cb29-194" aria-hidden="true" tabindex="-1"></a>        ax_resid.scatter(x, y <span class="op">-</span> yhat, color<span class="op">=</span><span class="st">"red"</span>)</span>
<span id="cb29-195"><a href="#cb29-195" aria-hidden="true" tabindex="-1"></a>        ax_resid.plot([<span class="dv">4</span>, <span class="dv">14</span>], [<span class="dv">0</span>, <span class="dv">0</span>], color<span class="op">=</span><span class="st">"black"</span>)</span>
<span id="cb29-196"><a href="#cb29-196" aria-hidden="true" tabindex="-1"></a>        ax_resid.set_title(<span class="st">"Residuals"</span>)</span>
<span id="cb29-197"><a href="#cb29-197" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-198"><a href="#cb29-198" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> fig</span>
<span id="cb29-199"><a href="#cb29-199" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb29-200"><a href="#cb29-200" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-203"><a href="#cb29-203" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb29-204"><a href="#cb29-204" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: true</span></span>
<span id="cb29-205"><a href="#cb29-205" aria-hidden="true" tabindex="-1"></a><span class="co">#| vscode: {languageId: python}</span></span>
<span id="cb29-206"><a href="#cb29-206" aria-hidden="true" tabindex="-1"></a><span class="co"># Load in four different datasets: I, II, III, IV</span></span>
<span id="cb29-207"><a href="#cb29-207" aria-hidden="true" tabindex="-1"></a>x <span class="op">=</span> [<span class="dv">10</span>, <span class="dv">8</span>, <span class="dv">13</span>, <span class="dv">9</span>, <span class="dv">11</span>, <span class="dv">14</span>, <span class="dv">6</span>, <span class="dv">4</span>, <span class="dv">12</span>, <span class="dv">7</span>, <span class="dv">5</span>]</span>
<span id="cb29-208"><a href="#cb29-208" aria-hidden="true" tabindex="-1"></a>y1 <span class="op">=</span> [<span class="fl">8.04</span>, <span class="fl">6.95</span>, <span class="fl">7.58</span>, <span class="fl">8.81</span>, <span class="fl">8.33</span>, <span class="fl">9.96</span>, <span class="fl">7.24</span>, <span class="fl">4.26</span>, <span class="fl">10.84</span>, <span class="fl">4.82</span>, <span class="fl">5.68</span>]</span>
<span id="cb29-209"><a href="#cb29-209" aria-hidden="true" tabindex="-1"></a>y2 <span class="op">=</span> [<span class="fl">9.14</span>, <span class="fl">8.14</span>, <span class="fl">8.74</span>, <span class="fl">8.77</span>, <span class="fl">9.26</span>, <span class="fl">8.10</span>, <span class="fl">6.13</span>, <span class="fl">3.10</span>, <span class="fl">9.13</span>, <span class="fl">7.26</span>, <span class="fl">4.74</span>]</span>
<span id="cb29-210"><a href="#cb29-210" aria-hidden="true" tabindex="-1"></a>y3 <span class="op">=</span> [<span class="fl">7.46</span>, <span class="fl">6.77</span>, <span class="fl">12.74</span>, <span class="fl">7.11</span>, <span class="fl">7.81</span>, <span class="fl">8.84</span>, <span class="fl">6.08</span>, <span class="fl">5.39</span>, <span class="fl">8.15</span>, <span class="fl">6.42</span>, <span class="fl">5.73</span>]</span>
<span id="cb29-211"><a href="#cb29-211" aria-hidden="true" tabindex="-1"></a>x4 <span class="op">=</span> [<span class="dv">8</span>, <span class="dv">8</span>, <span class="dv">8</span>, <span class="dv">8</span>, <span class="dv">8</span>, <span class="dv">8</span>, <span class="dv">8</span>, <span class="dv">19</span>, <span class="dv">8</span>, <span class="dv">8</span>, <span class="dv">8</span>]</span>
<span id="cb29-212"><a href="#cb29-212" aria-hidden="true" tabindex="-1"></a>y4 <span class="op">=</span> [<span class="fl">6.58</span>, <span class="fl">5.76</span>, <span class="fl">7.71</span>, <span class="fl">8.84</span>, <span class="fl">8.47</span>, <span class="fl">7.04</span>, <span class="fl">5.25</span>, <span class="fl">12.50</span>, <span class="fl">5.56</span>, <span class="fl">7.91</span>, <span class="fl">6.89</span>]</span>
<span id="cb29-213"><a href="#cb29-213" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-214"><a href="#cb29-214" aria-hidden="true" tabindex="-1"></a>anscombe <span class="op">=</span> {</span>
<span id="cb29-215"><a href="#cb29-215" aria-hidden="true" tabindex="-1"></a>    <span class="st">"I"</span>: pd.DataFrame(<span class="bu">list</span>(<span class="bu">zip</span>(x, y1)), columns<span class="op">=</span>[<span class="st">"x"</span>, <span class="st">"y"</span>]),</span>
<span id="cb29-216"><a href="#cb29-216" aria-hidden="true" tabindex="-1"></a>    <span class="st">"II"</span>: pd.DataFrame(<span class="bu">list</span>(<span class="bu">zip</span>(x, y2)), columns<span class="op">=</span>[<span class="st">"x"</span>, <span class="st">"y"</span>]),</span>
<span id="cb29-217"><a href="#cb29-217" aria-hidden="true" tabindex="-1"></a>    <span class="st">"III"</span>: pd.DataFrame(<span class="bu">list</span>(<span class="bu">zip</span>(x, y3)), columns<span class="op">=</span>[<span class="st">"x"</span>, <span class="st">"y"</span>]),</span>
<span id="cb29-218"><a href="#cb29-218" aria-hidden="true" tabindex="-1"></a>    <span class="st">"IV"</span>: pd.DataFrame(<span class="bu">list</span>(<span class="bu">zip</span>(x4, y4)), columns<span class="op">=</span>[<span class="st">"x"</span>, <span class="st">"y"</span>]),</span>
<span id="cb29-219"><a href="#cb29-219" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb29-220"><a href="#cb29-220" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-221"><a href="#cb29-221" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot the scatter plot and line of best fit</span></span>
<span id="cb29-222"><a href="#cb29-222" aria-hidden="true" tabindex="-1"></a>fig, axs <span class="op">=</span> plt.subplots(<span class="dv">2</span>, <span class="dv">2</span>, figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">10</span>))</span>
<span id="cb29-223"><a href="#cb29-223" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-224"><a href="#cb29-224" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i, dataset <span class="kw">in</span> <span class="bu">enumerate</span>([<span class="st">"I"</span>, <span class="st">"II"</span>, <span class="st">"III"</span>, <span class="st">"IV"</span>]):</span>
<span id="cb29-225"><a href="#cb29-225" aria-hidden="true" tabindex="-1"></a>    ans <span class="op">=</span> anscombe[dataset]</span>
<span id="cb29-226"><a href="#cb29-226" aria-hidden="true" tabindex="-1"></a>    x, y <span class="op">=</span> ans[<span class="st">"x"</span>], ans[<span class="st">"y"</span>]</span>
<span id="cb29-227"><a href="#cb29-227" aria-hidden="true" tabindex="-1"></a>    ahat, bhat <span class="op">=</span> fit_least_squares(x, y)</span>
<span id="cb29-228"><a href="#cb29-228" aria-hidden="true" tabindex="-1"></a>    yhat <span class="op">=</span> predict(x, ahat, bhat)</span>
<span id="cb29-229"><a href="#cb29-229" aria-hidden="true" tabindex="-1"></a>    axs[i <span class="op">//</span> <span class="dv">2</span>, i <span class="op">%</span> <span class="dv">2</span>].scatter(x, y, alpha<span class="op">=</span><span class="fl">0.6</span>, color<span class="op">=</span><span class="st">"red"</span>)  <span class="co"># plot the x, y points</span></span>
<span id="cb29-230"><a href="#cb29-230" aria-hidden="true" tabindex="-1"></a>    axs[i <span class="op">//</span> <span class="dv">2</span>, i <span class="op">%</span> <span class="dv">2</span>].plot(x, yhat)  <span class="co"># plot the line of best fit</span></span>
<span id="cb29-231"><a href="#cb29-231" aria-hidden="true" tabindex="-1"></a>    axs[i <span class="op">//</span> <span class="dv">2</span>, i <span class="op">%</span> <span class="dv">2</span>].set_xlabel(<span class="ss">f"$x_</span><span class="sc">{</span>i<span class="op">+</span><span class="dv">1</span><span class="sc">}</span><span class="ss">$"</span>)</span>
<span id="cb29-232"><a href="#cb29-232" aria-hidden="true" tabindex="-1"></a>    axs[i <span class="op">//</span> <span class="dv">2</span>, i <span class="op">%</span> <span class="dv">2</span>].set_ylabel(<span class="ss">f"$y_</span><span class="sc">{</span>i<span class="op">+</span><span class="dv">1</span><span class="sc">}</span><span class="ss">$"</span>)</span>
<span id="cb29-233"><a href="#cb29-233" aria-hidden="true" tabindex="-1"></a>    axs[i <span class="op">//</span> <span class="dv">2</span>, i <span class="op">%</span> <span class="dv">2</span>].set_title(<span class="ss">f"Dataset </span><span class="sc">{</span>dataset<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb29-234"><a href="#cb29-234" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-235"><a href="#cb29-235" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb29-236"><a href="#cb29-236" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb29-237"><a href="#cb29-237" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-238"><a href="#cb29-238" aria-hidden="true" tabindex="-1"></a>While these four sets of datapoints look very different, they actually all have identical means $\bar x$, $\bar y$, standard deviations $\sigma_x$, $\sigma_y$, correlation $r$, and RMSE! If we only look at these statistics, we would probably be inclined to say that these datasets are similar.</span>
<span id="cb29-239"><a href="#cb29-239" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-242"><a href="#cb29-242" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb29-243"><a href="#cb29-243" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: true</span></span>
<span id="cb29-244"><a href="#cb29-244" aria-hidden="true" tabindex="-1"></a><span class="co">#| vscode: {languageId: python}</span></span>
<span id="cb29-245"><a href="#cb29-245" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> dataset <span class="kw">in</span> [<span class="st">"I"</span>, <span class="st">"II"</span>, <span class="st">"III"</span>, <span class="st">"IV"</span>]:</span>
<span id="cb29-246"><a href="#cb29-246" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"&gt;&gt;&gt; Dataset </span><span class="sc">{</span>dataset<span class="sc">}</span><span class="ss">:"</span>)</span>
<span id="cb29-247"><a href="#cb29-247" aria-hidden="true" tabindex="-1"></a>    ans <span class="op">=</span> anscombe[dataset]</span>
<span id="cb29-248"><a href="#cb29-248" aria-hidden="true" tabindex="-1"></a>    fig <span class="op">=</span> least_squares_evaluation(ans[<span class="st">"x"</span>], ans[<span class="st">"y"</span>], visualize<span class="op">=</span>NO_VIZ)</span>
<span id="cb29-249"><a href="#cb29-249" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>()</span>
<span id="cb29-250"><a href="#cb29-250" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>()</span>
<span id="cb29-251"><a href="#cb29-251" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb29-252"><a href="#cb29-252" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-253"><a href="#cb29-253" aria-hidden="true" tabindex="-1"></a>We may also wish to visualize the model's **residuals**, defined as the difference between the observed and predicted $y_i$ value ($e_i = y_i - \hat{y}_i$). This gives a high-level view of how "off" each prediction is from the true observed value. Recall that you explored this concept in <span class="co">[</span><span class="ot">Data 8</span><span class="co">](https://inferentialthinking.com/chapters/15/5/Visual_Diagnostics.html?highlight=heteroscedasticity#detecting-heteroscedasticity)</span>: a good regression fit should display no clear pattern in its plot of residuals. The residual plots for Anscombe's quartet are displayed below. Note how only the first plot shows no clear pattern to the magnitude of residuals. This is an indication that SLR is not the best choice of model for the remaining three sets of points.</span>
<span id="cb29-254"><a href="#cb29-254" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-255"><a href="#cb29-255" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- &lt;img src="images/residual.png" alt='residual' width='600'&gt; --&gt;</span></span>
<span id="cb29-256"><a href="#cb29-256" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-259"><a href="#cb29-259" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb29-260"><a href="#cb29-260" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: true</span></span>
<span id="cb29-261"><a href="#cb29-261" aria-hidden="true" tabindex="-1"></a><span class="co">#| vscode: {languageId: python}</span></span>
<span id="cb29-262"><a href="#cb29-262" aria-hidden="true" tabindex="-1"></a><span class="co"># Residual visualization</span></span>
<span id="cb29-263"><a href="#cb29-263" aria-hidden="true" tabindex="-1"></a>fig, axs <span class="op">=</span> plt.subplots(<span class="dv">2</span>, <span class="dv">2</span>, figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">10</span>))</span>
<span id="cb29-264"><a href="#cb29-264" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-265"><a href="#cb29-265" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i, dataset <span class="kw">in</span> <span class="bu">enumerate</span>([<span class="st">"I"</span>, <span class="st">"II"</span>, <span class="st">"III"</span>, <span class="st">"IV"</span>]):</span>
<span id="cb29-266"><a href="#cb29-266" aria-hidden="true" tabindex="-1"></a>    ans <span class="op">=</span> anscombe[dataset]</span>
<span id="cb29-267"><a href="#cb29-267" aria-hidden="true" tabindex="-1"></a>    x, y <span class="op">=</span> ans[<span class="st">"x"</span>], ans[<span class="st">"y"</span>]</span>
<span id="cb29-268"><a href="#cb29-268" aria-hidden="true" tabindex="-1"></a>    ahat, bhat <span class="op">=</span> fit_least_squares(x, y)</span>
<span id="cb29-269"><a href="#cb29-269" aria-hidden="true" tabindex="-1"></a>    yhat <span class="op">=</span> predict(x, ahat, bhat)</span>
<span id="cb29-270"><a href="#cb29-270" aria-hidden="true" tabindex="-1"></a>    axs[i <span class="op">//</span> <span class="dv">2</span>, i <span class="op">%</span> <span class="dv">2</span>].scatter(</span>
<span id="cb29-271"><a href="#cb29-271" aria-hidden="true" tabindex="-1"></a>        x, y <span class="op">-</span> yhat, alpha<span class="op">=</span><span class="fl">0.6</span>, color<span class="op">=</span><span class="st">"red"</span></span>
<span id="cb29-272"><a href="#cb29-272" aria-hidden="true" tabindex="-1"></a>    )  <span class="co"># plot the x, y points</span></span>
<span id="cb29-273"><a href="#cb29-273" aria-hidden="true" tabindex="-1"></a>    axs[i <span class="op">//</span> <span class="dv">2</span>, i <span class="op">%</span> <span class="dv">2</span>].plot(</span>
<span id="cb29-274"><a href="#cb29-274" aria-hidden="true" tabindex="-1"></a>        x, np.zeros_like(x), color<span class="op">=</span><span class="st">"black"</span></span>
<span id="cb29-275"><a href="#cb29-275" aria-hidden="true" tabindex="-1"></a>    )  <span class="co"># plot the residual line</span></span>
<span id="cb29-276"><a href="#cb29-276" aria-hidden="true" tabindex="-1"></a>    axs[i <span class="op">//</span> <span class="dv">2</span>, i <span class="op">%</span> <span class="dv">2</span>].set_xlabel(<span class="ss">f"$x_</span><span class="sc">{</span>i<span class="op">+</span><span class="dv">1</span><span class="sc">}</span><span class="ss">$"</span>)</span>
<span id="cb29-277"><a href="#cb29-277" aria-hidden="true" tabindex="-1"></a>    axs[i <span class="op">//</span> <span class="dv">2</span>, i <span class="op">%</span> <span class="dv">2</span>].set_ylabel(<span class="ss">f"$e_</span><span class="sc">{</span>i<span class="op">+</span><span class="dv">1</span><span class="sc">}</span><span class="ss">$"</span>)</span>
<span id="cb29-278"><a href="#cb29-278" aria-hidden="true" tabindex="-1"></a>    axs[i <span class="op">//</span> <span class="dv">2</span>, i <span class="op">%</span> <span class="dv">2</span>].set_title(<span class="ss">f"Dataset </span><span class="sc">{</span>dataset<span class="sc">}</span><span class="ss"> Residuals"</span>)</span>
<span id="cb29-279"><a href="#cb29-279" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-280"><a href="#cb29-280" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb29-281"><a href="#cb29-281" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb29-282"><a href="#cb29-282" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-283"><a href="#cb29-283" aria-hidden="true" tabindex="-1"></a><span class="fu">## Constant Model + MSE</span></span>
<span id="cb29-284"><a href="#cb29-284" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-285"><a href="#cb29-285" aria-hidden="true" tabindex="-1"></a>Now, we'll shift from the SLR model to the **constant model**, also known as a summary statistic. The constant model is slightly different from the simple linear regression model we've explored previously. Rather than generating predictions from an inputted feature variable, the constant model always *predicts the same constant number*. This ignores any relationships between variables. For example, let's say we want to predict the number of drinks a boba shop sells in a day. Boba tea sales likely depend on the time of year, the weather, how the customers feel, whether school is in session, etc., but the constant model ignores these factors in favor of a simpler model. In other words, the constant model employs a **simplifying assumption**.</span>
<span id="cb29-286"><a href="#cb29-286" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-287"><a href="#cb29-287" aria-hidden="true" tabindex="-1"></a>It is also a parametric, statistical model:</span>
<span id="cb29-288"><a href="#cb29-288" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-289"><a href="#cb29-289" aria-hidden="true" tabindex="-1"></a>$$\hat{y} = \theta_0$$</span>
<span id="cb29-290"><a href="#cb29-290" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-291"><a href="#cb29-291" aria-hidden="true" tabindex="-1"></a>$\theta_0$ is the parameter of the constant model, just as $\theta_0$ and $\theta_1$ were the parameters in SLR.</span>
<span id="cb29-292"><a href="#cb29-292" aria-hidden="true" tabindex="-1"></a>Since our parameter $\theta_0$ is 1-dimensional ($\theta_0 \in \mathbb{R}$), we now have no input to our model and will always predict $\hat{y} = \theta_0$.</span>
<span id="cb29-293"><a href="#cb29-293" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-294"><a href="#cb29-294" aria-hidden="true" tabindex="-1"></a><span class="fu">### Deriving the optimal $\theta_0$</span></span>
<span id="cb29-295"><a href="#cb29-295" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-296"><a href="#cb29-296" aria-hidden="true" tabindex="-1"></a>Our task now is to determine what value of $\theta_0$ best represents the optimal model – in other words, what number should we guess each time to have the lowest possible **average loss** on our data?</span>
<span id="cb29-297"><a href="#cb29-297" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-298"><a href="#cb29-298" aria-hidden="true" tabindex="-1"></a>Like before, we'll use Mean Squared Error (MSE). Recall that the MSE is average squared loss (L2 loss) over the data $D = <span class="sc">\{</span>y_1, y_2, ..., y_n<span class="sc">\}</span>$.</span>
<span id="cb29-299"><a href="#cb29-299" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-300"><a href="#cb29-300" aria-hidden="true" tabindex="-1"></a>$$\hat{R}(\theta) = \frac{1}{n}\sum^{n}_{i=1} (y_i - \hat{y_i})^2 $$</span>
<span id="cb29-301"><a href="#cb29-301" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-302"><a href="#cb29-302" aria-hidden="true" tabindex="-1"></a>Our modeling process now looks like this:</span>
<span id="cb29-303"><a href="#cb29-303" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-304"><a href="#cb29-304" aria-hidden="true" tabindex="-1"></a><span class="ss">1. </span>Choose a model: constant model</span>
<span id="cb29-305"><a href="#cb29-305" aria-hidden="true" tabindex="-1"></a><span class="ss">2. </span>Choose a loss function: L2 loss</span>
<span id="cb29-306"><a href="#cb29-306" aria-hidden="true" tabindex="-1"></a><span class="ss">3. </span>Fit the model</span>
<span id="cb29-307"><a href="#cb29-307" aria-hidden="true" tabindex="-1"></a><span class="ss">4. </span>Evaluate model performance</span>
<span id="cb29-308"><a href="#cb29-308" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-309"><a href="#cb29-309" aria-hidden="true" tabindex="-1"></a>Given the **constant model** $\hat{y} = \theta_0$, we can rewrite the MSE equation as</span>
<span id="cb29-310"><a href="#cb29-310" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-311"><a href="#cb29-311" aria-hidden="true" tabindex="-1"></a>$$\hat{R}(\theta) = \frac{1}{n}\sum^{n}_{i=1} (y_i - \theta_0)^2 $$</span>
<span id="cb29-312"><a href="#cb29-312" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-313"><a href="#cb29-313" aria-hidden="true" tabindex="-1"></a>We can fit **the model** by finding the optimal $\hat{\theta_0}$ that minimizes the MSE using a calculus approach.</span>
<span id="cb29-314"><a href="#cb29-314" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-315"><a href="#cb29-315" aria-hidden="true" tabindex="-1"></a><span class="ss">1. </span>Differentiate with respect to $\theta_0$:</span>
<span id="cb29-316"><a href="#cb29-316" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-317"><a href="#cb29-317" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb29-318"><a href="#cb29-318" aria-hidden="true" tabindex="-1"></a>\begin{align}</span>
<span id="cb29-319"><a href="#cb29-319" aria-hidden="true" tabindex="-1"></a>\frac{d}{d\theta_0}\text{R}(\theta) &amp; = \frac{d}{d\theta_0}(\frac{1}{n}\sum^{n}_{i=1} (y_i - \theta_0)^2)</span>
<span id="cb29-320"><a href="#cb29-320" aria-hidden="true" tabindex="-1"></a><span class="sc">\\</span> &amp;= \frac{1}{n}\sum^{n}_{i=1} \frac{d}{d\theta_0}  (y_i - \theta_0)^2 \quad \quad \text{a derivative of sums is a sum of derivatives}</span>
<span id="cb29-321"><a href="#cb29-321" aria-hidden="true" tabindex="-1"></a><span class="sc">\\</span> &amp;= \frac{1}{n}\sum^{n}_{i=1} 2 (y_i - \theta_0) (-1) \quad \quad \text{chain rule}</span>
<span id="cb29-322"><a href="#cb29-322" aria-hidden="true" tabindex="-1"></a><span class="sc">\\</span> &amp;= {\frac{-2}{n}}\sum^{n}_{i=1} (y_i - \theta_0) \quad \quad \text{simply constants}</span>
<span id="cb29-323"><a href="#cb29-323" aria-hidden="true" tabindex="-1"></a>\end{align}</span>
<span id="cb29-324"><a href="#cb29-324" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb29-325"><a href="#cb29-325" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-326"><a href="#cb29-326" aria-hidden="true" tabindex="-1"></a><span class="ss">2. </span>Set the derivative equation equal to 0:</span>
<span id="cb29-327"><a href="#cb29-327" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-328"><a href="#cb29-328" aria-hidden="true" tabindex="-1"></a>   $$</span>
<span id="cb29-329"><a href="#cb29-329" aria-hidden="true" tabindex="-1"></a>   0 = {\frac{-2}{n}}\sum^{n}_{i=1} (y_i - \hat{\theta_0})</span>
<span id="cb29-330"><a href="#cb29-330" aria-hidden="true" tabindex="-1"></a>   $$</span>
<span id="cb29-331"><a href="#cb29-331" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-332"><a href="#cb29-332" aria-hidden="true" tabindex="-1"></a><span class="ss">3. </span>Solve for $\hat{\theta_0}$</span>
<span id="cb29-333"><a href="#cb29-333" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-334"><a href="#cb29-334" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb29-335"><a href="#cb29-335" aria-hidden="true" tabindex="-1"></a>\begin{align}</span>
<span id="cb29-336"><a href="#cb29-336" aria-hidden="true" tabindex="-1"></a>0 &amp;= {\frac{-2}{n}}\sum^{n}_{i=1} (y_i - \hat{\theta_0})</span>
<span id="cb29-337"><a href="#cb29-337" aria-hidden="true" tabindex="-1"></a><span class="sc">\\</span> &amp;= \sum^{n}_{i=1} (y_i - \hat{\theta_0}) \quad \quad \text{divide both sides by} \frac{-2}{n}</span>
<span id="cb29-338"><a href="#cb29-338" aria-hidden="true" tabindex="-1"></a><span class="sc">\\</span> &amp;= \left(\sum^{n}_{i=1} y_i\right) - \left(\sum^{n}_{i=1} \theta_0\right) \quad \quad \text{separate sums}</span>
<span id="cb29-339"><a href="#cb29-339" aria-hidden="true" tabindex="-1"></a><span class="sc">\\</span> &amp;= \left(\sum^{n}_{i=1} y_i\right) - (n \cdot \hat{\theta_0}) \quad \quad  \text{c + c + … + c = nc}</span>
<span id="cb29-340"><a href="#cb29-340" aria-hidden="true" tabindex="-1"></a><span class="sc">\\</span> n \cdot \hat{\theta_0} &amp;= \sum^{n}_{i=1} y_i</span>
<span id="cb29-341"><a href="#cb29-341" aria-hidden="true" tabindex="-1"></a><span class="sc">\\</span> \hat{\theta_0} &amp;= \frac{1}{n} \sum^{n}_{i=1} y_i</span>
<span id="cb29-342"><a href="#cb29-342" aria-hidden="true" tabindex="-1"></a><span class="sc">\\</span> \hat{\theta_0} &amp;= \bar{y}</span>
<span id="cb29-343"><a href="#cb29-343" aria-hidden="true" tabindex="-1"></a>\end{align}</span>
<span id="cb29-344"><a href="#cb29-344" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb29-345"><a href="#cb29-345" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-346"><a href="#cb29-346" aria-hidden="true" tabindex="-1"></a>Let's take a moment to interpret this result. $\hat{\theta_0} = \bar{y}$ is the optimal parameter for constant model + MSE.</span>
<span id="cb29-347"><a href="#cb29-347" aria-hidden="true" tabindex="-1"></a>It holds true regardless of what data sample you have, and it provides some formal reasoning as to why the mean is such a common summary statistic.</span>
<span id="cb29-348"><a href="#cb29-348" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-349"><a href="#cb29-349" aria-hidden="true" tabindex="-1"></a>Our optimal model parameter is the value of the parameter that minimizes the cost function. This minimum value of the cost function can be expressed:</span>
<span id="cb29-350"><a href="#cb29-350" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-351"><a href="#cb29-351" aria-hidden="true" tabindex="-1"></a>$$R(\hat{\theta_0}) = \min_{\theta_0} R(\theta_0)$$</span>
<span id="cb29-352"><a href="#cb29-352" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-353"><a href="#cb29-353" aria-hidden="true" tabindex="-1"></a>To restate the above in plain English: we are looking at the value of the cost function when it takes the best parameter as input. This optimal model parameter, $\hat{\theta_0}$, is the value of $\theta_0$ that minimizes the cost $R$.</span>
<span id="cb29-354"><a href="#cb29-354" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-355"><a href="#cb29-355" aria-hidden="true" tabindex="-1"></a>For modeling purposes, we care less about the minimum value of cost, $R(\hat{\theta_0})$, and more about the *value of $\theta$* that results in this lowest average loss. In other words, we concern ourselves with finding the best parameter value such that:</span>
<span id="cb29-356"><a href="#cb29-356" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-357"><a href="#cb29-357" aria-hidden="true" tabindex="-1"></a>$$\hat{\theta} = \underset{\theta}{\operatorname{\arg\min}}\:R(\theta)$$</span>
<span id="cb29-358"><a href="#cb29-358" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-359"><a href="#cb29-359" aria-hidden="true" tabindex="-1"></a>That is, we want to find the **arg**ument $\theta$ that **min**imizes the cost function.</span>
<span id="cb29-360"><a href="#cb29-360" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-361"><a href="#cb29-361" aria-hidden="true" tabindex="-1"></a><span class="fu">### Comparing Two Different Models, Both Fit with MSE</span></span>
<span id="cb29-362"><a href="#cb29-362" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-363"><a href="#cb29-363" aria-hidden="true" tabindex="-1"></a>Now that we've explored the constant model with an L2 loss, we can compare it to the SLR model that we learned last lecture. Consider the dataset below, which contains information about the ages and lengths of dugongs. Supposed we wanted to predict dugong ages:</span>
<span id="cb29-364"><a href="#cb29-364" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-365"><a href="#cb29-365" aria-hidden="true" tabindex="-1"></a>|                        | Constant Model                                                   | Simple Linear Regression                                                        |</span>
<span id="cb29-366"><a href="#cb29-366" aria-hidden="true" tabindex="-1"></a>| ---------------------- | ---------------------------------------------------------------- | ------------------------------------------------------------------------------- |</span>
<span id="cb29-367"><a href="#cb29-367" aria-hidden="true" tabindex="-1"></a>| model                  | $\hat{y} = \theta_0$                                             | $\hat{y} = \theta_0 + \theta_1 x$                                                |</span>
<span id="cb29-368"><a href="#cb29-368" aria-hidden="true" tabindex="-1"></a>| data                   | sample of ages $D = <span class="sc">\{</span>y_1, y_2, ..., y_n<span class="sc">\}</span>$                      | sample of ages $D = <span class="sc">\{</span>(x_1, y_1), (x_2, y_2), ..., (x_n, y_n)<span class="sc">\}</span>$                |</span>
<span id="cb29-369"><a href="#cb29-369" aria-hidden="true" tabindex="-1"></a>| dimensions             | $\hat{\theta_0}$ is 1-D                                          | $\hat{\theta} = <span class="co">[</span><span class="ot">\hat{\theta_0}, \hat{\theta_1}</span><span class="co">]</span>$ is 2-D                        |</span>
<span id="cb29-370"><a href="#cb29-370" aria-hidden="true" tabindex="-1"></a>| loss surface           | 2-D <span class="al">![](images/constant_loss_surface.png)</span>                        | 3-D <span class="al">![](images/slr_loss_surface.png)</span>                                            |</span>
<span id="cb29-371"><a href="#cb29-371" aria-hidden="true" tabindex="-1"></a>| loss model             | $\hat{R}(\theta) = \frac{1}{n}\sum^{n}_{i=1} (y_i - \theta_0)^2$ | $\hat{R}(\theta_0, \theta_1) = \frac{1}{n}\sum^{n}_{i=1} (y_i - (\theta_0 + \theta_1 x))^2$ |</span>
<span id="cb29-372"><a href="#cb29-372" aria-hidden="true" tabindex="-1"></a>| RMSE                   | 7.72                                                             | 4.31                                                                            |</span>
<span id="cb29-373"><a href="#cb29-373" aria-hidden="true" tabindex="-1"></a>| predictions visualized | rug plot <span class="al">![](images/dugong_rug.png)</span>                              | scatter plot <span class="al">![](images/dugong_scatter.png)</span>                                     |</span>
<span id="cb29-374"><a href="#cb29-374" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-375"><a href="#cb29-375" aria-hidden="true" tabindex="-1"></a>(Notice how the points for our SLR scatter plot are visually not a great linear fit. We'll come back to this).</span>
<span id="cb29-376"><a href="#cb29-376" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-377"><a href="#cb29-377" aria-hidden="true" tabindex="-1"></a>The code for generating the graphs and models is included below, but we won't go over it in too much depth.</span>
<span id="cb29-378"><a href="#cb29-378" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-381"><a href="#cb29-381" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb29-382"><a href="#cb29-382" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: true</span></span>
<span id="cb29-383"><a href="#cb29-383" aria-hidden="true" tabindex="-1"></a><span class="co">#| vscode: {languageId: python}</span></span>
<span id="cb29-384"><a href="#cb29-384" aria-hidden="true" tabindex="-1"></a>dugongs <span class="op">=</span> pd.read_csv(<span class="st">"data/dugongs.csv"</span>)</span>
<span id="cb29-385"><a href="#cb29-385" aria-hidden="true" tabindex="-1"></a>data_constant <span class="op">=</span> dugongs[<span class="st">"Age"</span>]</span>
<span id="cb29-386"><a href="#cb29-386" aria-hidden="true" tabindex="-1"></a>data_linear <span class="op">=</span> dugongs[[<span class="st">"Length"</span>, <span class="st">"Age"</span>]]</span>
<span id="cb29-387"><a href="#cb29-387" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb29-388"><a href="#cb29-388" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-391"><a href="#cb29-391" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb29-392"><a href="#cb29-392" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: true</span></span>
<span id="cb29-393"><a href="#cb29-393" aria-hidden="true" tabindex="-1"></a><span class="co">#| vscode: {languageId: python}</span></span>
<span id="cb29-394"><a href="#cb29-394" aria-hidden="true" tabindex="-1"></a><span class="co"># Constant Model + MSE</span></span>
<span id="cb29-395"><a href="#cb29-395" aria-hidden="true" tabindex="-1"></a>plt.style.use(<span class="st">'default'</span>) <span class="co"># Revert style to default mpl</span></span>
<span id="cb29-396"><a href="#cb29-396" aria-hidden="true" tabindex="-1"></a>adjust_fontsize(size<span class="op">=</span><span class="dv">16</span>)</span>
<span id="cb29-397"><a href="#cb29-397" aria-hidden="true" tabindex="-1"></a><span class="op">%</span>matplotlib inline</span>
<span id="cb29-398"><a href="#cb29-398" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-399"><a href="#cb29-399" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> mse_constant(theta, data):</span>
<span id="cb29-400"><a href="#cb29-400" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> np.mean(np.array([(y_obs <span class="op">-</span> theta) <span class="op">**</span> <span class="dv">2</span> <span class="cf">for</span> y_obs <span class="kw">in</span> data]), axis<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb29-401"><a href="#cb29-401" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-402"><a href="#cb29-402" aria-hidden="true" tabindex="-1"></a>thetas <span class="op">=</span> np.linspace(<span class="op">-</span><span class="dv">20</span>, <span class="dv">42</span>, <span class="dv">1000</span>)</span>
<span id="cb29-403"><a href="#cb29-403" aria-hidden="true" tabindex="-1"></a>l2_loss_thetas <span class="op">=</span> mse_constant(thetas, data_constant)</span>
<span id="cb29-404"><a href="#cb29-404" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-405"><a href="#cb29-405" aria-hidden="true" tabindex="-1"></a><span class="co"># Plotting the loss surface</span></span>
<span id="cb29-406"><a href="#cb29-406" aria-hidden="true" tabindex="-1"></a>plt.plot(thetas, l2_loss_thetas)</span>
<span id="cb29-407"><a href="#cb29-407" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="vs">r'$\theta_0$'</span>)</span>
<span id="cb29-408"><a href="#cb29-408" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="vs">r'MSE'</span>)</span>
<span id="cb29-409"><a href="#cb29-409" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-410"><a href="#cb29-410" aria-hidden="true" tabindex="-1"></a><span class="co"># Optimal point</span></span>
<span id="cb29-411"><a href="#cb29-411" aria-hidden="true" tabindex="-1"></a>thetahat <span class="op">=</span> np.mean(data_constant)</span>
<span id="cb29-412"><a href="#cb29-412" aria-hidden="true" tabindex="-1"></a>plt.scatter([thetahat], [mse_constant(thetahat, data_constant)], s<span class="op">=</span><span class="dv">50</span>, label <span class="op">=</span> <span class="vs">r"$\hat{\theta}_0$"</span>)</span>
<span id="cb29-413"><a href="#cb29-413" aria-hidden="true" tabindex="-1"></a>plt.legend()<span class="op">;</span></span>
<span id="cb29-414"><a href="#cb29-414" aria-hidden="true" tabindex="-1"></a><span class="co"># plt.show()</span></span>
<span id="cb29-415"><a href="#cb29-415" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb29-416"><a href="#cb29-416" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-419"><a href="#cb29-419" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb29-420"><a href="#cb29-420" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: true</span></span>
<span id="cb29-421"><a href="#cb29-421" aria-hidden="true" tabindex="-1"></a><span class="co">#| vscode: {languageId: python}</span></span>
<span id="cb29-422"><a href="#cb29-422" aria-hidden="true" tabindex="-1"></a><span class="co"># SLR + MSE</span></span>
<span id="cb29-423"><a href="#cb29-423" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> mse_linear(theta_0, theta_1, data_linear):</span>
<span id="cb29-424"><a href="#cb29-424" aria-hidden="true" tabindex="-1"></a>    data_x, data_y <span class="op">=</span> data_linear.iloc[:, <span class="dv">0</span>], data_linear.iloc[:, <span class="dv">1</span>]</span>
<span id="cb29-425"><a href="#cb29-425" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> np.mean(</span>
<span id="cb29-426"><a href="#cb29-426" aria-hidden="true" tabindex="-1"></a>        np.array([(y <span class="op">-</span> (theta_0 <span class="op">+</span> theta_1 <span class="op">*</span> x)) <span class="op">**</span> <span class="dv">2</span> <span class="cf">for</span> x, y <span class="kw">in</span> <span class="bu">zip</span>(data_x, data_y)]),</span>
<span id="cb29-427"><a href="#cb29-427" aria-hidden="true" tabindex="-1"></a>        axis<span class="op">=</span><span class="dv">0</span>,</span>
<span id="cb29-428"><a href="#cb29-428" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb29-429"><a href="#cb29-429" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-430"><a href="#cb29-430" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-431"><a href="#cb29-431" aria-hidden="true" tabindex="-1"></a><span class="co"># plotting the loss surface</span></span>
<span id="cb29-432"><a href="#cb29-432" aria-hidden="true" tabindex="-1"></a>theta_0_values <span class="op">=</span> np.linspace(<span class="op">-</span><span class="dv">80</span>, <span class="dv">20</span>, <span class="dv">80</span>)</span>
<span id="cb29-433"><a href="#cb29-433" aria-hidden="true" tabindex="-1"></a>theta_1_values <span class="op">=</span> np.linspace(<span class="op">-</span><span class="dv">10</span>, <span class="dv">30</span>, <span class="dv">80</span>)</span>
<span id="cb29-434"><a href="#cb29-434" aria-hidden="true" tabindex="-1"></a>mse_values <span class="op">=</span> np.array(</span>
<span id="cb29-435"><a href="#cb29-435" aria-hidden="true" tabindex="-1"></a>    [[mse_linear(x, y, data_linear) <span class="cf">for</span> x <span class="kw">in</span> theta_0_values] <span class="cf">for</span> y <span class="kw">in</span> theta_1_values]</span>
<span id="cb29-436"><a href="#cb29-436" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb29-437"><a href="#cb29-437" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-438"><a href="#cb29-438" aria-hidden="true" tabindex="-1"></a><span class="co"># Optimal point</span></span>
<span id="cb29-439"><a href="#cb29-439" aria-hidden="true" tabindex="-1"></a>data_x, data_y <span class="op">=</span> data_linear.iloc[:, <span class="dv">0</span>], data_linear.iloc[:, <span class="dv">1</span>]</span>
<span id="cb29-440"><a href="#cb29-440" aria-hidden="true" tabindex="-1"></a>theta_1_hat <span class="op">=</span> np.corrcoef(data_x, data_y)[<span class="dv">0</span>, <span class="dv">1</span>] <span class="op">*</span> np.std(data_y) <span class="op">/</span> np.std(data_x)</span>
<span id="cb29-441"><a href="#cb29-441" aria-hidden="true" tabindex="-1"></a>theta_0_hat <span class="op">=</span> np.mean(data_y) <span class="op">-</span> theta_1_hat <span class="op">*</span> np.mean(data_x)</span>
<span id="cb29-442"><a href="#cb29-442" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-443"><a href="#cb29-443" aria-hidden="true" tabindex="-1"></a><span class="co"># Create the 3D plot</span></span>
<span id="cb29-444"><a href="#cb29-444" aria-hidden="true" tabindex="-1"></a>fig <span class="op">=</span> plt.figure(figsize<span class="op">=</span>(<span class="dv">7</span>, <span class="dv">5</span>))</span>
<span id="cb29-445"><a href="#cb29-445" aria-hidden="true" tabindex="-1"></a>ax <span class="op">=</span> fig.add_subplot(<span class="dv">111</span>, projection<span class="op">=</span><span class="st">"3d"</span>)</span>
<span id="cb29-446"><a href="#cb29-446" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-447"><a href="#cb29-447" aria-hidden="true" tabindex="-1"></a>X, Y <span class="op">=</span> np.meshgrid(theta_0_values, theta_1_values)</span>
<span id="cb29-448"><a href="#cb29-448" aria-hidden="true" tabindex="-1"></a>surf <span class="op">=</span> ax.plot_surface(</span>
<span id="cb29-449"><a href="#cb29-449" aria-hidden="true" tabindex="-1"></a>    X, Y, mse_values, cmap<span class="op">=</span><span class="st">"viridis"</span>, alpha<span class="op">=</span><span class="fl">0.6</span></span>
<span id="cb29-450"><a href="#cb29-450" aria-hidden="true" tabindex="-1"></a>)  <span class="co"># Use alpha to make it slightly transparent</span></span>
<span id="cb29-451"><a href="#cb29-451" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-452"><a href="#cb29-452" aria-hidden="true" tabindex="-1"></a><span class="co"># Scatter point using matplotlib</span></span>
<span id="cb29-453"><a href="#cb29-453" aria-hidden="true" tabindex="-1"></a>sc <span class="op">=</span> ax.scatter(</span>
<span id="cb29-454"><a href="#cb29-454" aria-hidden="true" tabindex="-1"></a>    [theta_0_hat],</span>
<span id="cb29-455"><a href="#cb29-455" aria-hidden="true" tabindex="-1"></a>    [theta_1_hat],</span>
<span id="cb29-456"><a href="#cb29-456" aria-hidden="true" tabindex="-1"></a>    [mse_linear(theta_0_hat, theta_1_hat, data_linear)],</span>
<span id="cb29-457"><a href="#cb29-457" aria-hidden="true" tabindex="-1"></a>    marker<span class="op">=</span><span class="st">"o"</span>,</span>
<span id="cb29-458"><a href="#cb29-458" aria-hidden="true" tabindex="-1"></a>    color<span class="op">=</span><span class="st">"red"</span>,</span>
<span id="cb29-459"><a href="#cb29-459" aria-hidden="true" tabindex="-1"></a>    s<span class="op">=</span><span class="dv">100</span>,</span>
<span id="cb29-460"><a href="#cb29-460" aria-hidden="true" tabindex="-1"></a>    label<span class="op">=</span><span class="st">"theta hat"</span>,</span>
<span id="cb29-461"><a href="#cb29-461" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb29-462"><a href="#cb29-462" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-463"><a href="#cb29-463" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a colorbar</span></span>
<span id="cb29-464"><a href="#cb29-464" aria-hidden="true" tabindex="-1"></a>cbar <span class="op">=</span> fig.colorbar(surf, ax<span class="op">=</span>ax, shrink<span class="op">=</span><span class="fl">0.5</span>, aspect<span class="op">=</span><span class="dv">10</span>)</span>
<span id="cb29-465"><a href="#cb29-465" aria-hidden="true" tabindex="-1"></a>cbar.set_label(<span class="st">"Cost Value"</span>)</span>
<span id="cb29-466"><a href="#cb29-466" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-467"><a href="#cb29-467" aria-hidden="true" tabindex="-1"></a>ax.set_title(<span class="st">"MSE for different $</span><span class="ch">\\</span><span class="st">theta_0, </span><span class="ch">\\</span><span class="st">theta_1$"</span>)</span>
<span id="cb29-468"><a href="#cb29-468" aria-hidden="true" tabindex="-1"></a>ax.set_xlabel(<span class="st">"$</span><span class="ch">\\</span><span class="st">theta_0$"</span>)</span>
<span id="cb29-469"><a href="#cb29-469" aria-hidden="true" tabindex="-1"></a>ax.set_ylabel(<span class="st">"$</span><span class="ch">\\</span><span class="st">theta_1$"</span>)</span>
<span id="cb29-470"><a href="#cb29-470" aria-hidden="true" tabindex="-1"></a>ax.set_zlabel(<span class="st">"MSE"</span>)</span>
<span id="cb29-471"><a href="#cb29-471" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-472"><a href="#cb29-472" aria-hidden="true" tabindex="-1"></a><span class="co"># plt.show()</span></span>
<span id="cb29-473"><a href="#cb29-473" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb29-474"><a href="#cb29-474" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-477"><a href="#cb29-477" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb29-478"><a href="#cb29-478" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: true</span></span>
<span id="cb29-479"><a href="#cb29-479" aria-hidden="true" tabindex="-1"></a><span class="co">#| vscode: {languageId: python}</span></span>
<span id="cb29-480"><a href="#cb29-480" aria-hidden="true" tabindex="-1"></a><span class="co"># Predictions</span></span>
<span id="cb29-481"><a href="#cb29-481" aria-hidden="true" tabindex="-1"></a>yobs <span class="op">=</span> data_linear[<span class="st">"Age"</span>]  <span class="co"># The true observations y</span></span>
<span id="cb29-482"><a href="#cb29-482" aria-hidden="true" tabindex="-1"></a>xs <span class="op">=</span> data_linear[<span class="st">"Length"</span>]  <span class="co"># Needed for linear predictions</span></span>
<span id="cb29-483"><a href="#cb29-483" aria-hidden="true" tabindex="-1"></a>n <span class="op">=</span> <span class="bu">len</span>(yobs)  <span class="co"># Predictions</span></span>
<span id="cb29-484"><a href="#cb29-484" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-485"><a href="#cb29-485" aria-hidden="true" tabindex="-1"></a>yhats_constant <span class="op">=</span> [thetahat <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(n)]  <span class="co"># Not used, but food for thought</span></span>
<span id="cb29-486"><a href="#cb29-486" aria-hidden="true" tabindex="-1"></a>yhats_linear <span class="op">=</span> [theta_0_hat <span class="op">+</span> theta_1_hat <span class="op">*</span> x <span class="cf">for</span> x <span class="kw">in</span> xs]</span>
<span id="cb29-487"><a href="#cb29-487" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb29-488"><a href="#cb29-488" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-491"><a href="#cb29-491" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb29-492"><a href="#cb29-492" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: true</span></span>
<span id="cb29-493"><a href="#cb29-493" aria-hidden="true" tabindex="-1"></a><span class="co">#| vscode: {languageId: python}</span></span>
<span id="cb29-494"><a href="#cb29-494" aria-hidden="true" tabindex="-1"></a><span class="co"># Constant Model Rug Plot</span></span>
<span id="cb29-495"><a href="#cb29-495" aria-hidden="true" tabindex="-1"></a><span class="co"># In case we're in a weird style state</span></span>
<span id="cb29-496"><a href="#cb29-496" aria-hidden="true" tabindex="-1"></a>sns.set_theme()</span>
<span id="cb29-497"><a href="#cb29-497" aria-hidden="true" tabindex="-1"></a>adjust_fontsize(size<span class="op">=</span><span class="dv">16</span>)</span>
<span id="cb29-498"><a href="#cb29-498" aria-hidden="true" tabindex="-1"></a><span class="op">%</span>matplotlib inline</span>
<span id="cb29-499"><a href="#cb29-499" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-500"><a href="#cb29-500" aria-hidden="true" tabindex="-1"></a>fig <span class="op">=</span> plt.figure(figsize<span class="op">=</span>(<span class="dv">8</span>, <span class="fl">1.5</span>))</span>
<span id="cb29-501"><a href="#cb29-501" aria-hidden="true" tabindex="-1"></a>sns.rugplot(yobs, height<span class="op">=</span><span class="fl">0.25</span>, lw<span class="op">=</span><span class="dv">2</span>) <span class="op">;</span></span>
<span id="cb29-502"><a href="#cb29-502" aria-hidden="true" tabindex="-1"></a>plt.axvline(thetahat, color<span class="op">=</span><span class="st">'red'</span>, lw<span class="op">=</span><span class="dv">4</span>, label<span class="op">=</span><span class="vs">r"$\hat{\theta}_0$"</span>)<span class="op">;</span></span>
<span id="cb29-503"><a href="#cb29-503" aria-hidden="true" tabindex="-1"></a>plt.legend()</span>
<span id="cb29-504"><a href="#cb29-504" aria-hidden="true" tabindex="-1"></a>plt.yticks([])<span class="op">;</span></span>
<span id="cb29-505"><a href="#cb29-505" aria-hidden="true" tabindex="-1"></a><span class="co"># plt.show()</span></span>
<span id="cb29-506"><a href="#cb29-506" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb29-507"><a href="#cb29-507" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-510"><a href="#cb29-510" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb29-511"><a href="#cb29-511" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: true</span></span>
<span id="cb29-512"><a href="#cb29-512" aria-hidden="true" tabindex="-1"></a><span class="co">#| vscode: {languageId: python}</span></span>
<span id="cb29-513"><a href="#cb29-513" aria-hidden="true" tabindex="-1"></a><span class="co"># SLR model scatter plot </span></span>
<span id="cb29-514"><a href="#cb29-514" aria-hidden="true" tabindex="-1"></a><span class="co"># In case we're in a weird style state</span></span>
<span id="cb29-515"><a href="#cb29-515" aria-hidden="true" tabindex="-1"></a>sns.set_theme()</span>
<span id="cb29-516"><a href="#cb29-516" aria-hidden="true" tabindex="-1"></a>adjust_fontsize(size<span class="op">=</span><span class="dv">16</span>)</span>
<span id="cb29-517"><a href="#cb29-517" aria-hidden="true" tabindex="-1"></a><span class="op">%</span>matplotlib inline</span>
<span id="cb29-518"><a href="#cb29-518" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-519"><a href="#cb29-519" aria-hidden="true" tabindex="-1"></a>sns.scatterplot(x<span class="op">=</span>xs, y<span class="op">=</span>yobs)</span>
<span id="cb29-520"><a href="#cb29-520" aria-hidden="true" tabindex="-1"></a>plt.plot(xs, yhats_linear, color<span class="op">=</span><span class="st">'red'</span>, lw<span class="op">=</span><span class="dv">4</span>)<span class="op">;</span></span>
<span id="cb29-521"><a href="#cb29-521" aria-hidden="true" tabindex="-1"></a><span class="co"># plt.savefig('dugong_line.png', bbox_inches = 'tight');</span></span>
<span id="cb29-522"><a href="#cb29-522" aria-hidden="true" tabindex="-1"></a><span class="co"># plt.show()</span></span>
<span id="cb29-523"><a href="#cb29-523" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb29-524"><a href="#cb29-524" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-525"><a href="#cb29-525" aria-hidden="true" tabindex="-1"></a>Interpreting the RMSE (Root Mean Squared Error):</span>
<span id="cb29-526"><a href="#cb29-526" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-527"><a href="#cb29-527" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Because the constant error is **HIGHER** than the linear error,</span>
<span id="cb29-528"><a href="#cb29-528" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>The constant model is **WORSE** than the linear model (at least for this metric).</span>
<span id="cb29-529"><a href="#cb29-529" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-530"><a href="#cb29-530" aria-hidden="true" tabindex="-1"></a><span class="fu">## Constant Model + MAE</span></span>
<span id="cb29-531"><a href="#cb29-531" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-532"><a href="#cb29-532" aria-hidden="true" tabindex="-1"></a>We see now that changing the model used for prediction leads to a wildly different result for the optimal model parameter. What happens if we instead change the loss function used in model evaluation?</span>
<span id="cb29-533"><a href="#cb29-533" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-534"><a href="#cb29-534" aria-hidden="true" tabindex="-1"></a>This time, we will consider the constant model with L1 (absolute loss) as the loss function. This means that the average loss will be expressed as the **Mean Absolute Error (MAE)**.</span>
<span id="cb29-535"><a href="#cb29-535" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-536"><a href="#cb29-536" aria-hidden="true" tabindex="-1"></a><span class="ss">1. </span>Choose a model: constant model</span>
<span id="cb29-537"><a href="#cb29-537" aria-hidden="true" tabindex="-1"></a><span class="ss">2. </span>Choose a loss function: L1 loss</span>
<span id="cb29-538"><a href="#cb29-538" aria-hidden="true" tabindex="-1"></a><span class="ss">3. </span>Fit the model</span>
<span id="cb29-539"><a href="#cb29-539" aria-hidden="true" tabindex="-1"></a><span class="ss">4. </span>Evaluate model performance</span>
<span id="cb29-540"><a href="#cb29-540" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-541"><a href="#cb29-541" aria-hidden="true" tabindex="-1"></a><span class="fu">### Deriving the optimal $\theta_0$</span></span>
<span id="cb29-542"><a href="#cb29-542" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-543"><a href="#cb29-543" aria-hidden="true" tabindex="-1"></a>Recall that the MAE is average **absolute** loss (L1 loss) over the data $D = <span class="sc">\{</span>y_1, y_2, ..., y_n<span class="sc">\}</span>$.</span>
<span id="cb29-544"><a href="#cb29-544" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-545"><a href="#cb29-545" aria-hidden="true" tabindex="-1"></a>$$\hat{R}(\theta_0) = \frac{1}{n}\sum^{n}_{i=1} |y_i - \hat{y_i}| $$</span>
<span id="cb29-546"><a href="#cb29-546" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-547"><a href="#cb29-547" aria-hidden="true" tabindex="-1"></a>Given the constant model $\hat{y} = \theta_0$, we can write the MAE as:</span>
<span id="cb29-548"><a href="#cb29-548" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-549"><a href="#cb29-549" aria-hidden="true" tabindex="-1"></a>$$\hat{R}(\theta_0) = \frac{1}{n}\sum^{n}_{i=1} |y_i - \theta_0| $$</span>
<span id="cb29-550"><a href="#cb29-550" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-551"><a href="#cb29-551" aria-hidden="true" tabindex="-1"></a>To fit the model, we find the optimal parameter value $\hat{\theta_0}$ that minimizes the MAE by differentiating using a calculus approach:</span>
<span id="cb29-552"><a href="#cb29-552" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-553"><a href="#cb29-553" aria-hidden="true" tabindex="-1"></a><span class="ss">1. </span>Differentiate with respect to $\hat{\theta_0}$:</span>
<span id="cb29-554"><a href="#cb29-554" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-555"><a href="#cb29-555" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb29-556"><a href="#cb29-556" aria-hidden="true" tabindex="-1"></a>\begin{align}</span>
<span id="cb29-557"><a href="#cb29-557" aria-hidden="true" tabindex="-1"></a>\hat{R}(\theta_0) &amp;= \frac{1}{n}\sum^{n}_{i=1} |y_i - \theta_0| <span class="sc">\\</span></span>
<span id="cb29-558"><a href="#cb29-558" aria-hidden="true" tabindex="-1"></a>\frac{d}{d\theta_0} R(\theta_0) &amp;= \frac{d}{d\theta_0} \left(\frac{1}{n} \sum^{n}_{i=1} |y_i - \theta_0| \right) <span class="sc">\\</span></span>
<span id="cb29-559"><a href="#cb29-559" aria-hidden="true" tabindex="-1"></a>&amp;= \frac{1}{n} \sum^{n}_{i=1} \frac{d}{d\theta_0} |y_i - \theta_0|</span>
<span id="cb29-560"><a href="#cb29-560" aria-hidden="true" tabindex="-1"></a>\end{align}</span>
<span id="cb29-561"><a href="#cb29-561" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb29-562"><a href="#cb29-562" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-563"><a href="#cb29-563" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Here, we seem to have run into a problem: the derivative of an absolute value is undefined when the argument is 0 (i.e. when $y_i = \theta_0$). For now, we'll ignore this issue. It turns out that disregarding this case doesn't influence our final result.</span>
<span id="cb29-564"><a href="#cb29-564" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>To perform the derivative, consider two cases. When $\theta_0$ is *less than or equal to* $y_i$, the term $y_i - \theta_0$ will be positive and the absolute value has no impact. When $\theta_0$ is *greater than* $y_i$, the term $y_i - \theta_0$ will be negative. Applying the absolute value will convert this to a positive value, which we can express by saying $-(y_i - \theta_0) = \theta_0 - y_i$.</span>
<span id="cb29-565"><a href="#cb29-565" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-566"><a href="#cb29-566" aria-hidden="true" tabindex="-1"></a>$$|y_i - \theta_0| = \begin{cases} y_i - \theta_0 \quad \text{ if } \theta_0 \le y_i <span class="sc">\\</span> \theta_0 - y_i \quad \text{if }\theta_0 &gt; y_i \end{cases}$$</span>
<span id="cb29-567"><a href="#cb29-567" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-568"><a href="#cb29-568" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Taking derivatives:</span>
<span id="cb29-569"><a href="#cb29-569" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-570"><a href="#cb29-570" aria-hidden="true" tabindex="-1"></a>$$\frac{d}{d\theta_0} |y_i - \theta_0| = \begin{cases} \frac{d}{d\theta_0} (y_i - \theta_0) = -1 \quad \text{if }\theta_0 &lt; y_i <span class="sc">\\</span> \frac{d}{d\theta_0} (\theta_0 - y_i) = 1 \quad \text{if }\theta_0 &gt; y_i \end{cases}$$</span>
<span id="cb29-571"><a href="#cb29-571" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-572"><a href="#cb29-572" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>This means that we obtain a different value for the derivative for data points where $\theta_0 &lt; y_i$ and where $\theta_0 &gt; y_i$. We can summarize this by saying:</span>
<span id="cb29-573"><a href="#cb29-573" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-574"><a href="#cb29-574" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb29-575"><a href="#cb29-575" aria-hidden="true" tabindex="-1"></a>\frac{d}{d\theta_0} R(\theta_0) = \frac{1}{n} \sum^{n}_{i=1} \frac{d}{d\theta_0} |y_i - \theta_0| <span class="sc">\\</span></span>
<span id="cb29-576"><a href="#cb29-576" aria-hidden="true" tabindex="-1"></a>= \frac{1}{n} \left<span class="co">[</span><span class="ot">\sum_{\theta_0 &lt; y_i} (-1) + \sum_{\theta_0 &gt; y_i} (+1) \right</span><span class="co">]</span></span>
<span id="cb29-577"><a href="#cb29-577" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb29-578"><a href="#cb29-578" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-579"><a href="#cb29-579" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>In other words, we take the sum of values for $i = 1, 2, ..., n$:</span>
<span id="cb29-580"><a href="#cb29-580" aria-hidden="true" tabindex="-1"></a><span class="ss">  - </span>$-1$ if our observation $y_i$ is *greater than* our prediction $\hat{\theta_0}$</span>
<span id="cb29-581"><a href="#cb29-581" aria-hidden="true" tabindex="-1"></a><span class="ss">  - </span>$+1$ if our observation $y_i$ is *smaller than* our prediction $\hat{\theta_0}$</span>
<span id="cb29-582"><a href="#cb29-582" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-583"><a href="#cb29-583" aria-hidden="true" tabindex="-1"></a><span class="ss">2. </span>Set the derivative equation equal to 0:</span>
<span id="cb29-584"><a href="#cb29-584" aria-hidden="true" tabindex="-1"></a>   $$ 0 = \frac{1}{n}\sum_{\hat{\theta_0} &lt; y_i} (-1) + \frac{1}{n}\sum_{\hat{\theta_0} &gt; y_i} (+1) $$</span>
<span id="cb29-585"><a href="#cb29-585" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-586"><a href="#cb29-586" aria-hidden="true" tabindex="-1"></a><span class="ss">3. </span>Solve for $\hat{\theta_0}$:</span>
<span id="cb29-587"><a href="#cb29-587" aria-hidden="true" tabindex="-1"></a>   $$ 0 = -\frac{1}{n}\sum_{\hat{\theta_0} &lt; y_i} (1) + \frac{1}{n}\sum_{\hat{\theta_0} &gt; y_i} (1)$$</span>
<span id="cb29-588"><a href="#cb29-588" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-589"><a href="#cb29-589" aria-hidden="true" tabindex="-1"></a>$$\sum_{\hat{\theta_0} &lt; y_i} (1) = \sum_{\hat{\theta_0} &gt; y_i} (1) $$</span>
<span id="cb29-590"><a href="#cb29-590" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-591"><a href="#cb29-591" aria-hidden="true" tabindex="-1"></a>Thus, the constant model parameter $\theta = \hat{\theta_0}$ that minimizes MAE must satisfy:</span>
<span id="cb29-592"><a href="#cb29-592" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-593"><a href="#cb29-593" aria-hidden="true" tabindex="-1"></a>$$ \sum_{\hat{\theta_0} &lt; y_i} (1) = \sum_{\hat{\theta_0} &gt; y_i} (1) $$</span>
<span id="cb29-594"><a href="#cb29-594" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-595"><a href="#cb29-595" aria-hidden="true" tabindex="-1"></a>In other words, the number of observations greater than $\theta_0$ must be equal to the number of observations less than $\theta_0$; there must be an equal number of points on the left and right sides of the equation. This is the definition of median, so our optimal value is</span>
<span id="cb29-596"><a href="#cb29-596" aria-hidden="true" tabindex="-1"></a>$$ \hat{\theta_0} = median(y) $$</span>
<span id="cb29-597"><a href="#cb29-597" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-598"><a href="#cb29-598" aria-hidden="true" tabindex="-1"></a><span class="fu">## Summary: Loss Optimization, Calculus, and Critical Points</span></span>
<span id="cb29-599"><a href="#cb29-599" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-600"><a href="#cb29-600" aria-hidden="true" tabindex="-1"></a>First, define the **objective function** as average loss.</span>
<span id="cb29-601"><a href="#cb29-601" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-602"><a href="#cb29-602" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Plug in L1 or L2 loss.</span>
<span id="cb29-603"><a href="#cb29-603" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Plug in the model so that the resulting expression is a function of $\theta$.</span>
<span id="cb29-604"><a href="#cb29-604" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-605"><a href="#cb29-605" aria-hidden="true" tabindex="-1"></a>Then, find the minimum of the objective function:</span>
<span id="cb29-606"><a href="#cb29-606" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-607"><a href="#cb29-607" aria-hidden="true" tabindex="-1"></a><span class="ss">1. </span>Differentiate with respect to $\theta$.</span>
<span id="cb29-608"><a href="#cb29-608" aria-hidden="true" tabindex="-1"></a><span class="ss">2. </span>Set equal to 0.</span>
<span id="cb29-609"><a href="#cb29-609" aria-hidden="true" tabindex="-1"></a><span class="ss">3. </span>Solve for $\hat{\theta}$.</span>
<span id="cb29-610"><a href="#cb29-610" aria-hidden="true" tabindex="-1"></a><span class="ss">4. </span>(If we have multiple parameters) repeat steps 1-3 with partial derivatives.</span>
<span id="cb29-611"><a href="#cb29-611" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-612"><a href="#cb29-612" aria-hidden="true" tabindex="-1"></a>Recall critical points from calculus: $R(\hat{\theta})$ could be a minimum, maximum, or saddle point!</span>
<span id="cb29-613"><a href="#cb29-613" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-614"><a href="#cb29-614" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>We should technically also perform the second derivative test, i.e., show $R''(\hat{\theta}) &gt; 0$.</span>
<span id="cb29-615"><a href="#cb29-615" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>MSE has a property—**convexity**—that guarantees that $R(\hat{\theta})$ is a global minimum.</span>
<span id="cb29-616"><a href="#cb29-616" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>The proof of convexity for MAE is beyond this course.</span>
<span id="cb29-617"><a href="#cb29-617" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-618"><a href="#cb29-618" aria-hidden="true" tabindex="-1"></a><span class="fu">## Comparing Loss Functions</span></span>
<span id="cb29-619"><a href="#cb29-619" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-620"><a href="#cb29-620" aria-hidden="true" tabindex="-1"></a>We've now tried our hand at fitting a model under both MSE and MAE cost functions. How do the two results compare?</span>
<span id="cb29-621"><a href="#cb29-621" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-622"><a href="#cb29-622" aria-hidden="true" tabindex="-1"></a>Let's consider a dataset where each entry represents the number of drinks sold at a bubble tea store each day. We'll fit a constant model to predict the number of drinks that will be sold tomorrow.</span>
<span id="cb29-623"><a href="#cb29-623" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-626"><a href="#cb29-626" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb29-627"><a href="#cb29-627" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: false</span></span>
<span id="cb29-628"><a href="#cb29-628" aria-hidden="true" tabindex="-1"></a><span class="co">#| vscode: {languageId: python}</span></span>
<span id="cb29-629"><a href="#cb29-629" aria-hidden="true" tabindex="-1"></a>drinks <span class="op">=</span> np.array([<span class="dv">20</span>, <span class="dv">21</span>, <span class="dv">22</span>, <span class="dv">29</span>, <span class="dv">33</span>])</span>
<span id="cb29-630"><a href="#cb29-630" aria-hidden="true" tabindex="-1"></a>drinks</span>
<span id="cb29-631"><a href="#cb29-631" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb29-632"><a href="#cb29-632" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-633"><a href="#cb29-633" aria-hidden="true" tabindex="-1"></a>From our derivations above, we know that the optimal model parameter under MSE cost is the mean of the dataset. Under MAE cost, the optimal parameter is the median of the dataset.</span>
<span id="cb29-634"><a href="#cb29-634" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-637"><a href="#cb29-637" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb29-638"><a href="#cb29-638" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: false</span></span>
<span id="cb29-639"><a href="#cb29-639" aria-hidden="true" tabindex="-1"></a><span class="co">#| vscode: {languageId: python}</span></span>
<span id="cb29-640"><a href="#cb29-640" aria-hidden="true" tabindex="-1"></a>np.mean(drinks), np.median(drinks)</span>
<span id="cb29-641"><a href="#cb29-641" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb29-642"><a href="#cb29-642" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-643"><a href="#cb29-643" aria-hidden="true" tabindex="-1"></a>If we plot each empirical risk function across several possible values of $\theta$, we find that each $\hat{\theta}$ does indeed correspond to the lowest value of error:</span>
<span id="cb29-644"><a href="#cb29-644" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-645"><a href="#cb29-645" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;img</span> <span class="er">src</span><span class="ot">=</span><span class="st">"images/error.png"</span> <span class="er">alt</span><span class="ot">=</span><span class="st">'error'</span> <span class="er">width</span><span class="ot">=</span><span class="st">'600'</span><span class="kw">&gt;</span></span>
<span id="cb29-646"><a href="#cb29-646" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-647"><a href="#cb29-647" aria-hidden="true" tabindex="-1"></a>Notice that the MSE above is a **smooth** function – it is differentiable at all points, making it easy to minimize using numerical methods. The MAE, in contrast, is not differentiable at each of its "kinks." We'll explore how the smoothness of the cost function can impact our ability to apply numerical optimization in a few weeks.</span>
<span id="cb29-648"><a href="#cb29-648" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-649"><a href="#cb29-649" aria-hidden="true" tabindex="-1"></a>How do outliers affect each cost function? Imagine we replace the largest value in the dataset with 1000. The mean of the data increases substantially, while the median is nearly unaffected.</span>
<span id="cb29-650"><a href="#cb29-650" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-653"><a href="#cb29-653" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb29-654"><a href="#cb29-654" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: false</span></span>
<span id="cb29-655"><a href="#cb29-655" aria-hidden="true" tabindex="-1"></a><span class="co">#| vscode: {languageId: python}</span></span>
<span id="cb29-656"><a href="#cb29-656" aria-hidden="true" tabindex="-1"></a>drinks_with_outlier <span class="op">=</span> np.append(drinks, <span class="dv">1033</span>)</span>
<span id="cb29-657"><a href="#cb29-657" aria-hidden="true" tabindex="-1"></a>display(drinks_with_outlier)</span>
<span id="cb29-658"><a href="#cb29-658" aria-hidden="true" tabindex="-1"></a>np.mean(drinks_with_outlier), np.median(drinks_with_outlier)</span>
<span id="cb29-659"><a href="#cb29-659" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb29-660"><a href="#cb29-660" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-661"><a href="#cb29-661" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;img</span> <span class="er">src</span><span class="ot">=</span><span class="st">"images/outliers.png"</span> <span class="er">alt</span><span class="ot">=</span><span class="st">'outliers'</span> <span class="er">width</span><span class="ot">=</span><span class="st">'700'</span><span class="kw">&gt;</span></span>
<span id="cb29-662"><a href="#cb29-662" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-663"><a href="#cb29-663" aria-hidden="true" tabindex="-1"></a>This means that under the MSE, the optimal model parameter $\hat{\theta}$ is strongly affected by the presence of outliers. Under the MAE, the optimal parameter is not as influenced by outlying data. We can generalize this by saying that the MSE is **sensitive** to outliers, while the MAE is **robust** to outliers.</span>
<span id="cb29-664"><a href="#cb29-664" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-665"><a href="#cb29-665" aria-hidden="true" tabindex="-1"></a>Let's try another experiment. This time, we'll add an additional, non-outlying datapoint to the data.</span>
<span id="cb29-666"><a href="#cb29-666" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-669"><a href="#cb29-669" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb29-670"><a href="#cb29-670" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: false</span></span>
<span id="cb29-671"><a href="#cb29-671" aria-hidden="true" tabindex="-1"></a><span class="co">#| vscode: {languageId: python}</span></span>
<span id="cb29-672"><a href="#cb29-672" aria-hidden="true" tabindex="-1"></a>drinks_with_additional_observation <span class="op">=</span> np.append(drinks, <span class="dv">35</span>)</span>
<span id="cb29-673"><a href="#cb29-673" aria-hidden="true" tabindex="-1"></a>drinks_with_additional_observation</span>
<span id="cb29-674"><a href="#cb29-674" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb29-675"><a href="#cb29-675" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-676"><a href="#cb29-676" aria-hidden="true" tabindex="-1"></a>When we again visualize the cost functions, we find that the MAE now plots a horizontal line between 22 and 29. This means that there are _infinitely_ many optimal values for the model parameter: any value $\hat{\theta} \in <span class="co">[</span><span class="ot">22, 29</span><span class="co">]</span>$ will minimize the MAE. In contrast, the MSE still has a single best value for $\hat{\theta}$. In other words, the MSE has a **unique** solution for $\hat{\theta}$; the MAE is not guaranteed to have a single unique solution.</span>
<span id="cb29-677"><a href="#cb29-677" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-678"><a href="#cb29-678" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;img</span> <span class="er">src</span><span class="ot">=</span><span class="st">"images/mse_loss_26.png"</span> <span class="er">width</span><span class="ot">=</span><span class="st">'350'</span><span class="kw">&gt;</span> <span class="kw">&lt;img</span> <span class="er">src</span><span class="ot">=</span><span class="st">"images/mae_loss_infinite.png"</span> <span class="er">width</span><span class="ot">=</span><span class="st">'350'</span><span class="kw">&gt;</span></span>
<span id="cb29-679"><a href="#cb29-679" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-680"><a href="#cb29-680" aria-hidden="true" tabindex="-1"></a>To summarize our example,</span>
<span id="cb29-681"><a href="#cb29-681" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-682"><a href="#cb29-682" aria-hidden="true" tabindex="-1"></a>|                        | MSE (Mean Squared Loss)                                                   | MAE (Mean Absolute Loss)                                                        |</span>
<span id="cb29-683"><a href="#cb29-683" aria-hidden="true" tabindex="-1"></a>| ---------------------- | ---------------------------------------------------------------- | ------------------------------------------------------------------------------- |</span>
<span id="cb29-684"><a href="#cb29-684" aria-hidden="true" tabindex="-1"></a>| Loss Function                  | $\hat{R}(\theta) = \frac{1}{n}\sum^{n}_{i=1} (y_i - \theta_0)^2$                                            | $\hat{R}(\theta) = \frac{1}{n}\sum^{n}_{i=1} |y_i - \theta_0|$                                               |</span>
<span id="cb29-685"><a href="#cb29-685" aria-hidden="true" tabindex="-1"></a>| Optimal $\hat{\theta_0}$                   | $\hat{\theta_0} = mean(y) = \bar{y}$                      | $\hat{\theta_0} = median(y)$                 |</span>
<span id="cb29-686"><a href="#cb29-686" aria-hidden="true" tabindex="-1"></a>| Loss Surface           | <span class="kw">&lt;img</span> <span class="er">src</span><span class="ot">=</span><span class="st">"images/mse_loss_26.png"</span> <span class="er">width</span><span class="ot">=</span><span class="st">'250'</span><span class="kw">&gt;</span>                        | <span class="kw">&lt;img</span> <span class="er">src</span><span class="ot">=</span><span class="st">"images/mae_loss_infinite.png"</span> <span class="er">width</span><span class="ot">=</span><span class="st">'250'</span><span class="kw">&gt;</span>                                          |</span>
<span id="cb29-687"><a href="#cb29-687" aria-hidden="true" tabindex="-1"></a>| Shape            | **Smooth** - easy to minimize using numerical methods (in a few weeks)  | **Piecewise** - at each of the “kinks,” it’s not differentiable. Harder to minimize. |</span>
<span id="cb29-688"><a href="#cb29-688" aria-hidden="true" tabindex="-1"></a>| Outliers                   | **Sensitive** to outliers (since they change mean substantially). Sensitivity also depends on the dataset size.                                                            | **More robust** to outliers.                                                                           |</span>
<span id="cb29-689"><a href="#cb29-689" aria-hidden="true" tabindex="-1"></a>| $\hat{\theta_0}$ Uniqueness | **Unique** $\hat{\theta_0}$                              | **Infinitely many** $\hat{\theta_0}$s                                    |</span>
<span id="cb29-690"><a href="#cb29-690" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-691"><a href="#cb29-691" aria-hidden="true" tabindex="-1"></a><span class="fu">## Transformations to fit Linear Models</span></span>
<span id="cb29-692"><a href="#cb29-692" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-693"><a href="#cb29-693" aria-hidden="true" tabindex="-1"></a>At this point, we have an effective method of fitting models to predict linear relationships. Given a feature variable and target, we can apply our four-step process to find the optimal model parameters.</span>
<span id="cb29-694"><a href="#cb29-694" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-695"><a href="#cb29-695" aria-hidden="true" tabindex="-1"></a>A key word above is _linear_. When we computed parameter estimates earlier, we assumed that $x_i$ and $y_i$ shared a roughly linear relationship. Data in the real world isn't always so straightforward, but we can transform the data to try and obtain linearity.</span>
<span id="cb29-696"><a href="#cb29-696" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-697"><a href="#cb29-697" aria-hidden="true" tabindex="-1"></a>The **Tukey-Mosteller Bulge Diagram** is a useful tool for summarizing what transformations can linearize the relationship between two variables. To determine what transformations might be appropriate, trace the shape of the "bulge" made by your data. Find the quadrant of the diagram that matches this bulge. The transformations shown on the vertical and horizontal axes of this quadrant can help improve the fit between the variables.</span>
<span id="cb29-698"><a href="#cb29-698" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-699"><a href="#cb29-699" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;img</span> <span class="er">src</span><span class="ot">=</span><span class="st">"images/bulge.png"</span> <span class="er">alt</span><span class="ot">=</span><span class="st">'bulge'</span> <span class="er">width</span><span class="ot">=</span><span class="st">'600'</span><span class="kw">&gt;</span></span>
<span id="cb29-700"><a href="#cb29-700" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-701"><a href="#cb29-701" aria-hidden="true" tabindex="-1"></a>Note that:</span>
<span id="cb29-702"><a href="#cb29-702" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-703"><a href="#cb29-703" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>There are multiple solutions. Some will fit better than others.</span>
<span id="cb29-704"><a href="#cb29-704" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>sqrt and log make a value “smaller.”</span>
<span id="cb29-705"><a href="#cb29-705" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Raising to a power makes a value “bigger.”</span>
<span id="cb29-706"><a href="#cb29-706" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Each of these transformations equates to increasing or decreasing the scale of an axis.</span>
<span id="cb29-707"><a href="#cb29-707" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-708"><a href="#cb29-708" aria-hidden="true" tabindex="-1"></a>Other goals in addition to linearity are possible, for example, making data appear more symmetric.</span>
<span id="cb29-709"><a href="#cb29-709" aria-hidden="true" tabindex="-1"></a>Linearity allows us to fit lines to the transformed data.</span>
<span id="cb29-710"><a href="#cb29-710" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-711"><a href="#cb29-711" aria-hidden="true" tabindex="-1"></a>Let's revisit our dugongs example. The lengths and ages are plotted below:</span>
<span id="cb29-712"><a href="#cb29-712" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-715"><a href="#cb29-715" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb29-716"><a href="#cb29-716" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: true</span></span>
<span id="cb29-717"><a href="#cb29-717" aria-hidden="true" tabindex="-1"></a><span class="co">#| vscode: {languageId: python}</span></span>
<span id="cb29-718"><a href="#cb29-718" aria-hidden="true" tabindex="-1"></a><span class="co"># `corrcoef` computes the correlation coefficient between two variables</span></span>
<span id="cb29-719"><a href="#cb29-719" aria-hidden="true" tabindex="-1"></a><span class="co"># `std` finds the standard deviation</span></span>
<span id="cb29-720"><a href="#cb29-720" aria-hidden="true" tabindex="-1"></a>x <span class="op">=</span> dugongs[<span class="st">"Length"</span>]</span>
<span id="cb29-721"><a href="#cb29-721" aria-hidden="true" tabindex="-1"></a>y <span class="op">=</span> dugongs[<span class="st">"Age"</span>]</span>
<span id="cb29-722"><a href="#cb29-722" aria-hidden="true" tabindex="-1"></a>r <span class="op">=</span> np.corrcoef(x, y)[<span class="dv">0</span>, <span class="dv">1</span>]</span>
<span id="cb29-723"><a href="#cb29-723" aria-hidden="true" tabindex="-1"></a>theta_1 <span class="op">=</span> r <span class="op">*</span> np.std(y) <span class="op">/</span> np.std(x)</span>
<span id="cb29-724"><a href="#cb29-724" aria-hidden="true" tabindex="-1"></a>theta_0 <span class="op">=</span> np.mean(y) <span class="op">-</span> theta_1 <span class="op">*</span> np.mean(x)</span>
<span id="cb29-725"><a href="#cb29-725" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-726"><a href="#cb29-726" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(<span class="dv">1</span>, <span class="dv">2</span>, dpi<span class="op">=</span><span class="dv">200</span>, figsize<span class="op">=</span>(<span class="dv">8</span>, <span class="dv">3</span>))</span>
<span id="cb29-727"><a href="#cb29-727" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">0</span>].scatter(x, y)</span>
<span id="cb29-728"><a href="#cb29-728" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">0</span>].set_xlabel(<span class="st">"Length"</span>)</span>
<span id="cb29-729"><a href="#cb29-729" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">0</span>].set_ylabel(<span class="st">"Age"</span>)</span>
<span id="cb29-730"><a href="#cb29-730" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-731"><a href="#cb29-731" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">1</span>].scatter(x, y)</span>
<span id="cb29-732"><a href="#cb29-732" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">1</span>].plot(x, theta_0 <span class="op">+</span> theta_1 <span class="op">*</span> x, <span class="st">"tab:red"</span>)</span>
<span id="cb29-733"><a href="#cb29-733" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">1</span>].set_xlabel(<span class="st">"Length"</span>)</span>
<span id="cb29-734"><a href="#cb29-734" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">1</span>].set_ylabel(<span class="st">"Age"</span>)</span>
<span id="cb29-735"><a href="#cb29-735" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb29-736"><a href="#cb29-736" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-737"><a href="#cb29-737" aria-hidden="true" tabindex="-1"></a>Looking at the plot on the left, we see that there is a slight curvature to the data points. Plotting the SLR curve on the right results in a poor fit.</span>
<span id="cb29-738"><a href="#cb29-738" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-739"><a href="#cb29-739" aria-hidden="true" tabindex="-1"></a>For SLR to perform well, we'd like there to be a rough linear trend relating <span class="in">`"Age"`</span> and <span class="in">`"Length"`</span>. What is making the raw data deviate from a linear relationship? Notice that the data points with <span class="in">`"Length"`</span> greater than 2.6 have disproportionately high values of <span class="in">`"Age"`</span> relative to the rest of the data. If we could manipulate these data points to have lower <span class="in">`"Age"`</span> values, we'd "shift" these points downwards and reduce the curvature in the data. Applying a logarithmic transformation to $y_i$ (that is, taking $\log($ <span class="in">`"Age"`</span> $)$ ) would achieve just that.</span>
<span id="cb29-740"><a href="#cb29-740" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-741"><a href="#cb29-741" aria-hidden="true" tabindex="-1"></a>An important word on $\log$: in Data 100 (and most upper-division STEM courses), $\log$ denotes the natural logarithm with base $e$. The base-10 logarithm, where relevant, is indicated by $\log_{10}$.</span>
<span id="cb29-742"><a href="#cb29-742" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-745"><a href="#cb29-745" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb29-746"><a href="#cb29-746" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: true</span></span>
<span id="cb29-747"><a href="#cb29-747" aria-hidden="true" tabindex="-1"></a><span class="co">#| vscode: {languageId: python}</span></span>
<span id="cb29-748"><a href="#cb29-748" aria-hidden="true" tabindex="-1"></a>z <span class="op">=</span> np.log(y)</span>
<span id="cb29-749"><a href="#cb29-749" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-750"><a href="#cb29-750" aria-hidden="true" tabindex="-1"></a>r <span class="op">=</span> np.corrcoef(x, z)[<span class="dv">0</span>, <span class="dv">1</span>]</span>
<span id="cb29-751"><a href="#cb29-751" aria-hidden="true" tabindex="-1"></a>theta_1 <span class="op">=</span> r <span class="op">*</span> np.std(z) <span class="op">/</span> np.std(x)</span>
<span id="cb29-752"><a href="#cb29-752" aria-hidden="true" tabindex="-1"></a>theta_0 <span class="op">=</span> np.mean(z) <span class="op">-</span> theta_1 <span class="op">*</span> np.mean(x)</span>
<span id="cb29-753"><a href="#cb29-753" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-754"><a href="#cb29-754" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(<span class="dv">1</span>, <span class="dv">2</span>, dpi<span class="op">=</span><span class="dv">200</span>, figsize<span class="op">=</span>(<span class="dv">8</span>, <span class="dv">3</span>))</span>
<span id="cb29-755"><a href="#cb29-755" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">0</span>].scatter(x, z)</span>
<span id="cb29-756"><a href="#cb29-756" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">0</span>].set_xlabel(<span class="st">"Length"</span>)</span>
<span id="cb29-757"><a href="#cb29-757" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">0</span>].set_ylabel(<span class="vs">r"$\log{(Age)}$"</span>)</span>
<span id="cb29-758"><a href="#cb29-758" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-759"><a href="#cb29-759" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">1</span>].scatter(x, z)</span>
<span id="cb29-760"><a href="#cb29-760" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">1</span>].plot(x, theta_0 <span class="op">+</span> theta_1 <span class="op">*</span> x, <span class="st">"tab:red"</span>)</span>
<span id="cb29-761"><a href="#cb29-761" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">1</span>].set_xlabel(<span class="st">"Length"</span>)</span>
<span id="cb29-762"><a href="#cb29-762" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">1</span>].set_ylabel(<span class="vs">r"$\log{(Age)}$"</span>)</span>
<span id="cb29-763"><a href="#cb29-763" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-764"><a href="#cb29-764" aria-hidden="true" tabindex="-1"></a>plt.subplots_adjust(wspace<span class="op">=</span><span class="fl">0.3</span>)</span>
<span id="cb29-765"><a href="#cb29-765" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb29-766"><a href="#cb29-766" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-767"><a href="#cb29-767" aria-hidden="true" tabindex="-1"></a>Our SLR fit looks a lot better! We now have a new target variable: the SLR model is now trying to predict the _log_ of <span class="in">`"Age"`</span>, rather than the untransformed <span class="in">`"Age"`</span>. In other words, we are applying the transformation $z_i = \log{(y_i)}$. Notice that the resulting model is still **linear in the parameters** $\theta = <span class="co">[</span><span class="ot">\theta_0, \theta_1</span><span class="co">]</span>$. The SLR model becomes:</span>
<span id="cb29-768"><a href="#cb29-768" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-769"><a href="#cb29-769" aria-hidden="true" tabindex="-1"></a>$$\hat{\log{y}} = \theta_0 + \theta_1 x$$</span>
<span id="cb29-770"><a href="#cb29-770" aria-hidden="true" tabindex="-1"></a>$$\hat{z} = \theta_0 + \theta_1 x$$</span>
<span id="cb29-771"><a href="#cb29-771" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-772"><a href="#cb29-772" aria-hidden="true" tabindex="-1"></a>It turns out that this linearized relationship can help us understand the underlying relationship between $x$ and $y$. If we rearrange the relationship above, we find:</span>
<span id="cb29-773"><a href="#cb29-773" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-774"><a href="#cb29-774" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb29-775"><a href="#cb29-775" aria-hidden="true" tabindex="-1"></a>\log{(y)} = \theta_0 + \theta_1 x <span class="sc">\\</span></span>
<span id="cb29-776"><a href="#cb29-776" aria-hidden="true" tabindex="-1"></a>y = e^{\theta_0 + \theta_1 x} <span class="sc">\\</span></span>
<span id="cb29-777"><a href="#cb29-777" aria-hidden="true" tabindex="-1"></a>y = (e^{\theta_0})e^{\theta_1 x} <span class="sc">\\</span></span>
<span id="cb29-778"><a href="#cb29-778" aria-hidden="true" tabindex="-1"></a>y_i = C e^{k x}</span>
<span id="cb29-779"><a href="#cb29-779" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb29-780"><a href="#cb29-780" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-781"><a href="#cb29-781" aria-hidden="true" tabindex="-1"></a>For some constants $C$ and $k$.</span>
<span id="cb29-782"><a href="#cb29-782" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-783"><a href="#cb29-783" aria-hidden="true" tabindex="-1"></a>$y$ is an *exponential* function of $x$. Applying an exponential fit to the untransformed variables corroborates this finding.</span>
<span id="cb29-784"><a href="#cb29-784" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-787"><a href="#cb29-787" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb29-788"><a href="#cb29-788" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: true</span></span>
<span id="cb29-789"><a href="#cb29-789" aria-hidden="true" tabindex="-1"></a><span class="co">#| vscode: {languageId: python}</span></span>
<span id="cb29-790"><a href="#cb29-790" aria-hidden="true" tabindex="-1"></a>plt.figure(dpi<span class="op">=</span><span class="dv">120</span>, figsize<span class="op">=</span>(<span class="dv">4</span>, <span class="dv">3</span>))</span>
<span id="cb29-791"><a href="#cb29-791" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-792"><a href="#cb29-792" aria-hidden="true" tabindex="-1"></a>plt.scatter(x, y)</span>
<span id="cb29-793"><a href="#cb29-793" aria-hidden="true" tabindex="-1"></a>plt.plot(x, np.exp(theta_0) <span class="op">*</span> np.exp(theta_1 <span class="op">*</span> x), <span class="st">"tab:red"</span>)</span>
<span id="cb29-794"><a href="#cb29-794" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">"Length"</span>)</span>
<span id="cb29-795"><a href="#cb29-795" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">"Age"</span>)</span>
<span id="cb29-796"><a href="#cb29-796" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb29-797"><a href="#cb29-797" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-798"><a href="#cb29-798" aria-hidden="true" tabindex="-1"></a>You may wonder: why did we choose to apply a log transformation specifically? Why not some other function to linearize the data?</span>
<span id="cb29-799"><a href="#cb29-799" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-800"><a href="#cb29-800" aria-hidden="true" tabindex="-1"></a>Practically, many other mathematical operations that modify the relative scales of <span class="in">`"Age"`</span> and <span class="in">`"Length"`</span> could have worked here.</span>
<span id="cb29-801"><a href="#cb29-801" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-802"><a href="#cb29-802" aria-hidden="true" tabindex="-1"></a><span class="fu">## Multiple Linear Regression</span></span>
<span id="cb29-803"><a href="#cb29-803" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-804"><a href="#cb29-804" aria-hidden="true" tabindex="-1"></a>Multiple linear regression is an extension of simple linear regression that adds additional features to the model. The multiple linear regression model takes the form:</span>
<span id="cb29-805"><a href="#cb29-805" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-806"><a href="#cb29-806" aria-hidden="true" tabindex="-1"></a>$$\hat{y} = \theta_0\:+\:\theta_1x_{1}\:+\:\theta_2 x_{2}\:+\:...\:+\:\theta_p x_{p}$$</span>
<span id="cb29-807"><a href="#cb29-807" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-808"><a href="#cb29-808" aria-hidden="true" tabindex="-1"></a>Our predicted value of $y$, $\hat{y}$, is a linear combination of the single **observations** (features), $x_i$, and the parameters, $\theta_i$.</span>
<span id="cb29-809"><a href="#cb29-809" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-810"><a href="#cb29-810" aria-hidden="true" tabindex="-1"></a>We'll dive deeper into Multiple Linear Regression in the next lecture.</span>
<span id="cb29-811"><a href="#cb29-811" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-812"><a href="#cb29-812" aria-hidden="true" tabindex="-1"></a><span class="fu">## Bonus: Calculating Constant Model MSE Using an Algebraic Trick</span></span>
<span id="cb29-813"><a href="#cb29-813" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-814"><a href="#cb29-814" aria-hidden="true" tabindex="-1"></a>Earlier, we calculated the constant model MSE using calculus. It turns out that there is a much more elegant way of performing this same minimization algebraically, without using calculus at all.</span>
<span id="cb29-815"><a href="#cb29-815" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-816"><a href="#cb29-816" aria-hidden="true" tabindex="-1"></a>In this calculation, we use the fact that the **sum of deviations from the mean is $0$** or that $\sum_{i=1}^{n} (y_i - \bar{y}) = 0$.</span>
<span id="cb29-817"><a href="#cb29-817" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-818"><a href="#cb29-818" aria-hidden="true" tabindex="-1"></a>Let's quickly walk through the proof for this:</span>
<span id="cb29-819"><a href="#cb29-819" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb29-820"><a href="#cb29-820" aria-hidden="true" tabindex="-1"></a>\begin{align}</span>
<span id="cb29-821"><a href="#cb29-821" aria-hidden="true" tabindex="-1"></a>\sum_{i=1}^{n} (y_i - \bar{y}) &amp;= \sum_{i=1}^{n} y_i - \sum_{i=1}^{n} \bar{y} <span class="sc">\\</span></span>
<span id="cb29-822"><a href="#cb29-822" aria-hidden="true" tabindex="-1"></a> &amp;= \sum_{i=1}^{n} y_i - n\bar{y} <span class="sc">\\</span></span>
<span id="cb29-823"><a href="#cb29-823" aria-hidden="true" tabindex="-1"></a> &amp;= \sum_{i=1}^{n} y_i - n\frac{1}{n}\sum_{i=1}^{n}y_i <span class="sc">\\</span></span>
<span id="cb29-824"><a href="#cb29-824" aria-hidden="true" tabindex="-1"></a> &amp;= \sum_{i=1}^{n} y_i - \sum_{i=1}^{n}y_i <span class="sc">\\</span></span>
<span id="cb29-825"><a href="#cb29-825" aria-hidden="true" tabindex="-1"></a> &amp; = 0</span>
<span id="cb29-826"><a href="#cb29-826" aria-hidden="true" tabindex="-1"></a>\end{align}</span>
<span id="cb29-827"><a href="#cb29-827" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb29-828"><a href="#cb29-828" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-829"><a href="#cb29-829" aria-hidden="true" tabindex="-1"></a>In our calculations, we'll also be using the definition of the variance as a sample. As a refresher:</span>
<span id="cb29-830"><a href="#cb29-830" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-831"><a href="#cb29-831" aria-hidden="true" tabindex="-1"></a>$$\sigma_y^2 = \frac{1}{n}\sum_{i=1}^{n} (y_i - \bar{y})^2$$</span>
<span id="cb29-832"><a href="#cb29-832" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-833"><a href="#cb29-833" aria-hidden="true" tabindex="-1"></a>Getting into our calculation for MSE minimization:</span>
<span id="cb29-834"><a href="#cb29-834" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-835"><a href="#cb29-835" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb29-836"><a href="#cb29-836" aria-hidden="true" tabindex="-1"></a>\begin{align}</span>
<span id="cb29-837"><a href="#cb29-837" aria-hidden="true" tabindex="-1"></a>R(\theta) &amp;= {\frac{1}{n}}\sum^{n}_{i=1} (y_i - \theta)^2</span>
<span id="cb29-838"><a href="#cb29-838" aria-hidden="true" tabindex="-1"></a><span class="sc">\\</span> &amp;= \frac{1}{n}\sum^{n}_{i=1} <span class="co">[</span><span class="ot">(y_i - \bar{y}) + (\bar{y} - \theta)</span><span class="co">]</span>^2\quad \quad \text{using trick that a-b can be written as (a-c) + (c-b) } <span class="sc">\\</span></span>
<span id="cb29-839"><a href="#cb29-839" aria-hidden="true" tabindex="-1"></a>&amp;\quad \quad \quad \quad \quad \quad \quad \quad \quad \quad \quad \quad \quad \quad \space \space \text{where a, b, and c are any numbers}</span>
<span id="cb29-840"><a href="#cb29-840" aria-hidden="true" tabindex="-1"></a><span class="sc">\\</span> &amp;= \frac{1}{n}\sum^{n}_{i=1} <span class="co">[</span><span class="ot">(y_i - \bar{y})^2 + 2(y_i - \bar{y})(\bar{y} - \theta) + (\bar{y} - \theta)^2</span><span class="co">]</span></span>
<span id="cb29-841"><a href="#cb29-841" aria-hidden="true" tabindex="-1"></a><span class="sc">\\</span> &amp;= \frac{1}{n}<span class="co">[</span><span class="ot">\sum^{n}_{i=1}(y_i - \bar{y})^2 + 2(\bar{y} - \theta)\sum^{n}_{i=1}(y_i - \bar{y}) + n(\bar{y} - \theta)^2</span><span class="co">]</span> \quad \quad  \text{distribute sum to individual terms}</span>
<span id="cb29-842"><a href="#cb29-842" aria-hidden="true" tabindex="-1"></a><span class="sc">\\</span> &amp;= \frac{1}{n}\sum^{n}_{i=1}(y_i - \bar{y})^2 + \frac{2}{n}(\bar{y} - \theta)\cdot0 + (\bar{y} - \theta)^2 \quad \quad  \text{sum of deviations from mean is 0}</span>
<span id="cb29-843"><a href="#cb29-843" aria-hidden="true" tabindex="-1"></a><span class="sc">\\</span> &amp;= \sigma_y^2 + (\bar{y} - \theta)^2</span>
<span id="cb29-844"><a href="#cb29-844" aria-hidden="true" tabindex="-1"></a>\end{align}</span>
<span id="cb29-845"><a href="#cb29-845" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb29-846"><a href="#cb29-846" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-847"><a href="#cb29-847" aria-hidden="true" tabindex="-1"></a>Since variance can't be negative, we know that our first term, $\sigma_y^2$ is greater than or equal to $0$. Also note, that **the first term doesn't involve $\theta$ at all**, meaning changing our model won't change this value. For the purposes of determining $\hat{\theta}#, we can then essentially ignore this term.</span>
<span id="cb29-848"><a href="#cb29-848" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-849"><a href="#cb29-849" aria-hidden="true" tabindex="-1"></a>Looking at the second term, $(\bar{y} - \theta)^2$, since it is squared, we know it must be greater than or equal to $0$. As this term does involve $\theta$, picking the value of $\theta$ that minimizes this term will allow us to minimize our average loss. For the second term to equal $0$, $\theta = \bar{y}$, or in other words, $\hat{\theta} = \bar{y} = mean(y)$.</span>
<span id="cb29-850"><a href="#cb29-850" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-851"><a href="#cb29-851" aria-hidden="true" tabindex="-1"></a><span class="fu">##### Note</span></span>
<span id="cb29-852"><a href="#cb29-852" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-853"><a href="#cb29-853" aria-hidden="true" tabindex="-1"></a>In the derivation above, we decompose the expected loss, $R(\theta)$, into two key components: the variance of the data, $\sigma_y^2$, and the square of the bias, $(\bar{y} - \theta)^2$. This decomposition is insightful for understanding the behavior of estimators in statistical models.</span>
<span id="cb29-854"><a href="#cb29-854" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-855"><a href="#cb29-855" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Variance, $\sigma_y^2$**: This term represents the spread of the data points around their mean, $\bar{y}$, and is a measure of the data's inherent variability. Importantly, it does not depend on the choice of $\theta$, meaning it's a fixed property of the data. Variance serves as an indicator of the data's dispersion and is crucial in understanding the dataset's structure, but it remains constant regardless of how we adjust our model parameter $\theta$.</span>
<span id="cb29-856"><a href="#cb29-856" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-857"><a href="#cb29-857" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Bias Squared, $(\bar{y} - \theta)^2$**: This term captures the bias of the estimator, defined as the square of the difference between the mean of the data points, $\bar{y}$, and the parameter $\theta$. The bias quantifies the systematic error introduced when estimating $\theta$. Minimizing this term is essential for improving the accuracy of the estimator. When $\theta = \bar{y}$, the bias is $0$, indicating that the estimator is unbiased for the parameter it estimates. This highlights a critical principle in statistical estimation: choosing $\theta$ to be the sample mean, $\bar{y}$, minimizes the average loss, rendering the estimator both efficient and unbiased for the population mean.</span>
</code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->



</body></html>
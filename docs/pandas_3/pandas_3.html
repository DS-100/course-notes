<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.549">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Principles and Techniques of Data Science - 4&nbsp; Pandas III</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script><script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<link href="../eda/eda.html" rel="next">
<link href="../pandas_2/pandas_2.html" rel="prev">
<link href="../data100_logo.png" rel="icon" type="image/png">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>

<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>
<script type="text/javascript">
window.PlotlyConfig = {MathJaxConfig: 'local'};
if (window.MathJax && window.MathJax.Hub && window.MathJax.Hub.Config) {window.MathJax.Hub.Config({SVG: {font: "STIX-Web"}});}
if (typeof require !== 'undefined') {
require.undef("plotly");
requirejs.config({
    paths: {
        'plotly': ['https://cdn.plot.ly/plotly-2.18.2.min']
    }
});
require(['plotly'], function(Plotly) {
    window._Plotly = Plotly;
});
}
</script>



</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../pandas_3/pandas_3.html"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Pandas III</span></a></li></ol></nav>
        <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-full">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header sidebar-header-stacked">
      <a href="../index.html" class="sidebar-logo-link">
      <img src="../data100_logo.png" alt="" class="sidebar-logo py-0 d-lg-inline d-none">
      </a>
    <div class="sidebar-title mb-0 py-0">
      <a href="../">Principles and Techniques of Data Science</a> 
        <div class="sidebar-tools-main">
    <a href="https://github.com/DS-100/course-notes" title="Source Code" class="quarto-navigation-tool px-1" aria-label="Source Code"><i class="bi bi-github"></i></a>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Welcome</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../intro_lec/introduction.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Introduction</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../pandas_1/pandas_1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Pandas I</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../pandas_2/pandas_2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Pandas II</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../pandas_3/pandas_3.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Pandas III</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../eda/eda.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Data Cleaning and EDA</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../regex/regex.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Regular Expressions</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../visualization_1/visualization_1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Visualization I</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../visualization_2/visualization_2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Visualization II</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../sampling/sampling.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Sampling</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../intro_to_modeling/intro_to_modeling.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Introduction to Modeling</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../constant_model_loss_transformations/loss_transformations.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Constant Model, Loss, and Transformations</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../ols/ols.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Ordinary Least Squares</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../gradient_descent/gradient_descent.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">sklearn and Gradient Descent</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../feature_engineering/feature_engineering.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Feature Engineering</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../case_study_HCE/case_study_HCE.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">Case Study in Human Contexts and Ethics</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../cv_regularization/cv_reg.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">16</span>&nbsp; <span class="chapter-title">Cross Validation and Regularization</span></span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Pandas III</h2>
   
  <ul>
  <li><a href="#custom-sorts" id="toc-custom-sorts" class="nav-link active" data-scroll-target="#custom-sorts"><span class="header-section-number">4.1</span> Custom Sorts</a>
  <ul>
  <li><a href="#approach-1-create-a-temporary-column" id="toc-approach-1-create-a-temporary-column" class="nav-link" data-scroll-target="#approach-1-create-a-temporary-column"><span class="header-section-number">4.1.1</span> Approach 1: Create a Temporary Column</a></li>
  <li><a href="#approach-2-sorting-using-the-key-argument" id="toc-approach-2-sorting-using-the-key-argument" class="nav-link" data-scroll-target="#approach-2-sorting-using-the-key-argument"><span class="header-section-number">4.1.2</span> Approach 2: Sorting using the <code>key</code> Argument</a></li>
  <li><a href="#approach-3-sorting-using-the-map-function" id="toc-approach-3-sorting-using-the-map-function" class="nav-link" data-scroll-target="#approach-3-sorting-using-the-map-function"><span class="header-section-number">4.1.3</span> Approach 3: Sorting using the <code>map</code> Function</a></li>
  </ul></li>
  <li><a href="#aggregating-data-with-.groupby" id="toc-aggregating-data-with-.groupby" class="nav-link" data-scroll-target="#aggregating-data-with-.groupby"><span class="header-section-number">4.2</span> Aggregating Data with <code>.groupby</code></a>
  <ul>
  <li><a href="#aggregation-functions" id="toc-aggregation-functions" class="nav-link" data-scroll-target="#aggregation-functions"><span class="header-section-number">4.2.1</span> Aggregation Functions</a></li>
  <li><a href="#plotting-birth-counts" id="toc-plotting-birth-counts" class="nav-link" data-scroll-target="#plotting-birth-counts"><span class="header-section-number">4.2.2</span> Plotting Birth Counts</a></li>
  <li><a href="#summary-of-the-.groupby-function" id="toc-summary-of-the-.groupby-function" class="nav-link" data-scroll-target="#summary-of-the-.groupby-function"><span class="header-section-number">4.2.3</span> Summary of the <code>.groupby()</code> Function</a></li>
  <li><a href="#revisiting-the-.agg-function" id="toc-revisiting-the-.agg-function" class="nav-link" data-scroll-target="#revisiting-the-.agg-function"><span class="header-section-number">4.2.4</span> Revisiting the <code>.agg()</code> Function</a></li>
  <li><a href="#nuisance-columns" id="toc-nuisance-columns" class="nav-link" data-scroll-target="#nuisance-columns"><span class="header-section-number">4.2.5</span> Nuisance Columns</a></li>
  <li><a href="#renaming-columns-after-grouping" id="toc-renaming-columns-after-grouping" class="nav-link" data-scroll-target="#renaming-columns-after-grouping"><span class="header-section-number">4.2.6</span> Renaming Columns After Grouping</a></li>
  <li><a href="#some-data-science-payoff" id="toc-some-data-science-payoff" class="nav-link" data-scroll-target="#some-data-science-payoff"><span class="header-section-number">4.2.7</span> Some Data Science Payoff</a></li>
  </ul></li>
  <li><a href="#groupby-continued" id="toc-groupby-continued" class="nav-link" data-scroll-target="#groupby-continued"><span class="header-section-number">4.3</span> <code>.groupby()</code>, Continued</a>
  <ul>
  <li><a href="#raw-groupby-objects" id="toc-raw-groupby-objects" class="nav-link" data-scroll-target="#raw-groupby-objects"><span class="header-section-number">4.3.1</span> Raw <code>GroupBy</code> Objects</a></li>
  <li><a href="#other-groupby-methods" id="toc-other-groupby-methods" class="nav-link" data-scroll-target="#other-groupby-methods"><span class="header-section-number">4.3.2</span> Other <code>GroupBy</code> Methods</a></li>
  <li><a href="#filtering-by-group" id="toc-filtering-by-group" class="nav-link" data-scroll-target="#filtering-by-group"><span class="header-section-number">4.3.3</span> Filtering by Group</a></li>
  <li><a href="#aggregation-with-lambda-functions" id="toc-aggregation-with-lambda-functions" class="nav-link" data-scroll-target="#aggregation-with-lambda-functions"><span class="header-section-number">4.3.4</span> Aggregation with <code>lambda</code> Functions</a></li>
  </ul></li>
  <li><a href="#aggregating-data-with-pivot-tables" id="toc-aggregating-data-with-pivot-tables" class="nav-link" data-scroll-target="#aggregating-data-with-pivot-tables"><span class="header-section-number">4.4</span> Aggregating Data with Pivot Tables</a></li>
  <li><a href="#joining-tables" id="toc-joining-tables" class="nav-link" data-scroll-target="#joining-tables"><span class="header-section-number">4.5</span> Joining Tables</a></li>
  <li><a href="#parting-note" id="toc-parting-note" class="nav-link" data-scroll-target="#parting-note"><span class="header-section-number">4.6</span> Parting Note</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content column-body" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Pandas III</span></h1><button type="button" class="btn code-tools-button dropdown-toggle" id="quarto-code-tools-menu" data-bs-toggle="dropdown" aria-expanded="false"><i class="bi"></i> Code</button><ul class="dropdown-menu dropdown-menu-end" aria-labelelledby="quarto-code-tools-menu"><li><a id="quarto-show-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Show All Code</a></li><li><a id="quarto-hide-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Hide All Code</a></li><li><hr class="dropdown-divider"></li><li><a id="quarto-view-source" class="dropdown-item" href="javascript:void(0)" role="button">View Source</a></li></ul></div></div>
</div>



<div class="quarto-title-meta column-body">

    
  
    
  </div>
  


</header>


<div class="callout callout-style-default callout-note no-icon callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-1-contents" aria-controls="callout-1" aria-expanded="true" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Learning Outcomes
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-1" class="callout-1-contents callout-collapse collapse show">
<div class="callout-body-container callout-body">
<ul>
<li>Perform advanced aggregation using <code>.groupby()</code></li>
<li>Use the <code>pd.pivot_table</code> method to construct a pivot table</li>
<li>Perform simple merges between DataFrames using <code>pd.merge()</code></li>
</ul>
</div>
</div>
</div>
<p>We will introduce the concept of aggregating data – we will familiarize ourselves with <code>GroupBy</code> objects and used them as tools to consolidate and summarize a<code>DataFrame</code>. In this lecture, we will explore working with the different aggregation functions and dive into some advanced <code>.groupby</code> methods to show just how powerful of a resource they can be for understanding our data. We will also introduce other techniques for data aggregation to provide flexibility in how we manipulate our tables.</p>
<section id="custom-sorts" class="level2" data-number="4.1">
<h2 data-number="4.1" class="anchored" data-anchor-id="custom-sorts"><span class="header-section-number">4.1</span> Custom Sorts</h2>
<p>First, let’s finish our discussion about sorting. Let’s try to solve a sorting problem using different approaches. Assume we want to find the longest baby names and sort our data accordingly.</p>
<p>We’ll start by loading the <code>babynames</code> dataset. Note that this dataset is filtered to only contain data from California.</p>
<div id="bc220333" class="cell" data-execution_count="1">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># This code pulls census data and loads it into a DataFrame</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="co"># We won't cover it explicitly in this class, but you are welcome to explore it on your own</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> urllib.request</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> os.path</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> zipfile</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>data_url <span class="op">=</span> <span class="st">"https://www.ssa.gov/oact/babynames/state/namesbystate.zip"</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>local_filename <span class="op">=</span> <span class="st">"data/babynamesbystate.zip"</span></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="kw">not</span> os.path.exists(local_filename): <span class="co"># If the data exists don't download again</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">with</span> urllib.request.urlopen(data_url) <span class="im">as</span> resp, <span class="bu">open</span>(local_filename, <span class="st">'wb'</span>) <span class="im">as</span> f:</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>        f.write(resp.read())</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a>zf <span class="op">=</span> zipfile.ZipFile(local_filename, <span class="st">'r'</span>)</span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a>ca_name <span class="op">=</span> <span class="st">'STATE.CA.TXT'</span></span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a>field_names <span class="op">=</span> [<span class="st">'State'</span>, <span class="st">'Sex'</span>, <span class="st">'Year'</span>, <span class="st">'Name'</span>, <span class="st">'Count'</span>]</span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> zf.<span class="bu">open</span>(ca_name) <span class="im">as</span> fh:</span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a>    babynames <span class="op">=</span> pd.read_csv(fh, header<span class="op">=</span><span class="va">None</span>, names<span class="op">=</span>field_names)</span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a>babynames.tail(<span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="1">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">State</th>
<th data-quarto-table-cell-role="th">Sex</th>
<th data-quarto-table-cell-role="th">Year</th>
<th data-quarto-table-cell-role="th">Name</th>
<th data-quarto-table-cell-role="th">Count</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">407418</td>
<td>CA</td>
<td>M</td>
<td>2022</td>
<td>Zach</td>
<td>5</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">407419</td>
<td>CA</td>
<td>M</td>
<td>2022</td>
<td>Zadkiel</td>
<td>5</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">407420</td>
<td>CA</td>
<td>M</td>
<td>2022</td>
<td>Zae</td>
<td>5</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">407421</td>
<td>CA</td>
<td>M</td>
<td>2022</td>
<td>Zai</td>
<td>5</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">407422</td>
<td>CA</td>
<td>M</td>
<td>2022</td>
<td>Zay</td>
<td>5</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">407423</td>
<td>CA</td>
<td>M</td>
<td>2022</td>
<td>Zayvier</td>
<td>5</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">407424</td>
<td>CA</td>
<td>M</td>
<td>2022</td>
<td>Zia</td>
<td>5</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">407425</td>
<td>CA</td>
<td>M</td>
<td>2022</td>
<td>Zora</td>
<td>5</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">407426</td>
<td>CA</td>
<td>M</td>
<td>2022</td>
<td>Zuriel</td>
<td>5</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">407427</td>
<td>CA</td>
<td>M</td>
<td>2022</td>
<td>Zylo</td>
<td>5</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<section id="approach-1-create-a-temporary-column" class="level3" data-number="4.1.1">
<h3 data-number="4.1.1" class="anchored" data-anchor-id="approach-1-create-a-temporary-column"><span class="header-section-number">4.1.1</span> Approach 1: Create a Temporary Column</h3>
<p>One method to do this is to first start by creating a column that contains the lengths of the names.</p>
<div id="aa6df181" class="cell" data-execution_count="2">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a Series of the length of each name</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>babyname_lengths <span class="op">=</span> babynames[<span class="st">"Name"</span>].<span class="bu">str</span>.<span class="bu">len</span>()</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Add a column named "name_lengths" that includes the length of each name</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>babynames[<span class="st">"name_lengths"</span>] <span class="op">=</span> babyname_lengths</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>babynames.head(<span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="2">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">State</th>
<th data-quarto-table-cell-role="th">Sex</th>
<th data-quarto-table-cell-role="th">Year</th>
<th data-quarto-table-cell-role="th">Name</th>
<th data-quarto-table-cell-role="th">Count</th>
<th data-quarto-table-cell-role="th">name_lengths</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>CA</td>
<td>F</td>
<td>1910</td>
<td>Mary</td>
<td>295</td>
<td>4</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>CA</td>
<td>F</td>
<td>1910</td>
<td>Helen</td>
<td>239</td>
<td>5</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>CA</td>
<td>F</td>
<td>1910</td>
<td>Dorothy</td>
<td>220</td>
<td>7</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>CA</td>
<td>F</td>
<td>1910</td>
<td>Margaret</td>
<td>163</td>
<td>8</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>CA</td>
<td>F</td>
<td>1910</td>
<td>Frances</td>
<td>134</td>
<td>7</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>We can then sort the <code>DataFrame</code> by that column using <code>.sort_values()</code>:</p>
<div id="6e3c3452" class="cell" data-execution_count="3">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Sort by the temporary column</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>babynames <span class="op">=</span> babynames.sort_values(by<span class="op">=</span><span class="st">"name_lengths"</span>, ascending<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>babynames.head(<span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="3">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">State</th>
<th data-quarto-table-cell-role="th">Sex</th>
<th data-quarto-table-cell-role="th">Year</th>
<th data-quarto-table-cell-role="th">Name</th>
<th data-quarto-table-cell-role="th">Count</th>
<th data-quarto-table-cell-role="th">name_lengths</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">334166</td>
<td>CA</td>
<td>M</td>
<td>1996</td>
<td>Franciscojavier</td>
<td>8</td>
<td>15</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">337301</td>
<td>CA</td>
<td>M</td>
<td>1997</td>
<td>Franciscojavier</td>
<td>5</td>
<td>15</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">339472</td>
<td>CA</td>
<td>M</td>
<td>1998</td>
<td>Franciscojavier</td>
<td>6</td>
<td>15</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">321792</td>
<td>CA</td>
<td>M</td>
<td>1991</td>
<td>Ryanchristopher</td>
<td>7</td>
<td>15</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">327358</td>
<td>CA</td>
<td>M</td>
<td>1993</td>
<td>Johnchristopher</td>
<td>5</td>
<td>15</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>Finally, we can drop the <code>name_length</code> column from <code>babynames</code> to prevent our table from getting cluttered.</p>
<div id="80af12bf" class="cell" data-execution_count="4">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Drop the 'name_length' column</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>babynames <span class="op">=</span> babynames.drop(<span class="st">"name_lengths"</span>, axis<span class="op">=</span><span class="st">'columns'</span>)</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>babynames.head(<span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="4">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">State</th>
<th data-quarto-table-cell-role="th">Sex</th>
<th data-quarto-table-cell-role="th">Year</th>
<th data-quarto-table-cell-role="th">Name</th>
<th data-quarto-table-cell-role="th">Count</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">334166</td>
<td>CA</td>
<td>M</td>
<td>1996</td>
<td>Franciscojavier</td>
<td>8</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">337301</td>
<td>CA</td>
<td>M</td>
<td>1997</td>
<td>Franciscojavier</td>
<td>5</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">339472</td>
<td>CA</td>
<td>M</td>
<td>1998</td>
<td>Franciscojavier</td>
<td>6</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">321792</td>
<td>CA</td>
<td>M</td>
<td>1991</td>
<td>Ryanchristopher</td>
<td>7</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">327358</td>
<td>CA</td>
<td>M</td>
<td>1993</td>
<td>Johnchristopher</td>
<td>5</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
<section id="approach-2-sorting-using-the-key-argument" class="level3" data-number="4.1.2">
<h3 data-number="4.1.2" class="anchored" data-anchor-id="approach-2-sorting-using-the-key-argument"><span class="header-section-number">4.1.2</span> Approach 2: Sorting using the <code>key</code> Argument</h3>
<p>Another way to approach this is to use the <code>key</code> argument of <code>.sort_values()</code>. Here we can specify that we want to sort <code>"Name"</code> values by their length.</p>
<div id="1ae2a711" class="cell" data-execution_count="5">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>babynames.sort_values(<span class="st">"Name"</span>, key<span class="op">=</span><span class="kw">lambda</span> x: x.<span class="bu">str</span>.<span class="bu">len</span>(), ascending<span class="op">=</span><span class="va">False</span>).head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="5">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">State</th>
<th data-quarto-table-cell-role="th">Sex</th>
<th data-quarto-table-cell-role="th">Year</th>
<th data-quarto-table-cell-role="th">Name</th>
<th data-quarto-table-cell-role="th">Count</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">334166</td>
<td>CA</td>
<td>M</td>
<td>1996</td>
<td>Franciscojavier</td>
<td>8</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">327472</td>
<td>CA</td>
<td>M</td>
<td>1993</td>
<td>Ryanchristopher</td>
<td>5</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">337301</td>
<td>CA</td>
<td>M</td>
<td>1997</td>
<td>Franciscojavier</td>
<td>5</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">337477</td>
<td>CA</td>
<td>M</td>
<td>1997</td>
<td>Ryanchristopher</td>
<td>5</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">312543</td>
<td>CA</td>
<td>M</td>
<td>1987</td>
<td>Franciscojavier</td>
<td>5</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
<section id="approach-3-sorting-using-the-map-function" class="level3" data-number="4.1.3">
<h3 data-number="4.1.3" class="anchored" data-anchor-id="approach-3-sorting-using-the-map-function"><span class="header-section-number">4.1.3</span> Approach 3: Sorting using the <code>map</code> Function</h3>
<p>We can also use the <code>map</code> function on a <code>Series</code> to solve this. Say we want to sort the <code>babynames</code> table by the number of <code>"dr"</code>’s and <code>"ea"</code>’s in each <code>"Name"</code>. We’ll define the function <code>dr_ea_count</code> to help us out.</p>
<div id="656a0908" class="cell" data-execution_count="6">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># First, define a function to count the number of times "dr" or "ea" appear in each name</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> dr_ea_count(string):</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> string.count(<span class="st">'dr'</span>) <span class="op">+</span> string.count(<span class="st">'ea'</span>)</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Then, use `map` to apply `dr_ea_count` to each name in the "Name" column</span></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>babynames[<span class="st">"dr_ea_count"</span>] <span class="op">=</span> babynames[<span class="st">"Name"</span>].<span class="bu">map</span>(dr_ea_count)</span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Sort the DataFrame by the new "dr_ea_count" column so we can see our handiwork</span></span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>babynames <span class="op">=</span> babynames.sort_values(by<span class="op">=</span><span class="st">"dr_ea_count"</span>, ascending<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>babynames.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="6">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">State</th>
<th data-quarto-table-cell-role="th">Sex</th>
<th data-quarto-table-cell-role="th">Year</th>
<th data-quarto-table-cell-role="th">Name</th>
<th data-quarto-table-cell-role="th">Count</th>
<th data-quarto-table-cell-role="th">dr_ea_count</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">115957</td>
<td>CA</td>
<td>F</td>
<td>1990</td>
<td>Deandrea</td>
<td>5</td>
<td>3</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">101976</td>
<td>CA</td>
<td>F</td>
<td>1986</td>
<td>Deandrea</td>
<td>6</td>
<td>3</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">131029</td>
<td>CA</td>
<td>F</td>
<td>1994</td>
<td>Leandrea</td>
<td>5</td>
<td>3</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">108731</td>
<td>CA</td>
<td>F</td>
<td>1988</td>
<td>Deandrea</td>
<td>5</td>
<td>3</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">308131</td>
<td>CA</td>
<td>M</td>
<td>1985</td>
<td>Deandrea</td>
<td>6</td>
<td>3</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>We can drop the <code>dr_ea_count</code> once we’re done using it to maintain a neat table.</p>
<div id="6c768180" class="cell" data-execution_count="7">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Drop the `dr_ea_count` column</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>babynames <span class="op">=</span> babynames.drop(<span class="st">"dr_ea_count"</span>, axis <span class="op">=</span> <span class="st">'columns'</span>)</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>babynames.head(<span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="7">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">State</th>
<th data-quarto-table-cell-role="th">Sex</th>
<th data-quarto-table-cell-role="th">Year</th>
<th data-quarto-table-cell-role="th">Name</th>
<th data-quarto-table-cell-role="th">Count</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">115957</td>
<td>CA</td>
<td>F</td>
<td>1990</td>
<td>Deandrea</td>
<td>5</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">101976</td>
<td>CA</td>
<td>F</td>
<td>1986</td>
<td>Deandrea</td>
<td>6</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">131029</td>
<td>CA</td>
<td>F</td>
<td>1994</td>
<td>Leandrea</td>
<td>5</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">108731</td>
<td>CA</td>
<td>F</td>
<td>1988</td>
<td>Deandrea</td>
<td>5</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">308131</td>
<td>CA</td>
<td>M</td>
<td>1985</td>
<td>Deandrea</td>
<td>6</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
</section>
<section id="aggregating-data-with-.groupby" class="level2" data-number="4.2">
<h2 data-number="4.2" class="anchored" data-anchor-id="aggregating-data-with-.groupby"><span class="header-section-number">4.2</span> Aggregating Data with <code>.groupby</code></h2>
<p>Up until this point, we have been working with individual rows of <code>DataFrame</code>s. As data scientists, we often wish to investigate trends across a larger <em>subset</em> of our data. For example, we may want to compute some summary statistic (the mean, median, sum, etc.) for a group of rows in our <code>DataFrame</code>. To do this, we’ll use <code>pandas</code> <code>GroupBy</code> objects. Our goal is to group together rows that fall under the same category and perform an operation that aggregates across all rows in the category.</p>
<p>Let’s say we wanted to aggregate all rows in <code>babynames</code> for a given year.</p>
<div id="349005ea" class="cell" data-execution_count="8">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>babynames.groupby(<span class="st">"Year"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="8">
<pre><code>&lt;pandas.core.groupby.generic.DataFrameGroupBy object at 0x118dd1850&gt;</code></pre>
</div>
</div>
<p>What does this strange output mean? Calling <code>.groupby</code> <a href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.groupby.html">(documentation)</a> has generated a <code>GroupBy</code> object. You can imagine this as a set of “mini” sub-<code>DataFrame</code>s, where each subframe contains all of the rows from <code>babynames</code> that correspond to a particular year.</p>
<p>The diagram below shows a simplified view of <code>babynames</code> to help illustrate this idea.</p>
<center>
<img src="images/gb.png" width="600">
</center>
<p>We can’t work with a <code>GroupBy</code> object directly – that is why you saw that strange output earlier rather than a standard view of a <code>DataFrame</code>. To actually manipulate values within these “mini” <code>DataFrame</code>s, we’ll need to call an <em>aggregation method</em>. This is a method that tells <code>pandas</code> how to aggregate the values within the <code>GroupBy</code> object. Once the aggregation is applied, <code>pandas</code> will return a normal (now grouped) <code>DataFrame</code>.</p>
<p>The first aggregation method we’ll consider is <code>.agg</code>. The <code>.agg</code> method takes in a function as its argument; this function is then applied to each column of a “mini” grouped DataFrame. We end up with a new <code>DataFrame</code> with one aggregated row per subframe. Let’s see this in action by finding the <code>sum</code> of all counts for each year in <code>babynames</code> – this is equivalent to finding the number of babies born in each year.</p>
<div id="a9c22c7f" class="cell" data-execution_count="9">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>babynames[[<span class="st">"Year"</span>, <span class="st">"Count"</span>]].groupby(<span class="st">"Year"</span>).agg(<span class="st">"sum"</span>).head(<span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="9">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Count</th>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">Year</th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">1910</td>
<td>9163</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1911</td>
<td>9983</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">1912</td>
<td>17946</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1913</td>
<td>22094</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">1914</td>
<td>26926</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>We can relate this back to the diagram we used above. Remember that the diagram uses a simplified version of <code>babynames</code>, which is why we see smaller values for the summed counts.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/agg.png" class="img-fluid figure-img"></p>
<figcaption>Performing an aggregation</figcaption>
</figure>
</div>
<p>Calling <code>.agg</code> has condensed each subframe back into a single row. This gives us our final output: a <code>DataFrame</code> that is now indexed by <code>"Year"</code>, with a single row for each unique year in the original <code>babynames</code> DataFrame.</p>
<p>There are many different aggregation functions we can use, all of which are useful in different applications.</p>
<div id="9784e6be" class="cell" data-execution_count="10">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>babynames[[<span class="st">"Year"</span>, <span class="st">"Count"</span>]].groupby(<span class="st">"Year"</span>).agg(<span class="st">"min"</span>).head(<span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="10">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Count</th>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">Year</th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">1910</td>
<td>5</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1911</td>
<td>5</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">1912</td>
<td>5</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1913</td>
<td>5</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">1914</td>
<td>5</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div id="d1204a37" class="cell" data-execution_count="11">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>babynames[[<span class="st">"Year"</span>, <span class="st">"Count"</span>]].groupby(<span class="st">"Year"</span>).agg(<span class="st">"max"</span>).head(<span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="11">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Count</th>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">Year</th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">1910</td>
<td>295</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1911</td>
<td>390</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">1912</td>
<td>534</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1913</td>
<td>614</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">1914</td>
<td>773</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div id="e490504d" class="cell" data-execution_count="12">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Same result, but now we explicitly tell pandas to only consider the "Count" column when summing</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>babynames.groupby(<span class="st">"Year"</span>)[[<span class="st">"Count"</span>]].agg(<span class="st">"sum"</span>).head(<span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="12">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Count</th>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">Year</th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">1910</td>
<td>9163</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1911</td>
<td>9983</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">1912</td>
<td>17946</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1913</td>
<td>22094</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">1914</td>
<td>26926</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>There are many different aggregations that can be applied to the grouped data. The primary requirement is that an aggregation function must:</p>
<ul>
<li>Take in a <code>Series</code> of data (a single column of the grouped subframe).</li>
<li>Return a single value that aggregates this <code>Series</code>.</li>
</ul>
<section id="aggregation-functions" class="level3" data-number="4.2.1">
<h3 data-number="4.2.1" class="anchored" data-anchor-id="aggregation-functions"><span class="header-section-number">4.2.1</span> Aggregation Functions</h3>
<p>Because of this fairly broad requirement, <code>pandas</code> offers many ways of computing an aggregation.</p>
<p><strong>In-built</strong> Python operations – such as <code>sum</code>, <code>max</code>, and <code>min</code> – are automatically recognized by <code>pandas</code>.</p>
<div id="d09bcd87" class="cell" data-execution_count="13">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co"># What is the minimum count for each name in any year?</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>babynames.groupby(<span class="st">"Name"</span>)[[<span class="st">"Count"</span>]].agg(<span class="st">"min"</span>).head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="13">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Count</th>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">Name</th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">Aadan</td>
<td>5</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Aadarsh</td>
<td>6</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Aaden</td>
<td>10</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Aadhav</td>
<td>6</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Aadhini</td>
<td>6</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div id="46f7233b" class="cell" data-execution_count="14">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co"># What is the largest single-year count of each name?</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>babynames.groupby(<span class="st">"Name"</span>)[[<span class="st">"Count"</span>]].agg(<span class="st">"max"</span>).head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="14">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Count</th>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">Name</th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">Aadan</td>
<td>7</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Aadarsh</td>
<td>6</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Aaden</td>
<td>158</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Aadhav</td>
<td>8</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Aadhini</td>
<td>6</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>As mentioned previously, functions from the <code>NumPy</code> library, such as <code>np.mean</code>, <code>np.max</code>, <code>np.min</code>, and <code>np.sum</code>, are also fair game in <code>pandas</code>.</p>
<div id="173dda70" class="cell" data-execution_count="15">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="co"># What is the average count for each name across all years?</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>babynames.groupby(<span class="st">"Name"</span>)[[<span class="st">"Count"</span>]].agg(<span class="st">"mean"</span>).head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="15">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Count</th>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">Name</th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">Aadan</td>
<td>6.000000</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Aadarsh</td>
<td>6.000000</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Aaden</td>
<td>46.214286</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Aadhav</td>
<td>6.750000</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Aadhini</td>
<td>6.000000</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p><code>pandas</code> also offers a number of in-built functions. Functions that are native to <code>pandas</code> can be referenced using their string name within a call to <code>.agg</code>. Some examples include:</p>
<ul>
<li><code>.agg("sum")</code></li>
<li><code>.agg("max")</code></li>
<li><code>.agg("min")</code></li>
<li><code>.agg("mean")</code></li>
<li><code>.agg("first")</code></li>
<li><code>.agg("last")</code></li>
</ul>
<p>The latter two entries in this list – <code>"first"</code> and <code>"last"</code> – are unique to <code>pandas</code>. They return the first or last entry in a subframe column. Why might this be useful? Consider a case where <em>multiple</em> columns in a group share identical information. To represent this information in the grouped output, we can simply grab the first or last entry, which we know will be identical to all other entries.</p>
<p>Let’s illustrate this with an example. Say we add a new column to <code>babynames</code> that contains the first letter of each name.</p>
<div id="cdba993b" class="cell" data-execution_count="16">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Imagine we had an additional column, "First Letter". We'll explain this code next week</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>babynames[<span class="st">"First Letter"</span>] <span class="op">=</span> babynames[<span class="st">"Name"</span>].<span class="bu">str</span>[<span class="dv">0</span>]</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a><span class="co"># We construct a simplified DataFrame containing just a subset of columns</span></span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>babynames_new <span class="op">=</span> babynames[[<span class="st">"Name"</span>, <span class="st">"First Letter"</span>, <span class="st">"Year"</span>]]</span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>babynames_new.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="16">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Name</th>
<th data-quarto-table-cell-role="th">First Letter</th>
<th data-quarto-table-cell-role="th">Year</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">115957</td>
<td>Deandrea</td>
<td>D</td>
<td>1990</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">101976</td>
<td>Deandrea</td>
<td>D</td>
<td>1986</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">131029</td>
<td>Leandrea</td>
<td>L</td>
<td>1994</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">108731</td>
<td>Deandrea</td>
<td>D</td>
<td>1988</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">308131</td>
<td>Deandrea</td>
<td>D</td>
<td>1985</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>If we form groups for each name in the dataset, <code>"First Letter"</code> will be the same for all members of the group. This means that if we simply select the first entry for <code>"First Letter"</code> in the group, we’ll represent all data in that group.</p>
<p>We can use a dictionary to apply different aggregation functions to each column during grouping.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/first.png" class="img-fluid figure-img"></p>
<figcaption>Aggregating using “first”</figcaption>
</figure>
</div>
<div id="f2c6e58f" class="cell" data-execution_count="17">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>babynames_new.groupby(<span class="st">"Name"</span>).agg({<span class="st">"First Letter"</span>:<span class="st">"first"</span>, <span class="st">"Year"</span>:<span class="st">"max"</span>}).head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="17">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">First Letter</th>
<th data-quarto-table-cell-role="th">Year</th>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">Name</th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">Aadan</td>
<td>A</td>
<td>2014</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Aadarsh</td>
<td>A</td>
<td>2019</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Aaden</td>
<td>A</td>
<td>2020</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Aadhav</td>
<td>A</td>
<td>2019</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Aadhini</td>
<td>A</td>
<td>2022</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
<section id="plotting-birth-counts" class="level3" data-number="4.2.2">
<h3 data-number="4.2.2" class="anchored" data-anchor-id="plotting-birth-counts"><span class="header-section-number">4.2.2</span> Plotting Birth Counts</h3>
<p>Let’s use <code>.agg</code> to find the total number of babies born in each year. Recall that using <code>.agg</code> with <code>.groupby()</code> follows the format: <code>df.groupby(column_name).agg(aggregation_function)</code>. The line of code below gives us the total number of babies born in each year.</p>
<div id="cf466e99" class="cell" data-execution_count="18">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>babynames.groupby(<span class="st">"Year"</span>)[[<span class="st">"Count"</span>]].agg(<span class="bu">sum</span>).head(<span class="dv">5</span>)</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Alternative 1</span></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a><span class="co"># babynames.groupby("Year")[["Count"]].sum()</span></span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Alternative 2</span></span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a><span class="co"># babynames.groupby("Year").sum(numeric_only=True)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>/var/folders/ks/dgd81q6j5b7ghm1zc_4483vr0000gn/T/ipykernel_11544/390646742.py:1: FutureWarning:

The provided callable &lt;built-in function sum&gt; is currently using DataFrameGroupBy.sum. In a future version of pandas, the provided callable will be used directly. To keep current behavior pass the string "sum" instead.
</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="18">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Count</th>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">Year</th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">1910</td>
<td>9163</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1911</td>
<td>9983</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">1912</td>
<td>17946</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1913</td>
<td>22094</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">1914</td>
<td>26926</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>Here’s an illustration of the process:</p>
<p><img src="images/aggregation.png" alt="aggregation" width="600"></p>
<p>Plotting the <code>Dataframe</code> we obtain tells an interesting story.</p>
<div id="a6455d0f" class="cell" data-execution_count="19">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> plotly.express <span class="im">as</span> px</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>puzzle2 <span class="op">=</span> babynames.groupby(<span class="st">"Year"</span>)[[<span class="st">"Count"</span>]].agg(<span class="st">"sum"</span>)</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>px.line(puzzle2, y <span class="op">=</span> <span class="st">"Count"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div>                            <div id="5e4cacbe-830f-4826-b9da-0541f265f2e3" class="plotly-graph-div" style="height:525px; width:100%;"></div>            <script type="text/javascript">                require(["plotly"], function(Plotly) {                    window.PLOTLYENV=window.PLOTLYENV || {};                                    if (document.getElementById("5e4cacbe-830f-4826-b9da-0541f265f2e3")) {                    Plotly.newPlot(                        "5e4cacbe-830f-4826-b9da-0541f265f2e3",                        [{"hovertemplate":"Year=%{x}<br>Count=%{y}<extra></extra>","legendgroup":"","line":{"color":"#636efa","dash":"solid"},"marker":{"symbol":"circle"},"mode":"lines","name":"","orientation":"v","showlegend":false,"x":[1910,1911,1912,1913,1914,1915,1916,1917,1918,1919,1920,1921,1922,1923,1924,1925,1926,1927,1928,1929,1930,1931,1932,1933,1934,1935,1936,1937,1938,1939,1940,1941,1942,1943,1944,1945,1946,1947,1948,1949,1950,1951,1952,1953,1954,1955,1956,1957,1958,1959,1960,1961,1962,1963,1964,1965,1966,1967,1968,1969,1970,1971,1972,1973,1974,1975,1976,1977,1978,1979,1980,1981,1982,1983,1984,1985,1986,1987,1988,1989,1990,1991,1992,1993,1994,1995,1996,1997,1998,1999,2000,2001,2002,2003,2004,2005,2006,2007,2008,2009,2010,2011,2012,2013,2014,2015,2016,2017,2018,2019,2020,2021,2022],"xaxis":"x","y":[9163,9983,17946,22094,26926,35835,37501,39916,44692,45119,54142,58983,61004,67917,74451,73493,72910,74201,74264,72108,75294,71467,69522,66895,69789,71603,74932,83738,91626,93461,102627,114296,142033,159813,164349,171764,204945,232313,229033,233625,235582,250468,271681,287484,297099,304567,324186,340083,337562,345901,358544,363926,360475,361897,355386,336567,319421,318819,321040,333671,342411,310020,287239,275036,286947,290518,302547,315011,322241,343070,365973,382156,390581,394608,404961,425583,435964,453824,480602,512615,552647,549317,541054,524983,509302,494635,483288,468412,464300,460844,471649,466934,467742,477651,480892,484503,494971,497627,483360,460305,444619,437818,439402,431945,440683,431317,427015,411058,395436,386996,362882,362582,360023],"yaxis":"y","type":"scatter"}],                        {"template":{"data":{"histogram2dcontour":[{"type":"histogram2dcontour","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"choropleth":[{"type":"choropleth","colorbar":{"outlinewidth":0,"ticks":""}}],"histogram2d":[{"type":"histogram2d","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"heatmap":[{"type":"heatmap","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"heatmapgl":[{"type":"heatmapgl","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"contourcarpet":[{"type":"contourcarpet","colorbar":{"outlinewidth":0,"ticks":""}}],"contour":[{"type":"contour","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"surface":[{"type":"surface","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"mesh3d":[{"type":"mesh3d","colorbar":{"outlinewidth":0,"ticks":""}}],"scatter":[{"fillpattern":{"fillmode":"overlay","size":10,"solidity":0.2},"type":"scatter"}],"parcoords":[{"type":"parcoords","line":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scatterpolargl":[{"type":"scatterpolargl","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"bar":[{"error_x":{"color":"#2a3f5f"},"error_y":{"color":"#2a3f5f"},"marker":{"line":{"color":"#E5ECF6","width":0.5},"pattern":{"fillmode":"overlay","size":10,"solidity":0.2}},"type":"bar"}],"scattergeo":[{"type":"scattergeo","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scatterpolar":[{"type":"scatterpolar","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"histogram":[{"marker":{"pattern":{"fillmode":"overlay","size":10,"solidity":0.2}},"type":"histogram"}],"scattergl":[{"type":"scattergl","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scatter3d":[{"type":"scatter3d","line":{"colorbar":{"outlinewidth":0,"ticks":""}},"marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scattermapbox":[{"type":"scattermapbox","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scatterternary":[{"type":"scatterternary","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scattercarpet":[{"type":"scattercarpet","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"carpet":[{"aaxis":{"endlinecolor":"#2a3f5f","gridcolor":"white","linecolor":"white","minorgridcolor":"white","startlinecolor":"#2a3f5f"},"baxis":{"endlinecolor":"#2a3f5f","gridcolor":"white","linecolor":"white","minorgridcolor":"white","startlinecolor":"#2a3f5f"},"type":"carpet"}],"table":[{"cells":{"fill":{"color":"#EBF0F8"},"line":{"color":"white"}},"header":{"fill":{"color":"#C8D4E3"},"line":{"color":"white"}},"type":"table"}],"barpolar":[{"marker":{"line":{"color":"#E5ECF6","width":0.5},"pattern":{"fillmode":"overlay","size":10,"solidity":0.2}},"type":"barpolar"}],"pie":[{"automargin":true,"type":"pie"}]},"layout":{"autotypenumbers":"strict","colorway":["#636efa","#EF553B","#00cc96","#ab63fa","#FFA15A","#19d3f3","#FF6692","#B6E880","#FF97FF","#FECB52"],"font":{"color":"#2a3f5f"},"hovermode":"closest","hoverlabel":{"align":"left"},"paper_bgcolor":"white","plot_bgcolor":"#E5ECF6","polar":{"bgcolor":"#E5ECF6","angularaxis":{"gridcolor":"white","linecolor":"white","ticks":""},"radialaxis":{"gridcolor":"white","linecolor":"white","ticks":""}},"ternary":{"bgcolor":"#E5ECF6","aaxis":{"gridcolor":"white","linecolor":"white","ticks":""},"baxis":{"gridcolor":"white","linecolor":"white","ticks":""},"caxis":{"gridcolor":"white","linecolor":"white","ticks":""}},"coloraxis":{"colorbar":{"outlinewidth":0,"ticks":""}},"colorscale":{"sequential":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]],"sequentialminus":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]],"diverging":[[0,"#8e0152"],[0.1,"#c51b7d"],[0.2,"#de77ae"],[0.3,"#f1b6da"],[0.4,"#fde0ef"],[0.5,"#f7f7f7"],[0.6,"#e6f5d0"],[0.7,"#b8e186"],[0.8,"#7fbc41"],[0.9,"#4d9221"],[1,"#276419"]]},"xaxis":{"gridcolor":"white","linecolor":"white","ticks":"","title":{"standoff":15},"zerolinecolor":"white","automargin":true,"zerolinewidth":2},"yaxis":{"gridcolor":"white","linecolor":"white","ticks":"","title":{"standoff":15},"zerolinecolor":"white","automargin":true,"zerolinewidth":2},"scene":{"xaxis":{"backgroundcolor":"#E5ECF6","gridcolor":"white","linecolor":"white","showbackground":true,"ticks":"","zerolinecolor":"white","gridwidth":2},"yaxis":{"backgroundcolor":"#E5ECF6","gridcolor":"white","linecolor":"white","showbackground":true,"ticks":"","zerolinecolor":"white","gridwidth":2},"zaxis":{"backgroundcolor":"#E5ECF6","gridcolor":"white","linecolor":"white","showbackground":true,"ticks":"","zerolinecolor":"white","gridwidth":2}},"shapedefaults":{"line":{"color":"#2a3f5f"}},"annotationdefaults":{"arrowcolor":"#2a3f5f","arrowhead":0,"arrowwidth":1},"geo":{"bgcolor":"white","landcolor":"#E5ECF6","subunitcolor":"white","showland":true,"showlakes":true,"lakecolor":"white"},"title":{"x":0.05},"mapbox":{"style":"light"},"margin":{"b":0,"l":0,"r":0,"t":30}}},"xaxis":{"anchor":"y","domain":[0.0,1.0],"title":{"text":"Year"}},"yaxis":{"anchor":"x","domain":[0.0,1.0],"title":{"text":"Count"}},"legend":{"tracegroupgap":0}},                        {"responsive": true}                    ).then(function(){
                            
var gd = document.getElementById('5e4cacbe-830f-4826-b9da-0541f265f2e3');
var x = new MutationObserver(function (mutations, observer) {{
        var display = window.getComputedStyle(gd).display;
        if (!display || display === 'none') {{
            console.log([gd, 'removed!']);
            Plotly.purge(gd);
            observer.disconnect();
        }}
}});

// Listen for the removal of the full notebook cells
var notebookContainer = gd.closest('#notebook-container');
if (notebookContainer) {{
    x.observe(notebookContainer, {childList: true});
}}

// Listen for the clearing of the current output cell
var outputEl = gd.closest('.output');
if (outputEl) {{
    x.observe(outputEl, {childList: true});
}}

                        })                };                });            </script>        </div>
</div>
</div>
<p><strong>A word of warning</strong>: we made an enormous assumption when we decided to use this dataset to estimate birth rate. According to <a href="https://lao.ca.gov/LAOEconTax/Article/Detail/691">this article from the Legistlative Analyst Office</a>, the true number of babies born in California in 2020 was 421,275. However, our plot shows 362,882 babies —— what happened?</p>
</section>
<section id="summary-of-the-.groupby-function" class="level3" data-number="4.2.3">
<h3 data-number="4.2.3" class="anchored" data-anchor-id="summary-of-the-.groupby-function"><span class="header-section-number">4.2.3</span> Summary of the <code>.groupby()</code> Function</h3>
<p>A <code>groupby</code> operation involves some combination of <strong>splitting a <code>DataFrame</code> into grouped subframes</strong>, <strong>applying a function</strong>, and <strong>combining the results</strong>.</p>
<p>For some arbitrary <code>DataFrame</code> <code>df</code> below, the code <code>df.groupby("year").agg(sum)</code> does the following:</p>
<ul>
<li><strong>Splits</strong> the <code>DataFrame</code> into sub-<code>DataFrame</code>s with rows belonging to the same year.</li>
<li><strong>Applies</strong> the <code>sum</code> function to each column of each sub-<code>DataFrame</code>.</li>
<li><strong>Combines</strong> the results of <code>sum</code> into a single <code>DataFrame</code>, indexed by <code>year</code>.</li>
</ul>
<p><img src="images/groupby_demo.png" alt="groupby_demo" width="600"></p>
</section>
<section id="revisiting-the-.agg-function" class="level3" data-number="4.2.4">
<h3 data-number="4.2.4" class="anchored" data-anchor-id="revisiting-the-.agg-function"><span class="header-section-number">4.2.4</span> Revisiting the <code>.agg()</code> Function</h3>
<p><code>.agg()</code> can take in any function that aggregates several values into one summary value. Some commonly-used aggregation functions can even be called directly, without explicit use of <code>.agg()</code>. For example, we can call <code>.mean()</code> on <code>.groupby()</code>:</p>
<pre><code>babynames.groupby("Year").mean().head()</code></pre>
<p>We can now put this all into practice. Say we want to find the baby name with sex “F” that has fallen in popularity the most in California. To calculate this, we can first create a metric: “Ratio to Peak” (RTP). The RTP is the ratio of babies born with a given name in 2022 to the <em>maximum</em> number of babies born with the name in <em>any</em> year.</p>
<p>Let’s start with calculating this for one baby, “Jennifer”.</p>
<div id="95908cbb" class="cell" data-execution_count="20">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="co"># We filter by babies with sex "F" and sort by "Year"</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>f_babynames <span class="op">=</span> babynames[babynames[<span class="st">"Sex"</span>] <span class="op">==</span> <span class="st">"F"</span>]</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>f_babynames <span class="op">=</span> f_babynames.sort_values([<span class="st">"Year"</span>])</span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Determine how many Jennifers were born in CA per year</span></span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>jenn_counts_series <span class="op">=</span> f_babynames[f_babynames[<span class="st">"Name"</span>] <span class="op">==</span> <span class="st">"Jennifer"</span>][<span class="st">"Count"</span>]</span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Determine the max number of Jennifers born in a year and the number born in 2022 </span></span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a><span class="co"># to calculate RTP</span></span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a>max_jenn <span class="op">=</span> <span class="bu">max</span>(f_babynames[f_babynames[<span class="st">"Name"</span>] <span class="op">==</span> <span class="st">"Jennifer"</span>][<span class="st">"Count"</span>])</span>
<span id="cb23-11"><a href="#cb23-11" aria-hidden="true" tabindex="-1"></a>curr_jenn <span class="op">=</span> f_babynames[f_babynames[<span class="st">"Name"</span>] <span class="op">==</span> <span class="st">"Jennifer"</span>][<span class="st">"Count"</span>].iloc[<span class="op">-</span><span class="dv">1</span>]</span>
<span id="cb23-12"><a href="#cb23-12" aria-hidden="true" tabindex="-1"></a>rtp <span class="op">=</span> curr_jenn <span class="op">/</span> max_jenn</span>
<span id="cb23-13"><a href="#cb23-13" aria-hidden="true" tabindex="-1"></a>rtp</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="20">
<pre><code>np.float64(0.018796372629843364)</code></pre>
</div>
</div>
<p>By creating a function to calculate RTP and applying it to our <code>DataFrame</code> by using <code>.groupby()</code>, we can easily compute the RTP for all names at once!</p>
<div id="60b63fe8" class="cell" data-execution_count="21">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> ratio_to_peak(series):</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> series.iloc[<span class="op">-</span><span class="dv">1</span>] <span class="op">/</span> <span class="bu">max</span>(series)</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a><span class="co">#Using .groupby() to apply the function</span></span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a>rtp_table <span class="op">=</span> f_babynames.groupby(<span class="st">"Name"</span>)[[<span class="st">"Year"</span>, <span class="st">"Count"</span>]].agg(ratio_to_peak)</span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a>rtp_table.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="21">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Year</th>
<th data-quarto-table-cell-role="th">Count</th>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">Name</th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">Aadhini</td>
<td>1.0</td>
<td>1.000000</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Aadhira</td>
<td>1.0</td>
<td>0.500000</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Aadhya</td>
<td>1.0</td>
<td>0.660000</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Aadya</td>
<td>1.0</td>
<td>0.586207</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Aahana</td>
<td>1.0</td>
<td>0.269231</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>In the rows shown above, we can see that every row shown has a <code>Year</code> value of <code>1.0</code>.</p>
<p>This is the “<strong><code>pandas</code></strong>-ification” of logic you saw in Data 8. Much of the logic you’ve learned in Data 8 will serve you well in Data 100.</p>
</section>
<section id="nuisance-columns" class="level3" data-number="4.2.5">
<h3 data-number="4.2.5" class="anchored" data-anchor-id="nuisance-columns"><span class="header-section-number">4.2.5</span> Nuisance Columns</h3>
<p>Note that you must be careful with which columns you apply the <code>.agg()</code> function to. If we were to apply our function to the table as a whole by doing <code>f_babynames.groupby("Name").agg(ratio_to_peak)</code>, executing our <code>.agg()</code> call would result in a <code>TypeError</code>.</p>
<p><img src="images/error.png" alt="error" width="600"></p>
<p>We can avoid this issue (and prevent unintentional loss of data) by explicitly selecting column(s) we want to apply our aggregation function to <strong>BEFORE</strong> calling <code>.agg()</code>,</p>
</section>
<section id="renaming-columns-after-grouping" class="level3" data-number="4.2.6">
<h3 data-number="4.2.6" class="anchored" data-anchor-id="renaming-columns-after-grouping"><span class="header-section-number">4.2.6</span> Renaming Columns After Grouping</h3>
<p>By default, <code>.groupby</code> will not rename any aggregated columns. As we can see in the table above, the aggregated column is still named <code>Count</code> even though it now represents the RTP. For better readability, we can rename <code>Count</code> to <code>Count RTP</code></p>
<div id="4199ad0c" class="cell" data-execution_count="22">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>rtp_table <span class="op">=</span> rtp_table.rename(columns <span class="op">=</span> {<span class="st">"Count"</span>: <span class="st">"Count RTP"</span>})</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>rtp_table</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="22">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Year</th>
<th data-quarto-table-cell-role="th">Count RTP</th>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">Name</th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">Aadhini</td>
<td>1.0</td>
<td>1.000000</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Aadhira</td>
<td>1.0</td>
<td>0.500000</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Aadhya</td>
<td>1.0</td>
<td>0.660000</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Aadya</td>
<td>1.0</td>
<td>0.586207</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Aahana</td>
<td>1.0</td>
<td>0.269231</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Zyanya</td>
<td>1.0</td>
<td>0.466667</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Zyla</td>
<td>1.0</td>
<td>1.000000</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Zylah</td>
<td>1.0</td>
<td>1.000000</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Zyra</td>
<td>1.0</td>
<td>1.000000</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Zyrah</td>
<td>1.0</td>
<td>0.833333</td>
</tr>
</tbody>
</table>

<p>13782 rows × 2 columns</p>
</div>
</div>
</div>
</section>
<section id="some-data-science-payoff" class="level3" data-number="4.2.7">
<h3 data-number="4.2.7" class="anchored" data-anchor-id="some-data-science-payoff"><span class="header-section-number">4.2.7</span> Some Data Science Payoff</h3>
<p>By sorting <code>rtp_table</code>, we can see the names whose popularity has decreased the most.</p>
<div id="aa619666" class="cell" data-execution_count="23">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>rtp_table <span class="op">=</span> rtp_table.rename(columns <span class="op">=</span> {<span class="st">"Count"</span>: <span class="st">"Count RTP"</span>})</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>rtp_table.sort_values(<span class="st">"Count RTP"</span>).head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="23">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Year</th>
<th data-quarto-table-cell-role="th">Count RTP</th>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">Name</th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">Debra</td>
<td>1.0</td>
<td>0.001260</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Debbie</td>
<td>1.0</td>
<td>0.002815</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Carol</td>
<td>1.0</td>
<td>0.003180</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Tammy</td>
<td>1.0</td>
<td>0.003249</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Susan</td>
<td>1.0</td>
<td>0.003305</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>To visualize the above <code>DataFrame</code>, let’s look at the line plot below:</p>
<div id="379a5aed" class="cell" data-execution_count="24">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> plotly.express <span class="im">as</span> px</span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>px.line(f_babynames[f_babynames[<span class="st">"Name"</span>] <span class="op">==</span> <span class="st">"Debra"</span>], x <span class="op">=</span> <span class="st">"Year"</span>, y <span class="op">=</span> <span class="st">"Count"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div>                            <div id="fec40aa1-7ffd-4075-a571-57f6378ccd53" class="plotly-graph-div" style="height:525px; width:100%;"></div>            <script type="text/javascript">                require(["plotly"], function(Plotly) {                    window.PLOTLYENV=window.PLOTLYENV || {};                                    if (document.getElementById("fec40aa1-7ffd-4075-a571-57f6378ccd53")) {                    Plotly.newPlot(                        "fec40aa1-7ffd-4075-a571-57f6378ccd53",                        [{"hovertemplate":"Year=%{x}<br>Count=%{y}<extra></extra>","legendgroup":"","line":{"color":"#636efa","dash":"solid"},"marker":{"symbol":"circle"},"mode":"lines","name":"","orientation":"v","showlegend":false,"x":[1940,1942,1943,1944,1945,1946,1947,1948,1949,1950,1951,1952,1953,1954,1955,1956,1957,1958,1959,1960,1961,1962,1963,1964,1965,1966,1967,1968,1969,1970,1971,1972,1973,1974,1975,1976,1977,1978,1979,1980,1981,1982,1983,1984,1985,1986,1987,1988,1989,1990,1991,1992,1993,1994,1995,1996,1997,1998,1999,2000,2001,2002,2003,2004,2005,2006,2007,2008,2009,2012,2013,2016],"xaxis":"x","y":[7,7,8,15,19,20,56,92,199,601,1510,2351,3295,3784,3969,3755,3318,2660,2290,2014,1647,1592,1430,1287,1154,958,818,748,647,547,463,318,242,236,159,151,151,164,130,141,97,114,97,95,93,64,78,69,71,51,62,41,34,28,28,12,14,16,10,13,14,10,7,12,13,12,13,6,7,5,8,5],"yaxis":"y","type":"scatter"}],                        {"template":{"data":{"histogram2dcontour":[{"type":"histogram2dcontour","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"choropleth":[{"type":"choropleth","colorbar":{"outlinewidth":0,"ticks":""}}],"histogram2d":[{"type":"histogram2d","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"heatmap":[{"type":"heatmap","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"heatmapgl":[{"type":"heatmapgl","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"contourcarpet":[{"type":"contourcarpet","colorbar":{"outlinewidth":0,"ticks":""}}],"contour":[{"type":"contour","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"surface":[{"type":"surface","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"mesh3d":[{"type":"mesh3d","colorbar":{"outlinewidth":0,"ticks":""}}],"scatter":[{"fillpattern":{"fillmode":"overlay","size":10,"solidity":0.2},"type":"scatter"}],"parcoords":[{"type":"parcoords","line":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scatterpolargl":[{"type":"scatterpolargl","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"bar":[{"error_x":{"color":"#2a3f5f"},"error_y":{"color":"#2a3f5f"},"marker":{"line":{"color":"#E5ECF6","width":0.5},"pattern":{"fillmode":"overlay","size":10,"solidity":0.2}},"type":"bar"}],"scattergeo":[{"type":"scattergeo","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scatterpolar":[{"type":"scatterpolar","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"histogram":[{"marker":{"pattern":{"fillmode":"overlay","size":10,"solidity":0.2}},"type":"histogram"}],"scattergl":[{"type":"scattergl","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scatter3d":[{"type":"scatter3d","line":{"colorbar":{"outlinewidth":0,"ticks":""}},"marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scattermapbox":[{"type":"scattermapbox","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scatterternary":[{"type":"scatterternary","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scattercarpet":[{"type":"scattercarpet","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"carpet":[{"aaxis":{"endlinecolor":"#2a3f5f","gridcolor":"white","linecolor":"white","minorgridcolor":"white","startlinecolor":"#2a3f5f"},"baxis":{"endlinecolor":"#2a3f5f","gridcolor":"white","linecolor":"white","minorgridcolor":"white","startlinecolor":"#2a3f5f"},"type":"carpet"}],"table":[{"cells":{"fill":{"color":"#EBF0F8"},"line":{"color":"white"}},"header":{"fill":{"color":"#C8D4E3"},"line":{"color":"white"}},"type":"table"}],"barpolar":[{"marker":{"line":{"color":"#E5ECF6","width":0.5},"pattern":{"fillmode":"overlay","size":10,"solidity":0.2}},"type":"barpolar"}],"pie":[{"automargin":true,"type":"pie"}]},"layout":{"autotypenumbers":"strict","colorway":["#636efa","#EF553B","#00cc96","#ab63fa","#FFA15A","#19d3f3","#FF6692","#B6E880","#FF97FF","#FECB52"],"font":{"color":"#2a3f5f"},"hovermode":"closest","hoverlabel":{"align":"left"},"paper_bgcolor":"white","plot_bgcolor":"#E5ECF6","polar":{"bgcolor":"#E5ECF6","angularaxis":{"gridcolor":"white","linecolor":"white","ticks":""},"radialaxis":{"gridcolor":"white","linecolor":"white","ticks":""}},"ternary":{"bgcolor":"#E5ECF6","aaxis":{"gridcolor":"white","linecolor":"white","ticks":""},"baxis":{"gridcolor":"white","linecolor":"white","ticks":""},"caxis":{"gridcolor":"white","linecolor":"white","ticks":""}},"coloraxis":{"colorbar":{"outlinewidth":0,"ticks":""}},"colorscale":{"sequential":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]],"sequentialminus":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]],"diverging":[[0,"#8e0152"],[0.1,"#c51b7d"],[0.2,"#de77ae"],[0.3,"#f1b6da"],[0.4,"#fde0ef"],[0.5,"#f7f7f7"],[0.6,"#e6f5d0"],[0.7,"#b8e186"],[0.8,"#7fbc41"],[0.9,"#4d9221"],[1,"#276419"]]},"xaxis":{"gridcolor":"white","linecolor":"white","ticks":"","title":{"standoff":15},"zerolinecolor":"white","automargin":true,"zerolinewidth":2},"yaxis":{"gridcolor":"white","linecolor":"white","ticks":"","title":{"standoff":15},"zerolinecolor":"white","automargin":true,"zerolinewidth":2},"scene":{"xaxis":{"backgroundcolor":"#E5ECF6","gridcolor":"white","linecolor":"white","showbackground":true,"ticks":"","zerolinecolor":"white","gridwidth":2},"yaxis":{"backgroundcolor":"#E5ECF6","gridcolor":"white","linecolor":"white","showbackground":true,"ticks":"","zerolinecolor":"white","gridwidth":2},"zaxis":{"backgroundcolor":"#E5ECF6","gridcolor":"white","linecolor":"white","showbackground":true,"ticks":"","zerolinecolor":"white","gridwidth":2}},"shapedefaults":{"line":{"color":"#2a3f5f"}},"annotationdefaults":{"arrowcolor":"#2a3f5f","arrowhead":0,"arrowwidth":1},"geo":{"bgcolor":"white","landcolor":"#E5ECF6","subunitcolor":"white","showland":true,"showlakes":true,"lakecolor":"white"},"title":{"x":0.05},"mapbox":{"style":"light"},"margin":{"b":0,"l":0,"r":0,"t":30}}},"xaxis":{"anchor":"y","domain":[0.0,1.0],"title":{"text":"Year"}},"yaxis":{"anchor":"x","domain":[0.0,1.0],"title":{"text":"Count"}},"legend":{"tracegroupgap":0}},                        {"responsive": true}                    ).then(function(){
                            
var gd = document.getElementById('fec40aa1-7ffd-4075-a571-57f6378ccd53');
var x = new MutationObserver(function (mutations, observer) {{
        var display = window.getComputedStyle(gd).display;
        if (!display || display === 'none') {{
            console.log([gd, 'removed!']);
            Plotly.purge(gd);
            observer.disconnect();
        }}
}});

// Listen for the removal of the full notebook cells
var notebookContainer = gd.closest('#notebook-container');
if (notebookContainer) {{
    x.observe(notebookContainer, {childList: true});
}}

// Listen for the clearing of the current output cell
var outputEl = gd.closest('.output');
if (outputEl) {{
    x.observe(outputEl, {childList: true});
}}

                        })                };                });            </script>        </div>
</div>
</div>
<p>We can get the list of the top 10 names and then plot popularity with the following code:</p>
<div id="c5782e6d" class="cell" data-execution_count="25">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>top10 <span class="op">=</span> rtp_table.sort_values(<span class="st">"Count RTP"</span>).head(<span class="dv">10</span>).index</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>px.line(</span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>    f_babynames[f_babynames[<span class="st">"Name"</span>].isin(top10)], </span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>    x <span class="op">=</span> <span class="st">"Year"</span>, </span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a>    y <span class="op">=</span> <span class="st">"Count"</span>, </span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a>    color <span class="op">=</span> <span class="st">"Name"</span></span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>/Users/nikhilreddy/course-notes/ds100env/lib/python3.12/site-packages/plotly/express/_core.py:1980: FutureWarning:

When grouping with a length-1 list-like, you will need to pass a length-1 tuple to get_group in a future version of pandas. Pass `(name,)` instead of `name` to silence this warning.
</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>                            <div id="8322598c-e7f1-4ebf-847c-e9b6ece89f07" class="plotly-graph-div" style="height:525px; width:100%;"></div>            <script type="text/javascript">                require(["plotly"], function(Plotly) {                    window.PLOTLYENV=window.PLOTLYENV || {};                                    if (document.getElementById("8322598c-e7f1-4ebf-847c-e9b6ece89f07")) {                    Plotly.newPlot(                        "8322598c-e7f1-4ebf-847c-e9b6ece89f07",                        [{"hovertemplate":"Name=Carol<br>Year=%{x}<br>Count=%{y}<extra></extra>","legendgroup":"Carol","line":{"color":"#636efa","dash":"solid"},"marker":{"symbol":"circle"},"mode":"lines","name":"Carol","orientation":"v","showlegend":true,"x":[1910,1911,1912,1913,1914,1915,1916,1917,1918,1919,1920,1921,1922,1923,1924,1925,1926,1927,1928,1929,1930,1931,1932,1933,1934,1935,1936,1937,1938,1939,1940,1941,1942,1943,1944,1945,1946,1947,1948,1949,1950,1951,1952,1953,1954,1955,1956,1957,1958,1959,1960,1961,1962,1963,1964,1965,1966,1967,1968,1969,1970,1971,1972,1973,1974,1975,1976,1977,1978,1979,1980,1981,1982,1983,1984,1985,1986,1987,1988,1989,1990,1991,1992,1993,1994,1995,1996,1997,1998,1999,2000,2001,2002,2003,2004,2005,2006,2007,2008,2009,2010,2011,2012,2013,2014,2015,2016,2017,2018,2019,2020,2021,2022],"xaxis":"x","y":[8,13,17,16,26,38,59,47,55,48,64,67,74,94,138,153,151,148,193,279,270,297,367,453,559,669,873,1015,1050,1109,1079,1339,1672,1937,2089,2138,2152,2201,1954,1779,1737,1734,1727,1597,1684,1651,1704,1703,1545,1480,1359,1283,1191,993,1034,815,622,577,543,468,366,267,223,187,173,146,145,145,121,132,123,128,106,114,111,101,120,107,108,134,150,136,129,89,92,75,87,64,61,46,64,33,43,47,52,76,62,38,44,26,17,47,31,36,24,13,25,18,29,20,17,8,7],"yaxis":"y","type":"scatter"},{"hovertemplate":"Name=Susan<br>Year=%{x}<br>Count=%{y}<extra></extra>","legendgroup":"Susan","line":{"color":"#EF553B","dash":"solid"},"marker":{"symbol":"circle"},"mode":"lines","name":"Susan","orientation":"v","showlegend":true,"x":[1911,1912,1913,1914,1915,1916,1917,1918,1919,1920,1921,1922,1923,1924,1925,1926,1927,1928,1929,1930,1931,1932,1933,1934,1935,1936,1937,1938,1939,1940,1941,1942,1943,1944,1945,1946,1947,1948,1949,1950,1951,1952,1953,1954,1955,1956,1957,1958,1959,1960,1961,1962,1963,1964,1965,1966,1967,1968,1969,1970,1971,1972,1973,1974,1975,1976,1977,1978,1979,1980,1981,1982,1983,1984,1985,1986,1987,1988,1989,1990,1991,1992,1993,1994,1995,1996,1997,1998,1999,2000,2001,2002,2003,2004,2005,2006,2007,2008,2009,2010,2011,2012,2013,2014,2015,2016,2017,2018,2019,2020,2021,2022],"xaxis":"x","y":[6,8,8,10,16,17,15,20,22,21,19,15,22,26,32,29,43,25,37,63,47,63,74,101,118,138,183,271,433,630,795,1058,1380,1596,1991,2689,2831,3338,3180,3260,3346,3424,3753,3934,3900,3771,3631,3504,3123,3145,3135,2952,2839,2535,2008,1825,1644,1367,1232,1070,861,651,530,552,496,456,437,424,409,420,361,391,352,338,273,280,272,286,267,272,260,196,202,172,152,152,114,116,103,100,104,85,76,70,71,74,53,56,41,39,43,28,44,26,45,22,26,22,19,17,8,13],"yaxis":"y","type":"scatter"},{"hovertemplate":"Name=Tina<br>Year=%{x}<br>Count=%{y}<extra></extra>","legendgroup":"Tina","line":{"color":"#00cc96","dash":"solid"},"marker":{"symbol":"circle"},"mode":"lines","name":"Tina","orientation":"v","showlegend":true,"x":[1915,1916,1917,1918,1920,1921,1922,1924,1925,1927,1928,1929,1930,1937,1938,1939,1940,1941,1942,1943,1944,1945,1946,1947,1948,1949,1950,1951,1952,1953,1954,1955,1956,1957,1958,1959,1960,1961,1962,1963,1964,1965,1966,1967,1968,1969,1970,1971,1972,1973,1974,1975,1976,1977,1978,1979,1980,1981,1982,1983,1984,1985,1986,1987,1988,1989,1990,1991,1992,1993,1994,1995,1996,1997,1998,1999,2000,2001,2002,2003,2004,2005,2006,2007,2008,2009,2010,2011,2012,2013,2014,2015,2016,2017,2018,2019,2020,2021,2022],"xaxis":"x","y":[5,6,5,5,5,7,5,9,5,8,8,5,10,10,7,8,12,9,28,45,43,53,64,80,80,88,92,128,168,163,177,366,569,569,700,753,889,1045,1228,1212,1129,1202,1282,1342,1402,1302,1248,1091,941,634,642,546,450,370,414,363,335,371,310,268,271,310,238,252,252,208,180,196,163,171,147,121,111,91,80,83,90,80,67,64,63,69,36,37,47,39,39,27,39,28,46,38,33,36,26,21,15,13,6],"yaxis":"y","type":"scatter"},{"hovertemplate":"Name=Cheryl<br>Year=%{x}<br>Count=%{y}<extra></extra>","legendgroup":"Cheryl","line":{"color":"#ab63fa","dash":"solid"},"marker":{"symbol":"circle"},"mode":"lines","name":"Cheryl","orientation":"v","showlegend":true,"x":[1930,1934,1935,1936,1937,1938,1939,1940,1941,1942,1943,1944,1945,1946,1947,1948,1949,1950,1951,1952,1953,1954,1955,1956,1957,1958,1959,1960,1961,1962,1963,1964,1965,1966,1967,1968,1969,1970,1971,1972,1973,1974,1975,1976,1977,1978,1979,1980,1981,1982,1983,1984,1985,1986,1987,1988,1989,1990,1991,1992,1993,1994,1995,1996,1997,1998,1999,2000,2001,2002,2003,2004,2005,2006,2007,2008,2011,2012,2013,2014,2015,2016,2017,2018,2019,2021,2022],"xaxis":"x","y":[6,8,12,10,16,76,49,42,48,87,377,759,801,1063,1093,1021,916,903,993,955,1058,1465,1639,1715,1833,1832,1639,1624,1565,1420,1295,1207,1051,950,899,751,635,550,428,371,293,271,236,199,178,303,299,272,204,229,164,135,129,130,98,106,88,90,65,55,39,47,38,30,30,19,22,24,14,11,16,17,16,13,21,14,11,15,12,10,12,15,8,10,9,6,7],"yaxis":"y","type":"scatter"},{"hovertemplate":"Name=Michele<br>Year=%{x}<br>Count=%{y}<extra></extra>","legendgroup":"Michele","line":{"color":"#FFA15A","dash":"solid"},"marker":{"symbol":"circle"},"mode":"lines","name":"Michele","orientation":"v","showlegend":true,"x":[1936,1937,1938,1939,1940,1941,1942,1943,1944,1945,1946,1947,1948,1949,1950,1951,1952,1953,1954,1955,1956,1957,1958,1959,1960,1961,1962,1963,1964,1965,1966,1967,1968,1969,1970,1971,1972,1973,1974,1975,1976,1977,1978,1979,1980,1981,1982,1983,1984,1985,1986,1987,1988,1989,1990,1991,1992,1993,1994,1995,1996,1997,1998,1999,2000,2001,2002,2003,2004,2005,2006,2007,2008,2009,2010,2011,2012,2013,2014,2015,2022],"xaxis":"x","y":[7,8,5,8,18,34,113,132,166,171,172,253,213,335,295,306,401,421,500,498,464,454,470,506,576,763,766,775,768,796,1037,1033,1111,1016,973,700,702,571,494,484,437,390,381,305,281,223,230,227,200,162,206,146,143,164,137,142,125,104,82,65,52,47,45,38,28,37,27,22,28,16,21,15,15,11,14,7,5,10,6,11,5],"yaxis":"y","type":"scatter"},{"hovertemplate":"Name=Debbie<br>Year=%{x}<br>Count=%{y}<extra></extra>","legendgroup":"Debbie","line":{"color":"#19d3f3","dash":"solid"},"marker":{"symbol":"circle"},"mode":"lines","name":"Debbie","orientation":"v","showlegend":true,"x":[1936,1941,1942,1943,1944,1945,1946,1947,1948,1949,1950,1951,1952,1953,1954,1955,1956,1957,1958,1959,1960,1961,1962,1963,1964,1965,1966,1967,1968,1969,1970,1971,1972,1973,1974,1975,1976,1977,1978,1979,1980,1981,1982,1983,1984,1985,1986,1987,1988,1989,1990,1991,1992,1993,1994,1995,1996,1997,1998,1999,2000,2001,2002,2003,2004,2005,2006,2007,2008,2009,2010,2011,2014,2015,2016,2017,2021],"xaxis":"x","y":[5,9,9,10,16,11,32,74,91,115,120,191,233,300,427,697,902,1313,1656,1776,1675,1547,1458,1215,1004,648,504,415,338,279,243,192,145,108,108,92,72,64,87,91,81,65,79,67,74,64,56,71,78,93,85,78,50,61,70,53,46,39,22,28,19,11,16,14,13,8,21,10,11,10,12,8,9,6,5,5,5],"yaxis":"y","type":"scatter"},{"hovertemplate":"Name=Terri<br>Year=%{x}<br>Count=%{y}<extra></extra>","legendgroup":"Terri","line":{"color":"#FF6692","dash":"solid"},"marker":{"symbol":"circle"},"mode":"lines","name":"Terri","orientation":"v","showlegend":true,"x":[1938,1940,1941,1942,1943,1944,1945,1946,1947,1948,1949,1950,1951,1952,1953,1954,1955,1956,1957,1958,1959,1960,1961,1962,1963,1964,1965,1966,1967,1968,1969,1970,1971,1972,1973,1974,1975,1976,1977,1978,1979,1980,1981,1982,1983,1984,1985,1986,1987,1988,1989,1990,1991,1992,1993,1994,1995,1996,1997,1998,1999,2000,2001,2002,2004,2005,2006,2016,2021,2022],"xaxis":"x","y":[6,8,12,26,32,38,65,99,130,132,168,154,236,306,379,542,604,685,839,875,1052,964,937,902,826,737,486,448,398,323,312,263,191,153,120,106,81,59,84,57,44,49,47,53,44,36,37,35,32,34,20,26,29,15,19,22,11,15,12,13,11,14,9,7,6,7,5,5,5,5],"yaxis":"y","type":"scatter"},{"hovertemplate":"Name=Shannon<br>Year=%{x}<br>Count=%{y}<extra></extra>","legendgroup":"Shannon","line":{"color":"#B6E880","dash":"solid"},"marker":{"symbol":"circle"},"mode":"lines","name":"Shannon","orientation":"v","showlegend":true,"x":[1938,1939,1940,1942,1943,1944,1945,1946,1947,1948,1949,1950,1951,1952,1953,1954,1955,1956,1957,1958,1959,1960,1961,1962,1963,1964,1965,1966,1967,1968,1969,1970,1971,1972,1973,1974,1975,1976,1977,1978,1979,1980,1981,1982,1983,1984,1985,1986,1987,1988,1989,1990,1991,1992,1993,1994,1995,1996,1997,1998,1999,2000,2001,2002,2003,2004,2005,2006,2007,2008,2009,2010,2011,2012,2013,2014,2015,2016,2017,2018,2019,2020,2021,2022],"xaxis":"x","y":[6,9,6,10,14,19,25,16,34,23,34,43,51,59,73,83,111,106,126,129,161,145,206,216,305,409,441,516,587,932,1419,1650,1436,1198,1090,1127,982,1218,1136,1052,991,923,968,969,971,945,872,803,699,642,597,527,493,594,615,531,438,428,366,303,217,199,200,165,133,133,110,90,88,63,42,43,37,41,32,19,31,22,17,14,21,8,8,7],"yaxis":"y","type":"scatter"},{"hovertemplate":"Name=Debra<br>Year=%{x}<br>Count=%{y}<extra></extra>","legendgroup":"Debra","line":{"color":"#FF97FF","dash":"solid"},"marker":{"symbol":"circle"},"mode":"lines","name":"Debra","orientation":"v","showlegend":true,"x":[1940,1942,1943,1944,1945,1946,1947,1948,1949,1950,1951,1952,1953,1954,1955,1956,1957,1958,1959,1960,1961,1962,1963,1964,1965,1966,1967,1968,1969,1970,1971,1972,1973,1974,1975,1976,1977,1978,1979,1980,1981,1982,1983,1984,1985,1986,1987,1988,1989,1990,1991,1992,1993,1994,1995,1996,1997,1998,1999,2000,2001,2002,2003,2004,2005,2006,2007,2008,2009,2012,2013,2016],"xaxis":"x","y":[7,7,8,15,19,20,56,92,199,601,1510,2351,3295,3784,3969,3755,3318,2660,2290,2014,1647,1592,1430,1287,1154,958,818,748,647,547,463,318,242,236,159,151,151,164,130,141,97,114,97,95,93,64,78,69,71,51,62,41,34,28,28,12,14,16,10,13,14,10,7,12,13,12,13,6,7,5,8,5],"yaxis":"y","type":"scatter"},{"hovertemplate":"Name=Tammy<br>Year=%{x}<br>Count=%{y}<extra></extra>","legendgroup":"Tammy","line":{"color":"#FECB52","dash":"solid"},"marker":{"symbol":"circle"},"mode":"lines","name":"Tammy","orientation":"v","showlegend":true,"x":[1943,1944,1945,1946,1947,1948,1949,1950,1951,1952,1953,1954,1955,1956,1957,1958,1959,1960,1961,1962,1963,1964,1965,1966,1967,1968,1969,1970,1971,1972,1973,1974,1975,1976,1977,1978,1979,1980,1981,1982,1983,1984,1985,1986,1987,1988,1989,1990,1991,1992,1993,1994,1995,1996,1997,1998,1999,2000,2001,2002,2003,2004,2005,2006,2007,2008,2009,2010,2011,2012,2013,2014,2015,2016,2017,2019,2022],"xaxis":"x","y":[7,5,10,9,12,13,10,9,9,13,28,14,26,37,368,746,990,1038,1136,1223,1539,1273,1219,1168,1143,1099,977,1013,859,704,544,421,392,328,275,229,227,181,168,157,96,120,102,85,120,88,85,94,77,82,74,61,49,45,45,54,50,47,49,45,44,36,30,24,29,14,16,12,11,9,5,13,9,15,11,7,5],"yaxis":"y","type":"scatter"}],                        {"template":{"data":{"histogram2dcontour":[{"type":"histogram2dcontour","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"choropleth":[{"type":"choropleth","colorbar":{"outlinewidth":0,"ticks":""}}],"histogram2d":[{"type":"histogram2d","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"heatmap":[{"type":"heatmap","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"heatmapgl":[{"type":"heatmapgl","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"contourcarpet":[{"type":"contourcarpet","colorbar":{"outlinewidth":0,"ticks":""}}],"contour":[{"type":"contour","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"surface":[{"type":"surface","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"mesh3d":[{"type":"mesh3d","colorbar":{"outlinewidth":0,"ticks":""}}],"scatter":[{"fillpattern":{"fillmode":"overlay","size":10,"solidity":0.2},"type":"scatter"}],"parcoords":[{"type":"parcoords","line":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scatterpolargl":[{"type":"scatterpolargl","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"bar":[{"error_x":{"color":"#2a3f5f"},"error_y":{"color":"#2a3f5f"},"marker":{"line":{"color":"#E5ECF6","width":0.5},"pattern":{"fillmode":"overlay","size":10,"solidity":0.2}},"type":"bar"}],"scattergeo":[{"type":"scattergeo","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scatterpolar":[{"type":"scatterpolar","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"histogram":[{"marker":{"pattern":{"fillmode":"overlay","size":10,"solidity":0.2}},"type":"histogram"}],"scattergl":[{"type":"scattergl","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scatter3d":[{"type":"scatter3d","line":{"colorbar":{"outlinewidth":0,"ticks":""}},"marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scattermapbox":[{"type":"scattermapbox","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scatterternary":[{"type":"scatterternary","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scattercarpet":[{"type":"scattercarpet","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"carpet":[{"aaxis":{"endlinecolor":"#2a3f5f","gridcolor":"white","linecolor":"white","minorgridcolor":"white","startlinecolor":"#2a3f5f"},"baxis":{"endlinecolor":"#2a3f5f","gridcolor":"white","linecolor":"white","minorgridcolor":"white","startlinecolor":"#2a3f5f"},"type":"carpet"}],"table":[{"cells":{"fill":{"color":"#EBF0F8"},"line":{"color":"white"}},"header":{"fill":{"color":"#C8D4E3"},"line":{"color":"white"}},"type":"table"}],"barpolar":[{"marker":{"line":{"color":"#E5ECF6","width":0.5},"pattern":{"fillmode":"overlay","size":10,"solidity":0.2}},"type":"barpolar"}],"pie":[{"automargin":true,"type":"pie"}]},"layout":{"autotypenumbers":"strict","colorway":["#636efa","#EF553B","#00cc96","#ab63fa","#FFA15A","#19d3f3","#FF6692","#B6E880","#FF97FF","#FECB52"],"font":{"color":"#2a3f5f"},"hovermode":"closest","hoverlabel":{"align":"left"},"paper_bgcolor":"white","plot_bgcolor":"#E5ECF6","polar":{"bgcolor":"#E5ECF6","angularaxis":{"gridcolor":"white","linecolor":"white","ticks":""},"radialaxis":{"gridcolor":"white","linecolor":"white","ticks":""}},"ternary":{"bgcolor":"#E5ECF6","aaxis":{"gridcolor":"white","linecolor":"white","ticks":""},"baxis":{"gridcolor":"white","linecolor":"white","ticks":""},"caxis":{"gridcolor":"white","linecolor":"white","ticks":""}},"coloraxis":{"colorbar":{"outlinewidth":0,"ticks":""}},"colorscale":{"sequential":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]],"sequentialminus":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]],"diverging":[[0,"#8e0152"],[0.1,"#c51b7d"],[0.2,"#de77ae"],[0.3,"#f1b6da"],[0.4,"#fde0ef"],[0.5,"#f7f7f7"],[0.6,"#e6f5d0"],[0.7,"#b8e186"],[0.8,"#7fbc41"],[0.9,"#4d9221"],[1,"#276419"]]},"xaxis":{"gridcolor":"white","linecolor":"white","ticks":"","title":{"standoff":15},"zerolinecolor":"white","automargin":true,"zerolinewidth":2},"yaxis":{"gridcolor":"white","linecolor":"white","ticks":"","title":{"standoff":15},"zerolinecolor":"white","automargin":true,"zerolinewidth":2},"scene":{"xaxis":{"backgroundcolor":"#E5ECF6","gridcolor":"white","linecolor":"white","showbackground":true,"ticks":"","zerolinecolor":"white","gridwidth":2},"yaxis":{"backgroundcolor":"#E5ECF6","gridcolor":"white","linecolor":"white","showbackground":true,"ticks":"","zerolinecolor":"white","gridwidth":2},"zaxis":{"backgroundcolor":"#E5ECF6","gridcolor":"white","linecolor":"white","showbackground":true,"ticks":"","zerolinecolor":"white","gridwidth":2}},"shapedefaults":{"line":{"color":"#2a3f5f"}},"annotationdefaults":{"arrowcolor":"#2a3f5f","arrowhead":0,"arrowwidth":1},"geo":{"bgcolor":"white","landcolor":"#E5ECF6","subunitcolor":"white","showland":true,"showlakes":true,"lakecolor":"white"},"title":{"x":0.05},"mapbox":{"style":"light"},"margin":{"b":0,"l":0,"r":0,"t":30}}},"xaxis":{"anchor":"y","domain":[0.0,1.0],"title":{"text":"Year"}},"yaxis":{"anchor":"x","domain":[0.0,1.0],"title":{"text":"Count"}},"legend":{"title":{"text":"Name"},"tracegroupgap":0}},                        {"responsive": true}                    ).then(function(){
                            
var gd = document.getElementById('8322598c-e7f1-4ebf-847c-e9b6ece89f07');
var x = new MutationObserver(function (mutations, observer) {{
        var display = window.getComputedStyle(gd).display;
        if (!display || display === 'none') {{
            console.log([gd, 'removed!']);
            Plotly.purge(gd);
            observer.disconnect();
        }}
}});

// Listen for the removal of the full notebook cells
var notebookContainer = gd.closest('#notebook-container');
if (notebookContainer) {{
    x.observe(notebookContainer, {childList: true});
}}

// Listen for the clearing of the current output cell
var outputEl = gd.closest('.output');
if (outputEl) {{
    x.observe(outputEl, {childList: true});
}}

                        })                };                });            </script>        </div>
</div>
</div>
<p>As a quick exercise, consider what code would compute the total number of babies with each name.</p>
<div id="1f222b12" class="cell" data-execution_count="26">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>babynames.groupby(<span class="st">"Name"</span>)[[<span class="st">"Count"</span>]].agg(<span class="st">"sum"</span>).head()</span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a><span class="co"># alternative solution: </span></span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a><span class="co"># babynames.groupby("Name")[["Count"]].sum()</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="26">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Count</th>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">Name</th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">Aadan</td>
<td>18</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Aadarsh</td>
<td>6</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Aaden</td>
<td>647</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Aadhav</td>
<td>27</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Aadhini</td>
<td>6</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
</section>
<section id="groupby-continued" class="level2" data-number="4.3">
<h2 data-number="4.3" class="anchored" data-anchor-id="groupby-continued"><span class="header-section-number">4.3</span> <code>.groupby()</code>, Continued</h2>
<p>We’ll work with the <code>elections</code> <code>DataFrame</code> again.</p>
<div id="cfea6a51" class="cell" data-execution_count="27">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a>elections <span class="op">=</span> pd.read_csv(<span class="st">"data/elections.csv"</span>)</span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a>elections.head(<span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="27">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Year</th>
<th data-quarto-table-cell-role="th">Candidate</th>
<th data-quarto-table-cell-role="th">Party</th>
<th data-quarto-table-cell-role="th">Popular vote</th>
<th data-quarto-table-cell-role="th">Result</th>
<th data-quarto-table-cell-role="th">%</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>1824</td>
<td>Andrew Jackson</td>
<td>Democratic-Republican</td>
<td>151271</td>
<td>loss</td>
<td>57.210122</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>1824</td>
<td>John Quincy Adams</td>
<td>Democratic-Republican</td>
<td>113142</td>
<td>win</td>
<td>42.789878</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>1828</td>
<td>Andrew Jackson</td>
<td>Democratic</td>
<td>642806</td>
<td>win</td>
<td>56.203927</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>1828</td>
<td>John Quincy Adams</td>
<td>National Republican</td>
<td>500897</td>
<td>loss</td>
<td>43.796073</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>1832</td>
<td>Andrew Jackson</td>
<td>Democratic</td>
<td>702735</td>
<td>win</td>
<td>54.574789</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<section id="raw-groupby-objects" class="level3" data-number="4.3.1">
<h3 data-number="4.3.1" class="anchored" data-anchor-id="raw-groupby-objects"><span class="header-section-number">4.3.1</span> Raw <code>GroupBy</code> Objects</h3>
<p>The result of <code>groupby</code> applied to a <code>DataFrame</code> is a <code>DataFrameGroupBy</code> object, <strong>not</strong> a <code>DataFrame</code>.</p>
<div id="d8f2db71" class="cell" data-execution_count="28">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>grouped_by_year <span class="op">=</span> elections.groupby(<span class="st">"Year"</span>)</span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a><span class="bu">type</span>(grouped_by_year)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="28">
<pre><code>pandas.core.groupby.generic.DataFrameGroupBy</code></pre>
</div>
</div>
<p>There are several ways to look into <code>DataFrameGroupBy</code> objects:</p>
<div id="c2f89499" class="cell" data-execution_count="29">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>grouped_by_party <span class="op">=</span> elections.groupby(<span class="st">"Party"</span>)</span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>grouped_by_party.groups</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="29">
<pre><code>{'American': [22, 126], 'American Independent': [115, 119, 124], 'Anti-Masonic': [6], 'Anti-Monopoly': [38], 'Citizens': [127], 'Communist': [89], 'Constitution': [160, 164, 172], 'Constitutional Union': [24], 'Democratic': [2, 4, 8, 10, 13, 14, 17, 20, 28, 29, 34, 37, 39, 45, 47, 52, 55, 57, 64, 70, 74, 77, 81, 83, 86, 91, 94, 97, 100, 105, 108, 111, 114, 116, 118, 123, 129, 134, 137, 140, 144, 151, 158, 162, 168, 176, 178], 'Democratic-Republican': [0, 1], 'Dixiecrat': [103], 'Farmer–Labor': [78], 'Free Soil': [15, 18], 'Green': [149, 155, 156, 165, 170, 177, 181], 'Greenback': [35], 'Independent': [121, 130, 143, 161, 167, 174], 'Liberal Republican': [31], 'Libertarian': [125, 128, 132, 138, 139, 146, 153, 159, 163, 169, 175, 180], 'National Democratic': [50], 'National Republican': [3, 5], 'National Union': [27], 'Natural Law': [148], 'New Alliance': [136], 'Northern Democratic': [26], 'Populist': [48, 61, 141], 'Progressive': [68, 82, 101, 107], 'Prohibition': [41, 44, 49, 51, 54, 59, 63, 67, 73, 75, 99], 'Reform': [150, 154], 'Republican': [21, 23, 30, 32, 33, 36, 40, 43, 46, 53, 56, 60, 65, 69, 72, 79, 80, 84, 87, 90, 96, 98, 104, 106, 109, 112, 113, 117, 120, 122, 131, 133, 135, 142, 145, 152, 157, 166, 171, 173, 179], 'Socialist': [58, 62, 66, 71, 76, 85, 88, 92, 95, 102], 'Southern Democratic': [25], 'States' Rights': [110], 'Taxpayers': [147], 'Union': [93], 'Union Labor': [42], 'Whig': [7, 9, 11, 12, 16, 19]}</code></pre>
</div>
</div>
<div id="29ffa3bb" class="cell" data-execution_count="30">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>grouped_by_party.get_group(<span class="st">"Socialist"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="30">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Year</th>
<th data-quarto-table-cell-role="th">Candidate</th>
<th data-quarto-table-cell-role="th">Party</th>
<th data-quarto-table-cell-role="th">Popular vote</th>
<th data-quarto-table-cell-role="th">Result</th>
<th data-quarto-table-cell-role="th">%</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">58</td>
<td>1904</td>
<td>Eugene V. Debs</td>
<td>Socialist</td>
<td>402810</td>
<td>loss</td>
<td>2.985897</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">62</td>
<td>1908</td>
<td>Eugene V. Debs</td>
<td>Socialist</td>
<td>420852</td>
<td>loss</td>
<td>2.850866</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">66</td>
<td>1912</td>
<td>Eugene V. Debs</td>
<td>Socialist</td>
<td>901551</td>
<td>loss</td>
<td>6.004354</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">71</td>
<td>1916</td>
<td>Allan L. Benson</td>
<td>Socialist</td>
<td>590524</td>
<td>loss</td>
<td>3.194193</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">76</td>
<td>1920</td>
<td>Eugene V. Debs</td>
<td>Socialist</td>
<td>913693</td>
<td>loss</td>
<td>3.428282</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">85</td>
<td>1928</td>
<td>Norman Thomas</td>
<td>Socialist</td>
<td>267478</td>
<td>loss</td>
<td>0.728623</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">88</td>
<td>1932</td>
<td>Norman Thomas</td>
<td>Socialist</td>
<td>884885</td>
<td>loss</td>
<td>2.236211</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">92</td>
<td>1936</td>
<td>Norman Thomas</td>
<td>Socialist</td>
<td>187910</td>
<td>loss</td>
<td>0.412876</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">95</td>
<td>1940</td>
<td>Norman Thomas</td>
<td>Socialist</td>
<td>116599</td>
<td>loss</td>
<td>0.234237</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">102</td>
<td>1948</td>
<td>Norman Thomas</td>
<td>Socialist</td>
<td>139569</td>
<td>loss</td>
<td>0.286312</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
<section id="other-groupby-methods" class="level3" data-number="4.3.2">
<h3 data-number="4.3.2" class="anchored" data-anchor-id="other-groupby-methods"><span class="header-section-number">4.3.2</span> Other <code>GroupBy</code> Methods</h3>
<p>There are many aggregation methods we can use with <code>.agg</code>. Some useful options are:</p>
<ul>
<li><a href="https://pandas.pydata.org/docs/reference/api/pandas.core.groupby.DataFrameGroupBy.mean.html#pandas.core.groupby.DataFrameGroupBy.mean"><code>.mean</code></a>: creates a new <code>DataFrame</code> with the mean value of each group</li>
<li><a href="https://pandas.pydata.org/docs/reference/api/pandas.core.groupby.DataFrameGroupBy.sum.html#pandas.core.groupby.DataFrameGroupBy.sum"><code>.sum</code></a>: creates a new <code>DataFrame</code> with the sum of each group</li>
<li><a href="https://pandas.pydata.org/docs/reference/api/pandas.core.groupby.DataFrameGroupBy.max.html#pandas.core.groupby.DataFrameGroupBy.max"><code>.max</code></a> and <a href="https://pandas.pydata.org/docs/reference/api/pandas.core.groupby.DataFrameGroupBy.min.html#pandas.core.groupby.DataFrameGroupBy.min"><code>.min</code></a>: creates a new <code>DataFrame</code> with the maximum/minimum value of each group</li>
<li><a href="https://pandas.pydata.org/docs/reference/api/pandas.core.groupby.DataFrameGroupBy.first.html#pandas.core.groupby.DataFrameGroupBy.first"><code>.first</code></a> and <a href="https://pandas.pydata.org/docs/reference/api/pandas.core.groupby.DataFrameGroupBy.last.html#pandas.core.groupby.DataFrameGroupBy.last"><code>.last</code></a>: creates a new <code>DataFrame</code> with the first/last row in each group</li>
<li><a href="https://pandas.pydata.org/docs/reference/api/pandas.core.groupby.DataFrameGroupBy.size.html#pandas.core.groupby.DataFrameGroupBy.size"><code>.size</code></a>: creates a new <strong><code>Series</code></strong> with the number of entries in each group</li>
<li><a href="https://pandas.pydata.org/docs/reference/api/pandas.core.groupby.DataFrameGroupBy.count.html#pandas.core.groupby.DataFrameGroupBy.count"><code>.count</code></a>: creates a new <strong><code>DataFrame</code></strong> with the number of entries, excluding missing values.</li>
</ul>
<p>Let’s illustrate some examples by creating a <code>DataFrame</code> called <code>df</code>.</p>
<div id="878f2253" class="cell" data-execution_count="31">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.DataFrame({<span class="st">'letter'</span>:[<span class="st">'A'</span>,<span class="st">'A'</span>,<span class="st">'B'</span>,<span class="st">'C'</span>,<span class="st">'C'</span>,<span class="st">'C'</span>], </span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>                   <span class="st">'num'</span>:[<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>,np.nan,<span class="dv">4</span>], </span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a>                   <span class="st">'state'</span>:[np.nan, <span class="st">'tx'</span>, <span class="st">'fl'</span>, <span class="st">'hi'</span>, np.nan, <span class="st">'ak'</span>]})</span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a>df</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="31">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">letter</th>
<th data-quarto-table-cell-role="th">num</th>
<th data-quarto-table-cell-role="th">state</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>A</td>
<td>1.0</td>
<td>NaN</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>A</td>
<td>2.0</td>
<td>tx</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>B</td>
<td>3.0</td>
<td>fl</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>C</td>
<td>4.0</td>
<td>hi</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>C</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">5</td>
<td>C</td>
<td>4.0</td>
<td>ak</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>Note the slight difference between <code>.size()</code> and <code>.count()</code>: while <code>.size()</code> returns a <code>Series</code> and counts the number of entries including the missing values, <code>.count()</code> returns a <code>DataFrame</code> and counts the number of entries in each column <em>excluding missing values</em>.</p>
<div id="83e91f0e" class="cell" data-execution_count="32">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>df.groupby(<span class="st">"letter"</span>).size()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="32">
<pre><code>letter
A    2
B    1
C    3
dtype: int64</code></pre>
</div>
</div>
<div id="d56447f1" class="cell" data-execution_count="33">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>df.groupby(<span class="st">"letter"</span>).count()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="33">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">num</th>
<th data-quarto-table-cell-role="th">state</th>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">letter</th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">A</td>
<td>2</td>
<td>1</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">B</td>
<td>1</td>
<td>1</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">C</td>
<td>2</td>
<td>2</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>You might recall that the <code>value_counts()</code> function in the previous note does something similar. It turns out <code>value_counts()</code> and <code>groupby.size()</code> are the same, except <code>value_counts()</code> sorts the resulting <code>Series</code> in descending order automatically.</p>
<div id="38e9d983" class="cell" data-execution_count="34">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>df[<span class="st">"letter"</span>].value_counts()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="34">
<pre><code>letter
C    3
A    2
B    1
Name: count, dtype: int64</code></pre>
</div>
</div>
<p>These (and other) aggregation functions are so common that <code>pandas</code> allows for writing shorthand. Instead of explicitly stating the use of <code>.agg</code>, we can call the function directly on the <code>GroupBy</code> object.</p>
<p>For example, the following are equivalent:</p>
<ul>
<li><code>elections.groupby("Candidate").agg(mean)</code></li>
<li><code>elections.groupby("Candidate").mean()</code></li>
</ul>
<p>There are many other methods that <code>pandas</code> supports. You can check them out on the <a href="https://pandas.pydata.org/docs/reference/groupby.html"><code>pandas</code> documentation</a>.</p>
</section>
<section id="filtering-by-group" class="level3" data-number="4.3.3">
<h3 data-number="4.3.3" class="anchored" data-anchor-id="filtering-by-group"><span class="header-section-number">4.3.3</span> Filtering by Group</h3>
<p>Another common use for <code>GroupBy</code> objects is to filter data by group.</p>
<p><code>groupby.filter</code> takes an argument <code>func</code>, where <code>func</code> is a function that:</p>
<ul>
<li>Takes a <code>DataFrame</code> object as input</li>
<li>Returns a single <code>True</code> or <code>False</code>.</li>
</ul>
<p><code>groupby.filter</code> applies <code>func</code> to each group/sub-<code>DataFrame</code>:</p>
<ul>
<li>If <code>func</code> returns <code>True</code> for a group, then all rows belonging to the group are preserved.</li>
<li>If <code>func</code> returns <code>False</code> for a group, then all rows belonging to that group are filtered out.</li>
</ul>
<p>In other words, sub-<code>DataFrame</code>s that correspond to <code>True</code> are returned in the final result, whereas those with a <code>False</code> value are not. Importantly, <code>groupby.filter</code> is different from <code>groupby.agg</code> in that an <em>entire</em> sub-<code>DataFrame</code> is returned in the final <code>DataFrame</code>, not just a single row. As a result, <code>groupby.filter</code> preserves the original indices and the column we grouped on does <strong>NOT</strong> become the index!</p>
<p><img src="images/filter_demo.png" alt="groupby_demo" width="600"></p>
<p>To illustrate how this happens, let’s go back to the <code>elections</code> dataset. Say we want to identify “tight” election years – that is, we want to find all rows that correspond to election years where all candidates in that year won a similar portion of the total vote. Specifically, let’s find all rows corresponding to a year where no candidate won more than 45% of the total vote.</p>
<p>In other words, we want to:</p>
<ul>
<li>Find the years where the maximum <code>%</code> in that year is less than 45%</li>
<li>Return all <code>DataFrame</code> rows that correspond to these years</li>
</ul>
<p>For each year, we need to find the maximum <code>%</code> among <em>all</em> rows for that year. If this maximum <code>%</code> is lower than 45%, we will tell <code>pandas</code> to keep all rows corresponding to that year.</p>
<div id="7b50186e" class="cell" data-execution_count="35">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>elections.groupby(<span class="st">"Year"</span>).<span class="bu">filter</span>(<span class="kw">lambda</span> sf: sf[<span class="st">"%"</span>].<span class="bu">max</span>() <span class="op">&lt;</span> <span class="dv">45</span>).head(<span class="dv">9</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="35">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Year</th>
<th data-quarto-table-cell-role="th">Candidate</th>
<th data-quarto-table-cell-role="th">Party</th>
<th data-quarto-table-cell-role="th">Popular vote</th>
<th data-quarto-table-cell-role="th">Result</th>
<th data-quarto-table-cell-role="th">%</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">23</td>
<td>1860</td>
<td>Abraham Lincoln</td>
<td>Republican</td>
<td>1855993</td>
<td>win</td>
<td>39.699408</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">24</td>
<td>1860</td>
<td>John Bell</td>
<td>Constitutional Union</td>
<td>590901</td>
<td>loss</td>
<td>12.639283</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">25</td>
<td>1860</td>
<td>John C. Breckinridge</td>
<td>Southern Democratic</td>
<td>848019</td>
<td>loss</td>
<td>18.138998</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">26</td>
<td>1860</td>
<td>Stephen A. Douglas</td>
<td>Northern Democratic</td>
<td>1380202</td>
<td>loss</td>
<td>29.522311</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">66</td>
<td>1912</td>
<td>Eugene V. Debs</td>
<td>Socialist</td>
<td>901551</td>
<td>loss</td>
<td>6.004354</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">67</td>
<td>1912</td>
<td>Eugene W. Chafin</td>
<td>Prohibition</td>
<td>208156</td>
<td>loss</td>
<td>1.386325</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">68</td>
<td>1912</td>
<td>Theodore Roosevelt</td>
<td>Progressive</td>
<td>4122721</td>
<td>loss</td>
<td>27.457433</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">69</td>
<td>1912</td>
<td>William Taft</td>
<td>Republican</td>
<td>3486242</td>
<td>loss</td>
<td>23.218466</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">70</td>
<td>1912</td>
<td>Woodrow Wilson</td>
<td>Democratic</td>
<td>6296284</td>
<td>win</td>
<td>41.933422</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>What’s going on here? In this example, we’ve defined our filtering function, <code>func</code>, to be <code>lambda sf: sf["%"].max() &lt; 45</code>. This filtering function will find the maximum <code>"%"</code> value among all entries in the grouped sub-<code>DataFrame</code>, which we call <code>sf</code>. If the maximum value is less than 45, then the filter function will return <code>True</code> and all rows in that grouped sub-<code>DataFrame</code> will appear in the final output <code>DataFrame</code>.</p>
<p>Examine the <code>DataFrame</code> above. Notice how, in this preview of the first 9 rows, all entries from the years 1860 and 1912 appear. This means that in 1860 and 1912, no candidate in that year won more than 45% of the total vote.</p>
<p>You may ask: how is the <code>groupby.filter</code> procedure different to the boolean filtering we’ve seen previously? Boolean filtering considers <em>individual</em> rows when applying a boolean condition. For example, the code <code>elections[elections["%"] &lt; 45]</code> will check the <code>"%"</code> value of every single row in <code>elections</code>; if it is less than 45, then that row will be kept in the output. <code>groupby.filter</code>, in contrast, applies a boolean condition <em>across</em> all rows in a group. If not all rows in that group satisfy the condition specified by the filter, the entire group will be discarded in the output.</p>
</section>
<section id="aggregation-with-lambda-functions" class="level3" data-number="4.3.4">
<h3 data-number="4.3.4" class="anchored" data-anchor-id="aggregation-with-lambda-functions"><span class="header-section-number">4.3.4</span> Aggregation with <code>lambda</code> Functions</h3>
<p>What if we wish to aggregate our <code>DataFrame</code> using a non-standard function – for example, a function of our own design? We can do so by combining <code>.agg</code> with <code>lambda</code> expressions.</p>
<p>Let’s first consider a puzzle to jog our memory. We will attempt to find the <code>Candidate</code> from each <code>Party</code> with the highest <code>%</code> of votes.</p>
<p>A naive approach may be to group by the <code>Party</code> column and aggregate by the maximum.</p>
<div id="fbaa5e20" class="cell" data-execution_count="36">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a>elections.groupby(<span class="st">"Party"</span>).agg(<span class="bu">max</span>).head(<span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>/var/folders/ks/dgd81q6j5b7ghm1zc_4483vr0000gn/T/ipykernel_11544/4278286395.py:1: FutureWarning:

The provided callable &lt;built-in function max&gt; is currently using DataFrameGroupBy.max. In a future version of pandas, the provided callable will be used directly. To keep current behavior pass the string "max" instead.
</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="36">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Year</th>
<th data-quarto-table-cell-role="th">Candidate</th>
<th data-quarto-table-cell-role="th">Popular vote</th>
<th data-quarto-table-cell-role="th">Result</th>
<th data-quarto-table-cell-role="th">%</th>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">Party</th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">American</td>
<td>1976</td>
<td>Thomas J. Anderson</td>
<td>873053</td>
<td>loss</td>
<td>21.554001</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">American Independent</td>
<td>1976</td>
<td>Lester Maddox</td>
<td>9901118</td>
<td>loss</td>
<td>13.571218</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Anti-Masonic</td>
<td>1832</td>
<td>William Wirt</td>
<td>100715</td>
<td>loss</td>
<td>7.821583</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Anti-Monopoly</td>
<td>1884</td>
<td>Benjamin Butler</td>
<td>134294</td>
<td>loss</td>
<td>1.335838</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Citizens</td>
<td>1980</td>
<td>Barry Commoner</td>
<td>233052</td>
<td>loss</td>
<td>0.270182</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Communist</td>
<td>1932</td>
<td>William Z. Foster</td>
<td>103307</td>
<td>loss</td>
<td>0.261069</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Constitution</td>
<td>2016</td>
<td>Michael Peroutka</td>
<td>203091</td>
<td>loss</td>
<td>0.152398</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Constitutional Union</td>
<td>1860</td>
<td>John Bell</td>
<td>590901</td>
<td>loss</td>
<td>12.639283</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Democratic</td>
<td>2020</td>
<td>Woodrow Wilson</td>
<td>81268924</td>
<td>win</td>
<td>61.344703</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Democratic-Republican</td>
<td>1824</td>
<td>John Quincy Adams</td>
<td>151271</td>
<td>win</td>
<td>57.210122</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>This approach is clearly wrong – the <code>DataFrame</code> claims that Woodrow Wilson won the presidency in 2020.</p>
<p>Why is this happening? Here, the <code>max</code> aggregation function is taken over every column <em>independently</em>. Among Democrats, <code>max</code> is computing:</p>
<ul>
<li>The most recent <code>Year</code> a Democratic candidate ran for president (2020)</li>
<li>The <code>Candidate</code> with the alphabetically “largest” name (“Woodrow Wilson”)</li>
<li>The <code>Result</code> with the alphabetically “largest” outcome (“win”)</li>
</ul>
<p>Instead, let’s try a different approach. We will:</p>
<ol type="1">
<li>Sort the <code>DataFrame</code> so that rows are in descending order of <code>%</code></li>
<li>Group by <code>Party</code> and select the first row of each sub-<code>DataFrame</code></li>
</ol>
<p>While it may seem unintuitive, sorting <code>elections</code> by descending order of <code>%</code> is extremely helpful. If we then group by <code>Party</code>, the first row of each <code>GroupBy</code> object will contain information about the <code>Candidate</code> with the highest voter <code>%</code>.</p>
<div id="d409d8b4" class="cell" data-execution_count="37">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a>elections_sorted_by_percent <span class="op">=</span> elections.sort_values(<span class="st">"%"</span>, ascending<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a>elections_sorted_by_percent.head(<span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="37">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Year</th>
<th data-quarto-table-cell-role="th">Candidate</th>
<th data-quarto-table-cell-role="th">Party</th>
<th data-quarto-table-cell-role="th">Popular vote</th>
<th data-quarto-table-cell-role="th">Result</th>
<th data-quarto-table-cell-role="th">%</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">114</td>
<td>1964</td>
<td>Lyndon Johnson</td>
<td>Democratic</td>
<td>43127041</td>
<td>win</td>
<td>61.344703</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">91</td>
<td>1936</td>
<td>Franklin Roosevelt</td>
<td>Democratic</td>
<td>27752648</td>
<td>win</td>
<td>60.978107</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">120</td>
<td>1972</td>
<td>Richard Nixon</td>
<td>Republican</td>
<td>47168710</td>
<td>win</td>
<td>60.907806</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">79</td>
<td>1920</td>
<td>Warren Harding</td>
<td>Republican</td>
<td>16144093</td>
<td>win</td>
<td>60.574501</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">133</td>
<td>1984</td>
<td>Ronald Reagan</td>
<td>Republican</td>
<td>54455472</td>
<td>win</td>
<td>59.023326</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div id="135d010d" class="cell" data-execution_count="38">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a>elections_sorted_by_percent.groupby(<span class="st">"Party"</span>).agg(<span class="kw">lambda</span> x : x.iloc[<span class="dv">0</span>]).head(<span class="dv">10</span>)</span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Equivalent to the below code</span></span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a><span class="co"># elections_sorted_by_percent.groupby("Party").agg('first').head(10)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="38">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Year</th>
<th data-quarto-table-cell-role="th">Candidate</th>
<th data-quarto-table-cell-role="th">Popular vote</th>
<th data-quarto-table-cell-role="th">Result</th>
<th data-quarto-table-cell-role="th">%</th>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">Party</th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">American</td>
<td>1856</td>
<td>Millard Fillmore</td>
<td>873053</td>
<td>loss</td>
<td>21.554001</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">American Independent</td>
<td>1968</td>
<td>George Wallace</td>
<td>9901118</td>
<td>loss</td>
<td>13.571218</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Anti-Masonic</td>
<td>1832</td>
<td>William Wirt</td>
<td>100715</td>
<td>loss</td>
<td>7.821583</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Anti-Monopoly</td>
<td>1884</td>
<td>Benjamin Butler</td>
<td>134294</td>
<td>loss</td>
<td>1.335838</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Citizens</td>
<td>1980</td>
<td>Barry Commoner</td>
<td>233052</td>
<td>loss</td>
<td>0.270182</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Communist</td>
<td>1932</td>
<td>William Z. Foster</td>
<td>103307</td>
<td>loss</td>
<td>0.261069</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Constitution</td>
<td>2008</td>
<td>Chuck Baldwin</td>
<td>199750</td>
<td>loss</td>
<td>0.152398</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Constitutional Union</td>
<td>1860</td>
<td>John Bell</td>
<td>590901</td>
<td>loss</td>
<td>12.639283</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Democratic</td>
<td>1964</td>
<td>Lyndon Johnson</td>
<td>43127041</td>
<td>win</td>
<td>61.344703</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Democratic-Republican</td>
<td>1824</td>
<td>Andrew Jackson</td>
<td>151271</td>
<td>loss</td>
<td>57.210122</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>Here’s an illustration of the process:</p>
<p><img src="images/puzzle_demo.png" alt="groupby_demo" width="600"></p>
<p>Notice how our code correctly determines that Lyndon Johnson from the Democratic Party has the highest voter <code>%</code>.</p>
<p>More generally, <code>lambda</code> functions are used to design custom aggregation functions that aren’t pre-defined by Python. The input parameter <code>x</code> to the <code>lambda</code> function is a <code>GroupBy</code> object. Therefore, it should make sense why <code>lambda x : x.iloc[0]</code> selects the first row in each groupby object.</p>
<p>In fact, there’s a few different ways to approach this problem. Each approach has different tradeoffs in terms of readability, performance, memory consumption, complexity, etc. We’ve given a few examples below.</p>
<p><strong>Note</strong>: Understanding these alternative solutions is not required. They are given to demonstrate the vast number of problem-solving approaches in <code>pandas</code>.</p>
<div id="82fedc9e" class="cell" data-execution_count="39">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Using the idxmax function</span></span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a>best_per_party <span class="op">=</span> elections.loc[elections.groupby(<span class="st">'Party'</span>)[<span class="st">'%'</span>].idxmax()]</span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a>best_per_party.head(<span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="39">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Year</th>
<th data-quarto-table-cell-role="th">Candidate</th>
<th data-quarto-table-cell-role="th">Party</th>
<th data-quarto-table-cell-role="th">Popular vote</th>
<th data-quarto-table-cell-role="th">Result</th>
<th data-quarto-table-cell-role="th">%</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">22</td>
<td>1856</td>
<td>Millard Fillmore</td>
<td>American</td>
<td>873053</td>
<td>loss</td>
<td>21.554001</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">115</td>
<td>1968</td>
<td>George Wallace</td>
<td>American Independent</td>
<td>9901118</td>
<td>loss</td>
<td>13.571218</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">6</td>
<td>1832</td>
<td>William Wirt</td>
<td>Anti-Masonic</td>
<td>100715</td>
<td>loss</td>
<td>7.821583</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">38</td>
<td>1884</td>
<td>Benjamin Butler</td>
<td>Anti-Monopoly</td>
<td>134294</td>
<td>loss</td>
<td>1.335838</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">127</td>
<td>1980</td>
<td>Barry Commoner</td>
<td>Citizens</td>
<td>233052</td>
<td>loss</td>
<td>0.270182</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div id="0be7817f" class="cell" data-execution_count="40">
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Using the .drop_duplicates function</span></span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a>best_per_party2 <span class="op">=</span> elections.sort_values(<span class="st">'%'</span>).drop_duplicates([<span class="st">'Party'</span>], keep<span class="op">=</span><span class="st">'last'</span>)</span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a>best_per_party2.head(<span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="40">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Year</th>
<th data-quarto-table-cell-role="th">Candidate</th>
<th data-quarto-table-cell-role="th">Party</th>
<th data-quarto-table-cell-role="th">Popular vote</th>
<th data-quarto-table-cell-role="th">Result</th>
<th data-quarto-table-cell-role="th">%</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">148</td>
<td>1996</td>
<td>John Hagelin</td>
<td>Natural Law</td>
<td>113670</td>
<td>loss</td>
<td>0.118219</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">164</td>
<td>2008</td>
<td>Chuck Baldwin</td>
<td>Constitution</td>
<td>199750</td>
<td>loss</td>
<td>0.152398</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">110</td>
<td>1956</td>
<td>T. Coleman Andrews</td>
<td>States' Rights</td>
<td>107929</td>
<td>loss</td>
<td>0.174883</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">147</td>
<td>1996</td>
<td>Howard Phillips</td>
<td>Taxpayers</td>
<td>184656</td>
<td>loss</td>
<td>0.192045</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">136</td>
<td>1988</td>
<td>Lenora Fulani</td>
<td>New Alliance</td>
<td>217221</td>
<td>loss</td>
<td>0.237804</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
</section>
<section id="aggregating-data-with-pivot-tables" class="level2" data-number="4.4">
<h2 data-number="4.4" class="anchored" data-anchor-id="aggregating-data-with-pivot-tables"><span class="header-section-number">4.4</span> Aggregating Data with Pivot Tables</h2>
<p>We know now that <code>.groupby</code> gives us the ability to group and aggregate data across our <code>DataFrame</code>. The examples above formed groups using just one column in the <code>DataFrame</code>. It’s possible to group by multiple columns at once by passing in a list of column names to <code>.groupby</code>.</p>
<p>Let’s consider the <code>babynames</code> dataset again. In this problem, we will find the total number of baby names associated with each sex for each year. To do this, we’ll group by <em>both</em> the <code>"Year"</code> and <code>"Sex"</code> columns.</p>
<div id="471c1256" class="cell" data-execution_count="41">
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a>babynames.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="41">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">State</th>
<th data-quarto-table-cell-role="th">Sex</th>
<th data-quarto-table-cell-role="th">Year</th>
<th data-quarto-table-cell-role="th">Name</th>
<th data-quarto-table-cell-role="th">Count</th>
<th data-quarto-table-cell-role="th">First Letter</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">115957</td>
<td>CA</td>
<td>F</td>
<td>1990</td>
<td>Deandrea</td>
<td>5</td>
<td>D</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">101976</td>
<td>CA</td>
<td>F</td>
<td>1986</td>
<td>Deandrea</td>
<td>6</td>
<td>D</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">131029</td>
<td>CA</td>
<td>F</td>
<td>1994</td>
<td>Leandrea</td>
<td>5</td>
<td>L</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">108731</td>
<td>CA</td>
<td>F</td>
<td>1988</td>
<td>Deandrea</td>
<td>5</td>
<td>D</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">308131</td>
<td>CA</td>
<td>M</td>
<td>1985</td>
<td>Deandrea</td>
<td>6</td>
<td>D</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div id="045ff11d" class="cell" data-execution_count="42">
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Find the total number of baby names associated with each sex for each </span></span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a><span class="co"># year in the data</span></span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a>babynames.groupby([<span class="st">"Year"</span>, <span class="st">"Sex"</span>])[[<span class="st">"Count"</span>]].agg(<span class="bu">sum</span>).head(<span class="dv">6</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>/var/folders/ks/dgd81q6j5b7ghm1zc_4483vr0000gn/T/ipykernel_11544/3186035650.py:3: FutureWarning:

The provided callable &lt;built-in function sum&gt; is currently using DataFrameGroupBy.sum. In a future version of pandas, the provided callable will be used directly. To keep current behavior pass the string "sum" instead.
</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="42">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Count</th>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">Year</th>
<th data-quarto-table-cell-role="th">Sex</th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td rowspan="2" data-quarto-table-cell-role="th" data-valign="top">1910</td>
<td data-quarto-table-cell-role="th">F</td>
<td>5950</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">M</td>
<td>3213</td>
</tr>
<tr class="odd">
<td rowspan="2" data-quarto-table-cell-role="th" data-valign="top">1911</td>
<td data-quarto-table-cell-role="th">F</td>
<td>6602</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">M</td>
<td>3381</td>
</tr>
<tr class="odd">
<td rowspan="2" data-quarto-table-cell-role="th" data-valign="top">1912</td>
<td data-quarto-table-cell-role="th">F</td>
<td>9804</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">M</td>
<td>8142</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>Notice that both <code>"Year"</code> and <code>"Sex"</code> serve as the index of the <code>DataFrame</code> (they are both rendered in bold). We’ve created a <em>multi-index</em> <code>DataFrame</code> where two different index values, the year and sex, are used to uniquely identify each row.</p>
<p>This isn’t the most intuitive way of representing this data – and, because multi-indexed DataFrames have multiple dimensions in their index, they can often be difficult to use.</p>
<p>Another strategy to aggregate across two columns is to create a pivot table. You saw these back in <a href="https://inferentialthinking.com/chapters/08/3/Cross-Classifying_by_More_than_One_Variable.html#pivot-tables-rearranging-the-output-of-group">Data 8</a>. One set of values is used to create the index of the pivot table; another set is used to define the column names. The values contained in each cell of the table correspond to the aggregated data for each index-column pair.</p>
<p>Here’s an illustration of the process:</p>
<p><img src="images/pivot.png" alt="groupby_demo" width="600"></p>
<p>The best way to understand pivot tables is to see one in action. Let’s return to our original goal of summing the total number of names associated with each combination of year and sex. We’ll call the <code>pandas</code> <a href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.pivot_table.html"><code>.pivot_table</code></a> method to create a new table.</p>
<div id="c9990536" class="cell" data-execution_count="43">
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a><span class="co"># The `pivot_table` method is used to generate a Pandas pivot table</span></span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true" tabindex="-1"></a>babynames.pivot_table(</span>
<span id="cb54-4"><a href="#cb54-4" aria-hidden="true" tabindex="-1"></a>    index <span class="op">=</span> <span class="st">"Year"</span>,</span>
<span id="cb54-5"><a href="#cb54-5" aria-hidden="true" tabindex="-1"></a>    columns <span class="op">=</span> <span class="st">"Sex"</span>,    </span>
<span id="cb54-6"><a href="#cb54-6" aria-hidden="true" tabindex="-1"></a>    values <span class="op">=</span> <span class="st">"Count"</span>, </span>
<span id="cb54-7"><a href="#cb54-7" aria-hidden="true" tabindex="-1"></a>    aggfunc <span class="op">=</span> <span class="st">"sum"</span>, </span>
<span id="cb54-8"><a href="#cb54-8" aria-hidden="true" tabindex="-1"></a>).head(<span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="43">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">Sex</th>
<th data-quarto-table-cell-role="th">F</th>
<th data-quarto-table-cell-role="th">M</th>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">Year</th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">1910</td>
<td>5950</td>
<td>3213</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1911</td>
<td>6602</td>
<td>3381</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">1912</td>
<td>9804</td>
<td>8142</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1913</td>
<td>11860</td>
<td>10234</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">1914</td>
<td>13815</td>
<td>13111</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>Looks a lot better! Now, our <code>DataFrame</code> is structured with clear index-column combinations. Each entry in the pivot table represents the summed count of names for a given combination of <code>"Year"</code> and <code>"Sex"</code>.</p>
<p>Let’s take a closer look at the code implemented above.</p>
<ul>
<li><code>index = "Year"</code> specifies the column name in the original <code>DataFrame</code> that should be used as the index of the pivot table</li>
<li><code>columns = "Sex"</code> specifies the column name in the original <code>DataFrame</code> that should be used to generate the columns of the pivot table</li>
<li><code>values = "Count"</code> indicates what values from the original <code>DataFrame</code> should be used to populate the entry for each index-column combination</li>
<li><code>aggfunc = np.sum</code> tells <code>pandas</code> what function to use when aggregating the data specified by <code>values</code>. Here, we are summing the name counts for each pair of <code>"Year"</code> and <code>"Sex"</code></li>
</ul>
<p>We can even include multiple values in the index or columns of our pivot tables.</p>
<div id="5560bfd3" class="cell" data-execution_count="44">
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a>babynames_pivot <span class="op">=</span> babynames.pivot_table(</span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a>    index<span class="op">=</span><span class="st">"Year"</span>,     <span class="co"># the rows (turned into index)</span></span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a>    columns<span class="op">=</span><span class="st">"Sex"</span>,    <span class="co"># the column values</span></span>
<span id="cb55-4"><a href="#cb55-4" aria-hidden="true" tabindex="-1"></a>    values<span class="op">=</span>[<span class="st">"Count"</span>, <span class="st">"Name"</span>], </span>
<span id="cb55-5"><a href="#cb55-5" aria-hidden="true" tabindex="-1"></a>    aggfunc<span class="op">=</span><span class="st">"max"</span>,      <span class="co"># group operation</span></span>
<span id="cb55-6"><a href="#cb55-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb55-7"><a href="#cb55-7" aria-hidden="true" tabindex="-1"></a>babynames_pivot.head(<span class="dv">6</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="44">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th colspan="2" data-quarto-table-cell-role="th" data-halign="left">Count</th>
<th colspan="2" data-quarto-table-cell-role="th" data-halign="left">Name</th>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">Sex</th>
<th data-quarto-table-cell-role="th">F</th>
<th data-quarto-table-cell-role="th">M</th>
<th data-quarto-table-cell-role="th">F</th>
<th data-quarto-table-cell-role="th">M</th>
</tr>
<tr class="header">
<th data-quarto-table-cell-role="th">Year</th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">1910</td>
<td>295</td>
<td>237</td>
<td>Yvonne</td>
<td>William</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1911</td>
<td>390</td>
<td>214</td>
<td>Zelma</td>
<td>Willis</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">1912</td>
<td>534</td>
<td>501</td>
<td>Yvonne</td>
<td>Woodrow</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1913</td>
<td>584</td>
<td>614</td>
<td>Zelma</td>
<td>Yoshio</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">1914</td>
<td>773</td>
<td>769</td>
<td>Zelma</td>
<td>Yoshio</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1915</td>
<td>998</td>
<td>1033</td>
<td>Zita</td>
<td>Yukio</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>Note that each row provides the number of girls and number of boys having that year’s most common name, and also lists the alphabetically largest girl name and boy name. The counts for number of girls/boys in the resulting <code>DataFrame</code> do not correspond to the names listed. For example, in 1910, the most popular girl name is given to 295 girls, but that name was likely not Yvonne.</p>
</section>
<section id="joining-tables" class="level2" data-number="4.5">
<h2 data-number="4.5" class="anchored" data-anchor-id="joining-tables"><span class="header-section-number">4.5</span> Joining Tables</h2>
<p>When working on data science projects, we’re unlikely to have absolutely all the data we want contained in a single <code>DataFrame</code> – a real-world data scientist needs to grapple with data coming from multiple sources. If we have access to multiple datasets with related information, we can join two or more tables into a single <code>DataFrame</code>.</p>
<p>To put this into practice, we’ll revisit the <code>elections</code> dataset.</p>
<div id="02bfc941" class="cell" data-execution_count="45">
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a>elections.head(<span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="45">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Year</th>
<th data-quarto-table-cell-role="th">Candidate</th>
<th data-quarto-table-cell-role="th">Party</th>
<th data-quarto-table-cell-role="th">Popular vote</th>
<th data-quarto-table-cell-role="th">Result</th>
<th data-quarto-table-cell-role="th">%</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>1824</td>
<td>Andrew Jackson</td>
<td>Democratic-Republican</td>
<td>151271</td>
<td>loss</td>
<td>57.210122</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>1824</td>
<td>John Quincy Adams</td>
<td>Democratic-Republican</td>
<td>113142</td>
<td>win</td>
<td>42.789878</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>1828</td>
<td>Andrew Jackson</td>
<td>Democratic</td>
<td>642806</td>
<td>win</td>
<td>56.203927</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>1828</td>
<td>John Quincy Adams</td>
<td>National Republican</td>
<td>500897</td>
<td>loss</td>
<td>43.796073</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>1832</td>
<td>Andrew Jackson</td>
<td>Democratic</td>
<td>702735</td>
<td>win</td>
<td>54.574789</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>Say we want to understand the popularity of the names of each presidential candidate in 2022. To do this, we’ll need the combined data of <code>babynames</code> <em>and</em> <code>elections</code>.</p>
<p>We’ll start by creating a new column containing the first name of each presidential candidate. This will help us join each name in <code>elections</code> to the corresponding name data in <code>babynames</code>.</p>
<div id="7dd75e8f" class="cell" data-execution_count="46">
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a><span class="co"># This `str` operation splits each candidate's full name at each </span></span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a><span class="co"># blank space, then takes just the candidate's first name</span></span>
<span id="cb57-3"><a href="#cb57-3" aria-hidden="true" tabindex="-1"></a>elections[<span class="st">"First Name"</span>] <span class="op">=</span> elections[<span class="st">"Candidate"</span>].<span class="bu">str</span>.split().<span class="bu">str</span>[<span class="dv">0</span>]</span>
<span id="cb57-4"><a href="#cb57-4" aria-hidden="true" tabindex="-1"></a>elections.head(<span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="46">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Year</th>
<th data-quarto-table-cell-role="th">Candidate</th>
<th data-quarto-table-cell-role="th">Party</th>
<th data-quarto-table-cell-role="th">Popular vote</th>
<th data-quarto-table-cell-role="th">Result</th>
<th data-quarto-table-cell-role="th">%</th>
<th data-quarto-table-cell-role="th">First Name</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>1824</td>
<td>Andrew Jackson</td>
<td>Democratic-Republican</td>
<td>151271</td>
<td>loss</td>
<td>57.210122</td>
<td>Andrew</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>1824</td>
<td>John Quincy Adams</td>
<td>Democratic-Republican</td>
<td>113142</td>
<td>win</td>
<td>42.789878</td>
<td>John</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>1828</td>
<td>Andrew Jackson</td>
<td>Democratic</td>
<td>642806</td>
<td>win</td>
<td>56.203927</td>
<td>Andrew</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>1828</td>
<td>John Quincy Adams</td>
<td>National Republican</td>
<td>500897</td>
<td>loss</td>
<td>43.796073</td>
<td>John</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>1832</td>
<td>Andrew Jackson</td>
<td>Democratic</td>
<td>702735</td>
<td>win</td>
<td>54.574789</td>
<td>Andrew</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div id="21bbe096" class="cell" data-execution_count="47">
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Here, we'll only consider `babynames` data from 2022</span></span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a>babynames_2022 <span class="op">=</span> babynames[babynames[<span class="st">"Year"</span>]<span class="op">==</span><span class="dv">2022</span>]</span>
<span id="cb58-3"><a href="#cb58-3" aria-hidden="true" tabindex="-1"></a>babynames_2022.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="47">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">State</th>
<th data-quarto-table-cell-role="th">Sex</th>
<th data-quarto-table-cell-role="th">Year</th>
<th data-quarto-table-cell-role="th">Name</th>
<th data-quarto-table-cell-role="th">Count</th>
<th data-quarto-table-cell-role="th">First Letter</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">237964</td>
<td>CA</td>
<td>F</td>
<td>2022</td>
<td>Leandra</td>
<td>10</td>
<td>L</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">404916</td>
<td>CA</td>
<td>M</td>
<td>2022</td>
<td>Leandro</td>
<td>99</td>
<td>L</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">405892</td>
<td>CA</td>
<td>M</td>
<td>2022</td>
<td>Andreas</td>
<td>14</td>
<td>A</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">235927</td>
<td>CA</td>
<td>F</td>
<td>2022</td>
<td>Andrea</td>
<td>322</td>
<td>A</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">405695</td>
<td>CA</td>
<td>M</td>
<td>2022</td>
<td>Deandre</td>
<td>18</td>
<td>D</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>Now, we’re ready to join the two tables. <a href="https://pandas.pydata.org/docs/reference/api/pandas.DataFrame.merge.html"><code>pd.merge</code></a> is the <code>pandas</code> method used to join <code>DataFrame</code>s together.</p>
<div id="6eeb8271" class="cell" data-execution_count="48">
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a>merged <span class="op">=</span> pd.merge(left <span class="op">=</span> elections, right <span class="op">=</span> babynames_2022, <span class="op">\</span></span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a>                  left_on <span class="op">=</span> <span class="st">"First Name"</span>, right_on <span class="op">=</span> <span class="st">"Name"</span>)</span>
<span id="cb59-3"><a href="#cb59-3" aria-hidden="true" tabindex="-1"></a>merged.head()</span>
<span id="cb59-4"><a href="#cb59-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Notice that pandas automatically specifies `Year_x` and `Year_y` </span></span>
<span id="cb59-5"><a href="#cb59-5" aria-hidden="true" tabindex="-1"></a><span class="co"># when both merged DataFrames have the same column name to avoid confusion</span></span>
<span id="cb59-6"><a href="#cb59-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-7"><a href="#cb59-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Second option</span></span>
<span id="cb59-8"><a href="#cb59-8" aria-hidden="true" tabindex="-1"></a><span class="co"># merged = elections.merge(right = babynames_2022, \</span></span>
<span id="cb59-9"><a href="#cb59-9" aria-hidden="true" tabindex="-1"></a>    <span class="co"># left_on = "First Name", right_on = "Name")</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="48">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Year_x</th>
<th data-quarto-table-cell-role="th">Candidate</th>
<th data-quarto-table-cell-role="th">Party</th>
<th data-quarto-table-cell-role="th">Popular vote</th>
<th data-quarto-table-cell-role="th">Result</th>
<th data-quarto-table-cell-role="th">%</th>
<th data-quarto-table-cell-role="th">First Name</th>
<th data-quarto-table-cell-role="th">State</th>
<th data-quarto-table-cell-role="th">Sex</th>
<th data-quarto-table-cell-role="th">Year_y</th>
<th data-quarto-table-cell-role="th">Name</th>
<th data-quarto-table-cell-role="th">Count</th>
<th data-quarto-table-cell-role="th">First Letter</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>1824</td>
<td>Andrew Jackson</td>
<td>Democratic-Republican</td>
<td>151271</td>
<td>loss</td>
<td>57.210122</td>
<td>Andrew</td>
<td>CA</td>
<td>M</td>
<td>2022</td>
<td>Andrew</td>
<td>741</td>
<td>A</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>1824</td>
<td>John Quincy Adams</td>
<td>Democratic-Republican</td>
<td>113142</td>
<td>win</td>
<td>42.789878</td>
<td>John</td>
<td>CA</td>
<td>M</td>
<td>2022</td>
<td>John</td>
<td>490</td>
<td>J</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>1828</td>
<td>Andrew Jackson</td>
<td>Democratic</td>
<td>642806</td>
<td>win</td>
<td>56.203927</td>
<td>Andrew</td>
<td>CA</td>
<td>M</td>
<td>2022</td>
<td>Andrew</td>
<td>741</td>
<td>A</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>1828</td>
<td>John Quincy Adams</td>
<td>National Republican</td>
<td>500897</td>
<td>loss</td>
<td>43.796073</td>
<td>John</td>
<td>CA</td>
<td>M</td>
<td>2022</td>
<td>John</td>
<td>490</td>
<td>J</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>1832</td>
<td>Andrew Jackson</td>
<td>Democratic</td>
<td>702735</td>
<td>win</td>
<td>54.574789</td>
<td>Andrew</td>
<td>CA</td>
<td>M</td>
<td>2022</td>
<td>Andrew</td>
<td>741</td>
<td>A</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>Let’s take a closer look at the parameters:</p>
<ul>
<li><code>left</code> and <code>right</code> parameters are used to specify the <code>DataFrame</code>s to be joined.</li>
<li><code>left_on</code> and <code>right_on</code> parameters are assigned to the string names of the columns to be used when performing the join. These two <code>on</code> parameters tell <code>pandas</code> what values should act as pairing keys to determine which rows to merge across the <code>DataFrame</code>s. We’ll talk more about this idea of a pairing key next lecture.</li>
</ul>
</section>
<section id="parting-note" class="level2" data-number="4.6">
<h2 data-number="4.6" class="anchored" data-anchor-id="parting-note"><span class="header-section-number">4.6</span> Parting Note</h2>
<p>Congratulations! We finally tackled <code>pandas</code>. Don’t worry if you are still not feeling very comfortable with it—you will have plenty of chances to practice over the next few weeks.</p>
<p>Next, we will get our hands dirty with some real-world datasets and use our <code>pandas</code> knowledge to conduct some exploratory data analysis.</p>


<!-- -->

</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation column-body">
  <div class="nav-page nav-page-previous">
      <a href="../pandas_2/pandas_2.html" class="pagination-link  aria-label=" &lt;span="" ii&lt;="" span&gt;"="">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Pandas II</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="../eda/eda.html" class="pagination-link" aria-label="<span class='chapter-number'>5</span>&nbsp; <span class='chapter-title'>Data Cleaning and EDA</span>">
        <span class="nav-page-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Data Cleaning and EDA</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb60" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a><span class="an">title:</span><span class="co"> Pandas III</span></span>
<span id="cb60-3"><a href="#cb60-3" aria-hidden="true" tabindex="-1"></a><span class="an">execute:</span></span>
<span id="cb60-4"><a href="#cb60-4" aria-hidden="true" tabindex="-1"></a><span class="co">  echo: true</span></span>
<span id="cb60-5"><a href="#cb60-5" aria-hidden="true" tabindex="-1"></a><span class="co">  enabled: true</span></span>
<span id="cb60-6"><a href="#cb60-6" aria-hidden="true" tabindex="-1"></a><span class="an">format:</span></span>
<span id="cb60-7"><a href="#cb60-7" aria-hidden="true" tabindex="-1"></a><span class="co">  html:</span></span>
<span id="cb60-8"><a href="#cb60-8" aria-hidden="true" tabindex="-1"></a><span class="co">    code-fold: false</span></span>
<span id="cb60-9"><a href="#cb60-9" aria-hidden="true" tabindex="-1"></a><span class="co">    code-tools: true</span></span>
<span id="cb60-10"><a href="#cb60-10" aria-hidden="true" tabindex="-1"></a><span class="co">    toc: true</span></span>
<span id="cb60-11"><a href="#cb60-11" aria-hidden="true" tabindex="-1"></a><span class="co">    toc-title: Pandas III</span></span>
<span id="cb60-12"><a href="#cb60-12" aria-hidden="true" tabindex="-1"></a><span class="co">    page-layout: full</span></span>
<span id="cb60-13"><a href="#cb60-13" aria-hidden="true" tabindex="-1"></a><span class="co">    theme:</span></span>
<span id="cb60-14"><a href="#cb60-14" aria-hidden="true" tabindex="-1"></a><span class="co">      - cosmo</span></span>
<span id="cb60-15"><a href="#cb60-15" aria-hidden="true" tabindex="-1"></a><span class="co">      - cerulean</span></span>
<span id="cb60-16"><a href="#cb60-16" aria-hidden="true" tabindex="-1"></a><span class="co">    callout-icon: false</span></span>
<span id="cb60-17"><a href="#cb60-17" aria-hidden="true" tabindex="-1"></a><span class="an">jupyter:</span></span>
<span id="cb60-18"><a href="#cb60-18" aria-hidden="true" tabindex="-1"></a><span class="co">  jupytext:</span></span>
<span id="cb60-19"><a href="#cb60-19" aria-hidden="true" tabindex="-1"></a><span class="co">    text_representation:</span></span>
<span id="cb60-20"><a href="#cb60-20" aria-hidden="true" tabindex="-1"></a><span class="co">      extension: .qmd</span></span>
<span id="cb60-21"><a href="#cb60-21" aria-hidden="true" tabindex="-1"></a><span class="co">      format_name: quarto</span></span>
<span id="cb60-22"><a href="#cb60-22" aria-hidden="true" tabindex="-1"></a><span class="co">      format_version: '1.0'</span></span>
<span id="cb60-23"><a href="#cb60-23" aria-hidden="true" tabindex="-1"></a><span class="co">      jupytext_version: 1.16.1</span></span>
<span id="cb60-24"><a href="#cb60-24" aria-hidden="true" tabindex="-1"></a><span class="co">  kernelspec:</span></span>
<span id="cb60-25"><a href="#cb60-25" aria-hidden="true" tabindex="-1"></a><span class="co">    display_name: ds100env</span></span>
<span id="cb60-26"><a href="#cb60-26" aria-hidden="true" tabindex="-1"></a><span class="co">    language: python</span></span>
<span id="cb60-27"><a href="#cb60-27" aria-hidden="true" tabindex="-1"></a><span class="co">    name: python3</span></span>
<span id="cb60-28"><a href="#cb60-28" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb60-29"><a href="#cb60-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-30"><a href="#cb60-30" aria-hidden="true" tabindex="-1"></a>::: {.callout-note collapse="false"}</span>
<span id="cb60-31"><a href="#cb60-31" aria-hidden="true" tabindex="-1"></a><span class="fu">## Learning Outcomes</span></span>
<span id="cb60-32"><a href="#cb60-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-33"><a href="#cb60-33" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>Perform advanced aggregation using <span class="in">`.groupby()`</span></span>
<span id="cb60-34"><a href="#cb60-34" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>Use the <span class="in">`pd.pivot_table`</span> method to construct a pivot table</span>
<span id="cb60-35"><a href="#cb60-35" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>Perform simple merges between DataFrames using <span class="in">`pd.merge()`</span></span>
<span id="cb60-36"><a href="#cb60-36" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb60-37"><a href="#cb60-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-38"><a href="#cb60-38" aria-hidden="true" tabindex="-1"></a>We will introduce the concept of aggregating data – we will familiarize ourselves with <span class="in">`GroupBy`</span> objects and used them as tools to consolidate and summarize a<span class="in">`DataFrame`</span>. In this lecture, we will explore working with the different aggregation functions and dive into some advanced <span class="in">`.groupby`</span> methods to show just how powerful of a resource they can be for understanding our data. We will also introduce other techniques for data aggregation to provide flexibility in how we manipulate our tables. </span>
<span id="cb60-39"><a href="#cb60-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-40"><a href="#cb60-40" aria-hidden="true" tabindex="-1"></a><span class="fu">## Custom Sorts</span></span>
<span id="cb60-41"><a href="#cb60-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-42"><a href="#cb60-42" aria-hidden="true" tabindex="-1"></a>First, let's finish our discussion about sorting. Let's try to solve a sorting problem using different approaches. Assume we want to find the longest baby names and sort our data accordingly.</span>
<span id="cb60-43"><a href="#cb60-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-44"><a href="#cb60-44" aria-hidden="true" tabindex="-1"></a>We'll start by loading the <span class="in">`babynames`</span> dataset. Note that this dataset is filtered to only contain data from California.</span>
<span id="cb60-45"><a href="#cb60-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-48"><a href="#cb60-48" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb60-49"><a href="#cb60-49" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: true</span></span>
<span id="cb60-50"><a href="#cb60-50" aria-hidden="true" tabindex="-1"></a><span class="co"># This code pulls census data and loads it into a DataFrame</span></span>
<span id="cb60-51"><a href="#cb60-51" aria-hidden="true" tabindex="-1"></a><span class="co"># We won't cover it explicitly in this class, but you are welcome to explore it on your own</span></span>
<span id="cb60-52"><a href="#cb60-52" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb60-53"><a href="#cb60-53" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb60-54"><a href="#cb60-54" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> urllib.request</span>
<span id="cb60-55"><a href="#cb60-55" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> os.path</span>
<span id="cb60-56"><a href="#cb60-56" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> zipfile</span>
<span id="cb60-57"><a href="#cb60-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-58"><a href="#cb60-58" aria-hidden="true" tabindex="-1"></a>data_url <span class="op">=</span> <span class="st">"https://www.ssa.gov/oact/babynames/state/namesbystate.zip"</span></span>
<span id="cb60-59"><a href="#cb60-59" aria-hidden="true" tabindex="-1"></a>local_filename <span class="op">=</span> <span class="st">"data/babynamesbystate.zip"</span></span>
<span id="cb60-60"><a href="#cb60-60" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="kw">not</span> os.path.exists(local_filename): <span class="co"># If the data exists don't download again</span></span>
<span id="cb60-61"><a href="#cb60-61" aria-hidden="true" tabindex="-1"></a>    <span class="cf">with</span> urllib.request.urlopen(data_url) <span class="im">as</span> resp, <span class="bu">open</span>(local_filename, <span class="st">'wb'</span>) <span class="im">as</span> f:</span>
<span id="cb60-62"><a href="#cb60-62" aria-hidden="true" tabindex="-1"></a>        f.write(resp.read())</span>
<span id="cb60-63"><a href="#cb60-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-64"><a href="#cb60-64" aria-hidden="true" tabindex="-1"></a>zf <span class="op">=</span> zipfile.ZipFile(local_filename, <span class="st">'r'</span>)</span>
<span id="cb60-65"><a href="#cb60-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-66"><a href="#cb60-66" aria-hidden="true" tabindex="-1"></a>ca_name <span class="op">=</span> <span class="st">'STATE.CA.TXT'</span></span>
<span id="cb60-67"><a href="#cb60-67" aria-hidden="true" tabindex="-1"></a>field_names <span class="op">=</span> [<span class="st">'State'</span>, <span class="st">'Sex'</span>, <span class="st">'Year'</span>, <span class="st">'Name'</span>, <span class="st">'Count'</span>]</span>
<span id="cb60-68"><a href="#cb60-68" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> zf.<span class="bu">open</span>(ca_name) <span class="im">as</span> fh:</span>
<span id="cb60-69"><a href="#cb60-69" aria-hidden="true" tabindex="-1"></a>    babynames <span class="op">=</span> pd.read_csv(fh, header<span class="op">=</span><span class="va">None</span>, names<span class="op">=</span>field_names)</span>
<span id="cb60-70"><a href="#cb60-70" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-71"><a href="#cb60-71" aria-hidden="true" tabindex="-1"></a>babynames.tail(<span class="dv">10</span>)</span>
<span id="cb60-72"><a href="#cb60-72" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb60-73"><a href="#cb60-73" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-74"><a href="#cb60-74" aria-hidden="true" tabindex="-1"></a><span class="fu">### Approach 1: Create a Temporary Column</span></span>
<span id="cb60-75"><a href="#cb60-75" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-76"><a href="#cb60-76" aria-hidden="true" tabindex="-1"></a>One method to do this is to first start by creating a column that contains the lengths of the names.</span>
<span id="cb60-77"><a href="#cb60-77" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-80"><a href="#cb60-80" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb60-81"><a href="#cb60-81" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a Series of the length of each name</span></span>
<span id="cb60-82"><a href="#cb60-82" aria-hidden="true" tabindex="-1"></a>babyname_lengths <span class="op">=</span> babynames[<span class="st">"Name"</span>].<span class="bu">str</span>.<span class="bu">len</span>()</span>
<span id="cb60-83"><a href="#cb60-83" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-84"><a href="#cb60-84" aria-hidden="true" tabindex="-1"></a><span class="co"># Add a column named "name_lengths" that includes the length of each name</span></span>
<span id="cb60-85"><a href="#cb60-85" aria-hidden="true" tabindex="-1"></a>babynames[<span class="st">"name_lengths"</span>] <span class="op">=</span> babyname_lengths</span>
<span id="cb60-86"><a href="#cb60-86" aria-hidden="true" tabindex="-1"></a>babynames.head(<span class="dv">5</span>)</span>
<span id="cb60-87"><a href="#cb60-87" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb60-88"><a href="#cb60-88" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-89"><a href="#cb60-89" aria-hidden="true" tabindex="-1"></a>We can then sort the <span class="in">`DataFrame`</span> by that column using <span class="in">`.sort_values()`</span>:</span>
<span id="cb60-90"><a href="#cb60-90" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-93"><a href="#cb60-93" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb60-94"><a href="#cb60-94" aria-hidden="true" tabindex="-1"></a><span class="co"># Sort by the temporary column</span></span>
<span id="cb60-95"><a href="#cb60-95" aria-hidden="true" tabindex="-1"></a>babynames <span class="op">=</span> babynames.sort_values(by<span class="op">=</span><span class="st">"name_lengths"</span>, ascending<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb60-96"><a href="#cb60-96" aria-hidden="true" tabindex="-1"></a>babynames.head(<span class="dv">5</span>)</span>
<span id="cb60-97"><a href="#cb60-97" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb60-98"><a href="#cb60-98" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-99"><a href="#cb60-99" aria-hidden="true" tabindex="-1"></a>Finally, we can drop the <span class="in">`name_length`</span> column from <span class="in">`babynames`</span> to prevent our table from getting cluttered.</span>
<span id="cb60-100"><a href="#cb60-100" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-103"><a href="#cb60-103" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb60-104"><a href="#cb60-104" aria-hidden="true" tabindex="-1"></a><span class="co"># Drop the 'name_length' column</span></span>
<span id="cb60-105"><a href="#cb60-105" aria-hidden="true" tabindex="-1"></a>babynames <span class="op">=</span> babynames.drop(<span class="st">"name_lengths"</span>, axis<span class="op">=</span><span class="st">'columns'</span>)</span>
<span id="cb60-106"><a href="#cb60-106" aria-hidden="true" tabindex="-1"></a>babynames.head(<span class="dv">5</span>)</span>
<span id="cb60-107"><a href="#cb60-107" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb60-108"><a href="#cb60-108" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-109"><a href="#cb60-109" aria-hidden="true" tabindex="-1"></a><span class="fu">### Approach 2: Sorting using the `key` Argument</span></span>
<span id="cb60-110"><a href="#cb60-110" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-111"><a href="#cb60-111" aria-hidden="true" tabindex="-1"></a>Another way to approach this is to use the <span class="in">`key`</span> argument of <span class="in">`.sort_values()`</span>. Here we can specify that we want to sort <span class="in">`"Name"`</span> values by their length.</span>
<span id="cb60-112"><a href="#cb60-112" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-115"><a href="#cb60-115" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb60-116"><a href="#cb60-116" aria-hidden="true" tabindex="-1"></a>babynames.sort_values(<span class="st">"Name"</span>, key<span class="op">=</span><span class="kw">lambda</span> x: x.<span class="bu">str</span>.<span class="bu">len</span>(), ascending<span class="op">=</span><span class="va">False</span>).head()</span>
<span id="cb60-117"><a href="#cb60-117" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb60-118"><a href="#cb60-118" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-119"><a href="#cb60-119" aria-hidden="true" tabindex="-1"></a><span class="fu">### Approach 3: Sorting using the `map` Function</span></span>
<span id="cb60-120"><a href="#cb60-120" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-121"><a href="#cb60-121" aria-hidden="true" tabindex="-1"></a>We can also use the <span class="in">`map`</span> function on a <span class="in">`Series`</span> to solve this. Say we want to sort the <span class="in">`babynames`</span> table by the number of <span class="in">`"dr"`</span>'s and <span class="in">`"ea"`</span>'s in each <span class="in">`"Name"`</span>. We'll define the function <span class="in">`dr_ea_count`</span> to help us out.</span>
<span id="cb60-122"><a href="#cb60-122" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-125"><a href="#cb60-125" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb60-126"><a href="#cb60-126" aria-hidden="true" tabindex="-1"></a><span class="co"># First, define a function to count the number of times "dr" or "ea" appear in each name</span></span>
<span id="cb60-127"><a href="#cb60-127" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> dr_ea_count(string):</span>
<span id="cb60-128"><a href="#cb60-128" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> string.count(<span class="st">'dr'</span>) <span class="op">+</span> string.count(<span class="st">'ea'</span>)</span>
<span id="cb60-129"><a href="#cb60-129" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-130"><a href="#cb60-130" aria-hidden="true" tabindex="-1"></a><span class="co"># Then, use `map` to apply `dr_ea_count` to each name in the "Name" column</span></span>
<span id="cb60-131"><a href="#cb60-131" aria-hidden="true" tabindex="-1"></a>babynames[<span class="st">"dr_ea_count"</span>] <span class="op">=</span> babynames[<span class="st">"Name"</span>].<span class="bu">map</span>(dr_ea_count)</span>
<span id="cb60-132"><a href="#cb60-132" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-133"><a href="#cb60-133" aria-hidden="true" tabindex="-1"></a><span class="co"># Sort the DataFrame by the new "dr_ea_count" column so we can see our handiwork</span></span>
<span id="cb60-134"><a href="#cb60-134" aria-hidden="true" tabindex="-1"></a>babynames <span class="op">=</span> babynames.sort_values(by<span class="op">=</span><span class="st">"dr_ea_count"</span>, ascending<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb60-135"><a href="#cb60-135" aria-hidden="true" tabindex="-1"></a>babynames.head()</span>
<span id="cb60-136"><a href="#cb60-136" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb60-137"><a href="#cb60-137" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-138"><a href="#cb60-138" aria-hidden="true" tabindex="-1"></a>We can drop the <span class="in">`dr_ea_count`</span> once we're done using it to maintain a neat table.</span>
<span id="cb60-139"><a href="#cb60-139" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-142"><a href="#cb60-142" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb60-143"><a href="#cb60-143" aria-hidden="true" tabindex="-1"></a><span class="co"># Drop the `dr_ea_count` column</span></span>
<span id="cb60-144"><a href="#cb60-144" aria-hidden="true" tabindex="-1"></a>babynames <span class="op">=</span> babynames.drop(<span class="st">"dr_ea_count"</span>, axis <span class="op">=</span> <span class="st">'columns'</span>)</span>
<span id="cb60-145"><a href="#cb60-145" aria-hidden="true" tabindex="-1"></a>babynames.head(<span class="dv">5</span>)</span>
<span id="cb60-146"><a href="#cb60-146" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb60-147"><a href="#cb60-147" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-148"><a href="#cb60-148" aria-hidden="true" tabindex="-1"></a><span class="fu">## Aggregating Data with `.groupby`</span></span>
<span id="cb60-149"><a href="#cb60-149" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-150"><a href="#cb60-150" aria-hidden="true" tabindex="-1"></a>Up until this point, we have been working with individual rows of <span class="in">`DataFrame`</span>s. As data scientists, we often wish to investigate trends across a larger *subset* of our data. For example, we may want to compute some summary statistic (the mean, median, sum, etc.) for a group of rows in our <span class="in">`DataFrame`</span>. To do this, we'll use <span class="in">`pandas`</span> <span class="in">`GroupBy`</span> objects. Our goal is to group together rows that fall under the same category and perform an operation that aggregates across all rows in the category. </span>
<span id="cb60-151"><a href="#cb60-151" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-152"><a href="#cb60-152" aria-hidden="true" tabindex="-1"></a>Let's say we wanted to aggregate all rows in <span class="in">`babynames`</span> for a given year. </span>
<span id="cb60-153"><a href="#cb60-153" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-156"><a href="#cb60-156" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb60-157"><a href="#cb60-157" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: false</span></span>
<span id="cb60-158"><a href="#cb60-158" aria-hidden="true" tabindex="-1"></a>babynames.groupby(<span class="st">"Year"</span>)</span>
<span id="cb60-159"><a href="#cb60-159" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb60-160"><a href="#cb60-160" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-161"><a href="#cb60-161" aria-hidden="true" tabindex="-1"></a>What does this strange output mean? Calling <span class="in">`.groupby`</span> <span class="co">[</span><span class="ot">(documentation)</span><span class="co">](https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.groupby.html)</span> has generated a <span class="in">`GroupBy`</span> object. You can imagine this as a set of "mini" sub-<span class="in">`DataFrame`</span>s, where each subframe contains all of the rows from <span class="in">`babynames`</span> that correspond to a particular year. </span>
<span id="cb60-162"><a href="#cb60-162" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-163"><a href="#cb60-163" aria-hidden="true" tabindex="-1"></a>The diagram below shows a simplified view of <span class="in">`babynames`</span> to help illustrate this idea.</span>
<span id="cb60-164"><a href="#cb60-164" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-165"><a href="#cb60-165" aria-hidden="true" tabindex="-1"></a>&lt;center&gt;&lt;img src = "images/gb.png" width = "600"&gt;&lt;/img&gt;&lt;/a&gt;&lt;/center&gt;</span>
<span id="cb60-166"><a href="#cb60-166" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-167"><a href="#cb60-167" aria-hidden="true" tabindex="-1"></a>We can't work with a <span class="in">`GroupBy`</span> object directly – that is why you saw that strange output earlier rather than a standard view of a <span class="in">`DataFrame`</span>. To actually manipulate values within these "mini" <span class="in">`DataFrame`</span>s, we'll need to call an *aggregation method*. This is a method that tells <span class="in">`pandas`</span> how to aggregate the values within the <span class="in">`GroupBy`</span> object. Once the aggregation is applied, <span class="in">`pandas`</span> will return a normal (now grouped) <span class="in">`DataFrame`</span>.</span>
<span id="cb60-168"><a href="#cb60-168" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-169"><a href="#cb60-169" aria-hidden="true" tabindex="-1"></a>The first aggregation method we'll consider is <span class="in">`.agg`</span>. The <span class="in">`.agg`</span> method takes in a function as its argument; this function is then applied to each column of a "mini" grouped DataFrame. We end up with a new <span class="in">`DataFrame`</span> with one aggregated row per subframe. Let's see this in action by finding the <span class="in">`sum`</span> of all counts for each year in <span class="in">`babynames`</span> – this is equivalent to finding the number of babies born in each year. </span>
<span id="cb60-170"><a href="#cb60-170" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-173"><a href="#cb60-173" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb60-174"><a href="#cb60-174" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: false</span></span>
<span id="cb60-175"><a href="#cb60-175" aria-hidden="true" tabindex="-1"></a>babynames[[<span class="st">"Year"</span>, <span class="st">"Count"</span>]].groupby(<span class="st">"Year"</span>).agg(<span class="st">"sum"</span>).head(<span class="dv">5</span>)</span>
<span id="cb60-176"><a href="#cb60-176" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb60-177"><a href="#cb60-177" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-178"><a href="#cb60-178" aria-hidden="true" tabindex="-1"></a>We can relate this back to the diagram we used above. Remember that the diagram uses a simplified version of <span class="in">`babynames`</span>, which is why we see smaller values for the summed counts.</span>
<span id="cb60-179"><a href="#cb60-179" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-180"><a href="#cb60-180" aria-hidden="true" tabindex="-1"></a><span class="al">![Performing an aggregation](images/agg.png)</span></span>
<span id="cb60-181"><a href="#cb60-181" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-182"><a href="#cb60-182" aria-hidden="true" tabindex="-1"></a>Calling <span class="in">`.agg`</span> has condensed each subframe back into a single row. This gives us our final output: a <span class="in">`DataFrame`</span> that is now indexed by <span class="in">`"Year"`</span>, with a single row for each unique year in the original <span class="in">`babynames`</span> DataFrame.</span>
<span id="cb60-183"><a href="#cb60-183" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-184"><a href="#cb60-184" aria-hidden="true" tabindex="-1"></a>There are many different aggregation functions we can use, all of which are useful in different applications.</span>
<span id="cb60-185"><a href="#cb60-185" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-188"><a href="#cb60-188" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb60-189"><a href="#cb60-189" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: false</span></span>
<span id="cb60-190"><a href="#cb60-190" aria-hidden="true" tabindex="-1"></a>babynames[[<span class="st">"Year"</span>, <span class="st">"Count"</span>]].groupby(<span class="st">"Year"</span>).agg(<span class="st">"min"</span>).head(<span class="dv">5</span>)</span>
<span id="cb60-191"><a href="#cb60-191" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb60-192"><a href="#cb60-192" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-195"><a href="#cb60-195" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb60-196"><a href="#cb60-196" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: false</span></span>
<span id="cb60-197"><a href="#cb60-197" aria-hidden="true" tabindex="-1"></a>babynames[[<span class="st">"Year"</span>, <span class="st">"Count"</span>]].groupby(<span class="st">"Year"</span>).agg(<span class="st">"max"</span>).head(<span class="dv">5</span>)</span>
<span id="cb60-198"><a href="#cb60-198" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb60-199"><a href="#cb60-199" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-202"><a href="#cb60-202" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb60-203"><a href="#cb60-203" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: false</span></span>
<span id="cb60-204"><a href="#cb60-204" aria-hidden="true" tabindex="-1"></a><span class="co"># Same result, but now we explicitly tell pandas to only consider the "Count" column when summing</span></span>
<span id="cb60-205"><a href="#cb60-205" aria-hidden="true" tabindex="-1"></a>babynames.groupby(<span class="st">"Year"</span>)[[<span class="st">"Count"</span>]].agg(<span class="st">"sum"</span>).head(<span class="dv">5</span>)</span>
<span id="cb60-206"><a href="#cb60-206" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb60-207"><a href="#cb60-207" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-208"><a href="#cb60-208" aria-hidden="true" tabindex="-1"></a>There are many different aggregations that can be applied to the grouped data. The primary requirement is that an aggregation function must:</span>
<span id="cb60-209"><a href="#cb60-209" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-210"><a href="#cb60-210" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>Take in a <span class="in">`Series`</span> of data (a single column of the grouped subframe).</span>
<span id="cb60-211"><a href="#cb60-211" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>Return a single value that aggregates this <span class="in">`Series`</span>.</span>
<span id="cb60-212"><a href="#cb60-212" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-213"><a href="#cb60-213" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-214"><a href="#cb60-214" aria-hidden="true" tabindex="-1"></a><span class="fu">### Aggregation Functions</span></span>
<span id="cb60-215"><a href="#cb60-215" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-216"><a href="#cb60-216" aria-hidden="true" tabindex="-1"></a>Because of this fairly broad requirement, <span class="in">`pandas`</span> offers many ways of computing an aggregation.</span>
<span id="cb60-217"><a href="#cb60-217" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-218"><a href="#cb60-218" aria-hidden="true" tabindex="-1"></a>**In-built** Python operations – such as <span class="in">`sum`</span>, <span class="in">`max`</span>, and <span class="in">`min`</span> – are automatically recognized by <span class="in">`pandas`</span>.</span>
<span id="cb60-219"><a href="#cb60-219" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-222"><a href="#cb60-222" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb60-223"><a href="#cb60-223" aria-hidden="true" tabindex="-1"></a><span class="co"># What is the minimum count for each name in any year?</span></span>
<span id="cb60-224"><a href="#cb60-224" aria-hidden="true" tabindex="-1"></a>babynames.groupby(<span class="st">"Name"</span>)[[<span class="st">"Count"</span>]].agg(<span class="st">"min"</span>).head()</span>
<span id="cb60-225"><a href="#cb60-225" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb60-226"><a href="#cb60-226" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-229"><a href="#cb60-229" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb60-230"><a href="#cb60-230" aria-hidden="true" tabindex="-1"></a><span class="co"># What is the largest single-year count of each name?</span></span>
<span id="cb60-231"><a href="#cb60-231" aria-hidden="true" tabindex="-1"></a>babynames.groupby(<span class="st">"Name"</span>)[[<span class="st">"Count"</span>]].agg(<span class="st">"max"</span>).head()</span>
<span id="cb60-232"><a href="#cb60-232" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb60-233"><a href="#cb60-233" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-234"><a href="#cb60-234" aria-hidden="true" tabindex="-1"></a>As mentioned previously, functions from the <span class="in">`NumPy`</span> library, such as <span class="in">`np.mean`</span>, <span class="in">`np.max`</span>, <span class="in">`np.min`</span>, and <span class="in">`np.sum`</span>, are also fair game in <span class="in">`pandas`</span>.</span>
<span id="cb60-235"><a href="#cb60-235" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-238"><a href="#cb60-238" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb60-239"><a href="#cb60-239" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: false</span></span>
<span id="cb60-240"><a href="#cb60-240" aria-hidden="true" tabindex="-1"></a><span class="co"># What is the average count for each name across all years?</span></span>
<span id="cb60-241"><a href="#cb60-241" aria-hidden="true" tabindex="-1"></a>babynames.groupby(<span class="st">"Name"</span>)[[<span class="st">"Count"</span>]].agg(<span class="st">"mean"</span>).head()</span>
<span id="cb60-242"><a href="#cb60-242" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb60-243"><a href="#cb60-243" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-244"><a href="#cb60-244" aria-hidden="true" tabindex="-1"></a><span class="in">`pandas`</span> also offers a number of in-built functions. Functions that are native to <span class="in">`pandas`</span> can be referenced using their string name within a call to <span class="in">`.agg`</span>. Some examples include:</span>
<span id="cb60-245"><a href="#cb60-245" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-246"><a href="#cb60-246" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span><span class="in">`.agg("sum")`</span></span>
<span id="cb60-247"><a href="#cb60-247" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span><span class="in">`.agg("max")`</span></span>
<span id="cb60-248"><a href="#cb60-248" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span><span class="in">`.agg("min")`</span></span>
<span id="cb60-249"><a href="#cb60-249" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span><span class="in">`.agg("mean")`</span></span>
<span id="cb60-250"><a href="#cb60-250" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span><span class="in">`.agg("first")`</span></span>
<span id="cb60-251"><a href="#cb60-251" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span><span class="in">`.agg("last")`</span></span>
<span id="cb60-252"><a href="#cb60-252" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-253"><a href="#cb60-253" aria-hidden="true" tabindex="-1"></a>The latter two entries in this list – <span class="in">`"first"`</span> and <span class="in">`"last"`</span> – are unique to <span class="in">`pandas`</span>. They return the first or last entry in a subframe column. Why might this be useful? Consider a case where *multiple* columns in a group share identical information. To represent this information in the grouped output, we can simply grab the first or last entry, which we know will be identical to all other entries.</span>
<span id="cb60-254"><a href="#cb60-254" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-255"><a href="#cb60-255" aria-hidden="true" tabindex="-1"></a>Let's illustrate this with an example. Say we add a new column to <span class="in">`babynames`</span> that contains the first letter of each name. </span>
<span id="cb60-256"><a href="#cb60-256" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-259"><a href="#cb60-259" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb60-260"><a href="#cb60-260" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: false</span></span>
<span id="cb60-261"><a href="#cb60-261" aria-hidden="true" tabindex="-1"></a><span class="co"># Imagine we had an additional column, "First Letter". We'll explain this code next week</span></span>
<span id="cb60-262"><a href="#cb60-262" aria-hidden="true" tabindex="-1"></a>babynames[<span class="st">"First Letter"</span>] <span class="op">=</span> babynames[<span class="st">"Name"</span>].<span class="bu">str</span>[<span class="dv">0</span>]</span>
<span id="cb60-263"><a href="#cb60-263" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-264"><a href="#cb60-264" aria-hidden="true" tabindex="-1"></a><span class="co"># We construct a simplified DataFrame containing just a subset of columns</span></span>
<span id="cb60-265"><a href="#cb60-265" aria-hidden="true" tabindex="-1"></a>babynames_new <span class="op">=</span> babynames[[<span class="st">"Name"</span>, <span class="st">"First Letter"</span>, <span class="st">"Year"</span>]]</span>
<span id="cb60-266"><a href="#cb60-266" aria-hidden="true" tabindex="-1"></a>babynames_new.head()</span>
<span id="cb60-267"><a href="#cb60-267" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb60-268"><a href="#cb60-268" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-269"><a href="#cb60-269" aria-hidden="true" tabindex="-1"></a>If we form groups for each name in the dataset, <span class="in">`"First Letter"`</span> will be the same for all members of the group. This means that if we simply select the first entry for <span class="in">`"First Letter"`</span> in the group, we'll represent all data in that group. </span>
<span id="cb60-270"><a href="#cb60-270" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-271"><a href="#cb60-271" aria-hidden="true" tabindex="-1"></a>We can use a dictionary to apply different aggregation functions to each column during grouping.</span>
<span id="cb60-272"><a href="#cb60-272" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-273"><a href="#cb60-273" aria-hidden="true" tabindex="-1"></a><span class="al">![Aggregating using "first"](images/first.png)</span></span>
<span id="cb60-274"><a href="#cb60-274" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-277"><a href="#cb60-277" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb60-278"><a href="#cb60-278" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: false</span></span>
<span id="cb60-279"><a href="#cb60-279" aria-hidden="true" tabindex="-1"></a>babynames_new.groupby(<span class="st">"Name"</span>).agg({<span class="st">"First Letter"</span>:<span class="st">"first"</span>, <span class="st">"Year"</span>:<span class="st">"max"</span>}).head()</span>
<span id="cb60-280"><a href="#cb60-280" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb60-281"><a href="#cb60-281" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-282"><a href="#cb60-282" aria-hidden="true" tabindex="-1"></a><span class="fu">### Plotting Birth Counts</span></span>
<span id="cb60-283"><a href="#cb60-283" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-284"><a href="#cb60-284" aria-hidden="true" tabindex="-1"></a>Let's use <span class="in">`.agg`</span> to find the total number of babies born in each year. Recall that using <span class="in">`.agg`</span> with <span class="in">`.groupby()`</span> follows the format: <span class="in">`df.groupby(column_name).agg(aggregation_function)`</span>. The line of code below gives us the total number of babies born in each year.</span>
<span id="cb60-285"><a href="#cb60-285" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-288"><a href="#cb60-288" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb60-289"><a href="#cb60-289" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: true</span></span>
<span id="cb60-290"><a href="#cb60-290" aria-hidden="true" tabindex="-1"></a>babynames.groupby(<span class="st">"Year"</span>)[[<span class="st">"Count"</span>]].agg(<span class="bu">sum</span>).head(<span class="dv">5</span>)</span>
<span id="cb60-291"><a href="#cb60-291" aria-hidden="true" tabindex="-1"></a><span class="co"># Alternative 1</span></span>
<span id="cb60-292"><a href="#cb60-292" aria-hidden="true" tabindex="-1"></a><span class="co"># babynames.groupby("Year")[["Count"]].sum()</span></span>
<span id="cb60-293"><a href="#cb60-293" aria-hidden="true" tabindex="-1"></a><span class="co"># Alternative 2</span></span>
<span id="cb60-294"><a href="#cb60-294" aria-hidden="true" tabindex="-1"></a><span class="co"># babynames.groupby("Year").sum(numeric_only=True)</span></span>
<span id="cb60-295"><a href="#cb60-295" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb60-296"><a href="#cb60-296" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-297"><a href="#cb60-297" aria-hidden="true" tabindex="-1"></a>Here's an illustration of the process: </span>
<span id="cb60-298"><a href="#cb60-298" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-299"><a href="#cb60-299" aria-hidden="true" tabindex="-1"></a>&lt;img src="images/aggregation.png" alt='aggregation' width='600'&gt;</span>
<span id="cb60-300"><a href="#cb60-300" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-301"><a href="#cb60-301" aria-hidden="true" tabindex="-1"></a>Plotting the <span class="in">`Dataframe`</span> we obtain tells an interesting story.</span>
<span id="cb60-302"><a href="#cb60-302" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-305"><a href="#cb60-305" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb60-306"><a href="#cb60-306" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: true</span></span>
<span id="cb60-307"><a href="#cb60-307" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> plotly.express <span class="im">as</span> px</span>
<span id="cb60-308"><a href="#cb60-308" aria-hidden="true" tabindex="-1"></a>puzzle2 <span class="op">=</span> babynames.groupby(<span class="st">"Year"</span>)[[<span class="st">"Count"</span>]].agg(<span class="st">"sum"</span>)</span>
<span id="cb60-309"><a href="#cb60-309" aria-hidden="true" tabindex="-1"></a>px.line(puzzle2, y <span class="op">=</span> <span class="st">"Count"</span>)</span>
<span id="cb60-310"><a href="#cb60-310" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb60-311"><a href="#cb60-311" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-312"><a href="#cb60-312" aria-hidden="true" tabindex="-1"></a>**A word of warning**: we made an enormous assumption when we decided to use this dataset to estimate birth rate. According to <span class="co">[</span><span class="ot">this article from the Legistlative Analyst Office</span><span class="co">](https://lao.ca.gov/LAOEconTax/Article/Detail/691)</span>, the true number of babies born in California in 2020 was 421,275. However, our plot shows 362,882 babies —— what happened? </span>
<span id="cb60-313"><a href="#cb60-313" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-314"><a href="#cb60-314" aria-hidden="true" tabindex="-1"></a><span class="fu">### Summary of the `.groupby()` Function</span></span>
<span id="cb60-315"><a href="#cb60-315" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-316"><a href="#cb60-316" aria-hidden="true" tabindex="-1"></a>A <span class="in">`groupby`</span> operation involves some combination of **splitting a `DataFrame` into grouped subframes**, **applying a function**, and **combining the results**. </span>
<span id="cb60-317"><a href="#cb60-317" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-318"><a href="#cb60-318" aria-hidden="true" tabindex="-1"></a>For some arbitrary <span class="in">`DataFrame`</span> <span class="in">`df`</span> below, the code <span class="in">`df.groupby("year").agg(sum)`</span> does the following:</span>
<span id="cb60-319"><a href="#cb60-319" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-320"><a href="#cb60-320" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Splits** the <span class="in">`DataFrame`</span> into sub-<span class="in">`DataFrame`</span>s with rows belonging to the same year.</span>
<span id="cb60-321"><a href="#cb60-321" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Applies** the <span class="in">`sum`</span> function to each column of each sub-<span class="in">`DataFrame`</span>.</span>
<span id="cb60-322"><a href="#cb60-322" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Combines** the results of <span class="in">`sum`</span> into a single <span class="in">`DataFrame`</span>, indexed by <span class="in">`year`</span>.</span>
<span id="cb60-323"><a href="#cb60-323" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-324"><a href="#cb60-324" aria-hidden="true" tabindex="-1"></a>&lt;img src="images/groupby_demo.png" alt='groupby_demo' width='600'&gt;</span>
<span id="cb60-325"><a href="#cb60-325" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-326"><a href="#cb60-326" aria-hidden="true" tabindex="-1"></a><span class="fu">### Revisiting the `.agg()` Function</span></span>
<span id="cb60-327"><a href="#cb60-327" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-328"><a href="#cb60-328" aria-hidden="true" tabindex="-1"></a><span class="in">`.agg()`</span> can take in any function that aggregates several values into one summary value. Some commonly-used aggregation functions can even be called directly, without explicit use of <span class="in">`.agg()`</span>. For example, we can call <span class="in">`.mean()`</span> on <span class="in">`.groupby()`</span>: </span>
<span id="cb60-329"><a href="#cb60-329" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb60-330"><a href="#cb60-330" aria-hidden="true" tabindex="-1"></a><span class="in">    babynames.groupby("Year").mean().head()</span></span>
<span id="cb60-331"><a href="#cb60-331" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-332"><a href="#cb60-332" aria-hidden="true" tabindex="-1"></a>We can now put this all into practice. Say we want to find the baby name with sex "F" that has fallen in popularity the most in California. To calculate this, we can first create a metric: "Ratio to Peak" (RTP). The RTP is the ratio of babies born with a given name in 2022 to the *maximum* number of babies born with the name in *any* year. </span>
<span id="cb60-333"><a href="#cb60-333" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-334"><a href="#cb60-334" aria-hidden="true" tabindex="-1"></a>Let's start with calculating this for one baby, "Jennifer".</span>
<span id="cb60-335"><a href="#cb60-335" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-338"><a href="#cb60-338" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb60-339"><a href="#cb60-339" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: false</span></span>
<span id="cb60-340"><a href="#cb60-340" aria-hidden="true" tabindex="-1"></a><span class="co"># We filter by babies with sex "F" and sort by "Year"</span></span>
<span id="cb60-341"><a href="#cb60-341" aria-hidden="true" tabindex="-1"></a>f_babynames <span class="op">=</span> babynames[babynames[<span class="st">"Sex"</span>] <span class="op">==</span> <span class="st">"F"</span>]</span>
<span id="cb60-342"><a href="#cb60-342" aria-hidden="true" tabindex="-1"></a>f_babynames <span class="op">=</span> f_babynames.sort_values([<span class="st">"Year"</span>])</span>
<span id="cb60-343"><a href="#cb60-343" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-344"><a href="#cb60-344" aria-hidden="true" tabindex="-1"></a><span class="co"># Determine how many Jennifers were born in CA per year</span></span>
<span id="cb60-345"><a href="#cb60-345" aria-hidden="true" tabindex="-1"></a>jenn_counts_series <span class="op">=</span> f_babynames[f_babynames[<span class="st">"Name"</span>] <span class="op">==</span> <span class="st">"Jennifer"</span>][<span class="st">"Count"</span>]</span>
<span id="cb60-346"><a href="#cb60-346" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-347"><a href="#cb60-347" aria-hidden="true" tabindex="-1"></a><span class="co"># Determine the max number of Jennifers born in a year and the number born in 2022 </span></span>
<span id="cb60-348"><a href="#cb60-348" aria-hidden="true" tabindex="-1"></a><span class="co"># to calculate RTP</span></span>
<span id="cb60-349"><a href="#cb60-349" aria-hidden="true" tabindex="-1"></a>max_jenn <span class="op">=</span> <span class="bu">max</span>(f_babynames[f_babynames[<span class="st">"Name"</span>] <span class="op">==</span> <span class="st">"Jennifer"</span>][<span class="st">"Count"</span>])</span>
<span id="cb60-350"><a href="#cb60-350" aria-hidden="true" tabindex="-1"></a>curr_jenn <span class="op">=</span> f_babynames[f_babynames[<span class="st">"Name"</span>] <span class="op">==</span> <span class="st">"Jennifer"</span>][<span class="st">"Count"</span>].iloc[<span class="op">-</span><span class="dv">1</span>]</span>
<span id="cb60-351"><a href="#cb60-351" aria-hidden="true" tabindex="-1"></a>rtp <span class="op">=</span> curr_jenn <span class="op">/</span> max_jenn</span>
<span id="cb60-352"><a href="#cb60-352" aria-hidden="true" tabindex="-1"></a>rtp</span>
<span id="cb60-353"><a href="#cb60-353" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb60-354"><a href="#cb60-354" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-355"><a href="#cb60-355" aria-hidden="true" tabindex="-1"></a>By creating a function to calculate RTP and applying it to our <span class="in">`DataFrame`</span> by using <span class="in">`.groupby()`</span>, we can easily compute the RTP for all names at once! </span>
<span id="cb60-356"><a href="#cb60-356" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-359"><a href="#cb60-359" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb60-360"><a href="#cb60-360" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: false</span></span>
<span id="cb60-361"><a href="#cb60-361" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> ratio_to_peak(series):</span>
<span id="cb60-362"><a href="#cb60-362" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> series.iloc[<span class="op">-</span><span class="dv">1</span>] <span class="op">/</span> <span class="bu">max</span>(series)</span>
<span id="cb60-363"><a href="#cb60-363" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-364"><a href="#cb60-364" aria-hidden="true" tabindex="-1"></a><span class="co">#Using .groupby() to apply the function</span></span>
<span id="cb60-365"><a href="#cb60-365" aria-hidden="true" tabindex="-1"></a>rtp_table <span class="op">=</span> f_babynames.groupby(<span class="st">"Name"</span>)[[<span class="st">"Year"</span>, <span class="st">"Count"</span>]].agg(ratio_to_peak)</span>
<span id="cb60-366"><a href="#cb60-366" aria-hidden="true" tabindex="-1"></a>rtp_table.head()</span>
<span id="cb60-367"><a href="#cb60-367" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb60-368"><a href="#cb60-368" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-369"><a href="#cb60-369" aria-hidden="true" tabindex="-1"></a>In the rows shown above, we can see that every row shown has a <span class="in">`Year`</span> value of <span class="in">`1.0`</span>.</span>
<span id="cb60-370"><a href="#cb60-370" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-371"><a href="#cb60-371" aria-hidden="true" tabindex="-1"></a>This is the "**`pandas`**-ification" of logic you saw in Data 8. Much of the logic you've learned in Data 8 will serve you well in Data 100.</span>
<span id="cb60-372"><a href="#cb60-372" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-373"><a href="#cb60-373" aria-hidden="true" tabindex="-1"></a><span class="fu">### Nuisance Columns</span></span>
<span id="cb60-374"><a href="#cb60-374" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-375"><a href="#cb60-375" aria-hidden="true" tabindex="-1"></a>Note that you must be careful with which columns you apply the <span class="in">`.agg()`</span> function to. If we were to apply our function to the table as a whole by doing <span class="in">`f_babynames.groupby("Name").agg(ratio_to_peak)`</span>, executing our <span class="in">`.agg()`</span> call would result in a <span class="in">`TypeError`</span>.</span>
<span id="cb60-376"><a href="#cb60-376" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-377"><a href="#cb60-377" aria-hidden="true" tabindex="-1"></a>&lt;img src="images/error.png" alt='error' width='600'&gt;</span>
<span id="cb60-378"><a href="#cb60-378" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-379"><a href="#cb60-379" aria-hidden="true" tabindex="-1"></a>We can avoid this issue (and prevent unintentional loss of data) by explicitly selecting column(s) we want to apply our aggregation function to **BEFORE** calling <span class="in">`.agg()`</span>, </span>
<span id="cb60-380"><a href="#cb60-380" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-381"><a href="#cb60-381" aria-hidden="true" tabindex="-1"></a><span class="fu">### Renaming Columns After Grouping</span></span>
<span id="cb60-382"><a href="#cb60-382" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-383"><a href="#cb60-383" aria-hidden="true" tabindex="-1"></a>By default, <span class="in">`.groupby`</span> will not rename any aggregated columns. As we can see in the table above, the aggregated column is still named <span class="in">`Count`</span> even though it now represents the RTP. For better readability, we can rename <span class="in">`Count`</span> to <span class="in">`Count RTP`</span></span>
<span id="cb60-384"><a href="#cb60-384" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-387"><a href="#cb60-387" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb60-388"><a href="#cb60-388" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: false</span></span>
<span id="cb60-389"><a href="#cb60-389" aria-hidden="true" tabindex="-1"></a>rtp_table <span class="op">=</span> rtp_table.rename(columns <span class="op">=</span> {<span class="st">"Count"</span>: <span class="st">"Count RTP"</span>})</span>
<span id="cb60-390"><a href="#cb60-390" aria-hidden="true" tabindex="-1"></a>rtp_table</span>
<span id="cb60-391"><a href="#cb60-391" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb60-392"><a href="#cb60-392" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-393"><a href="#cb60-393" aria-hidden="true" tabindex="-1"></a><span class="fu">### Some Data Science Payoff</span></span>
<span id="cb60-394"><a href="#cb60-394" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-395"><a href="#cb60-395" aria-hidden="true" tabindex="-1"></a>By sorting <span class="in">`rtp_table`</span>, we can see the names whose popularity has decreased the most.</span>
<span id="cb60-396"><a href="#cb60-396" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-399"><a href="#cb60-399" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb60-400"><a href="#cb60-400" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: false</span></span>
<span id="cb60-401"><a href="#cb60-401" aria-hidden="true" tabindex="-1"></a>rtp_table <span class="op">=</span> rtp_table.rename(columns <span class="op">=</span> {<span class="st">"Count"</span>: <span class="st">"Count RTP"</span>})</span>
<span id="cb60-402"><a href="#cb60-402" aria-hidden="true" tabindex="-1"></a>rtp_table.sort_values(<span class="st">"Count RTP"</span>).head()</span>
<span id="cb60-403"><a href="#cb60-403" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb60-404"><a href="#cb60-404" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-405"><a href="#cb60-405" aria-hidden="true" tabindex="-1"></a>To visualize the above <span class="in">`DataFrame`</span>, let's look at the line plot below:</span>
<span id="cb60-406"><a href="#cb60-406" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-409"><a href="#cb60-409" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb60-410"><a href="#cb60-410" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: true</span></span>
<span id="cb60-411"><a href="#cb60-411" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> plotly.express <span class="im">as</span> px</span>
<span id="cb60-412"><a href="#cb60-412" aria-hidden="true" tabindex="-1"></a>px.line(f_babynames[f_babynames[<span class="st">"Name"</span>] <span class="op">==</span> <span class="st">"Debra"</span>], x <span class="op">=</span> <span class="st">"Year"</span>, y <span class="op">=</span> <span class="st">"Count"</span>)</span>
<span id="cb60-413"><a href="#cb60-413" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb60-414"><a href="#cb60-414" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-415"><a href="#cb60-415" aria-hidden="true" tabindex="-1"></a>We can get the list of the top 10 names and then plot popularity with the following code:</span>
<span id="cb60-416"><a href="#cb60-416" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-419"><a href="#cb60-419" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb60-420"><a href="#cb60-420" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: false</span></span>
<span id="cb60-421"><a href="#cb60-421" aria-hidden="true" tabindex="-1"></a>top10 <span class="op">=</span> rtp_table.sort_values(<span class="st">"Count RTP"</span>).head(<span class="dv">10</span>).index</span>
<span id="cb60-422"><a href="#cb60-422" aria-hidden="true" tabindex="-1"></a>px.line(</span>
<span id="cb60-423"><a href="#cb60-423" aria-hidden="true" tabindex="-1"></a>    f_babynames[f_babynames[<span class="st">"Name"</span>].isin(top10)], </span>
<span id="cb60-424"><a href="#cb60-424" aria-hidden="true" tabindex="-1"></a>    x <span class="op">=</span> <span class="st">"Year"</span>, </span>
<span id="cb60-425"><a href="#cb60-425" aria-hidden="true" tabindex="-1"></a>    y <span class="op">=</span> <span class="st">"Count"</span>, </span>
<span id="cb60-426"><a href="#cb60-426" aria-hidden="true" tabindex="-1"></a>    color <span class="op">=</span> <span class="st">"Name"</span></span>
<span id="cb60-427"><a href="#cb60-427" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb60-428"><a href="#cb60-428" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb60-429"><a href="#cb60-429" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-430"><a href="#cb60-430" aria-hidden="true" tabindex="-1"></a>As a quick exercise, consider what code would compute the total number of babies with each name. </span>
<span id="cb60-431"><a href="#cb60-431" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-434"><a href="#cb60-434" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb60-435"><a href="#cb60-435" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: true</span></span>
<span id="cb60-436"><a href="#cb60-436" aria-hidden="true" tabindex="-1"></a>babynames.groupby(<span class="st">"Name"</span>)[[<span class="st">"Count"</span>]].agg(<span class="st">"sum"</span>).head()</span>
<span id="cb60-437"><a href="#cb60-437" aria-hidden="true" tabindex="-1"></a><span class="co"># alternative solution: </span></span>
<span id="cb60-438"><a href="#cb60-438" aria-hidden="true" tabindex="-1"></a><span class="co"># babynames.groupby("Name")[["Count"]].sum()</span></span>
<span id="cb60-439"><a href="#cb60-439" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb60-440"><a href="#cb60-440" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-441"><a href="#cb60-441" aria-hidden="true" tabindex="-1"></a><span class="fu">## `.groupby()`, Continued</span></span>
<span id="cb60-442"><a href="#cb60-442" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-443"><a href="#cb60-443" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-444"><a href="#cb60-444" aria-hidden="true" tabindex="-1"></a>We'll work with the <span class="in">`elections`</span> <span class="in">`DataFrame`</span> again.</span>
<span id="cb60-445"><a href="#cb60-445" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-448"><a href="#cb60-448" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb60-449"><a href="#cb60-449" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: true</span></span>
<span id="cb60-450"><a href="#cb60-450" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-451"><a href="#cb60-451" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb60-452"><a href="#cb60-452" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb60-453"><a href="#cb60-453" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-454"><a href="#cb60-454" aria-hidden="true" tabindex="-1"></a>elections <span class="op">=</span> pd.read_csv(<span class="st">"data/elections.csv"</span>)</span>
<span id="cb60-455"><a href="#cb60-455" aria-hidden="true" tabindex="-1"></a>elections.head(<span class="dv">5</span>)</span>
<span id="cb60-456"><a href="#cb60-456" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb60-457"><a href="#cb60-457" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-458"><a href="#cb60-458" aria-hidden="true" tabindex="-1"></a><span class="fu">### Raw `GroupBy` Objects</span></span>
<span id="cb60-459"><a href="#cb60-459" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-460"><a href="#cb60-460" aria-hidden="true" tabindex="-1"></a>The result of <span class="in">`groupby`</span> applied to a <span class="in">`DataFrame`</span> is a <span class="in">`DataFrameGroupBy`</span> object, **not** a <span class="in">`DataFrame`</span>.</span>
<span id="cb60-461"><a href="#cb60-461" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-464"><a href="#cb60-464" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb60-465"><a href="#cb60-465" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: false</span></span>
<span id="cb60-466"><a href="#cb60-466" aria-hidden="true" tabindex="-1"></a>grouped_by_year <span class="op">=</span> elections.groupby(<span class="st">"Year"</span>)</span>
<span id="cb60-467"><a href="#cb60-467" aria-hidden="true" tabindex="-1"></a><span class="bu">type</span>(grouped_by_year)</span>
<span id="cb60-468"><a href="#cb60-468" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb60-469"><a href="#cb60-469" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-470"><a href="#cb60-470" aria-hidden="true" tabindex="-1"></a>There are several ways to look into <span class="in">`DataFrameGroupBy`</span> objects: </span>
<span id="cb60-471"><a href="#cb60-471" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-474"><a href="#cb60-474" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb60-475"><a href="#cb60-475" aria-hidden="true" tabindex="-1"></a>grouped_by_party <span class="op">=</span> elections.groupby(<span class="st">"Party"</span>)</span>
<span id="cb60-476"><a href="#cb60-476" aria-hidden="true" tabindex="-1"></a>grouped_by_party.groups</span>
<span id="cb60-477"><a href="#cb60-477" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb60-478"><a href="#cb60-478" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-481"><a href="#cb60-481" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb60-482"><a href="#cb60-482" aria-hidden="true" tabindex="-1"></a>grouped_by_party.get_group(<span class="st">"Socialist"</span>)</span>
<span id="cb60-483"><a href="#cb60-483" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb60-484"><a href="#cb60-484" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-485"><a href="#cb60-485" aria-hidden="true" tabindex="-1"></a><span class="fu">### Other `GroupBy` Methods</span></span>
<span id="cb60-486"><a href="#cb60-486" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-487"><a href="#cb60-487" aria-hidden="true" tabindex="-1"></a>There are many aggregation methods we can use with <span class="in">`.agg`</span>. Some useful options are:</span>
<span id="cb60-488"><a href="#cb60-488" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-489"><a href="#cb60-489" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span><span class="co">[</span><span class="ot">`.mean`</span><span class="co">](https://pandas.pydata.org/docs/reference/api/pandas.core.groupby.DataFrameGroupBy.mean.html#pandas.core.groupby.DataFrameGroupBy.mean)</span>: creates a new <span class="in">`DataFrame`</span> with the mean value of each group</span>
<span id="cb60-490"><a href="#cb60-490" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span><span class="co">[</span><span class="ot">`.sum`</span><span class="co">](https://pandas.pydata.org/docs/reference/api/pandas.core.groupby.DataFrameGroupBy.sum.html#pandas.core.groupby.DataFrameGroupBy.sum)</span>: creates a new <span class="in">`DataFrame`</span> with the sum of each group</span>
<span id="cb60-491"><a href="#cb60-491" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span><span class="co">[</span><span class="ot">`.max`</span><span class="co">](https://pandas.pydata.org/docs/reference/api/pandas.core.groupby.DataFrameGroupBy.max.html#pandas.core.groupby.DataFrameGroupBy.max)</span> and <span class="co">[</span><span class="ot">`.min`</span><span class="co">](https://pandas.pydata.org/docs/reference/api/pandas.core.groupby.DataFrameGroupBy.min.html#pandas.core.groupby.DataFrameGroupBy.min)</span>: creates a new <span class="in">`DataFrame`</span> with the maximum/minimum value of each group</span>
<span id="cb60-492"><a href="#cb60-492" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span><span class="co">[</span><span class="ot">`.first`</span><span class="co">](https://pandas.pydata.org/docs/reference/api/pandas.core.groupby.DataFrameGroupBy.first.html#pandas.core.groupby.DataFrameGroupBy.first)</span> and <span class="co">[</span><span class="ot">`.last`</span><span class="co">](https://pandas.pydata.org/docs/reference/api/pandas.core.groupby.DataFrameGroupBy.last.html#pandas.core.groupby.DataFrameGroupBy.last)</span>: creates a new <span class="in">`DataFrame`</span> with the first/last row in each group</span>
<span id="cb60-493"><a href="#cb60-493" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span><span class="co">[</span><span class="ot">`.size`</span><span class="co">](https://pandas.pydata.org/docs/reference/api/pandas.core.groupby.DataFrameGroupBy.size.html#pandas.core.groupby.DataFrameGroupBy.size)</span>: creates a new **`Series`** with the number of entries in each group</span>
<span id="cb60-494"><a href="#cb60-494" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span><span class="co">[</span><span class="ot">`.count`</span><span class="co">](https://pandas.pydata.org/docs/reference/api/pandas.core.groupby.DataFrameGroupBy.count.html#pandas.core.groupby.DataFrameGroupBy.count)</span>: creates a new **`DataFrame`** with the number of entries, excluding missing values. </span>
<span id="cb60-495"><a href="#cb60-495" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-496"><a href="#cb60-496" aria-hidden="true" tabindex="-1"></a>Let's illustrate some examples by creating a <span class="in">`DataFrame`</span> called <span class="in">`df`</span>. </span>
<span id="cb60-497"><a href="#cb60-497" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-500"><a href="#cb60-500" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb60-501"><a href="#cb60-501" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.DataFrame({<span class="st">'letter'</span>:[<span class="st">'A'</span>,<span class="st">'A'</span>,<span class="st">'B'</span>,<span class="st">'C'</span>,<span class="st">'C'</span>,<span class="st">'C'</span>], </span>
<span id="cb60-502"><a href="#cb60-502" aria-hidden="true" tabindex="-1"></a>                   <span class="st">'num'</span>:[<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>,np.nan,<span class="dv">4</span>], </span>
<span id="cb60-503"><a href="#cb60-503" aria-hidden="true" tabindex="-1"></a>                   <span class="st">'state'</span>:[np.nan, <span class="st">'tx'</span>, <span class="st">'fl'</span>, <span class="st">'hi'</span>, np.nan, <span class="st">'ak'</span>]})</span>
<span id="cb60-504"><a href="#cb60-504" aria-hidden="true" tabindex="-1"></a>df</span>
<span id="cb60-505"><a href="#cb60-505" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb60-506"><a href="#cb60-506" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-507"><a href="#cb60-507" aria-hidden="true" tabindex="-1"></a>Note the slight difference between <span class="in">`.size()`</span> and <span class="in">`.count()`</span>: while <span class="in">`.size()`</span> returns a <span class="in">`Series`</span> and counts the number of entries including the missing values, <span class="in">`.count()`</span> returns a <span class="in">`DataFrame`</span> and counts the number of entries in each column *excluding missing values*. </span>
<span id="cb60-508"><a href="#cb60-508" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-511"><a href="#cb60-511" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb60-512"><a href="#cb60-512" aria-hidden="true" tabindex="-1"></a>df.groupby(<span class="st">"letter"</span>).size()</span>
<span id="cb60-513"><a href="#cb60-513" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb60-514"><a href="#cb60-514" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-517"><a href="#cb60-517" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb60-518"><a href="#cb60-518" aria-hidden="true" tabindex="-1"></a>df.groupby(<span class="st">"letter"</span>).count()</span>
<span id="cb60-519"><a href="#cb60-519" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb60-520"><a href="#cb60-520" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-521"><a href="#cb60-521" aria-hidden="true" tabindex="-1"></a>You might recall that the <span class="in">`value_counts()`</span> function in the previous note does something similar. It turns out <span class="in">`value_counts()`</span> and <span class="in">`groupby.size()`</span> are the same, except <span class="in">`value_counts()`</span> sorts the resulting <span class="in">`Series`</span> in descending order automatically.</span>
<span id="cb60-522"><a href="#cb60-522" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-525"><a href="#cb60-525" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb60-526"><a href="#cb60-526" aria-hidden="true" tabindex="-1"></a>df[<span class="st">"letter"</span>].value_counts()</span>
<span id="cb60-527"><a href="#cb60-527" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb60-528"><a href="#cb60-528" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-529"><a href="#cb60-529" aria-hidden="true" tabindex="-1"></a>These (and other) aggregation functions are so common that <span class="in">`pandas`</span> allows for writing shorthand. Instead of explicitly stating the use of <span class="in">`.agg`</span>, we can call the function directly on the <span class="in">`GroupBy`</span> object.</span>
<span id="cb60-530"><a href="#cb60-530" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-531"><a href="#cb60-531" aria-hidden="true" tabindex="-1"></a>For example, the following are equivalent:</span>
<span id="cb60-532"><a href="#cb60-532" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-533"><a href="#cb60-533" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="in">`elections.groupby("Candidate").agg(mean)`</span> </span>
<span id="cb60-534"><a href="#cb60-534" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="in">`elections.groupby("Candidate").mean()`</span></span>
<span id="cb60-535"><a href="#cb60-535" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-536"><a href="#cb60-536" aria-hidden="true" tabindex="-1"></a>There are many other methods that <span class="in">`pandas`</span> supports. You can check them out on the <span class="co">[</span><span class="ot">`pandas` documentation</span><span class="co">](https://pandas.pydata.org/docs/reference/groupby.html)</span>.</span>
<span id="cb60-537"><a href="#cb60-537" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-538"><a href="#cb60-538" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-539"><a href="#cb60-539" aria-hidden="true" tabindex="-1"></a><span class="fu">### Filtering by Group</span></span>
<span id="cb60-540"><a href="#cb60-540" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-541"><a href="#cb60-541" aria-hidden="true" tabindex="-1"></a>Another common use for <span class="in">`GroupBy`</span> objects is to filter data by group. </span>
<span id="cb60-542"><a href="#cb60-542" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-543"><a href="#cb60-543" aria-hidden="true" tabindex="-1"></a><span class="in">`groupby.filter`</span> takes an argument <span class="in">`func`</span>, where <span class="in">`func`</span> is a function that:</span>
<span id="cb60-544"><a href="#cb60-544" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-545"><a href="#cb60-545" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Takes a <span class="in">`DataFrame`</span> object as input</span>
<span id="cb60-546"><a href="#cb60-546" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Returns a single <span class="in">`True`</span> or <span class="in">`False`</span>.</span>
<span id="cb60-547"><a href="#cb60-547" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-548"><a href="#cb60-548" aria-hidden="true" tabindex="-1"></a><span class="in">`groupby.filter`</span> applies <span class="in">`func`</span> to each group/sub-<span class="in">`DataFrame`</span>:</span>
<span id="cb60-549"><a href="#cb60-549" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-550"><a href="#cb60-550" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>If <span class="in">`func`</span> returns <span class="in">`True`</span> for a group, then all rows belonging to the group are preserved.</span>
<span id="cb60-551"><a href="#cb60-551" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>If <span class="in">`func`</span> returns <span class="in">`False`</span> for a group, then all rows belonging to that group are filtered out.</span>
<span id="cb60-552"><a href="#cb60-552" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-553"><a href="#cb60-553" aria-hidden="true" tabindex="-1"></a>In other words, sub-<span class="in">`DataFrame`</span>s that correspond to <span class="in">`True`</span> are returned in the final result, whereas those with a <span class="in">`False`</span> value are not. Importantly, <span class="in">`groupby.filter`</span> is different from <span class="in">`groupby.agg`</span> in that an *entire* sub-`DataFrame` is returned in the final `DataFrame`, not just a single row. As a result, `groupby.filter` preserves the original indices and the column we grouped on does **NOT** become the index!</span>
<span id="cb60-554"><a href="#cb60-554" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-555"><a href="#cb60-555" aria-hidden="true" tabindex="-1"></a>&lt;img src="images/filter_demo.png" alt='groupby_demo' width='600'&gt;</span>
<span id="cb60-556"><a href="#cb60-556" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-557"><a href="#cb60-557" aria-hidden="true" tabindex="-1"></a>To illustrate how this happens, let's go back to the <span class="in">`elections`</span> dataset. Say we want to identify "tight" election years – that is, we want to find all rows that correspond to election years where all candidates in that year won a similar portion of the total vote. Specifically, let's find all rows corresponding to a year where no candidate won more than 45% of the total vote. </span>
<span id="cb60-558"><a href="#cb60-558" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-559"><a href="#cb60-559" aria-hidden="true" tabindex="-1"></a>In other words, we want to: </span>
<span id="cb60-560"><a href="#cb60-560" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-561"><a href="#cb60-561" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Find the years where the maximum <span class="in">`%`</span> in that year is less than 45%</span>
<span id="cb60-562"><a href="#cb60-562" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Return all <span class="in">`DataFrame`</span> rows that correspond to these years</span>
<span id="cb60-563"><a href="#cb60-563" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-564"><a href="#cb60-564" aria-hidden="true" tabindex="-1"></a>For each year, we need to find the maximum <span class="in">`%`</span> among *all* rows for that year. If this maximum <span class="in">`%`</span> is lower than 45%, we will tell <span class="in">`pandas`</span> to keep all rows corresponding to that year. </span>
<span id="cb60-565"><a href="#cb60-565" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-568"><a href="#cb60-568" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb60-569"><a href="#cb60-569" aria-hidden="true" tabindex="-1"></a>elections.groupby(<span class="st">"Year"</span>).<span class="bu">filter</span>(<span class="kw">lambda</span> sf: sf[<span class="st">"%"</span>].<span class="bu">max</span>() <span class="op">&lt;</span> <span class="dv">45</span>).head(<span class="dv">9</span>)</span>
<span id="cb60-570"><a href="#cb60-570" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb60-571"><a href="#cb60-571" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-572"><a href="#cb60-572" aria-hidden="true" tabindex="-1"></a>What's going on here? In this example, we've defined our filtering function, <span class="in">`func`</span>, to be <span class="in">`lambda sf: sf["%"].max() &lt; 45`</span>. This filtering function will find the maximum <span class="in">`"%"`</span> value among all entries in the grouped sub-<span class="in">`DataFrame`</span>, which we call <span class="in">`sf`</span>. If the maximum value is less than 45, then the filter function will return <span class="in">`True`</span> and all rows in that grouped sub-<span class="in">`DataFrame`</span> will appear in the final output <span class="in">`DataFrame`</span>. </span>
<span id="cb60-573"><a href="#cb60-573" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-574"><a href="#cb60-574" aria-hidden="true" tabindex="-1"></a>Examine the <span class="in">`DataFrame`</span> above. Notice how, in this preview of the first 9 rows, all entries from the years 1860 and 1912 appear. This means that in 1860 and 1912, no candidate in that year won more than 45% of the total vote. </span>
<span id="cb60-575"><a href="#cb60-575" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-576"><a href="#cb60-576" aria-hidden="true" tabindex="-1"></a>You may ask: how is the <span class="in">`groupby.filter`</span> procedure different to the boolean filtering we've seen previously? Boolean filtering considers *individual* rows when applying a boolean condition. For example, the code `elections[elections["%"] &lt; 45]` will check the `"%"` value of every single row in `elections`; if it is less than 45, then that row will be kept in the output. `groupby.filter`, in contrast, applies a boolean condition *across* all rows in a group. If not all rows in that group satisfy the condition specified by the filter, the entire group will be discarded in the output. </span>
<span id="cb60-577"><a href="#cb60-577" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-578"><a href="#cb60-578" aria-hidden="true" tabindex="-1"></a><span class="fu">### Aggregation with `lambda` Functions</span></span>
<span id="cb60-579"><a href="#cb60-579" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-580"><a href="#cb60-580" aria-hidden="true" tabindex="-1"></a>What if we wish to aggregate our <span class="in">`DataFrame`</span> using a non-standard function – for example, a function of our own design? We can do so by combining <span class="in">`.agg`</span> with <span class="in">`lambda`</span> expressions.</span>
<span id="cb60-581"><a href="#cb60-581" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-582"><a href="#cb60-582" aria-hidden="true" tabindex="-1"></a>Let's first consider a puzzle to jog our memory. We will attempt to find the <span class="in">`Candidate`</span> from each <span class="in">`Party`</span> with the highest <span class="in">`%`</span> of votes. </span>
<span id="cb60-583"><a href="#cb60-583" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-584"><a href="#cb60-584" aria-hidden="true" tabindex="-1"></a>A naive approach may be to group by the <span class="in">`Party`</span> column and aggregate by the maximum.</span>
<span id="cb60-585"><a href="#cb60-585" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-588"><a href="#cb60-588" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb60-589"><a href="#cb60-589" aria-hidden="true" tabindex="-1"></a>elections.groupby(<span class="st">"Party"</span>).agg(<span class="bu">max</span>).head(<span class="dv">10</span>)</span>
<span id="cb60-590"><a href="#cb60-590" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb60-591"><a href="#cb60-591" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-592"><a href="#cb60-592" aria-hidden="true" tabindex="-1"></a>This approach is clearly wrong – the <span class="in">`DataFrame`</span> claims that Woodrow Wilson won the presidency in 2020.</span>
<span id="cb60-593"><a href="#cb60-593" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-594"><a href="#cb60-594" aria-hidden="true" tabindex="-1"></a>Why is this happening? Here, the <span class="in">`max`</span> aggregation function is taken over every column *independently*. Among Democrats, <span class="in">`max`</span> is computing:</span>
<span id="cb60-595"><a href="#cb60-595" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-596"><a href="#cb60-596" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>The most recent <span class="in">`Year`</span> a Democratic candidate ran for president (2020)</span>
<span id="cb60-597"><a href="#cb60-597" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>The <span class="in">`Candidate`</span> with the alphabetically "largest" name ("Woodrow Wilson")</span>
<span id="cb60-598"><a href="#cb60-598" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>The <span class="in">`Result`</span> with the alphabetically "largest" outcome ("win")</span>
<span id="cb60-599"><a href="#cb60-599" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-600"><a href="#cb60-600" aria-hidden="true" tabindex="-1"></a>Instead, let's try a different approach. We will:</span>
<span id="cb60-601"><a href="#cb60-601" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-602"><a href="#cb60-602" aria-hidden="true" tabindex="-1"></a><span class="ss">1. </span>Sort the <span class="in">`DataFrame`</span> so that rows are in descending order of <span class="in">`%`</span></span>
<span id="cb60-603"><a href="#cb60-603" aria-hidden="true" tabindex="-1"></a><span class="ss">2. </span>Group by <span class="in">`Party`</span> and select the first row of each sub-<span class="in">`DataFrame`</span></span>
<span id="cb60-604"><a href="#cb60-604" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-605"><a href="#cb60-605" aria-hidden="true" tabindex="-1"></a>While it may seem unintuitive, sorting <span class="in">`elections`</span> by descending order of <span class="in">`%`</span> is extremely helpful. If we then group by <span class="in">`Party`</span>, the first row of each <span class="in">`GroupBy`</span> object will contain information about the <span class="in">`Candidate`</span> with the highest voter <span class="in">`%`</span>.</span>
<span id="cb60-606"><a href="#cb60-606" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-609"><a href="#cb60-609" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb60-610"><a href="#cb60-610" aria-hidden="true" tabindex="-1"></a>elections_sorted_by_percent <span class="op">=</span> elections.sort_values(<span class="st">"%"</span>, ascending<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb60-611"><a href="#cb60-611" aria-hidden="true" tabindex="-1"></a>elections_sorted_by_percent.head(<span class="dv">5</span>)</span>
<span id="cb60-612"><a href="#cb60-612" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb60-613"><a href="#cb60-613" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-616"><a href="#cb60-616" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb60-617"><a href="#cb60-617" aria-hidden="true" tabindex="-1"></a>elections_sorted_by_percent.groupby(<span class="st">"Party"</span>).agg(<span class="kw">lambda</span> x : x.iloc[<span class="dv">0</span>]).head(<span class="dv">10</span>)</span>
<span id="cb60-618"><a href="#cb60-618" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-619"><a href="#cb60-619" aria-hidden="true" tabindex="-1"></a><span class="co"># Equivalent to the below code</span></span>
<span id="cb60-620"><a href="#cb60-620" aria-hidden="true" tabindex="-1"></a><span class="co"># elections_sorted_by_percent.groupby("Party").agg('first').head(10)</span></span>
<span id="cb60-621"><a href="#cb60-621" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb60-622"><a href="#cb60-622" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-623"><a href="#cb60-623" aria-hidden="true" tabindex="-1"></a>Here's an illustration of the process:</span>
<span id="cb60-624"><a href="#cb60-624" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-625"><a href="#cb60-625" aria-hidden="true" tabindex="-1"></a>&lt;img src="images/puzzle_demo.png" alt='groupby_demo' width='600'&gt;</span>
<span id="cb60-626"><a href="#cb60-626" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-627"><a href="#cb60-627" aria-hidden="true" tabindex="-1"></a>Notice how our code correctly determines that Lyndon Johnson from the Democratic Party has the highest voter <span class="in">`%`</span>.</span>
<span id="cb60-628"><a href="#cb60-628" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-629"><a href="#cb60-629" aria-hidden="true" tabindex="-1"></a>More generally, <span class="in">`lambda`</span> functions are used to design custom aggregation functions that aren't pre-defined by Python. The input parameter <span class="in">`x`</span> to the <span class="in">`lambda`</span> function is a <span class="in">`GroupBy`</span> object. Therefore, it should make sense why <span class="in">`lambda x : x.iloc[0]`</span> selects the first row in each groupby object.</span>
<span id="cb60-630"><a href="#cb60-630" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-631"><a href="#cb60-631" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-632"><a href="#cb60-632" aria-hidden="true" tabindex="-1"></a>In fact, there's a few different ways to approach this problem. Each approach has different tradeoffs in terms of readability, performance, memory consumption, complexity, etc. We've given a few examples below. </span>
<span id="cb60-633"><a href="#cb60-633" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-634"><a href="#cb60-634" aria-hidden="true" tabindex="-1"></a>**Note**: Understanding these alternative solutions is not required. They are given to demonstrate the vast number of problem-solving approaches in <span class="in">`pandas`</span>.</span>
<span id="cb60-635"><a href="#cb60-635" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-638"><a href="#cb60-638" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb60-639"><a href="#cb60-639" aria-hidden="true" tabindex="-1"></a><span class="co"># Using the idxmax function</span></span>
<span id="cb60-640"><a href="#cb60-640" aria-hidden="true" tabindex="-1"></a>best_per_party <span class="op">=</span> elections.loc[elections.groupby(<span class="st">'Party'</span>)[<span class="st">'%'</span>].idxmax()]</span>
<span id="cb60-641"><a href="#cb60-641" aria-hidden="true" tabindex="-1"></a>best_per_party.head(<span class="dv">5</span>)</span>
<span id="cb60-642"><a href="#cb60-642" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb60-643"><a href="#cb60-643" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-646"><a href="#cb60-646" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb60-647"><a href="#cb60-647" aria-hidden="true" tabindex="-1"></a><span class="co"># Using the .drop_duplicates function</span></span>
<span id="cb60-648"><a href="#cb60-648" aria-hidden="true" tabindex="-1"></a>best_per_party2 <span class="op">=</span> elections.sort_values(<span class="st">'%'</span>).drop_duplicates([<span class="st">'Party'</span>], keep<span class="op">=</span><span class="st">'last'</span>)</span>
<span id="cb60-649"><a href="#cb60-649" aria-hidden="true" tabindex="-1"></a>best_per_party2.head(<span class="dv">5</span>)</span>
<span id="cb60-650"><a href="#cb60-650" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb60-651"><a href="#cb60-651" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-652"><a href="#cb60-652" aria-hidden="true" tabindex="-1"></a><span class="fu">## Aggregating Data with Pivot Tables</span></span>
<span id="cb60-653"><a href="#cb60-653" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-654"><a href="#cb60-654" aria-hidden="true" tabindex="-1"></a>We know now that <span class="in">`.groupby`</span> gives us the ability to group and aggregate data across our <span class="in">`DataFrame`</span>. The examples above formed groups using just one column in the <span class="in">`DataFrame`</span>. It's possible to group by multiple columns at once by passing in a list of column names to <span class="in">`.groupby`</span>. </span>
<span id="cb60-655"><a href="#cb60-655" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-656"><a href="#cb60-656" aria-hidden="true" tabindex="-1"></a>Let's consider the <span class="in">`babynames`</span> dataset again. In this problem, we will find the total number of baby names associated with each sex for each year. To do this, we'll group by *both* the <span class="in">`"Year"`</span> and <span class="in">`"Sex"`</span> columns.</span>
<span id="cb60-657"><a href="#cb60-657" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-660"><a href="#cb60-660" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb60-661"><a href="#cb60-661" aria-hidden="true" tabindex="-1"></a>babynames.head()</span>
<span id="cb60-662"><a href="#cb60-662" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb60-663"><a href="#cb60-663" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-666"><a href="#cb60-666" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb60-667"><a href="#cb60-667" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: false</span></span>
<span id="cb60-668"><a href="#cb60-668" aria-hidden="true" tabindex="-1"></a><span class="co"># Find the total number of baby names associated with each sex for each </span></span>
<span id="cb60-669"><a href="#cb60-669" aria-hidden="true" tabindex="-1"></a><span class="co"># year in the data</span></span>
<span id="cb60-670"><a href="#cb60-670" aria-hidden="true" tabindex="-1"></a>babynames.groupby([<span class="st">"Year"</span>, <span class="st">"Sex"</span>])[[<span class="st">"Count"</span>]].agg(<span class="bu">sum</span>).head(<span class="dv">6</span>)</span>
<span id="cb60-671"><a href="#cb60-671" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb60-672"><a href="#cb60-672" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-673"><a href="#cb60-673" aria-hidden="true" tabindex="-1"></a>Notice that both <span class="in">`"Year"`</span> and <span class="in">`"Sex"`</span> serve as the index of the <span class="in">`DataFrame`</span> (they are both rendered in bold). We've created a *multi-index* <span class="in">`DataFrame`</span> where two different index values, the year and sex, are used to uniquely identify each row. </span>
<span id="cb60-674"><a href="#cb60-674" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-675"><a href="#cb60-675" aria-hidden="true" tabindex="-1"></a>This isn't the most intuitive way of representing this data – and, because multi-indexed DataFrames have multiple dimensions in their index, they can often be difficult to use. </span>
<span id="cb60-676"><a href="#cb60-676" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-677"><a href="#cb60-677" aria-hidden="true" tabindex="-1"></a>Another strategy to aggregate across two columns is to create a pivot table. You saw these back in <span class="co">[</span><span class="ot">Data 8</span><span class="co">](https://inferentialthinking.com/chapters/08/3/Cross-Classifying_by_More_than_One_Variable.html#pivot-tables-rearranging-the-output-of-group)</span>. One set of values is used to create the index of the pivot table; another set is used to define the column names. The values contained in each cell of the table correspond to the aggregated data for each index-column pair.</span>
<span id="cb60-678"><a href="#cb60-678" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-679"><a href="#cb60-679" aria-hidden="true" tabindex="-1"></a>Here's an illustration of the process: </span>
<span id="cb60-680"><a href="#cb60-680" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-681"><a href="#cb60-681" aria-hidden="true" tabindex="-1"></a>&lt;img src="images/pivot.png" alt='groupby_demo' width='600'&gt;</span>
<span id="cb60-682"><a href="#cb60-682" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-683"><a href="#cb60-683" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-684"><a href="#cb60-684" aria-hidden="true" tabindex="-1"></a>The best way to understand pivot tables is to see one in action. Let's return to our original goal of summing the total number of names associated with each combination of year and sex. We'll call the <span class="in">`pandas`</span> <span class="co">[</span><span class="ot">`.pivot_table`</span><span class="co">](https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.pivot_table.html)</span> method to create a new table.</span>
<span id="cb60-685"><a href="#cb60-685" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-688"><a href="#cb60-688" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb60-689"><a href="#cb60-689" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: false</span></span>
<span id="cb60-690"><a href="#cb60-690" aria-hidden="true" tabindex="-1"></a><span class="co"># The `pivot_table` method is used to generate a Pandas pivot table</span></span>
<span id="cb60-691"><a href="#cb60-691" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb60-692"><a href="#cb60-692" aria-hidden="true" tabindex="-1"></a>babynames.pivot_table(</span>
<span id="cb60-693"><a href="#cb60-693" aria-hidden="true" tabindex="-1"></a>    index <span class="op">=</span> <span class="st">"Year"</span>,</span>
<span id="cb60-694"><a href="#cb60-694" aria-hidden="true" tabindex="-1"></a>    columns <span class="op">=</span> <span class="st">"Sex"</span>,    </span>
<span id="cb60-695"><a href="#cb60-695" aria-hidden="true" tabindex="-1"></a>    values <span class="op">=</span> <span class="st">"Count"</span>, </span>
<span id="cb60-696"><a href="#cb60-696" aria-hidden="true" tabindex="-1"></a>    aggfunc <span class="op">=</span> <span class="st">"sum"</span>, </span>
<span id="cb60-697"><a href="#cb60-697" aria-hidden="true" tabindex="-1"></a>).head(<span class="dv">5</span>)</span>
<span id="cb60-698"><a href="#cb60-698" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb60-699"><a href="#cb60-699" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-700"><a href="#cb60-700" aria-hidden="true" tabindex="-1"></a>Looks a lot better! Now, our <span class="in">`DataFrame`</span> is structured with clear index-column combinations. Each entry in the pivot table represents the summed count of names for a given combination of <span class="in">`"Year"`</span> and <span class="in">`"Sex"`</span>.</span>
<span id="cb60-701"><a href="#cb60-701" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-702"><a href="#cb60-702" aria-hidden="true" tabindex="-1"></a>Let's take a closer look at the code implemented above. </span>
<span id="cb60-703"><a href="#cb60-703" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-704"><a href="#cb60-704" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span><span class="in">`index = "Year"`</span> specifies the column name in the original <span class="in">`DataFrame`</span> that should be used as the index of the pivot table</span>
<span id="cb60-705"><a href="#cb60-705" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span><span class="in">`columns = "Sex"`</span> specifies the column name in the original <span class="in">`DataFrame`</span> that should be used to generate the columns of the pivot table</span>
<span id="cb60-706"><a href="#cb60-706" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span><span class="in">`values = "Count"`</span> indicates what values from the original <span class="in">`DataFrame`</span> should be used to populate the entry for each index-column combination</span>
<span id="cb60-707"><a href="#cb60-707" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span><span class="in">`aggfunc = np.sum`</span> tells <span class="in">`pandas`</span> what function to use when aggregating the data specified by <span class="in">`values`</span>. Here, we are summing the name counts for each pair of <span class="in">`"Year"`</span> and <span class="in">`"Sex"`</span></span>
<span id="cb60-708"><a href="#cb60-708" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-709"><a href="#cb60-709" aria-hidden="true" tabindex="-1"></a>We can even include multiple values in the index or columns of our pivot tables. </span>
<span id="cb60-710"><a href="#cb60-710" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-713"><a href="#cb60-713" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb60-714"><a href="#cb60-714" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: false</span></span>
<span id="cb60-715"><a href="#cb60-715" aria-hidden="true" tabindex="-1"></a>babynames_pivot <span class="op">=</span> babynames.pivot_table(</span>
<span id="cb60-716"><a href="#cb60-716" aria-hidden="true" tabindex="-1"></a>    index<span class="op">=</span><span class="st">"Year"</span>,     <span class="co"># the rows (turned into index)</span></span>
<span id="cb60-717"><a href="#cb60-717" aria-hidden="true" tabindex="-1"></a>    columns<span class="op">=</span><span class="st">"Sex"</span>,    <span class="co"># the column values</span></span>
<span id="cb60-718"><a href="#cb60-718" aria-hidden="true" tabindex="-1"></a>    values<span class="op">=</span>[<span class="st">"Count"</span>, <span class="st">"Name"</span>], </span>
<span id="cb60-719"><a href="#cb60-719" aria-hidden="true" tabindex="-1"></a>    aggfunc<span class="op">=</span><span class="st">"max"</span>,      <span class="co"># group operation</span></span>
<span id="cb60-720"><a href="#cb60-720" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb60-721"><a href="#cb60-721" aria-hidden="true" tabindex="-1"></a>babynames_pivot.head(<span class="dv">6</span>)</span>
<span id="cb60-722"><a href="#cb60-722" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb60-723"><a href="#cb60-723" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-724"><a href="#cb60-724" aria-hidden="true" tabindex="-1"></a>Note that each row provides the number of girls and number of boys having that year's most common name, and also lists the alphabetically largest girl name and boy name. The counts for number of girls/boys in the resulting <span class="in">`DataFrame`</span> do not correspond to the names listed. For example, in 1910, the most popular girl name is given to 295 girls, but that name was likely not Yvonne. </span>
<span id="cb60-725"><a href="#cb60-725" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-726"><a href="#cb60-726" aria-hidden="true" tabindex="-1"></a><span class="fu">## Joining Tables </span></span>
<span id="cb60-727"><a href="#cb60-727" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-728"><a href="#cb60-728" aria-hidden="true" tabindex="-1"></a>When working on data science projects, we're unlikely to have absolutely all the data we want contained in a single <span class="in">`DataFrame`</span> – a real-world data scientist needs to grapple with data coming from multiple sources. If we have access to multiple datasets with related information, we can join two or more tables into a single <span class="in">`DataFrame`</span>. </span>
<span id="cb60-729"><a href="#cb60-729" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-730"><a href="#cb60-730" aria-hidden="true" tabindex="-1"></a>To put this into practice, we'll revisit the <span class="in">`elections`</span> dataset.</span>
<span id="cb60-731"><a href="#cb60-731" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-734"><a href="#cb60-734" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb60-735"><a href="#cb60-735" aria-hidden="true" tabindex="-1"></a>elections.head(<span class="dv">5</span>)</span>
<span id="cb60-736"><a href="#cb60-736" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb60-737"><a href="#cb60-737" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-738"><a href="#cb60-738" aria-hidden="true" tabindex="-1"></a>Say we want to understand the popularity of the names of each presidential candidate in 2022. To do this, we'll need the combined data of <span class="in">`babynames`</span> *and* <span class="in">`elections`</span>. </span>
<span id="cb60-739"><a href="#cb60-739" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-740"><a href="#cb60-740" aria-hidden="true" tabindex="-1"></a>We'll start by creating a new column containing the first name of each presidential candidate. This will help us join each name in <span class="in">`elections`</span> to the corresponding name data in <span class="in">`babynames`</span>. </span>
<span id="cb60-741"><a href="#cb60-741" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-744"><a href="#cb60-744" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb60-745"><a href="#cb60-745" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: false</span></span>
<span id="cb60-746"><a href="#cb60-746" aria-hidden="true" tabindex="-1"></a><span class="co"># This `str` operation splits each candidate's full name at each </span></span>
<span id="cb60-747"><a href="#cb60-747" aria-hidden="true" tabindex="-1"></a><span class="co"># blank space, then takes just the candidate's first name</span></span>
<span id="cb60-748"><a href="#cb60-748" aria-hidden="true" tabindex="-1"></a>elections[<span class="st">"First Name"</span>] <span class="op">=</span> elections[<span class="st">"Candidate"</span>].<span class="bu">str</span>.split().<span class="bu">str</span>[<span class="dv">0</span>]</span>
<span id="cb60-749"><a href="#cb60-749" aria-hidden="true" tabindex="-1"></a>elections.head(<span class="dv">5</span>)</span>
<span id="cb60-750"><a href="#cb60-750" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb60-751"><a href="#cb60-751" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-754"><a href="#cb60-754" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb60-755"><a href="#cb60-755" aria-hidden="true" tabindex="-1"></a><span class="co"># Here, we'll only consider `babynames` data from 2022</span></span>
<span id="cb60-756"><a href="#cb60-756" aria-hidden="true" tabindex="-1"></a>babynames_2022 <span class="op">=</span> babynames[babynames[<span class="st">"Year"</span>]<span class="op">==</span><span class="dv">2022</span>]</span>
<span id="cb60-757"><a href="#cb60-757" aria-hidden="true" tabindex="-1"></a>babynames_2022.head()</span>
<span id="cb60-758"><a href="#cb60-758" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb60-759"><a href="#cb60-759" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-760"><a href="#cb60-760" aria-hidden="true" tabindex="-1"></a>Now, we're ready to join the two tables. <span class="co">[</span><span class="ot">`pd.merge`</span><span class="co">](https://pandas.pydata.org/docs/reference/api/pandas.DataFrame.merge.html)</span> is the <span class="in">`pandas`</span> method used to join <span class="in">`DataFrame`</span>s together.</span>
<span id="cb60-761"><a href="#cb60-761" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-764"><a href="#cb60-764" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb60-765"><a href="#cb60-765" aria-hidden="true" tabindex="-1"></a>merged <span class="op">=</span> pd.merge(left <span class="op">=</span> elections, right <span class="op">=</span> babynames_2022, <span class="op">\</span></span>
<span id="cb60-766"><a href="#cb60-766" aria-hidden="true" tabindex="-1"></a>                  left_on <span class="op">=</span> <span class="st">"First Name"</span>, right_on <span class="op">=</span> <span class="st">"Name"</span>)</span>
<span id="cb60-767"><a href="#cb60-767" aria-hidden="true" tabindex="-1"></a>merged.head()</span>
<span id="cb60-768"><a href="#cb60-768" aria-hidden="true" tabindex="-1"></a><span class="co"># Notice that pandas automatically specifies `Year_x` and `Year_y` </span></span>
<span id="cb60-769"><a href="#cb60-769" aria-hidden="true" tabindex="-1"></a><span class="co"># when both merged DataFrames have the same column name to avoid confusion</span></span>
<span id="cb60-770"><a href="#cb60-770" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-771"><a href="#cb60-771" aria-hidden="true" tabindex="-1"></a><span class="co"># Second option</span></span>
<span id="cb60-772"><a href="#cb60-772" aria-hidden="true" tabindex="-1"></a><span class="co"># merged = elections.merge(right = babynames_2022, \</span></span>
<span id="cb60-773"><a href="#cb60-773" aria-hidden="true" tabindex="-1"></a>    <span class="co"># left_on = "First Name", right_on = "Name")</span></span>
<span id="cb60-774"><a href="#cb60-774" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb60-775"><a href="#cb60-775" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-776"><a href="#cb60-776" aria-hidden="true" tabindex="-1"></a>Let's take a closer look at the parameters:</span>
<span id="cb60-777"><a href="#cb60-777" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-778"><a href="#cb60-778" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span><span class="in">`left`</span> and <span class="in">`right`</span> parameters are used to specify the <span class="in">`DataFrame`</span>s to be joined.</span>
<span id="cb60-779"><a href="#cb60-779" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span><span class="in">`left_on`</span> and <span class="in">`right_on`</span> parameters are assigned to the string names of the columns to be used when performing the join. These two <span class="in">`on`</span> parameters tell <span class="in">`pandas`</span> what values should act as pairing keys to determine which rows to merge across the <span class="in">`DataFrame`</span>s. We'll talk more about this idea of a pairing key next lecture.</span>
<span id="cb60-780"><a href="#cb60-780" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-781"><a href="#cb60-781" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-782"><a href="#cb60-782" aria-hidden="true" tabindex="-1"></a><span class="fu">## Parting Note</span></span>
<span id="cb60-783"><a href="#cb60-783" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-784"><a href="#cb60-784" aria-hidden="true" tabindex="-1"></a>Congratulations! We finally tackled <span class="in">`pandas`</span>. Don't worry if you are still not feeling very comfortable with it—you will have plenty of chances to practice over the next few weeks.</span>
<span id="cb60-785"><a href="#cb60-785" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-786"><a href="#cb60-786" aria-hidden="true" tabindex="-1"></a>Next, we will get our hands dirty with some real-world datasets and use our <span class="in">`pandas`</span> knowledge to conduct some exploratory data analysis.</span>
</code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->




</body></html>
<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Data Cleaning and EDA</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="eda_files/libs/clipboard/clipboard.min.js"></script>
<script src="eda_files/libs/quarto-html/quarto.js"></script>
<script src="eda_files/libs/quarto-html/popper.min.js"></script>
<script src="eda_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="eda_files/libs/quarto-html/anchor.min.js"></script>
<link href="eda_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="eda_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="eda_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="eda_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="eda_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script>
<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

</head>

<body>

<div id="quarto-content" class="page-columns page-rows-contents page-layout-full">
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
  <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Data Cleaning and EDA</h2>
   
  <ul>
  <li><a href="#structure" id="toc-structure" class="nav-link active" data-scroll-target="#structure">Structure</a>
  <ul class="collapse">
  <li><a href="#file-formats" id="toc-file-formats" class="nav-link" data-scroll-target="#file-formats">File Formats</a></li>
  <li><a href="#variable-types" id="toc-variable-types" class="nav-link" data-scroll-target="#variable-types">Variable Types</a></li>
  <li><a href="#primary-and-foreign-keys" id="toc-primary-and-foreign-keys" class="nav-link" data-scroll-target="#primary-and-foreign-keys">Primary and Foreign Keys</a></li>
  </ul></li>
  <li><a href="#granularity-scope-and-temporality" id="toc-granularity-scope-and-temporality" class="nav-link" data-scroll-target="#granularity-scope-and-temporality">Granularity, Scope, and Temporality</a>
  <ul class="collapse">
  <li><a href="#granularity" id="toc-granularity" class="nav-link" data-scroll-target="#granularity">Granularity</a></li>
  <li><a href="#scope" id="toc-scope" class="nav-link" data-scroll-target="#scope">Scope</a></li>
  <li><a href="#temporality" id="toc-temporality" class="nav-link" data-scroll-target="#temporality">Temporality</a></li>
  </ul></li>
  <li><a href="#faithfulness" id="toc-faithfulness" class="nav-link" data-scroll-target="#faithfulness">Faithfulness</a>
  <ul class="collapse">
  <li><a href="#missing-values" id="toc-missing-values" class="nav-link" data-scroll-target="#missing-values">Missing Values</a></li>
  </ul></li>
  <li><a href="#eda-demo-1-tuberculosis-in-the-united-states" id="toc-eda-demo-1-tuberculosis-in-the-united-states" class="nav-link" data-scroll-target="#eda-demo-1-tuberculosis-in-the-united-states">EDA Demo 1: Tuberculosis in the United States</a>
  <ul class="collapse">
  <li><a href="#csvs-and-field-names" id="toc-csvs-and-field-names" class="nav-link" data-scroll-target="#csvs-and-field-names">CSVs and Field Names</a></li>
  <li><a href="#record-granularity" id="toc-record-granularity" class="nav-link" data-scroll-target="#record-granularity">Record Granularity</a></li>
  <li><a href="#gather-census-data" id="toc-gather-census-data" class="nav-link" data-scroll-target="#gather-census-data">Gather Census Data</a></li>
  <li><a href="#joining-data-merging-dataframes" id="toc-joining-data-merging-dataframes" class="nav-link" data-scroll-target="#joining-data-merging-dataframes">Joining Data (Merging <code>DataFrame</code>s)</a></li>
  <li><a href="#reproducing-data-compute-incidence" id="toc-reproducing-data-compute-incidence" class="nav-link" data-scroll-target="#reproducing-data-compute-incidence">Reproducing Data: Compute Incidence</a></li>
  <li><a href="#bonus-eda-reproducing-the-reported-statistic" id="toc-bonus-eda-reproducing-the-reported-statistic" class="nav-link" data-scroll-target="#bonus-eda-reproducing-the-reported-statistic">Bonus EDA: Reproducing the Reported Statistic</a></li>
  </ul></li>
  <li><a href="#eda-demo-2-mauna-loa-co2-data-a-lesson-in-data-faithfulness" id="toc-eda-demo-2-mauna-loa-co2-data-a-lesson-in-data-faithfulness" class="nav-link" data-scroll-target="#eda-demo-2-mauna-loa-co2-data-a-lesson-in-data-faithfulness">EDA Demo 2: Mauna Loa CO<sub>2</sub> Data – A Lesson in Data Faithfulness</a>
  <ul class="collapse">
  <li><a href="#reading-this-file-into-pandas" id="toc-reading-this-file-into-pandas" class="nav-link" data-scroll-target="#reading-this-file-into-pandas">Reading this file into Pandas?</a></li>
  <li><a href="#exploring-variable-feature-types" id="toc-exploring-variable-feature-types" class="nav-link" data-scroll-target="#exploring-variable-feature-types">Exploring Variable Feature Types</a></li>
  <li><a href="#visualizing-co2" id="toc-visualizing-co2" class="nav-link" data-scroll-target="#visualizing-co2">Visualizing CO<sub>2</sub></a></li>
  <li><a href="#sanity-checks-reasoning-about-the-data" id="toc-sanity-checks-reasoning-about-the-data" class="nav-link" data-scroll-target="#sanity-checks-reasoning-about-the-data">Sanity Checks: Reasoning about the data</a></li>
  <li><a href="#understanding-missing-value-1-days" id="toc-understanding-missing-value-1-days" class="nav-link" data-scroll-target="#understanding-missing-value-1-days">Understanding Missing Value 1: <code>Days</code></a></li>
  <li><a href="#understanding-missing-value-2-avg" id="toc-understanding-missing-value-2-avg" class="nav-link" data-scroll-target="#understanding-missing-value-2-avg">Understanding Missing Value 2: <code>Avg</code></a></li>
  <li><a href="#drop-nan-or-impute-missing-avg-data" id="toc-drop-nan-or-impute-missing-avg-data" class="nav-link" data-scroll-target="#drop-nan-or-impute-missing-avg-data">Drop, <code>NaN</code>, or Impute Missing <code>Avg</code> Data?</a></li>
  <li><a href="#presenting-the-data-a-discussion-on-data-granularity" id="toc-presenting-the-data-a-discussion-on-data-granularity" class="nav-link" data-scroll-target="#presenting-the-data-a-discussion-on-data-granularity">Presenting the data: A Discussion on Data Granularity</a></li>
  </ul></li>
  <li><a href="#summary" id="toc-summary" class="nav-link" data-scroll-target="#summary">Summary</a>
  <ul class="collapse">
  <li><a href="#dealing-with-missing-values" id="toc-dealing-with-missing-values" class="nav-link" data-scroll-target="#dealing-with-missing-values">Dealing with Missing Values</a></li>
  <li><a href="#eda-and-data-wrangling" id="toc-eda-and-data-wrangling" class="nav-link" data-scroll-target="#eda-and-data-wrangling">EDA and Data Wrangling</a></li>
  </ul></li>
  </ul>
</nav>
</div>
<main class="content column-page-left" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title">Data Cleaning and EDA</h1><button type="button" class="btn code-tools-button dropdown-toggle" id="quarto-code-tools-menu" data-bs-toggle="dropdown" aria-expanded="false"><i class="bi"></i> Code</button><ul class="dropdown-menu dropdown-menu-end" aria-labelelledby="quarto-code-tools-menu"><li><a id="quarto-show-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Show All Code</a></li><li><a id="quarto-hide-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Hide All Code</a></li></ul></div></div>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<div class="cell" data-execution_count="77">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> seaborn <span class="im">as</span> sns</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="co">#%matplotlib inline</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>plt.rcParams[<span class="st">'figure.figsize'</span>] <span class="op">=</span> (<span class="dv">12</span>, <span class="dv">9</span>)</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>sns.<span class="bu">set</span>()</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>sns.set_context(<span class="st">'talk'</span>)</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>np.set_printoptions(threshold<span class="op">=</span><span class="dv">20</span>, precision<span class="op">=</span><span class="dv">2</span>, suppress<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>pd.set_option(<span class="st">'display.max_rows'</span>, <span class="dv">30</span>)</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>pd.set_option(<span class="st">'display.max_columns'</span>, <span class="va">None</span>)</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>pd.set_option(<span class="st">'display.precision'</span>, <span class="dv">2</span>)</span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a><span class="co"># This option stops scientific notation for pandas</span></span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a>pd.set_option(<span class="st">'display.float_format'</span>, <span class="st">'</span><span class="sc">{:.2f}</span><span class="st">'</span>.<span class="bu">format</span>)</span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Silence some spurious seaborn warnings</span></span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> warnings</span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a>warnings.filterwarnings(<span class="st">"ignore"</span>, category<span class="op">=</span><span class="pp">FutureWarning</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="callout callout-style-default callout-note no-icon callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-1-contents" aria-controls="callout-1" aria-expanded="true" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Learning Outcomes
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-1" class="callout-1-contents callout-collapse collapse show">
<div class="callout-body-container callout-body">
<ul>
<li>Recognize common file formats</li>
<li>Categorize data by its variable type</li>
<li>Build awareness of issues with data faithfulness and develop targeted solutions</li>
</ul>
</div>
</div>
</div>
<p><strong>This content is covered in lectures 4, 5, and 6.</strong></p>
<p>In the past few lectures, we’ve learned that <code>pandas</code> is a toolkit to restructure, modify, and explore a dataset. What we haven’t yet touched on is <em>how</em> to make these data transformation decisions. When we receive a new set of data from the “real world,” how do we know what processing we should do to convert this data into a usable form?</p>
<p><strong>Data cleaning</strong>, also called <strong>data wrangling</strong>, is the process of transforming raw data to facilitate subsequent analysis. It is often used to address issues like:</p>
<ul>
<li>Unclear structure or formatting</li>
<li>Missing or corrupted values</li>
<li>Unit conversions</li>
<li>…and so on</li>
</ul>
<p><strong>Exploratory Data Analysis (EDA)</strong> is the process of understanding a new dataset. It is an open-ended, informal analysis that involves familiarizing ourselves with the variables present in the data, discovering potential hypotheses, and identifying possible issues with the data. This last point can often motivate further data cleaning to address any problems with the dataset’s format; because of this, EDA and data cleaning are often thought of as an “infinite loop,” with each process driving the other.</p>
<p>In this lecture, we will consider the key properties of data to consider when performing data cleaning and EDA. In doing so, we’ll develop a “checklist” of sorts for you to consider when approaching a new dataset. Throughout this process, we’ll build a deeper understanding of this early (but very important!) stage of the data science lifecycle.</p>
<section id="structure" class="level2">
<h2 class="anchored" data-anchor-id="structure">Structure</h2>
<section id="file-formats" class="level3">
<h3 class="anchored" data-anchor-id="file-formats">File Formats</h3>
<p>There are many file types for storing structured data: TSV, JSON, XML, ASCII, SAS, etc. We’ll only cover CSV, TSV, and JSON in lecture, but you’ll likely encounter other formats as you work with different datasets. Reading documentation is your best bet for understanding how to process the multitude of different file types.</p>
<section id="csv" class="level4">
<h4 class="anchored" data-anchor-id="csv">CSV</h4>
<p>CSVs, which stand for <strong>Comma-Separated Values</strong>, are a common tabular data format. In the past two <code>pandas</code> lectures, we briefly touched on the idea of file format: the way data is encoded in a file for storage. Specifically, our <code>elections</code> and <code>babynames</code> datasets were stored and loaded as CSVs:</p>
<div class="cell" data-execution_count="78">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>pd.read_csv(<span class="st">"data/elections.csv"</span>).head(<span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="78">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Year</th>
<th data-quarto-table-cell-role="th">Candidate</th>
<th data-quarto-table-cell-role="th">Party</th>
<th data-quarto-table-cell-role="th">Popular vote</th>
<th data-quarto-table-cell-role="th">Result</th>
<th data-quarto-table-cell-role="th">%</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>1824</td>
<td>Andrew Jackson</td>
<td>Democratic-Republican</td>
<td>151271</td>
<td>loss</td>
<td>57.21</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>1824</td>
<td>John Quincy Adams</td>
<td>Democratic-Republican</td>
<td>113142</td>
<td>win</td>
<td>42.79</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>1828</td>
<td>Andrew Jackson</td>
<td>Democratic</td>
<td>642806</td>
<td>win</td>
<td>56.20</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>1828</td>
<td>John Quincy Adams</td>
<td>National Republican</td>
<td>500897</td>
<td>loss</td>
<td>43.80</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>1832</td>
<td>Andrew Jackson</td>
<td>Democratic</td>
<td>702735</td>
<td>win</td>
<td>54.57</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>To better understand the properties of a CSV, let’s take a look at the first few rows of the raw data file to see what it looks like before being loaded into a <code>DataFrame</code>. We’ll use the <code>repr()</code> function to return the raw string with its special characters:</p>
<div class="cell" data-execution_count="79">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> <span class="bu">open</span>(<span class="st">"data/elections.csv"</span>, <span class="st">"r"</span>) <span class="im">as</span> table:</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>    i <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> row <span class="kw">in</span> table:</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="bu">repr</span>(row))</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>        i <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> i <span class="op">&gt;</span> <span class="dv">3</span>:</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>            <span class="cf">break</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>'Year,Candidate,Party,Popular vote,Result,%\n'
'1824,Andrew Jackson,Democratic-Republican,151271,loss,57.21012204\n'
'1824,John Quincy Adams,Democratic-Republican,113142,win,42.78987796\n'
'1828,Andrew Jackson,Democratic,642806,win,56.20392707\n'</code></pre>
</div>
</div>
<p>Each row, or <strong>record</strong>, in the data is delimited by a newline <code>\n</code>. Each column, or <strong>field</strong>, in the data is delimited by a comma <code>,</code> (hence, comma-separated!).</p>
</section>
<section id="tsv" class="level4">
<h4 class="anchored" data-anchor-id="tsv">TSV</h4>
<p>Another common file type is <strong>TSV (Tab-Separated Values)</strong>. In a TSV, records are still delimited by a newline <code>\n</code>, while fields are delimited by <code>\t</code> tab character.</p>
<p>Let’s check out the first few rows of the raw TSV file. Again, we’ll use the <code>repr()</code> function so that <code>print</code> shows the special characters.</p>
<div class="cell" data-execution_count="80">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> <span class="bu">open</span>(<span class="st">"data/elections.txt"</span>, <span class="st">"r"</span>) <span class="im">as</span> table:</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>    i <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> row <span class="kw">in</span> table:</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="bu">repr</span>(row))</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>        i <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> i <span class="op">&gt;</span> <span class="dv">3</span>:</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>            <span class="cf">break</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>'\ufeffYear\tCandidate\tParty\tPopular vote\tResult\t%\n'
'1824\tAndrew Jackson\tDemocratic-Republican\t151271\tloss\t57.21012204\n'
'1824\tJohn Quincy Adams\tDemocratic-Republican\t113142\twin\t42.78987796\n'
'1828\tAndrew Jackson\tDemocratic\t642806\twin\t56.20392707\n'</code></pre>
</div>
</div>
<p>TSVs can be loaded into <code>pandas</code> using <code>pd.read_csv</code>. We’ll need to specify the <strong>delimiter</strong> with parameter<code>sep='\t'</code> <a href="https://pandas.pydata.org/docs/reference/api/pandas.read_csv.html">(documentation)</a>.</p>
<div class="cell" data-execution_count="81">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>pd.read_csv(<span class="st">"data/elections.txt"</span>, sep<span class="op">=</span><span class="st">'</span><span class="ch">\t</span><span class="st">'</span>).head(<span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="81">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Year</th>
<th data-quarto-table-cell-role="th">Candidate</th>
<th data-quarto-table-cell-role="th">Party</th>
<th data-quarto-table-cell-role="th">Popular vote</th>
<th data-quarto-table-cell-role="th">Result</th>
<th data-quarto-table-cell-role="th">%</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>1824</td>
<td>Andrew Jackson</td>
<td>Democratic-Republican</td>
<td>151271</td>
<td>loss</td>
<td>57.21</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>1824</td>
<td>John Quincy Adams</td>
<td>Democratic-Republican</td>
<td>113142</td>
<td>win</td>
<td>42.79</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>1828</td>
<td>Andrew Jackson</td>
<td>Democratic</td>
<td>642806</td>
<td>win</td>
<td>56.20</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>An issue with CSVs and TSVs comes up whenever there are commas or tabs within the records. How does <code>pandas</code> differentiate between a comma delimiter vs.&nbsp;a comma within the field itself, for example <code>8,900</code>? To remedy this, check out the <a href="https://pandas.pydata.org/docs/reference/api/pandas.read_csv.html"><code>quotechar</code> parameter</a>.</p>
</section>
<section id="json" class="level4">
<h4 class="anchored" data-anchor-id="json">JSON</h4>
<p><strong>JSON (JavaScript Object Notation)</strong> files behave similarly to Python dictionaries. A raw JSON is shown below.</p>
<div class="cell" data-execution_count="82">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> <span class="bu">open</span>(<span class="st">"data/elections.json"</span>, <span class="st">"r"</span>) <span class="im">as</span> table:</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>    i <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> row <span class="kw">in</span> table:</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(row)</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>        i <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> i <span class="op">&gt;</span> <span class="dv">8</span>:</span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>            <span class="cf">break</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[

 {

   "Year": 1824,

   "Candidate": "Andrew Jackson",

   "Party": "Democratic-Republican",

   "Popular vote": 151271,

   "Result": "loss",

   "%": 57.21012204

 },
</code></pre>
</div>
</div>
<p>JSON files can be loaded into <code>pandas</code> using <code>pd.read_json</code>.</p>
<div class="cell" data-execution_count="83">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>pd.read_json(<span class="st">'data/elections.json'</span>).head(<span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="83">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Year</th>
<th data-quarto-table-cell-role="th">Candidate</th>
<th data-quarto-table-cell-role="th">Party</th>
<th data-quarto-table-cell-role="th">Popular vote</th>
<th data-quarto-table-cell-role="th">Result</th>
<th data-quarto-table-cell-role="th">%</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>1824</td>
<td>Andrew Jackson</td>
<td>Democratic-Republican</td>
<td>151271</td>
<td>loss</td>
<td>57.21</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>1824</td>
<td>John Quincy Adams</td>
<td>Democratic-Republican</td>
<td>113142</td>
<td>win</td>
<td>42.79</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>1828</td>
<td>Andrew Jackson</td>
<td>Democratic</td>
<td>642806</td>
<td>win</td>
<td>56.20</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<section id="eda-with-json-berkeley-covid-19-data" class="level5">
<h5 class="anchored" data-anchor-id="eda-with-json-berkeley-covid-19-data">EDA with JSON: Berkeley COVID-19 Data</h5>
<p>The City of Berkeley Open Data <a href="https://data.cityofberkeley.info/Health/COVID-19-Confirmed-Cases/xn6j-b766">website</a> has a dataset with COVID-19 Confirmed Cases among Berkeley residents by date. Let’s download the file and save it as a JSON (note the source URL file type is also a JSON). In the interest of reproducible data science, we will download the data programatically. We have defined some helper functions in the <a href="https://ds100.org/fa23/resources/assets/lectures/lec05/lec05-eda.html"><code>ds100_utils.py</code></a> file that we can reuse these helper functions in many different notebooks.</p>
<div class="cell" data-execution_count="84">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> ds100_utils <span class="im">import</span> fetch_and_cache</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>covid_file <span class="op">=</span> fetch_and_cache(</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">"https://data.cityofberkeley.info/api/views/xn6j-b766/rows.json?accessType=DOWNLOAD"</span>,</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">"confirmed-cases.json"</span>,</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>    force<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>covid_file          <span class="co"># a file path wrapper object</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Using cached version that was downloaded (UTC): Fri Aug 25 09:57:25 2023</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="84">
<pre><code>PosixPath('data/confirmed-cases.json')</code></pre>
</div>
</div>
<section id="file-size" class="level6">
<h6 class="anchored" data-anchor-id="file-size">File Size</h6>
<p>Let’s start our analysis by getting a rough estimate of the size of the dataset to inform the tools we use to view the data. For relatively small datasets, we can use a text editor or spreadsheet. For larger datasets, more programmatic exploration or distributed computing tools may be more fitting. Here we will use <code>Python</code> tools to probe the file.</p>
<p>Since there seem to be text files, let’s investigate the number of lines, which often corresponds to the number of records</p>
<div class="cell" data-execution_count="85">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> os</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(covid_file, <span class="st">"is"</span>, os.path.getsize(covid_file) <span class="op">/</span> <span class="fl">1e6</span>, <span class="st">"MB"</span>)</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> <span class="bu">open</span>(covid_file, <span class="st">"r"</span>) <span class="im">as</span> f:</span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(covid_file, <span class="st">"is"</span>, <span class="bu">sum</span>(<span class="dv">1</span> <span class="cf">for</span> l <span class="kw">in</span> f), <span class="st">"lines."</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>data/confirmed-cases.json is 0.116367 MB
data/confirmed-cases.json is 1110 lines.</code></pre>
</div>
</div>
</section>
<section id="unix-commands" class="level6">
<h6 class="anchored" data-anchor-id="unix-commands">Unix Commands</h6>
<p>As part of the EDA workflow, Unix commands can come in very handy. In fact, there’s an entire book called <a href="https://datascienceatthecommandline.com/">“Data Science at the Command Line”</a> that explores this idea in depth! In Jupyter/IPython, you can prefix lines with <code>!</code> to execute arbitrary Unix commands, and within those lines, you can refer to <code>Python</code> variables and expressions with the syntax <code>{expr}</code>.</p>
<p>Here, we use the <code>ls</code> command to list files, using the <code>-lh</code> flags, which request “long format with information in human-readable form.” We also use the <code>wc</code> command for “word count,” but with the <code>-l</code> flag, which asks for line counts instead of words.</p>
<p>These two give us the same information as the code above, albeit in a slightly different form:</p>
<div class="cell" data-execution_count="86">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="op">!</span>ls <span class="op">-</span>lh {covid_file}</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a><span class="op">!</span>wc <span class="op">-</span>l {covid_file}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>-rw-r--r--  1 lillianweng  staff   114K Aug 25 09:57 data/confirmed-cases.json
    1109 data/confirmed-cases.json</code></pre>
</div>
</div>
</section>
<section id="file-contents" class="level6">
<h6 class="anchored" data-anchor-id="file-contents">File Contents</h6>
<p>Let’s explore the data format using <code>Python</code>.</p>
<div class="cell" data-execution_count="87">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> <span class="bu">open</span>(covid_file, <span class="st">"r"</span>) <span class="im">as</span> f:</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i, row <span class="kw">in</span> <span class="bu">enumerate</span>(f):</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="bu">repr</span>(row)) <span class="co"># print raw strings</span></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> i <span class="op">&gt;=</span> <span class="dv">4</span>: <span class="cf">break</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>'{\n'
'  "meta" : {\n'
'    "view" : {\n'
'      "id" : "xn6j-b766",\n'
'      "name" : "COVID-19 Confirmed Cases",\n'</code></pre>
</div>
</div>
<p>We can use the <code>head</code> Unix command (which is where <code>pandas</code>’ <code>head</code> method comes from!) to see the first few lines of the file:</p>
<div class="cell" data-execution_count="88">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="op">!</span>head <span class="op">-</span><span class="dv">5</span> {covid_file}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>{
  "meta" : {
    "view" : {
      "id" : "xn6j-b766",
      "name" : "COVID-19 Confirmed Cases",</code></pre>
</div>
</div>
<p>In order to load the JSON file into <code>pandas</code>, Let’s first do some EDA with <code>Python</code>’s <code>json</code> package to understand the particular structure of this JSON file so that we can decide what (if anything) to load into <code>pandas</code>. <code>Python</code> has relatively good support for JSON data since it closely matches the internal python object model. In the following cell we import the entire JSON datafile into a python dictionary using the <code>json</code> package.</p>
<div class="cell" data-execution_count="89">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> json</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> <span class="bu">open</span>(covid_file, <span class="st">"rb"</span>) <span class="im">as</span> f:</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>    covid_json <span class="op">=</span> json.load(f)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The <code>covid_json</code> variable is now a dictionary encoding the data in the file:</p>
<div class="cell" data-execution_count="90">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="bu">type</span>(covid_json)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="90">
<pre><code>dict</code></pre>
</div>
</div>
<p>We can examine what keys are in the top level json object by listing out the keys.</p>
<div class="cell" data-execution_count="91">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>covid_json.keys()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="91">
<pre><code>dict_keys(['meta', 'data'])</code></pre>
</div>
</div>
<p><strong>Observation</strong>: The JSON dictionary contains a <code>meta</code> key which likely refers to meta data (data about the data). Meta data often maintained with the data and can be a good source of additional information.</p>
<p>We can investigate the meta data further by examining the keys associated with the metadata.</p>
<div class="cell" data-execution_count="92">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>covid_json[<span class="st">'meta'</span>].keys()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="92">
<pre><code>dict_keys(['view'])</code></pre>
</div>
</div>
<p>The <code>meta</code> key contains another dictionary called <code>view</code>. This likely refers to meta-data about a particular “view” of some underlying database. We will learn more about views when we study SQL later in the class.</p>
<div class="cell" data-execution_count="93">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>covid_json[<span class="st">'meta'</span>][<span class="st">'view'</span>].keys()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="93">
<pre><code>dict_keys(['id', 'name', 'assetType', 'attribution', 'averageRating', 'category', 'createdAt', 'description', 'displayType', 'downloadCount', 'hideFromCatalog', 'hideFromDataJson', 'newBackend', 'numberOfComments', 'oid', 'provenance', 'publicationAppendEnabled', 'publicationDate', 'publicationGroup', 'publicationStage', 'rowsUpdatedAt', 'rowsUpdatedBy', 'tableId', 'totalTimesRated', 'viewCount', 'viewLastModified', 'viewType', 'approvals', 'columns', 'grants', 'metadata', 'owner', 'query', 'rights', 'tableAuthor', 'tags', 'flags'])</code></pre>
</div>
</div>
<p>Notice that this a nested/recursive data structure. As we dig deeper we reveal more and more keys and the corresponding data:</p>
<pre><code>meta
|-&gt; data
    | ... (haven't explored yet)
|-&gt; view
    | -&gt; id
    | -&gt; name
    | -&gt; attribution 
    ...
    | -&gt; description
    ...
    | -&gt; columns
    ...</code></pre>
<p>There is a key called description in the view sub dictionary. This likely contains a description of the data:</p>
<div class="cell" data-execution_count="94">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(covid_json[<span class="st">'meta'</span>][<span class="st">'view'</span>][<span class="st">'description'</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Counts of confirmed COVID-19 cases among Berkeley residents by date.</code></pre>
</div>
</div>
</section>
<section id="examining-the-data-field-for-records" class="level6">
<h6 class="anchored" data-anchor-id="examining-the-data-field-for-records">Examining the Data Field for Records</h6>
<p>We can look at a few entries in the <code>data</code> field. This is what we’ll load into <code>pandas</code>.</p>
<div class="cell" data-execution_count="95">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">3</span>):</span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"</span><span class="sc">{</span>i<span class="sc">:03}</span><span class="ss"> | </span><span class="sc">{</span>covid_json[<span class="st">'data'</span>][i]<span class="sc">}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>000 | ['row-kzbg.v7my-c3y2', '00000000-0000-0000-0405-CB14DE51DAA7', 0, 1643733903, None, 1643733903, None, '{ }', '2020-02-28T00:00:00', '1', '1']
001 | ['row-jkyx_9u4r-h2yw', '00000000-0000-0000-F806-86D0DBE0E17F', 0, 1643733903, None, 1643733903, None, '{ }', '2020-02-29T00:00:00', '0', '1']
002 | ['row-qifg_4aug-y3ym', '00000000-0000-0000-2DCE-4D1872F9B216', 0, 1643733903, None, 1643733903, None, '{ }', '2020-03-01T00:00:00', '0', '1']</code></pre>
</div>
</div>
<p>Observations: * These look like equal-length records, so maybe <code>data</code> is a table! * But what do each of values in the record mean? Where can we find column headers?</p>
<p>For that, we’ll need the <code>columns</code> key in the metadata dictionary. This returns a list:</p>
<div class="cell" data-execution_count="96">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="bu">type</span>(covid_json[<span class="st">'meta'</span>][<span class="st">'view'</span>][<span class="st">'columns'</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="96">
<pre><code>list</code></pre>
</div>
</div>
</section>
<section id="summary-of-exploring-the-json-file" class="level6">
<h6 class="anchored" data-anchor-id="summary-of-exploring-the-json-file">Summary of exploring the JSON file</h6>
<ol type="1">
<li>The above <strong>metadata</strong> tells us a lot about the columns in the data including column names, potential data anomalies, and a basic statistic.</li>
<li>Because of its non-tabular structure, JSON makes it easier (than CSV) to create <strong>self-documenting data</strong>, meaning that information about the data is stored in the same file as the data.</li>
<li>Self-documenting data can be helpful since it maintains its own description and these descriptions are more likely to be updated as data changes.</li>
</ol>
</section>
<section id="loading-covid-data-into-pandas" class="level6">
<h6 class="anchored" data-anchor-id="loading-covid-data-into-pandas">Loading COVID Data into <code>pandas</code></h6>
<p>Finally, let’s load the data (not the metadata) into a <code>pandas</code> <code>DataFrame</code>. In the following block of code we:</p>
<ol type="1">
<li><p>Translate the JSON records into a <code>DataFrame</code>:</p>
<ul>
<li>fields: <code>covid_json['meta']['view']['columns']</code></li>
<li>records: <code>covid_json['data']</code></li>
</ul></li>
<li><p>Remove columns that have no metadata description. This would be a bad idea in general, but here we remove these columns since the above analysis suggests they are unlikely to contain useful information.</p></li>
<li><p>Examine the <code>tail</code> of the table.</p></li>
</ol>
<div class="cell" data-execution_count="97">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Load the data from JSON and assign column titles</span></span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>covid <span class="op">=</span> pd.DataFrame(</span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a>    covid_json[<span class="st">'data'</span>],</span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a>    columns<span class="op">=</span>[c[<span class="st">'name'</span>] <span class="cf">for</span> c <span class="kw">in</span> covid_json[<span class="st">'meta'</span>][<span class="st">'view'</span>][<span class="st">'columns'</span>]])</span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a>covid.tail()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="97">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">sid</th>
<th data-quarto-table-cell-role="th">id</th>
<th data-quarto-table-cell-role="th">position</th>
<th data-quarto-table-cell-role="th">created_at</th>
<th data-quarto-table-cell-role="th">created_meta</th>
<th data-quarto-table-cell-role="th">updated_at</th>
<th data-quarto-table-cell-role="th">updated_meta</th>
<th data-quarto-table-cell-role="th">meta</th>
<th data-quarto-table-cell-role="th">Date</th>
<th data-quarto-table-cell-role="th">New Cases</th>
<th data-quarto-table-cell-role="th">Cumulative Cases</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">699</td>
<td>row-49b6_x8zv.gyum</td>
<td>00000000-0000-0000-A18C-9174A6D05774</td>
<td>0</td>
<td>1643733903</td>
<td>None</td>
<td>1643733903</td>
<td>None</td>
<td>{ }</td>
<td>2022-01-27T00:00:00</td>
<td>106</td>
<td>10694</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">700</td>
<td>row-gs55-p5em.y4v9</td>
<td>00000000-0000-0000-F41D-5724AEABB4D6</td>
<td>0</td>
<td>1643733903</td>
<td>None</td>
<td>1643733903</td>
<td>None</td>
<td>{ }</td>
<td>2022-01-28T00:00:00</td>
<td>223</td>
<td>10917</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">701</td>
<td>row-3pyj.tf95-qu67</td>
<td>00000000-0000-0000-BEE3-B0188D2518BD</td>
<td>0</td>
<td>1643733903</td>
<td>None</td>
<td>1643733903</td>
<td>None</td>
<td>{ }</td>
<td>2022-01-29T00:00:00</td>
<td>139</td>
<td>11056</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">702</td>
<td>row-cgnd.8syv.jvjn</td>
<td>00000000-0000-0000-C318-63CF75F7F740</td>
<td>0</td>
<td>1643733903</td>
<td>None</td>
<td>1643733903</td>
<td>None</td>
<td>{ }</td>
<td>2022-01-30T00:00:00</td>
<td>33</td>
<td>11089</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">703</td>
<td>row-qywv_24x6-237y</td>
<td>00000000-0000-0000-FE92-9789FED3AA20</td>
<td>0</td>
<td>1643733903</td>
<td>None</td>
<td>1643733903</td>
<td>None</td>
<td>{ }</td>
<td>2022-01-31T00:00:00</td>
<td>42</td>
<td>11131</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
</section>
</section>
</section>
<section id="variable-types" class="level3">
<h3 class="anchored" data-anchor-id="variable-types">Variable Types</h3>
<p>After loading data into a file, it’s a good idea to take the time to understand what pieces of information are encoded in the dataset. In particular, we want to identify what variable types are present in our data. Broadly speaking, we can categorize variables into one of two overarching types.</p>
<p><strong>Quantitative variables</strong> describe some numeric quantity or amount. We can divide quantitative data further into:</p>
<ul>
<li><strong>Continuous quantitative variables</strong>: numeric data that can be measured on a continuous scale to arbitrary precision. Continuous variables do not have a strict set of possible values – they can be recorded to any number of decimal places. For example, weights, GPA, or CO<sub>2</sub> concentrations.</li>
<li><strong>Discrete quantitative variables</strong>: numeric data that can only take on a finite set of possible values. For example, someone’s age or the number of siblings they have.</li>
</ul>
<p><strong>Qualitative variables</strong>, also known as <strong>categorical variables</strong>, describe data that isn’t measuring some quantity or amount. The sub-categories of categorical data are:</p>
<ul>
<li><strong>Ordinal qualitative variables</strong>: categories with ordered levels. Specifically, ordinal variables are those where the difference between levels has no consistent, quantifiable meaning. Some examples include levels of education (high school, undergrad, grad, etc.), income bracket (low, medium, high), or Yelp rating.</li>
<li><strong>Nominal qualitative variables</strong>: categories with no specific order. For example, someone’s political affiliation or Cal ID number.</li>
</ul>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/variable.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">Classification of variable types</figcaption>
</figure>
</div>
<p>Note that many variables don’t sit neatly in just one of these categories. Qualitative variables could have numeric levels, and conversely, quantitative variables could be stored as strings.</p>
</section>
<section id="primary-and-foreign-keys" class="level3">
<h3 class="anchored" data-anchor-id="primary-and-foreign-keys">Primary and Foreign Keys</h3>
<p>Last time, we introduced <code>.merge</code> as the <code>pandas</code> method for joining multiple <code>DataFrame</code>s together. In our discussion of joins, we touched on the idea of using a “key” to determine what rows should be merged from each table. Let’s take a moment to examine this idea more closely.</p>
<p>The <strong>primary key</strong> is the column or set of columns in a table that <em>uniquely</em> determine the values of the remaining columns. It can be thought of as the unique identifier for each individual row in the table. For example, a table of Data 100 students might use each student’s Cal ID as the primary key.</p>
<div class="cell" data-execution_count="98">
<div class="cell-output cell-output-display" data-execution_count="98">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Cal ID</th>
<th data-quarto-table-cell-role="th">Name</th>
<th data-quarto-table-cell-role="th">Major</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>3034619471</td>
<td>Oski</td>
<td>Data Science</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>3035619472</td>
<td>Ollie</td>
<td>Computer Science</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>3025619473</td>
<td>Orrie</td>
<td>Data Science</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>3046789372</td>
<td>Ollie</td>
<td>Economics</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>The <strong>foreign key</strong> is the column or set of columns in a table that reference primary keys in other tables. Knowing a dataset’s foreign keys can be useful when assigning the <code>left_on</code> and <code>right_on</code> parameters of <code>.merge</code>. In the table of office hour tickets below, <code>"Cal ID"</code> is a foreign key referencing the previous table.</p>
<div class="cell" data-execution_count="99">
<div class="cell-output cell-output-display" data-execution_count="99">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">OH Request</th>
<th data-quarto-table-cell-role="th">Cal ID</th>
<th data-quarto-table-cell-role="th">Question</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>1</td>
<td>3034619471</td>
<td>HW 2 Q1</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>2</td>
<td>3035619472</td>
<td>HW 2 Q3</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>3</td>
<td>3025619473</td>
<td>Lab 3 Q4</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>4</td>
<td>3035619472</td>
<td>HW 2 Q7</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
</section>
<section id="granularity-scope-and-temporality" class="level2">
<h2 class="anchored" data-anchor-id="granularity-scope-and-temporality">Granularity, Scope, and Temporality</h2>
<p>After understanding the structure of the dataset, the next task is to determine what exactly the data represents. We’ll do so by considering the data’s granularity, scope, and temporality.</p>
<section id="granularity" class="level3">
<h3 class="anchored" data-anchor-id="granularity">Granularity</h3>
<p>The <strong>granularity</strong> of a dataset is what a single row represents. You can also think of it as the level of detail included in the data. To determine the data’s granularity, ask: what does each row in the dataset represent? Fine-grained data contains a high level of detail, with a single row representing a small individual unit. For example, each record may represent one person. Coarse-grained data is encoded such that a single row represents a large individual unit – for example, each record may represent a group of people.</p>
</section>
<section id="scope" class="level3">
<h3 class="anchored" data-anchor-id="scope">Scope</h3>
<p>The <strong>scope</strong> of a dataset is the subset of the population covered by the data. If we were investigating student performance in Data Science courses, a dataset with a narrow scope might encompass all students enrolled in Data 100 whereas a dataset with an expansive scope might encompass all students in California.</p>
</section>
<section id="temporality" class="level3">
<h3 class="anchored" data-anchor-id="temporality">Temporality</h3>
<p>The <strong>temporality</strong> of a dataset describes the periodicity over which the data was collected as well as when the data was most recently collected or updated.</p>
<p>Time and date fields of a dataset could represent a few things:</p>
<ol type="1">
<li>when the “event” happened</li>
<li>when the data was collected, or when it was entered into the system</li>
<li>when the data was copied into the database</li>
</ol>
<p>To fully understand the temporality of the data, it also may be necessary to standardize time zones or inspect recurring time-based trends in the data (do patterns recur in 24-hour periods? Over the course of a month? Seasonally?). The convention for standardizing time is the Coordinated Universal Time (UTC), an international time standard measured at 0 degrees latitude that stays consistent throughout the year (no daylight savings). We can represent Berkeley’s time zone, Pacific Standard Time (PST), as UTC-7 (with daylight savings).</p>
<section id="temporality-with-pandas-dt-accessors" class="level4">
<h4 class="anchored" data-anchor-id="temporality-with-pandas-dt-accessors">Temporality with <code>pandas</code>’ <code>dt</code> accessors</h4>
<p>Let’s briefly look at how we can use <code>pandas</code>’ <code>dt</code> accessors to work with dates/times in a dataset using the dataset you’ll see in Lab 3: the Berkeley PD Calls for Service dataset.</p>
<div class="cell" data-execution_count="100">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>calls <span class="op">=</span> pd.read_csv(<span class="st">"data/Berkeley_PD_-_Calls_for_Service.csv"</span>)</span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>calls.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="100">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">CASENO</th>
<th data-quarto-table-cell-role="th">OFFENSE</th>
<th data-quarto-table-cell-role="th">EVENTDT</th>
<th data-quarto-table-cell-role="th">EVENTTM</th>
<th data-quarto-table-cell-role="th">CVLEGEND</th>
<th data-quarto-table-cell-role="th">CVDOW</th>
<th data-quarto-table-cell-role="th">InDbDate</th>
<th data-quarto-table-cell-role="th">Block_Location</th>
<th data-quarto-table-cell-role="th">BLKADDR</th>
<th data-quarto-table-cell-role="th">City</th>
<th data-quarto-table-cell-role="th">State</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>21014296</td>
<td>THEFT MISD. (UNDER $950)</td>
<td>04/01/2021 12:00:00 AM</td>
<td>10:58</td>
<td>LARCENY</td>
<td>4</td>
<td>06/15/2021 12:00:00 AM</td>
<td>Berkeley, CA\n(37.869058, -122.270455)</td>
<td>NaN</td>
<td>Berkeley</td>
<td>CA</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>21014391</td>
<td>THEFT MISD. (UNDER $950)</td>
<td>04/01/2021 12:00:00 AM</td>
<td>10:38</td>
<td>LARCENY</td>
<td>4</td>
<td>06/15/2021 12:00:00 AM</td>
<td>Berkeley, CA\n(37.869058, -122.270455)</td>
<td>NaN</td>
<td>Berkeley</td>
<td>CA</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>21090494</td>
<td>THEFT MISD. (UNDER $950)</td>
<td>04/19/2021 12:00:00 AM</td>
<td>12:15</td>
<td>LARCENY</td>
<td>1</td>
<td>06/15/2021 12:00:00 AM</td>
<td>2100 BLOCK HASTE ST\nBerkeley, CA\n(37.864908,...</td>
<td>2100 BLOCK HASTE ST</td>
<td>Berkeley</td>
<td>CA</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>21090204</td>
<td>THEFT FELONY (OVER $950)</td>
<td>02/13/2021 12:00:00 AM</td>
<td>17:00</td>
<td>LARCENY</td>
<td>6</td>
<td>06/15/2021 12:00:00 AM</td>
<td>2600 BLOCK WARRING ST\nBerkeley, CA\n(37.86393...</td>
<td>2600 BLOCK WARRING ST</td>
<td>Berkeley</td>
<td>CA</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>21090179</td>
<td>BURGLARY AUTO</td>
<td>02/08/2021 12:00:00 AM</td>
<td>6:20</td>
<td>BURGLARY - VEHICLE</td>
<td>1</td>
<td>06/15/2021 12:00:00 AM</td>
<td>2700 BLOCK GARBER ST\nBerkeley, CA\n(37.86066,...</td>
<td>2700 BLOCK GARBER ST</td>
<td>Berkeley</td>
<td>CA</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>Looks like there are three columns with dates/times: <code>EVENTDT</code>, <code>EVENTTM</code>, and <code>InDbDate</code>.</p>
<p>Most likely, <code>EVENTDT</code> stands for the date when the event took place, <code>EVENTTM</code> stands for the time of day the event took place (in 24-hr format), and <code>InDbDate</code> is the date this call is recorded onto the database.</p>
<p>If we check the data type of these columns, we will see they are stored as strings. We can convert them to <code>datetime</code> objects using pandas <code>to_datetime</code> function.</p>
<div class="cell" data-execution_count="101">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>calls[<span class="st">"EVENTDT"</span>] <span class="op">=</span> pd.to_datetime(calls[<span class="st">"EVENTDT"</span>])</span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>calls.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="101">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">CASENO</th>
<th data-quarto-table-cell-role="th">OFFENSE</th>
<th data-quarto-table-cell-role="th">EVENTDT</th>
<th data-quarto-table-cell-role="th">EVENTTM</th>
<th data-quarto-table-cell-role="th">CVLEGEND</th>
<th data-quarto-table-cell-role="th">CVDOW</th>
<th data-quarto-table-cell-role="th">InDbDate</th>
<th data-quarto-table-cell-role="th">Block_Location</th>
<th data-quarto-table-cell-role="th">BLKADDR</th>
<th data-quarto-table-cell-role="th">City</th>
<th data-quarto-table-cell-role="th">State</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>21014296</td>
<td>THEFT MISD. (UNDER $950)</td>
<td>2021-04-01</td>
<td>10:58</td>
<td>LARCENY</td>
<td>4</td>
<td>06/15/2021 12:00:00 AM</td>
<td>Berkeley, CA\n(37.869058, -122.270455)</td>
<td>NaN</td>
<td>Berkeley</td>
<td>CA</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>21014391</td>
<td>THEFT MISD. (UNDER $950)</td>
<td>2021-04-01</td>
<td>10:38</td>
<td>LARCENY</td>
<td>4</td>
<td>06/15/2021 12:00:00 AM</td>
<td>Berkeley, CA\n(37.869058, -122.270455)</td>
<td>NaN</td>
<td>Berkeley</td>
<td>CA</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>21090494</td>
<td>THEFT MISD. (UNDER $950)</td>
<td>2021-04-19</td>
<td>12:15</td>
<td>LARCENY</td>
<td>1</td>
<td>06/15/2021 12:00:00 AM</td>
<td>2100 BLOCK HASTE ST\nBerkeley, CA\n(37.864908,...</td>
<td>2100 BLOCK HASTE ST</td>
<td>Berkeley</td>
<td>CA</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>21090204</td>
<td>THEFT FELONY (OVER $950)</td>
<td>2021-02-13</td>
<td>17:00</td>
<td>LARCENY</td>
<td>6</td>
<td>06/15/2021 12:00:00 AM</td>
<td>2600 BLOCK WARRING ST\nBerkeley, CA\n(37.86393...</td>
<td>2600 BLOCK WARRING ST</td>
<td>Berkeley</td>
<td>CA</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>21090179</td>
<td>BURGLARY AUTO</td>
<td>2021-02-08</td>
<td>6:20</td>
<td>BURGLARY - VEHICLE</td>
<td>1</td>
<td>06/15/2021 12:00:00 AM</td>
<td>2700 BLOCK GARBER ST\nBerkeley, CA\n(37.86066,...</td>
<td>2700 BLOCK GARBER ST</td>
<td>Berkeley</td>
<td>CA</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>Now, we can use the <code>dt</code> accessor on this column.</p>
<p>We can get the month:</p>
<div class="cell" data-execution_count="102">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>calls[<span class="st">"EVENTDT"</span>].dt.month.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="102">
<pre><code>0    4
1    4
2    4
3    2
4    2
Name: EVENTDT, dtype: int64</code></pre>
</div>
</div>
<p>Which day of the week the date is on:</p>
<div class="cell" data-execution_count="103">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a>calls[<span class="st">"EVENTDT"</span>].dt.dayofweek.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="103">
<pre><code>0    3
1    3
2    0
3    5
4    0
Name: EVENTDT, dtype: int64</code></pre>
</div>
</div>
<p>Check the mimimum values to see if there are any suspicious-looking, 70s dates:</p>
<div class="cell" data-execution_count="104">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a>calls.sort_values(<span class="st">"EVENTDT"</span>).head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="104">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">CASENO</th>
<th data-quarto-table-cell-role="th">OFFENSE</th>
<th data-quarto-table-cell-role="th">EVENTDT</th>
<th data-quarto-table-cell-role="th">EVENTTM</th>
<th data-quarto-table-cell-role="th">CVLEGEND</th>
<th data-quarto-table-cell-role="th">CVDOW</th>
<th data-quarto-table-cell-role="th">InDbDate</th>
<th data-quarto-table-cell-role="th">Block_Location</th>
<th data-quarto-table-cell-role="th">BLKADDR</th>
<th data-quarto-table-cell-role="th">City</th>
<th data-quarto-table-cell-role="th">State</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">2513</td>
<td>20057398</td>
<td>BURGLARY COMMERCIAL</td>
<td>2020-12-17</td>
<td>16:05</td>
<td>BURGLARY - COMMERCIAL</td>
<td>4</td>
<td>06/15/2021 12:00:00 AM</td>
<td>600 BLOCK GILMAN ST\nBerkeley, CA\n(37.878405,...</td>
<td>600 BLOCK GILMAN ST</td>
<td>Berkeley</td>
<td>CA</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">624</td>
<td>20057207</td>
<td>ASSAULT/BATTERY MISD.</td>
<td>2020-12-17</td>
<td>16:50</td>
<td>ASSAULT</td>
<td>4</td>
<td>06/15/2021 12:00:00 AM</td>
<td>2100 BLOCK SHATTUCK AVE\nBerkeley, CA\n(37.871...</td>
<td>2100 BLOCK SHATTUCK AVE</td>
<td>Berkeley</td>
<td>CA</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">154</td>
<td>20092214</td>
<td>THEFT FROM AUTO</td>
<td>2020-12-17</td>
<td>18:30</td>
<td>LARCENY - FROM VEHICLE</td>
<td>4</td>
<td>06/15/2021 12:00:00 AM</td>
<td>800 BLOCK SHATTUCK AVE\nBerkeley, CA\n(37.8918...</td>
<td>800 BLOCK SHATTUCK AVE</td>
<td>Berkeley</td>
<td>CA</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">659</td>
<td>20057324</td>
<td>THEFT MISD. (UNDER $950)</td>
<td>2020-12-17</td>
<td>15:44</td>
<td>LARCENY</td>
<td>4</td>
<td>06/15/2021 12:00:00 AM</td>
<td>1800 BLOCK 4TH ST\nBerkeley, CA\n(37.869888, -...</td>
<td>1800 BLOCK 4TH ST</td>
<td>Berkeley</td>
<td>CA</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">993</td>
<td>20057573</td>
<td>BURGLARY RESIDENTIAL</td>
<td>2020-12-17</td>
<td>22:15</td>
<td>BURGLARY - RESIDENTIAL</td>
<td>4</td>
<td>06/15/2021 12:00:00 AM</td>
<td>1700 BLOCK STUART ST\nBerkeley, CA\n(37.857495...</td>
<td>1700 BLOCK STUART ST</td>
<td>Berkeley</td>
<td>CA</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>Doesn’t look like it! We are good!</p>
<p>We can also do many things with the <code>dt</code> accessor like switching time zones and converting time back to UNIX/POSIX time. Check out the documentation on <a href="https://pandas.pydata.org/docs/user_guide/basics.html#basics-dt-accessors"><code>.dt</code> accessor</a> and <a href="https://pandas.pydata.org/docs/user_guide/timeseries.html#">time series/date functionality</a>.</p>
</section>
</section>
</section>
<section id="faithfulness" class="level2">
<h2 class="anchored" data-anchor-id="faithfulness">Faithfulness</h2>
<p>At this stage in our data cleaning and EDA workflow, we’ve achieved quite a lot: we’ve identified how our data is structured, come to terms with what information it encodes, and gained insight as to how it was generated. Throughout this process, we should always recall the original intent of our work in Data Science – to use data to better understand and model the real world. To achieve this goal, we need to ensure that the data we use is faithful to reality; that is, that our data accurately captures the “real world.”</p>
<p>Data used in research or industry is often “messy” – there may be errors or inaccuracies that impact the faithfulness of the dataset. Signs that data may not be faithful include:</p>
<ul>
<li>Unrealistic or “incorrect” values, such as negative counts, locations that don’t exist, or dates set in the future</li>
<li>Violations of obvious dependencies, like an age that does not match a birthday</li>
<li>Clear signs that data was entered by hand, which can lead to spelling errors or fields that are incorrectly shifted</li>
<li>Signs of data falsification, such as fake email addresses or repeated use of the same names</li>
<li>Duplicated records or fields containing the same information</li>
<li>Truncated data, e.g.&nbsp;Microsoft Excel would limit the number of rows to 655536 and the number of columns to 255</li>
</ul>
<p>We often solve some of these more common issues in the following ways:</p>
<ul>
<li>Spelling errors: apply corrections or drop records that aren’t in a dictionary</li>
<li>Time zone inconsistencies: convert to a common time zone (e.g.&nbsp;UTC)</li>
<li>Duplicated records or fields: identify and eliminate duplicates (using primary keys)</li>
<li>Unspecified or inconsistent units: infer the units and check that values are in reasonable ranges in the data</li>
</ul>
<section id="missing-values" class="level3">
<h3 class="anchored" data-anchor-id="missing-values">Missing Values</h3>
<p>Another common issue encountered with real-world datasets is that of missing data. One strategy to resolve this is to simply drop any records with missing values from the dataset. This does, however, introduce the risk of inducing biases – it is possible that the missing or corrupt records may be systemically related to some feature of interest in the data. Another solution is to keep the data as <code>NaN</code> values.</p>
<p>A third method to address missing data is to perform <strong>imputation</strong>: infer the missing values using other data available in the dataset. There is a wide variety of imputation techniques that can be implemented; some of the most common are listed below.</p>
<ul>
<li>Average imputation: replace missing values with the average value for that field</li>
<li>Hot deck imputation: replace missing values with some random value</li>
<li>Regression imputation: develop a model to predict missing values</li>
<li>Multiple imputation: replace missing values with multiple random values</li>
</ul>
<p>Regardless of the strategy used to deal with missing data, we should think carefully about <em>why</em> particular records or fields may be missing – this can help inform whether or not the absence of these values is significant or meaningful.</p>
</section>
</section>
<section id="eda-demo-1-tuberculosis-in-the-united-states" class="level1">
<h1>EDA Demo 1: Tuberculosis in the United States</h1>
<p>Now, let’s walk through the data-cleaning and EDA workflow to see what can we learn about the presence of Tuberculosis in the United States!</p>
<p>We will examine the data included in the <a href="https://www.cdc.gov/mmwr/volumes/71/wr/mm7112a1.htm?s_cid=mm7112a1_w#T1_down">original CDC article</a> published in 2021.</p>
<section id="csvs-and-field-names" class="level2">
<h2 class="anchored" data-anchor-id="csvs-and-field-names">CSVs and Field Names</h2>
<p>Suppose Table 1 was saved as a CSV file located in <code>data/cdc_tuberculosis.csv</code>.</p>
<p>We can then explore the CSV (which is a text file, and does not contain binary-encoded data) in many ways: 1. Using a text editor like emacs, vim, VSCode, etc. 2. Opening the CSV directly in DataHub (read-only), Excel, Google Sheets, etc. 3. The <code>Python</code> file object 4. <code>pandas</code>, using <code>pd.read_csv()</code></p>
<p>To try out options 1 and 2, you can view or download the Tuberculosis from the <a href="https://data100.datahub.berkeley.edu/hub/user-redirect/git-pull?repo=https%3A%2F%2Fgithub.com%2FDS-100%2Ffa23-student&amp;urlpath=lab%2Ftree%2Ffa23-student%2Flecture%2Flec05%2Flec04-eda.ipynb&amp;branch=main">lecture demo notebook</a> under the <code>data</code> folder in the left hand menu. Notice how the CSV file is a type of <strong>rectangular data (i.e., tabular data) stored as comma-separated values</strong>.</p>
<p>Next, let’s try out option 3 using the <code>Python</code> file object. We’ll look at the first four lines:</p>
<div class="cell" data-execution_count="105">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> <span class="bu">open</span>(<span class="st">"data/cdc_tuberculosis.csv"</span>, <span class="st">"r"</span>) <span class="im">as</span> f:</span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a>    i <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> row <span class="kw">in</span> f:</span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(row)</span>
<span id="cb46-5"><a href="#cb46-5" aria-hidden="true" tabindex="-1"></a>        i <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb46-6"><a href="#cb46-6" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> i <span class="op">&gt;</span> <span class="dv">3</span>:</span>
<span id="cb46-7"><a href="#cb46-7" aria-hidden="true" tabindex="-1"></a>            <span class="cf">break</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>,No. of TB cases,,,TB incidence,,

U.S. jurisdiction,2019,2020,2021,2019,2020,2021

Total,"8,900","7,173","7,860",2.71,2.16,2.37

Alabama,87,72,92,1.77,1.43,1.83
</code></pre>
</div>
</div>
<p>Whoa, why are there blank lines interspaced between the lines of the CSV?</p>
<p>You may recall that all line breaks in text files are encoded as the special newline character <code>\n</code>. Python’s <code>print()</code> prints each string (including the newline), and an additional newline on top of that.</p>
<p>If you’re curious, we can use the <code>repr()</code> function to return the raw string with all special characters:</p>
<div class="cell" data-execution_count="106">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> <span class="bu">open</span>(<span class="st">"data/cdc_tuberculosis.csv"</span>, <span class="st">"r"</span>) <span class="im">as</span> f:</span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a>    i <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> row <span class="kw">in</span> f:</span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="bu">repr</span>(row)) <span class="co"># print raw strings</span></span>
<span id="cb48-5"><a href="#cb48-5" aria-hidden="true" tabindex="-1"></a>        i <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb48-6"><a href="#cb48-6" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> i <span class="op">&gt;</span> <span class="dv">3</span>:</span>
<span id="cb48-7"><a href="#cb48-7" aria-hidden="true" tabindex="-1"></a>            <span class="cf">break</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>',No. of TB cases,,,TB incidence,,\n'
'U.S. jurisdiction,2019,2020,2021,2019,2020,2021\n'
'Total,"8,900","7,173","7,860",2.71,2.16,2.37\n'
'Alabama,87,72,92,1.77,1.43,1.83\n'</code></pre>
</div>
</div>
<p>Finally, let’s try option 4 and use the tried-and-true Data 100 approach: <code>pandas</code>.</p>
<div class="cell" data-execution_count="107">
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a>tb_df <span class="op">=</span> pd.read_csv(<span class="st">"data/cdc_tuberculosis.csv"</span>)</span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a>tb_df.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="107">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Unnamed: 0</th>
<th data-quarto-table-cell-role="th">No. of TB cases</th>
<th data-quarto-table-cell-role="th">Unnamed: 2</th>
<th data-quarto-table-cell-role="th">Unnamed: 3</th>
<th data-quarto-table-cell-role="th">TB incidence</th>
<th data-quarto-table-cell-role="th">Unnamed: 5</th>
<th data-quarto-table-cell-role="th">Unnamed: 6</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>U.S. jurisdiction</td>
<td>2019</td>
<td>2020</td>
<td>2021</td>
<td>2019.00</td>
<td>2020.00</td>
<td>2021.00</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>Total</td>
<td>8,900</td>
<td>7,173</td>
<td>7,860</td>
<td>2.71</td>
<td>2.16</td>
<td>2.37</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>Alabama</td>
<td>87</td>
<td>72</td>
<td>92</td>
<td>1.77</td>
<td>1.43</td>
<td>1.83</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>Alaska</td>
<td>58</td>
<td>58</td>
<td>58</td>
<td>7.91</td>
<td>7.92</td>
<td>7.92</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>Arizona</td>
<td>183</td>
<td>136</td>
<td>129</td>
<td>2.51</td>
<td>1.89</td>
<td>1.77</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>You may notice some strange things about this table: what’s up with the “Unnamed” column names and the first row?</p>
<p>Congratulations — you’re ready to wrangle your data! Because of how things are stored, we’ll need to clean the data a bit to name our columns better.</p>
<p>A reasonable first step is to identify the row with the right header. The <code>pd.read_csv()</code> function (<a href="https://pandas.pydata.org/docs/reference/api/pandas.read_csv.html">documentation</a>) has the convenient <code>header</code> parameter that we can set to use the elements in row 1 as the appropriate columns:</p>
<div class="cell" data-execution_count="108">
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a>tb_df <span class="op">=</span> pd.read_csv(<span class="st">"data/cdc_tuberculosis.csv"</span>, header<span class="op">=</span><span class="dv">1</span>) <span class="co"># row index</span></span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a>tb_df.head(<span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="108">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">U.S. jurisdiction</th>
<th data-quarto-table-cell-role="th">2019</th>
<th data-quarto-table-cell-role="th">2020</th>
<th data-quarto-table-cell-role="th">2021</th>
<th data-quarto-table-cell-role="th">2019.1</th>
<th data-quarto-table-cell-role="th">2020.1</th>
<th data-quarto-table-cell-role="th">2021.1</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>Total</td>
<td>8,900</td>
<td>7,173</td>
<td>7,860</td>
<td>2.71</td>
<td>2.16</td>
<td>2.37</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>Alabama</td>
<td>87</td>
<td>72</td>
<td>92</td>
<td>1.77</td>
<td>1.43</td>
<td>1.83</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>Alaska</td>
<td>58</td>
<td>58</td>
<td>58</td>
<td>7.91</td>
<td>7.92</td>
<td>7.92</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>Arizona</td>
<td>183</td>
<td>136</td>
<td>129</td>
<td>2.51</td>
<td>1.89</td>
<td>1.77</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>Arkansas</td>
<td>64</td>
<td>59</td>
<td>69</td>
<td>2.12</td>
<td>1.96</td>
<td>2.28</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>Wait…but now we can’t differentiate betwen the “Number of TB cases” and “TB incidence” year columns. <code>pandas</code> has tried to make our lives easier by automatically adding “.1” to the latter columns, but this doesn’t help us, as humans, understand the data.</p>
<p>We can do this manually with <code>df.rename()</code> (<a href="https://pandas.pydata.org/docs/reference/api/pandas.DataFrame.rename.html?highlight=rename#pandas.DataFrame.rename">documentation</a>):</p>
<div class="cell" data-execution_count="109">
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a>rename_dict <span class="op">=</span> {<span class="st">'2019'</span>: <span class="st">'TB cases 2019'</span>,</span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a>               <span class="st">'2020'</span>: <span class="st">'TB cases 2020'</span>,</span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a>               <span class="st">'2021'</span>: <span class="st">'TB cases 2021'</span>,</span>
<span id="cb52-4"><a href="#cb52-4" aria-hidden="true" tabindex="-1"></a>               <span class="st">'2019.1'</span>: <span class="st">'TB incidence 2019'</span>,</span>
<span id="cb52-5"><a href="#cb52-5" aria-hidden="true" tabindex="-1"></a>               <span class="st">'2020.1'</span>: <span class="st">'TB incidence 2020'</span>,</span>
<span id="cb52-6"><a href="#cb52-6" aria-hidden="true" tabindex="-1"></a>               <span class="st">'2021.1'</span>: <span class="st">'TB incidence 2021'</span>}</span>
<span id="cb52-7"><a href="#cb52-7" aria-hidden="true" tabindex="-1"></a>tb_df <span class="op">=</span> tb_df.rename(columns<span class="op">=</span>rename_dict)</span>
<span id="cb52-8"><a href="#cb52-8" aria-hidden="true" tabindex="-1"></a>tb_df.head(<span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="109">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">U.S. jurisdiction</th>
<th data-quarto-table-cell-role="th">TB cases 2019</th>
<th data-quarto-table-cell-role="th">TB cases 2020</th>
<th data-quarto-table-cell-role="th">TB cases 2021</th>
<th data-quarto-table-cell-role="th">TB incidence 2019</th>
<th data-quarto-table-cell-role="th">TB incidence 2020</th>
<th data-quarto-table-cell-role="th">TB incidence 2021</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>Total</td>
<td>8,900</td>
<td>7,173</td>
<td>7,860</td>
<td>2.71</td>
<td>2.16</td>
<td>2.37</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>Alabama</td>
<td>87</td>
<td>72</td>
<td>92</td>
<td>1.77</td>
<td>1.43</td>
<td>1.83</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>Alaska</td>
<td>58</td>
<td>58</td>
<td>58</td>
<td>7.91</td>
<td>7.92</td>
<td>7.92</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>Arizona</td>
<td>183</td>
<td>136</td>
<td>129</td>
<td>2.51</td>
<td>1.89</td>
<td>1.77</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>Arkansas</td>
<td>64</td>
<td>59</td>
<td>69</td>
<td>2.12</td>
<td>1.96</td>
<td>2.28</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
<section id="record-granularity" class="level2">
<h2 class="anchored" data-anchor-id="record-granularity">Record Granularity</h2>
<p>You might already be wondering: what’s up with that first record?</p>
<p>Row 0 is what we call a <strong>rollup record</strong>, or summary record. It’s often useful when displaying tables to humans. The <strong>granularity</strong> of record 0 (Totals) vs the rest of the records (States) is different.</p>
<p>Okay, EDA step two. How was the rollup record aggregated?</p>
<p>Let’s check if Total TB cases is the sum of all state TB cases. If we sum over all rows, we should get <strong>2x</strong> the total cases in each of our TB cases by year (why do you think this is?).</p>
<div class="cell" data-execution_count="110">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a>tb_df.<span class="bu">sum</span>(axis<span class="op">=</span><span class="dv">0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="110">
<pre><code>U.S. jurisdiction    TotalAlabamaAlaskaArizonaArkansasCaliforniaCol...
TB cases 2019        8,9008758183642,111666718245583029973261085237...
TB cases 2020        7,1737258136591,706525417194122219282169239376...
TB cases 2021        7,8609258129691,750585443194992281064255127494...
TB incidence 2019                                               109.94
TB incidence 2020                                                93.09
TB incidence 2021                                               102.94
dtype: object</code></pre>
</div>
</div>
<p>Whoa, what’s going on with the TB cases in 2019, 2020, and 2021? Check out the column types:</p>
<div class="cell" data-execution_count="111">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a>tb_df.dtypes</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="111">
<pre><code>U.S. jurisdiction     object
TB cases 2019         object
TB cases 2020         object
TB cases 2021         object
TB incidence 2019    float64
TB incidence 2020    float64
TB incidence 2021    float64
dtype: object</code></pre>
</div>
</div>
<p>Since there are commas in the values for TB cases, the numbers are read as the <code>object</code> datatype, or <strong>storage type</strong> (close to the <code>Python</code> string datatype), so <code>pandas</code> is concatenating strings instead of adding integers (recall that <code>Python</code> can “sum”, or concatenate, strings together: <code>"data" + "100"</code> evaluates to <code>"data100"</code>).</p>
<p>Fortunately <code>read_csv</code> also has a <code>thousands</code> parameter (<a href="https://pandas.pydata.org/docs/reference/api/pandas.read_csv.html">documentation</a>):</p>
<div class="cell" data-execution_count="112">
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a><span class="co"># improve readability: chaining method calls with outer parentheses/line breaks</span></span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a>tb_df <span class="op">=</span> (</span>
<span id="cb57-3"><a href="#cb57-3" aria-hidden="true" tabindex="-1"></a>    pd.read_csv(<span class="st">"data/cdc_tuberculosis.csv"</span>, header<span class="op">=</span><span class="dv">1</span>, thousands<span class="op">=</span><span class="st">','</span>)</span>
<span id="cb57-4"><a href="#cb57-4" aria-hidden="true" tabindex="-1"></a>    .rename(columns<span class="op">=</span>rename_dict)</span>
<span id="cb57-5"><a href="#cb57-5" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb57-6"><a href="#cb57-6" aria-hidden="true" tabindex="-1"></a>tb_df.head(<span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="112">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">U.S. jurisdiction</th>
<th data-quarto-table-cell-role="th">TB cases 2019</th>
<th data-quarto-table-cell-role="th">TB cases 2020</th>
<th data-quarto-table-cell-role="th">TB cases 2021</th>
<th data-quarto-table-cell-role="th">TB incidence 2019</th>
<th data-quarto-table-cell-role="th">TB incidence 2020</th>
<th data-quarto-table-cell-role="th">TB incidence 2021</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>Total</td>
<td>8900</td>
<td>7173</td>
<td>7860</td>
<td>2.71</td>
<td>2.16</td>
<td>2.37</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>Alabama</td>
<td>87</td>
<td>72</td>
<td>92</td>
<td>1.77</td>
<td>1.43</td>
<td>1.83</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>Alaska</td>
<td>58</td>
<td>58</td>
<td>58</td>
<td>7.91</td>
<td>7.92</td>
<td>7.92</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>Arizona</td>
<td>183</td>
<td>136</td>
<td>129</td>
<td>2.51</td>
<td>1.89</td>
<td>1.77</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>Arkansas</td>
<td>64</td>
<td>59</td>
<td>69</td>
<td>2.12</td>
<td>1.96</td>
<td>2.28</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div class="cell" data-execution_count="113">
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a>tb_df.<span class="bu">sum</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="113">
<pre><code>U.S. jurisdiction    TotalAlabamaAlaskaArizonaArkansasCaliforniaCol...
TB cases 2019                                                    17800
TB cases 2020                                                    14346
TB cases 2021                                                    15720
TB incidence 2019                                               109.94
TB incidence 2020                                                93.09
TB incidence 2021                                               102.94
dtype: object</code></pre>
</div>
</div>
<p>The Total TB cases look right. Phew!</p>
<p>Let’s just look at the records with <strong>state-level granularity</strong>:</p>
<div class="cell" data-execution_count="114">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a>state_tb_df <span class="op">=</span> tb_df[<span class="dv">1</span>:]</span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a>state_tb_df.head(<span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="114">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">U.S. jurisdiction</th>
<th data-quarto-table-cell-role="th">TB cases 2019</th>
<th data-quarto-table-cell-role="th">TB cases 2020</th>
<th data-quarto-table-cell-role="th">TB cases 2021</th>
<th data-quarto-table-cell-role="th">TB incidence 2019</th>
<th data-quarto-table-cell-role="th">TB incidence 2020</th>
<th data-quarto-table-cell-role="th">TB incidence 2021</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">1</td>
<td>Alabama</td>
<td>87</td>
<td>72</td>
<td>92</td>
<td>1.77</td>
<td>1.43</td>
<td>1.83</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2</td>
<td>Alaska</td>
<td>58</td>
<td>58</td>
<td>58</td>
<td>7.91</td>
<td>7.92</td>
<td>7.92</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">3</td>
<td>Arizona</td>
<td>183</td>
<td>136</td>
<td>129</td>
<td>2.51</td>
<td>1.89</td>
<td>1.77</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">4</td>
<td>Arkansas</td>
<td>64</td>
<td>59</td>
<td>69</td>
<td>2.12</td>
<td>1.96</td>
<td>2.28</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">5</td>
<td>California</td>
<td>2111</td>
<td>1706</td>
<td>1750</td>
<td>5.35</td>
<td>4.32</td>
<td>4.46</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
<section id="gather-census-data" class="level2">
<h2 class="anchored" data-anchor-id="gather-census-data">Gather Census Data</h2>
<p>U.S. Census population estimates <a href="https://www.census.gov/data/tables/time-series/demo/popest/2010s-state-total.html">source</a> (2019), <a href="https://www.census.gov/data/tables/time-series/demo/popest/2020s-state-total.html">source</a> (2020-2021).</p>
<p>Running the below cells cleans the data. There are a few new methods here: * <code>df.convert_dtypes()</code> (<a href="https://pandas.pydata.org/docs/reference/api/pandas.DataFrame.convert_dtypes.html">documentation</a>) conveniently converts all float dtypes into ints and is out of scope for the class. * <code>df.drop_na()</code> (<a href="https://pandas.pydata.org/docs/reference/api/pandas.DataFrame.dropna.html">documentation</a>) will be explained in more detail next time.</p>
<div class="cell" data-execution_count="115">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 2010s census data</span></span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a>census_2010s_df <span class="op">=</span> pd.read_csv(<span class="st">"data/nst-est2019-01.csv"</span>, header<span class="op">=</span><span class="dv">3</span>, thousands<span class="op">=</span><span class="st">","</span>)</span>
<span id="cb61-3"><a href="#cb61-3" aria-hidden="true" tabindex="-1"></a>census_2010s_df <span class="op">=</span> (</span>
<span id="cb61-4"><a href="#cb61-4" aria-hidden="true" tabindex="-1"></a>    census_2010s_df</span>
<span id="cb61-5"><a href="#cb61-5" aria-hidden="true" tabindex="-1"></a>    .reset_index()</span>
<span id="cb61-6"><a href="#cb61-6" aria-hidden="true" tabindex="-1"></a>    .drop(columns<span class="op">=</span>[<span class="st">"index"</span>, <span class="st">"Census"</span>, <span class="st">"Estimates Base"</span>])</span>
<span id="cb61-7"><a href="#cb61-7" aria-hidden="true" tabindex="-1"></a>    .rename(columns<span class="op">=</span>{<span class="st">"Unnamed: 0"</span>: <span class="st">"Geographic Area"</span>})</span>
<span id="cb61-8"><a href="#cb61-8" aria-hidden="true" tabindex="-1"></a>    .convert_dtypes()                 <span class="co"># "smart" converting of columns, use at your own risk</span></span>
<span id="cb61-9"><a href="#cb61-9" aria-hidden="true" tabindex="-1"></a>    .dropna()                         <span class="co"># we'll introduce this next time</span></span>
<span id="cb61-10"><a href="#cb61-10" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb61-11"><a href="#cb61-11" aria-hidden="true" tabindex="-1"></a>census_2010s_df[<span class="st">'Geographic Area'</span>] <span class="op">=</span> census_2010s_df[<span class="st">'Geographic Area'</span>].<span class="bu">str</span>.strip(<span class="st">'.'</span>)</span>
<span id="cb61-12"><a href="#cb61-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-13"><a href="#cb61-13" aria-hidden="true" tabindex="-1"></a><span class="co"># with pd.option_context('display.min_rows', 30): # shows more rows</span></span>
<span id="cb61-14"><a href="#cb61-14" aria-hidden="true" tabindex="-1"></a><span class="co">#     display(census_2010s_df)</span></span>
<span id="cb61-15"><a href="#cb61-15" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb61-16"><a href="#cb61-16" aria-hidden="true" tabindex="-1"></a>census_2010s_df.head(<span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="115">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Geographic Area</th>
<th data-quarto-table-cell-role="th">2010</th>
<th data-quarto-table-cell-role="th">2011</th>
<th data-quarto-table-cell-role="th">2012</th>
<th data-quarto-table-cell-role="th">2013</th>
<th data-quarto-table-cell-role="th">2014</th>
<th data-quarto-table-cell-role="th">2015</th>
<th data-quarto-table-cell-role="th">2016</th>
<th data-quarto-table-cell-role="th">2017</th>
<th data-quarto-table-cell-role="th">2018</th>
<th data-quarto-table-cell-role="th">2019</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>United States</td>
<td>309321666</td>
<td>311556874</td>
<td>313830990</td>
<td>315993715</td>
<td>318301008</td>
<td>320635163</td>
<td>322941311</td>
<td>324985539</td>
<td>326687501</td>
<td>328239523</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>Northeast</td>
<td>55380134</td>
<td>55604223</td>
<td>55775216</td>
<td>55901806</td>
<td>56006011</td>
<td>56034684</td>
<td>56042330</td>
<td>56059240</td>
<td>56046620</td>
<td>55982803</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>Midwest</td>
<td>66974416</td>
<td>67157800</td>
<td>67336743</td>
<td>67560379</td>
<td>67745167</td>
<td>67860583</td>
<td>67987540</td>
<td>68126781</td>
<td>68236628</td>
<td>68329004</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>South</td>
<td>114866680</td>
<td>116006522</td>
<td>117241208</td>
<td>118364400</td>
<td>119624037</td>
<td>120997341</td>
<td>122351760</td>
<td>123542189</td>
<td>124569433</td>
<td>125580448</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>West</td>
<td>72100436</td>
<td>72788329</td>
<td>73477823</td>
<td>74167130</td>
<td>74925793</td>
<td>75742555</td>
<td>76559681</td>
<td>77257329</td>
<td>77834820</td>
<td>78347268</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>Occasionally, you will want to modify code that you have imported. To reimport those modifications you can either use <code>python</code>’s <code>importlib</code> library:</p>
<div class="sourceCode" id="cb62"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> importlib <span class="im">import</span> <span class="bu">reload</span></span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a><span class="bu">reload</span>(utils)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>or use <code>iPython</code> magic which will intelligently import code when files change:</p>
<div class="sourceCode" id="cb63"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a><span class="op">%</span>load_ext autoreload</span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true" tabindex="-1"></a><span class="op">%</span>autoreload <span class="dv">2</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell" data-execution_count="116">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a><span class="co"># census 2020s data</span></span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a>census_2020s_df <span class="op">=</span> pd.read_csv(<span class="st">"data/NST-EST2022-POP.csv"</span>, header<span class="op">=</span><span class="dv">3</span>, thousands<span class="op">=</span><span class="st">","</span>)</span>
<span id="cb64-3"><a href="#cb64-3" aria-hidden="true" tabindex="-1"></a>census_2020s_df <span class="op">=</span> (</span>
<span id="cb64-4"><a href="#cb64-4" aria-hidden="true" tabindex="-1"></a>    census_2020s_df</span>
<span id="cb64-5"><a href="#cb64-5" aria-hidden="true" tabindex="-1"></a>    .reset_index()</span>
<span id="cb64-6"><a href="#cb64-6" aria-hidden="true" tabindex="-1"></a>    .drop(columns<span class="op">=</span>[<span class="st">"index"</span>, <span class="st">"Unnamed: 1"</span>])</span>
<span id="cb64-7"><a href="#cb64-7" aria-hidden="true" tabindex="-1"></a>    .rename(columns<span class="op">=</span>{<span class="st">"Unnamed: 0"</span>: <span class="st">"Geographic Area"</span>})</span>
<span id="cb64-8"><a href="#cb64-8" aria-hidden="true" tabindex="-1"></a>    .convert_dtypes()                 <span class="co"># "smart" converting of columns, use at your own risk</span></span>
<span id="cb64-9"><a href="#cb64-9" aria-hidden="true" tabindex="-1"></a>    .dropna()                         <span class="co"># we'll introduce this next time</span></span>
<span id="cb64-10"><a href="#cb64-10" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb64-11"><a href="#cb64-11" aria-hidden="true" tabindex="-1"></a>census_2020s_df[<span class="st">'Geographic Area'</span>] <span class="op">=</span> census_2020s_df[<span class="st">'Geographic Area'</span>].<span class="bu">str</span>.strip(<span class="st">'.'</span>)</span>
<span id="cb64-12"><a href="#cb64-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-13"><a href="#cb64-13" aria-hidden="true" tabindex="-1"></a>census_2020s_df.head(<span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="116">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Geographic Area</th>
<th data-quarto-table-cell-role="th">2020</th>
<th data-quarto-table-cell-role="th">2021</th>
<th data-quarto-table-cell-role="th">2022</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>United States</td>
<td>331511512</td>
<td>332031554</td>
<td>333287557</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>Northeast</td>
<td>57448898</td>
<td>57259257</td>
<td>57040406</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>Midwest</td>
<td>68961043</td>
<td>68836505</td>
<td>68787595</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>South</td>
<td>126450613</td>
<td>127346029</td>
<td>128716192</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>West</td>
<td>78650958</td>
<td>78589763</td>
<td>78743364</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
<section id="joining-data-merging-dataframes" class="level2">
<h2 class="anchored" data-anchor-id="joining-data-merging-dataframes">Joining Data (Merging <code>DataFrame</code>s)</h2>
<p>Time to <code>merge</code>! Here we use the <code>DataFrame</code> method <code>df1.merge(right=df2, ...)</code> on <code>DataFrame</code> <code>df1</code> (<a href="https://pandas.pydata.org/docs/reference/api/pandas.DataFrame.merge.html">documentation</a>). Contrast this with the function <code>pd.merge(left=df1, right=df2, ...)</code> (<a href="https://pandas.pydata.org/docs/reference/api/pandas.merge.html?highlight=pandas%20merge#pandas.merge">documentation</a>). Feel free to use either.</p>
<div class="cell" data-execution_count="117">
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a><span class="co"># merge TB DataFrame with two US census DataFrames</span></span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true" tabindex="-1"></a>tb_census_df <span class="op">=</span> (</span>
<span id="cb65-3"><a href="#cb65-3" aria-hidden="true" tabindex="-1"></a>    tb_df</span>
<span id="cb65-4"><a href="#cb65-4" aria-hidden="true" tabindex="-1"></a>    .merge(right<span class="op">=</span>census_2010s_df,</span>
<span id="cb65-5"><a href="#cb65-5" aria-hidden="true" tabindex="-1"></a>           left_on<span class="op">=</span><span class="st">"U.S. jurisdiction"</span>, right_on<span class="op">=</span><span class="st">"Geographic Area"</span>)</span>
<span id="cb65-6"><a href="#cb65-6" aria-hidden="true" tabindex="-1"></a>    .merge(right<span class="op">=</span>census_2020s_df,</span>
<span id="cb65-7"><a href="#cb65-7" aria-hidden="true" tabindex="-1"></a>           left_on<span class="op">=</span><span class="st">"U.S. jurisdiction"</span>, right_on<span class="op">=</span><span class="st">"Geographic Area"</span>)</span>
<span id="cb65-8"><a href="#cb65-8" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb65-9"><a href="#cb65-9" aria-hidden="true" tabindex="-1"></a>tb_census_df.head(<span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="117">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">U.S. jurisdiction</th>
<th data-quarto-table-cell-role="th">TB cases 2019</th>
<th data-quarto-table-cell-role="th">TB cases 2020</th>
<th data-quarto-table-cell-role="th">TB cases 2021</th>
<th data-quarto-table-cell-role="th">TB incidence 2019</th>
<th data-quarto-table-cell-role="th">TB incidence 2020</th>
<th data-quarto-table-cell-role="th">TB incidence 2021</th>
<th data-quarto-table-cell-role="th">Geographic Area_x</th>
<th data-quarto-table-cell-role="th">2010</th>
<th data-quarto-table-cell-role="th">2011</th>
<th data-quarto-table-cell-role="th">2012</th>
<th data-quarto-table-cell-role="th">2013</th>
<th data-quarto-table-cell-role="th">2014</th>
<th data-quarto-table-cell-role="th">2015</th>
<th data-quarto-table-cell-role="th">2016</th>
<th data-quarto-table-cell-role="th">2017</th>
<th data-quarto-table-cell-role="th">2018</th>
<th data-quarto-table-cell-role="th">2019</th>
<th data-quarto-table-cell-role="th">Geographic Area_y</th>
<th data-quarto-table-cell-role="th">2020</th>
<th data-quarto-table-cell-role="th">2021</th>
<th data-quarto-table-cell-role="th">2022</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>Alabama</td>
<td>87</td>
<td>72</td>
<td>92</td>
<td>1.77</td>
<td>1.43</td>
<td>1.83</td>
<td>Alabama</td>
<td>4785437</td>
<td>4799069</td>
<td>4815588</td>
<td>4830081</td>
<td>4841799</td>
<td>4852347</td>
<td>4863525</td>
<td>4874486</td>
<td>4887681</td>
<td>4903185</td>
<td>Alabama</td>
<td>5031362</td>
<td>5049846</td>
<td>5074296</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>Alaska</td>
<td>58</td>
<td>58</td>
<td>58</td>
<td>7.91</td>
<td>7.92</td>
<td>7.92</td>
<td>Alaska</td>
<td>713910</td>
<td>722128</td>
<td>730443</td>
<td>737068</td>
<td>736283</td>
<td>737498</td>
<td>741456</td>
<td>739700</td>
<td>735139</td>
<td>731545</td>
<td>Alaska</td>
<td>732923</td>
<td>734182</td>
<td>733583</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>Arizona</td>
<td>183</td>
<td>136</td>
<td>129</td>
<td>2.51</td>
<td>1.89</td>
<td>1.77</td>
<td>Arizona</td>
<td>6407172</td>
<td>6472643</td>
<td>6554978</td>
<td>6632764</td>
<td>6730413</td>
<td>6829676</td>
<td>6941072</td>
<td>7044008</td>
<td>7158024</td>
<td>7278717</td>
<td>Arizona</td>
<td>7179943</td>
<td>7264877</td>
<td>7359197</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>Arkansas</td>
<td>64</td>
<td>59</td>
<td>69</td>
<td>2.12</td>
<td>1.96</td>
<td>2.28</td>
<td>Arkansas</td>
<td>2921964</td>
<td>2940667</td>
<td>2952164</td>
<td>2959400</td>
<td>2967392</td>
<td>2978048</td>
<td>2989918</td>
<td>3001345</td>
<td>3009733</td>
<td>3017804</td>
<td>Arkansas</td>
<td>3014195</td>
<td>3028122</td>
<td>3045637</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>California</td>
<td>2111</td>
<td>1706</td>
<td>1750</td>
<td>5.35</td>
<td>4.32</td>
<td>4.46</td>
<td>California</td>
<td>37319502</td>
<td>37638369</td>
<td>37948800</td>
<td>38260787</td>
<td>38596972</td>
<td>38918045</td>
<td>39167117</td>
<td>39358497</td>
<td>39461588</td>
<td>39512223</td>
<td>California</td>
<td>39501653</td>
<td>39142991</td>
<td>39029342</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>Having all of these columns is a little unwieldy. We could either drop the unneeded columns now, or just merge on smaller census <code>DataFrame</code>s. Let’s do the latter.</p>
<div class="cell" data-execution_count="118">
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a><span class="co"># try merging again, but cleaner this time</span></span>
<span id="cb66-2"><a href="#cb66-2" aria-hidden="true" tabindex="-1"></a>tb_census_df <span class="op">=</span> (</span>
<span id="cb66-3"><a href="#cb66-3" aria-hidden="true" tabindex="-1"></a>    tb_df</span>
<span id="cb66-4"><a href="#cb66-4" aria-hidden="true" tabindex="-1"></a>    .merge(right<span class="op">=</span>census_2010s_df[[<span class="st">"Geographic Area"</span>, <span class="st">"2019"</span>]],</span>
<span id="cb66-5"><a href="#cb66-5" aria-hidden="true" tabindex="-1"></a>           left_on<span class="op">=</span><span class="st">"U.S. jurisdiction"</span>, right_on<span class="op">=</span><span class="st">"Geographic Area"</span>)</span>
<span id="cb66-6"><a href="#cb66-6" aria-hidden="true" tabindex="-1"></a>    .drop(columns<span class="op">=</span><span class="st">"Geographic Area"</span>)</span>
<span id="cb66-7"><a href="#cb66-7" aria-hidden="true" tabindex="-1"></a>    .merge(right<span class="op">=</span>census_2020s_df[[<span class="st">"Geographic Area"</span>, <span class="st">"2020"</span>, <span class="st">"2021"</span>]],</span>
<span id="cb66-8"><a href="#cb66-8" aria-hidden="true" tabindex="-1"></a>           left_on<span class="op">=</span><span class="st">"U.S. jurisdiction"</span>, right_on<span class="op">=</span><span class="st">"Geographic Area"</span>)</span>
<span id="cb66-9"><a href="#cb66-9" aria-hidden="true" tabindex="-1"></a>    .drop(columns<span class="op">=</span><span class="st">"Geographic Area"</span>)</span>
<span id="cb66-10"><a href="#cb66-10" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb66-11"><a href="#cb66-11" aria-hidden="true" tabindex="-1"></a>tb_census_df.head(<span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="118">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">U.S. jurisdiction</th>
<th data-quarto-table-cell-role="th">TB cases 2019</th>
<th data-quarto-table-cell-role="th">TB cases 2020</th>
<th data-quarto-table-cell-role="th">TB cases 2021</th>
<th data-quarto-table-cell-role="th">TB incidence 2019</th>
<th data-quarto-table-cell-role="th">TB incidence 2020</th>
<th data-quarto-table-cell-role="th">TB incidence 2021</th>
<th data-quarto-table-cell-role="th">2019</th>
<th data-quarto-table-cell-role="th">2020</th>
<th data-quarto-table-cell-role="th">2021</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>Alabama</td>
<td>87</td>
<td>72</td>
<td>92</td>
<td>1.77</td>
<td>1.43</td>
<td>1.83</td>
<td>4903185</td>
<td>5031362</td>
<td>5049846</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>Alaska</td>
<td>58</td>
<td>58</td>
<td>58</td>
<td>7.91</td>
<td>7.92</td>
<td>7.92</td>
<td>731545</td>
<td>732923</td>
<td>734182</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>Arizona</td>
<td>183</td>
<td>136</td>
<td>129</td>
<td>2.51</td>
<td>1.89</td>
<td>1.77</td>
<td>7278717</td>
<td>7179943</td>
<td>7264877</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>Arkansas</td>
<td>64</td>
<td>59</td>
<td>69</td>
<td>2.12</td>
<td>1.96</td>
<td>2.28</td>
<td>3017804</td>
<td>3014195</td>
<td>3028122</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>California</td>
<td>2111</td>
<td>1706</td>
<td>1750</td>
<td>5.35</td>
<td>4.32</td>
<td>4.46</td>
<td>39512223</td>
<td>39501653</td>
<td>39142991</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
<section id="reproducing-data-compute-incidence" class="level2">
<h2 class="anchored" data-anchor-id="reproducing-data-compute-incidence">Reproducing Data: Compute Incidence</h2>
<p>Let’s recompute incidence to make sure we know where the original CDC numbers came from.</p>
<p>From the <a href="https://www.cdc.gov/mmwr/volumes/71/wr/mm7112a1.htm?s_cid=mm7112a1_w#T1_down">CDC report</a>: TB incidence is computed as “Cases per 100,000 persons using mid-year population estimates from the U.S. Census Bureau.”</p>
<p>If we define a group as 100,000 people, then we can compute the TB incidence for a given state population as</p>
<p><span class="math display">\[\text{TB incidence} = \frac{\text{TB cases in population}}{\text{groups in population}} = \frac{\text{TB cases in population}}{\text{population}/100000} \]</span></p>
<p><span class="math display">\[= \frac{\text{TB cases in population}}{\text{population}} \times 100000\]</span></p>
<p>Let’s try this for 2019:</p>
<div class="cell" data-execution_count="119">
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a>tb_census_df[<span class="st">"recompute incidence 2019"</span>] <span class="op">=</span> tb_census_df[<span class="st">"TB cases 2019"</span>]<span class="op">/</span>tb_census_df[<span class="st">"2019"</span>]<span class="op">*</span><span class="dv">100000</span></span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true" tabindex="-1"></a>tb_census_df.head(<span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="119">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">U.S. jurisdiction</th>
<th data-quarto-table-cell-role="th">TB cases 2019</th>
<th data-quarto-table-cell-role="th">TB cases 2020</th>
<th data-quarto-table-cell-role="th">TB cases 2021</th>
<th data-quarto-table-cell-role="th">TB incidence 2019</th>
<th data-quarto-table-cell-role="th">TB incidence 2020</th>
<th data-quarto-table-cell-role="th">TB incidence 2021</th>
<th data-quarto-table-cell-role="th">2019</th>
<th data-quarto-table-cell-role="th">2020</th>
<th data-quarto-table-cell-role="th">2021</th>
<th data-quarto-table-cell-role="th">recompute incidence 2019</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>Alabama</td>
<td>87</td>
<td>72</td>
<td>92</td>
<td>1.77</td>
<td>1.43</td>
<td>1.83</td>
<td>4903185</td>
<td>5031362</td>
<td>5049846</td>
<td>1.77</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>Alaska</td>
<td>58</td>
<td>58</td>
<td>58</td>
<td>7.91</td>
<td>7.92</td>
<td>7.92</td>
<td>731545</td>
<td>732923</td>
<td>734182</td>
<td>7.93</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>Arizona</td>
<td>183</td>
<td>136</td>
<td>129</td>
<td>2.51</td>
<td>1.89</td>
<td>1.77</td>
<td>7278717</td>
<td>7179943</td>
<td>7264877</td>
<td>2.51</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>Arkansas</td>
<td>64</td>
<td>59</td>
<td>69</td>
<td>2.12</td>
<td>1.96</td>
<td>2.28</td>
<td>3017804</td>
<td>3014195</td>
<td>3028122</td>
<td>2.12</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>California</td>
<td>2111</td>
<td>1706</td>
<td>1750</td>
<td>5.35</td>
<td>4.32</td>
<td>4.46</td>
<td>39512223</td>
<td>39501653</td>
<td>39142991</td>
<td>5.34</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>Awesome!!!</p>
<p>Let’s use a for-loop and <code>Python</code> format strings to compute TB incidence for all years. <code>Python</code> f-strings are just used for the purposes of this demo, but they’re handy to know when you explore data beyond this course (<a href="https://docs.python.org/3/tutorial/inputoutput.html">documentation</a>).</p>
<div class="cell" data-execution_count="120">
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a><span class="co"># recompute incidence for all years</span></span>
<span id="cb68-2"><a href="#cb68-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> year <span class="kw">in</span> [<span class="dv">2019</span>, <span class="dv">2020</span>, <span class="dv">2021</span>]:</span>
<span id="cb68-3"><a href="#cb68-3" aria-hidden="true" tabindex="-1"></a>    tb_census_df[<span class="ss">f"recompute incidence </span><span class="sc">{</span>year<span class="sc">}</span><span class="ss">"</span>] <span class="op">=</span> tb_census_df[<span class="ss">f"TB cases </span><span class="sc">{</span>year<span class="sc">}</span><span class="ss">"</span>]<span class="op">/</span>tb_census_df[<span class="ss">f"</span><span class="sc">{</span>year<span class="sc">}</span><span class="ss">"</span>]<span class="op">*</span><span class="dv">100000</span></span>
<span id="cb68-4"><a href="#cb68-4" aria-hidden="true" tabindex="-1"></a>tb_census_df.head(<span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="120">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">U.S. jurisdiction</th>
<th data-quarto-table-cell-role="th">TB cases 2019</th>
<th data-quarto-table-cell-role="th">TB cases 2020</th>
<th data-quarto-table-cell-role="th">TB cases 2021</th>
<th data-quarto-table-cell-role="th">TB incidence 2019</th>
<th data-quarto-table-cell-role="th">TB incidence 2020</th>
<th data-quarto-table-cell-role="th">TB incidence 2021</th>
<th data-quarto-table-cell-role="th">2019</th>
<th data-quarto-table-cell-role="th">2020</th>
<th data-quarto-table-cell-role="th">2021</th>
<th data-quarto-table-cell-role="th">recompute incidence 2019</th>
<th data-quarto-table-cell-role="th">recompute incidence 2020</th>
<th data-quarto-table-cell-role="th">recompute incidence 2021</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>Alabama</td>
<td>87</td>
<td>72</td>
<td>92</td>
<td>1.77</td>
<td>1.43</td>
<td>1.83</td>
<td>4903185</td>
<td>5031362</td>
<td>5049846</td>
<td>1.77</td>
<td>1.43</td>
<td>1.82</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>Alaska</td>
<td>58</td>
<td>58</td>
<td>58</td>
<td>7.91</td>
<td>7.92</td>
<td>7.92</td>
<td>731545</td>
<td>732923</td>
<td>734182</td>
<td>7.93</td>
<td>7.91</td>
<td>7.90</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>Arizona</td>
<td>183</td>
<td>136</td>
<td>129</td>
<td>2.51</td>
<td>1.89</td>
<td>1.77</td>
<td>7278717</td>
<td>7179943</td>
<td>7264877</td>
<td>2.51</td>
<td>1.89</td>
<td>1.78</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>Arkansas</td>
<td>64</td>
<td>59</td>
<td>69</td>
<td>2.12</td>
<td>1.96</td>
<td>2.28</td>
<td>3017804</td>
<td>3014195</td>
<td>3028122</td>
<td>2.12</td>
<td>1.96</td>
<td>2.28</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>California</td>
<td>2111</td>
<td>1706</td>
<td>1750</td>
<td>5.35</td>
<td>4.32</td>
<td>4.46</td>
<td>39512223</td>
<td>39501653</td>
<td>39142991</td>
<td>5.34</td>
<td>4.32</td>
<td>4.47</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>These numbers look pretty close!!! There are a few errors in the hundredths place, particularly in 2021. It may be useful to further explore reasons behind this discrepancy.</p>
<div class="cell" data-execution_count="121">
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a>tb_census_df.describe()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="121">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">TB cases 2019</th>
<th data-quarto-table-cell-role="th">TB cases 2020</th>
<th data-quarto-table-cell-role="th">TB cases 2021</th>
<th data-quarto-table-cell-role="th">TB incidence 2019</th>
<th data-quarto-table-cell-role="th">TB incidence 2020</th>
<th data-quarto-table-cell-role="th">TB incidence 2021</th>
<th data-quarto-table-cell-role="th">2019</th>
<th data-quarto-table-cell-role="th">2020</th>
<th data-quarto-table-cell-role="th">2021</th>
<th data-quarto-table-cell-role="th">recompute incidence 2019</th>
<th data-quarto-table-cell-role="th">recompute incidence 2020</th>
<th data-quarto-table-cell-role="th">recompute incidence 2021</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">count</td>
<td>51.00</td>
<td>51.00</td>
<td>51.00</td>
<td>51.00</td>
<td>51.00</td>
<td>51.00</td>
<td>51.00</td>
<td>51.00</td>
<td>51.00</td>
<td>51.00</td>
<td>51.00</td>
<td>51.00</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">mean</td>
<td>174.51</td>
<td>140.65</td>
<td>154.12</td>
<td>2.10</td>
<td>1.78</td>
<td>1.97</td>
<td>6436069.08</td>
<td>6500225.73</td>
<td>6510422.63</td>
<td>2.10</td>
<td>1.78</td>
<td>1.97</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">std</td>
<td>341.74</td>
<td>271.06</td>
<td>286.78</td>
<td>1.50</td>
<td>1.34</td>
<td>1.48</td>
<td>7360660.47</td>
<td>7408168.46</td>
<td>7394300.08</td>
<td>1.50</td>
<td>1.34</td>
<td>1.47</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">min</td>
<td>1.00</td>
<td>0.00</td>
<td>2.00</td>
<td>0.17</td>
<td>0.00</td>
<td>0.21</td>
<td>578759.00</td>
<td>577605.00</td>
<td>579483.00</td>
<td>0.17</td>
<td>0.00</td>
<td>0.21</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">25%</td>
<td>25.50</td>
<td>29.00</td>
<td>23.00</td>
<td>1.29</td>
<td>1.21</td>
<td>1.23</td>
<td>1789606.00</td>
<td>1820311.00</td>
<td>1844920.00</td>
<td>1.30</td>
<td>1.21</td>
<td>1.23</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">50%</td>
<td>70.00</td>
<td>67.00</td>
<td>69.00</td>
<td>1.80</td>
<td>1.52</td>
<td>1.70</td>
<td>4467673.00</td>
<td>4507445.00</td>
<td>4506589.00</td>
<td>1.81</td>
<td>1.52</td>
<td>1.69</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">75%</td>
<td>180.50</td>
<td>139.00</td>
<td>150.00</td>
<td>2.58</td>
<td>1.99</td>
<td>2.22</td>
<td>7446805.00</td>
<td>7451987.00</td>
<td>7502811.00</td>
<td>2.58</td>
<td>1.99</td>
<td>2.22</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">max</td>
<td>2111.00</td>
<td>1706.00</td>
<td>1750.00</td>
<td>7.91</td>
<td>7.92</td>
<td>7.92</td>
<td>39512223.00</td>
<td>39501653.00</td>
<td>39142991.00</td>
<td>7.93</td>
<td>7.91</td>
<td>7.90</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
<section id="bonus-eda-reproducing-the-reported-statistic" class="level2">
<h2 class="anchored" data-anchor-id="bonus-eda-reproducing-the-reported-statistic">Bonus EDA: Reproducing the Reported Statistic</h2>
<p><strong>How do we reproduce that reported statistic in the original <a href="https://www.cdc.gov/mmwr/volumes/71/wr/mm7112a1.htm?s_cid=mm7112a1_w">CDC report</a>?</strong></p>
<blockquote class="blockquote">
<p>Reported TB incidence (cases per 100,000 persons) increased <strong>9.4%</strong>, from <strong>2.2</strong> during 2020 to <strong>2.4</strong> during 2021 but was lower than incidence during 2019 (2.7). Increases occurred among both U.S.-born and non–U.S.-born persons.</p>
</blockquote>
<p>This is TB incidence computed across the entire U.S. population! How do we reproduce this? * We need to reproduce the “Total” TB incidences in our rolled record. * But our current <code>tb_census_df</code> only has 51 entries (50 states plus Washington, D.C.). There is no rolled record. * What happened…?</p>
<p>Let’s get exploring!</p>
<p>Before we keep exploring, we’ll set all indexes to more meaningful values, instead of just numbers that pertain to some row at some point. This will make our cleaning slightly easier.</p>
<div class="cell" data-execution_count="122">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb70"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a>tb_df <span class="op">=</span> tb_df.set_index(<span class="st">"U.S. jurisdiction"</span>)</span>
<span id="cb70-2"><a href="#cb70-2" aria-hidden="true" tabindex="-1"></a>tb_df.head(<span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="122">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">TB cases 2019</th>
<th data-quarto-table-cell-role="th">TB cases 2020</th>
<th data-quarto-table-cell-role="th">TB cases 2021</th>
<th data-quarto-table-cell-role="th">TB incidence 2019</th>
<th data-quarto-table-cell-role="th">TB incidence 2020</th>
<th data-quarto-table-cell-role="th">TB incidence 2021</th>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">U.S. jurisdiction</th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">Total</td>
<td>8900</td>
<td>7173</td>
<td>7860</td>
<td>2.71</td>
<td>2.16</td>
<td>2.37</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Alabama</td>
<td>87</td>
<td>72</td>
<td>92</td>
<td>1.77</td>
<td>1.43</td>
<td>1.83</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Alaska</td>
<td>58</td>
<td>58</td>
<td>58</td>
<td>7.91</td>
<td>7.92</td>
<td>7.92</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Arizona</td>
<td>183</td>
<td>136</td>
<td>129</td>
<td>2.51</td>
<td>1.89</td>
<td>1.77</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Arkansas</td>
<td>64</td>
<td>59</td>
<td>69</td>
<td>2.12</td>
<td>1.96</td>
<td>2.28</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div class="cell" data-execution_count="123">
<div class="sourceCode cell-code" id="cb71"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a>census_2010s_df <span class="op">=</span> census_2010s_df.set_index(<span class="st">"Geographic Area"</span>)</span>
<span id="cb71-2"><a href="#cb71-2" aria-hidden="true" tabindex="-1"></a>census_2010s_df.head(<span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="123">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">2010</th>
<th data-quarto-table-cell-role="th">2011</th>
<th data-quarto-table-cell-role="th">2012</th>
<th data-quarto-table-cell-role="th">2013</th>
<th data-quarto-table-cell-role="th">2014</th>
<th data-quarto-table-cell-role="th">2015</th>
<th data-quarto-table-cell-role="th">2016</th>
<th data-quarto-table-cell-role="th">2017</th>
<th data-quarto-table-cell-role="th">2018</th>
<th data-quarto-table-cell-role="th">2019</th>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">Geographic Area</th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">United States</td>
<td>309321666</td>
<td>311556874</td>
<td>313830990</td>
<td>315993715</td>
<td>318301008</td>
<td>320635163</td>
<td>322941311</td>
<td>324985539</td>
<td>326687501</td>
<td>328239523</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Northeast</td>
<td>55380134</td>
<td>55604223</td>
<td>55775216</td>
<td>55901806</td>
<td>56006011</td>
<td>56034684</td>
<td>56042330</td>
<td>56059240</td>
<td>56046620</td>
<td>55982803</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Midwest</td>
<td>66974416</td>
<td>67157800</td>
<td>67336743</td>
<td>67560379</td>
<td>67745167</td>
<td>67860583</td>
<td>67987540</td>
<td>68126781</td>
<td>68236628</td>
<td>68329004</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">South</td>
<td>114866680</td>
<td>116006522</td>
<td>117241208</td>
<td>118364400</td>
<td>119624037</td>
<td>120997341</td>
<td>122351760</td>
<td>123542189</td>
<td>124569433</td>
<td>125580448</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">West</td>
<td>72100436</td>
<td>72788329</td>
<td>73477823</td>
<td>74167130</td>
<td>74925793</td>
<td>75742555</td>
<td>76559681</td>
<td>77257329</td>
<td>77834820</td>
<td>78347268</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div class="cell" data-execution_count="124">
<div class="sourceCode cell-code" id="cb72"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a>census_2020s_df <span class="op">=</span> census_2020s_df.set_index(<span class="st">"Geographic Area"</span>)</span>
<span id="cb72-2"><a href="#cb72-2" aria-hidden="true" tabindex="-1"></a>census_2020s_df.head(<span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="124">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">2020</th>
<th data-quarto-table-cell-role="th">2021</th>
<th data-quarto-table-cell-role="th">2022</th>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">Geographic Area</th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">United States</td>
<td>331511512</td>
<td>332031554</td>
<td>333287557</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Northeast</td>
<td>57448898</td>
<td>57259257</td>
<td>57040406</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Midwest</td>
<td>68961043</td>
<td>68836505</td>
<td>68787595</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">South</td>
<td>126450613</td>
<td>127346029</td>
<td>128716192</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">West</td>
<td>78650958</td>
<td>78589763</td>
<td>78743364</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>It turns out that our merge above only kept state records, even though our original <code>tb_df</code> had the “Total” rolled record:</p>
<div class="cell" data-execution_count="125">
<div class="sourceCode cell-code" id="cb73"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a>tb_df.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="125">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">TB cases 2019</th>
<th data-quarto-table-cell-role="th">TB cases 2020</th>
<th data-quarto-table-cell-role="th">TB cases 2021</th>
<th data-quarto-table-cell-role="th">TB incidence 2019</th>
<th data-quarto-table-cell-role="th">TB incidence 2020</th>
<th data-quarto-table-cell-role="th">TB incidence 2021</th>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">U.S. jurisdiction</th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">Total</td>
<td>8900</td>
<td>7173</td>
<td>7860</td>
<td>2.71</td>
<td>2.16</td>
<td>2.37</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Alabama</td>
<td>87</td>
<td>72</td>
<td>92</td>
<td>1.77</td>
<td>1.43</td>
<td>1.83</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Alaska</td>
<td>58</td>
<td>58</td>
<td>58</td>
<td>7.91</td>
<td>7.92</td>
<td>7.92</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Arizona</td>
<td>183</td>
<td>136</td>
<td>129</td>
<td>2.51</td>
<td>1.89</td>
<td>1.77</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Arkansas</td>
<td>64</td>
<td>59</td>
<td>69</td>
<td>2.12</td>
<td>1.96</td>
<td>2.28</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>Recall that <code>merge</code> by default does an <strong>inner</strong> merge by default, meaning that it only preserves keys that are present in <strong>both</strong> <code>DataFrame</code>s.</p>
<p>The rolled records in our census <code>DataFrame</code> have different <code>Geographic Area</code> fields, which was the key we merged on:</p>
<div class="cell" data-execution_count="126">
<div class="sourceCode cell-code" id="cb74"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a>census_2010s_df.head(<span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="126">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">2010</th>
<th data-quarto-table-cell-role="th">2011</th>
<th data-quarto-table-cell-role="th">2012</th>
<th data-quarto-table-cell-role="th">2013</th>
<th data-quarto-table-cell-role="th">2014</th>
<th data-quarto-table-cell-role="th">2015</th>
<th data-quarto-table-cell-role="th">2016</th>
<th data-quarto-table-cell-role="th">2017</th>
<th data-quarto-table-cell-role="th">2018</th>
<th data-quarto-table-cell-role="th">2019</th>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">Geographic Area</th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">United States</td>
<td>309321666</td>
<td>311556874</td>
<td>313830990</td>
<td>315993715</td>
<td>318301008</td>
<td>320635163</td>
<td>322941311</td>
<td>324985539</td>
<td>326687501</td>
<td>328239523</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Northeast</td>
<td>55380134</td>
<td>55604223</td>
<td>55775216</td>
<td>55901806</td>
<td>56006011</td>
<td>56034684</td>
<td>56042330</td>
<td>56059240</td>
<td>56046620</td>
<td>55982803</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Midwest</td>
<td>66974416</td>
<td>67157800</td>
<td>67336743</td>
<td>67560379</td>
<td>67745167</td>
<td>67860583</td>
<td>67987540</td>
<td>68126781</td>
<td>68236628</td>
<td>68329004</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">South</td>
<td>114866680</td>
<td>116006522</td>
<td>117241208</td>
<td>118364400</td>
<td>119624037</td>
<td>120997341</td>
<td>122351760</td>
<td>123542189</td>
<td>124569433</td>
<td>125580448</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">West</td>
<td>72100436</td>
<td>72788329</td>
<td>73477823</td>
<td>74167130</td>
<td>74925793</td>
<td>75742555</td>
<td>76559681</td>
<td>77257329</td>
<td>77834820</td>
<td>78347268</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>The Census <code>DataFrame</code> has several rolled records. The aggregate record we are looking for actually has the Geographic Area named “United States”.</p>
<p>One straightforward way to get the right merge is to rename the value itself. Because we now have the Geographic Area index, we’ll use <code>df.rename()</code> (<a href="https://pandas.pydata.org/docs/reference/api/pandas.DataFrame.rename.html">documentation</a>):</p>
<div class="cell" data-execution_count="127">
<div class="sourceCode cell-code" id="cb75"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a><span class="co"># rename rolled record for 2010s</span></span>
<span id="cb75-2"><a href="#cb75-2" aria-hidden="true" tabindex="-1"></a>census_2010s_df.rename(index<span class="op">=</span>{<span class="st">'United States'</span>:<span class="st">'Total'</span>}, inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb75-3"><a href="#cb75-3" aria-hidden="true" tabindex="-1"></a>census_2010s_df.head(<span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="127">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">2010</th>
<th data-quarto-table-cell-role="th">2011</th>
<th data-quarto-table-cell-role="th">2012</th>
<th data-quarto-table-cell-role="th">2013</th>
<th data-quarto-table-cell-role="th">2014</th>
<th data-quarto-table-cell-role="th">2015</th>
<th data-quarto-table-cell-role="th">2016</th>
<th data-quarto-table-cell-role="th">2017</th>
<th data-quarto-table-cell-role="th">2018</th>
<th data-quarto-table-cell-role="th">2019</th>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">Geographic Area</th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">Total</td>
<td>309321666</td>
<td>311556874</td>
<td>313830990</td>
<td>315993715</td>
<td>318301008</td>
<td>320635163</td>
<td>322941311</td>
<td>324985539</td>
<td>326687501</td>
<td>328239523</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Northeast</td>
<td>55380134</td>
<td>55604223</td>
<td>55775216</td>
<td>55901806</td>
<td>56006011</td>
<td>56034684</td>
<td>56042330</td>
<td>56059240</td>
<td>56046620</td>
<td>55982803</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Midwest</td>
<td>66974416</td>
<td>67157800</td>
<td>67336743</td>
<td>67560379</td>
<td>67745167</td>
<td>67860583</td>
<td>67987540</td>
<td>68126781</td>
<td>68236628</td>
<td>68329004</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">South</td>
<td>114866680</td>
<td>116006522</td>
<td>117241208</td>
<td>118364400</td>
<td>119624037</td>
<td>120997341</td>
<td>122351760</td>
<td>123542189</td>
<td>124569433</td>
<td>125580448</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">West</td>
<td>72100436</td>
<td>72788329</td>
<td>73477823</td>
<td>74167130</td>
<td>74925793</td>
<td>75742555</td>
<td>76559681</td>
<td>77257329</td>
<td>77834820</td>
<td>78347268</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div class="cell" data-execution_count="128">
<div class="sourceCode cell-code" id="cb76"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a><span class="co"># same, but for 2020s rename rolled record</span></span>
<span id="cb76-2"><a href="#cb76-2" aria-hidden="true" tabindex="-1"></a>census_2020s_df.rename(index<span class="op">=</span>{<span class="st">'United States'</span>:<span class="st">'Total'</span>}, inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb76-3"><a href="#cb76-3" aria-hidden="true" tabindex="-1"></a>census_2020s_df.head(<span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="128">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">2020</th>
<th data-quarto-table-cell-role="th">2021</th>
<th data-quarto-table-cell-role="th">2022</th>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">Geographic Area</th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">Total</td>
<td>331511512</td>
<td>332031554</td>
<td>333287557</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Northeast</td>
<td>57448898</td>
<td>57259257</td>
<td>57040406</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Midwest</td>
<td>68961043</td>
<td>68836505</td>
<td>68787595</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">South</td>
<td>126450613</td>
<td>127346029</td>
<td>128716192</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">West</td>
<td>78650958</td>
<td>78589763</td>
<td>78743364</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p><br></p>
<p>Next let’s rerun our merge. Note the different chaining, because we are now merging on indexes (<code>df.merge()</code> <a href="https://pandas.pydata.org/docs/reference/api/pandas.DataFrame.merge.html">documentation</a>).</p>
<div class="cell" data-execution_count="129">
<div class="sourceCode cell-code" id="cb77"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a>tb_census_df <span class="op">=</span> (</span>
<span id="cb77-2"><a href="#cb77-2" aria-hidden="true" tabindex="-1"></a>    tb_df</span>
<span id="cb77-3"><a href="#cb77-3" aria-hidden="true" tabindex="-1"></a>    .merge(right<span class="op">=</span>census_2010s_df[[<span class="st">"2019"</span>]],</span>
<span id="cb77-4"><a href="#cb77-4" aria-hidden="true" tabindex="-1"></a>           left_index<span class="op">=</span><span class="va">True</span>, right_index<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb77-5"><a href="#cb77-5" aria-hidden="true" tabindex="-1"></a>    .merge(right<span class="op">=</span>census_2020s_df[[<span class="st">"2020"</span>, <span class="st">"2021"</span>]],</span>
<span id="cb77-6"><a href="#cb77-6" aria-hidden="true" tabindex="-1"></a>           left_index<span class="op">=</span><span class="va">True</span>, right_index<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb77-7"><a href="#cb77-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb77-8"><a href="#cb77-8" aria-hidden="true" tabindex="-1"></a>tb_census_df.head(<span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="129">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">TB cases 2019</th>
<th data-quarto-table-cell-role="th">TB cases 2020</th>
<th data-quarto-table-cell-role="th">TB cases 2021</th>
<th data-quarto-table-cell-role="th">TB incidence 2019</th>
<th data-quarto-table-cell-role="th">TB incidence 2020</th>
<th data-quarto-table-cell-role="th">TB incidence 2021</th>
<th data-quarto-table-cell-role="th">2019</th>
<th data-quarto-table-cell-role="th">2020</th>
<th data-quarto-table-cell-role="th">2021</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">Total</td>
<td>8900</td>
<td>7173</td>
<td>7860</td>
<td>2.71</td>
<td>2.16</td>
<td>2.37</td>
<td>328239523</td>
<td>331511512</td>
<td>332031554</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Alabama</td>
<td>87</td>
<td>72</td>
<td>92</td>
<td>1.77</td>
<td>1.43</td>
<td>1.83</td>
<td>4903185</td>
<td>5031362</td>
<td>5049846</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Alaska</td>
<td>58</td>
<td>58</td>
<td>58</td>
<td>7.91</td>
<td>7.92</td>
<td>7.92</td>
<td>731545</td>
<td>732923</td>
<td>734182</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Arizona</td>
<td>183</td>
<td>136</td>
<td>129</td>
<td>2.51</td>
<td>1.89</td>
<td>1.77</td>
<td>7278717</td>
<td>7179943</td>
<td>7264877</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Arkansas</td>
<td>64</td>
<td>59</td>
<td>69</td>
<td>2.12</td>
<td>1.96</td>
<td>2.28</td>
<td>3017804</td>
<td>3014195</td>
<td>3028122</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p><br></p>
<p>Finally, let’s recompute our incidences:</p>
<div class="cell" data-execution_count="130">
<div class="sourceCode cell-code" id="cb78"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a><span class="co"># recompute incidence for all years</span></span>
<span id="cb78-2"><a href="#cb78-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> year <span class="kw">in</span> [<span class="dv">2019</span>, <span class="dv">2020</span>, <span class="dv">2021</span>]:</span>
<span id="cb78-3"><a href="#cb78-3" aria-hidden="true" tabindex="-1"></a>    tb_census_df[<span class="ss">f"recompute incidence </span><span class="sc">{</span>year<span class="sc">}</span><span class="ss">"</span>] <span class="op">=</span> tb_census_df[<span class="ss">f"TB cases </span><span class="sc">{</span>year<span class="sc">}</span><span class="ss">"</span>]<span class="op">/</span>tb_census_df[<span class="ss">f"</span><span class="sc">{</span>year<span class="sc">}</span><span class="ss">"</span>]<span class="op">*</span><span class="dv">100000</span></span>
<span id="cb78-4"><a href="#cb78-4" aria-hidden="true" tabindex="-1"></a>tb_census_df.head(<span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="130">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">TB cases 2019</th>
<th data-quarto-table-cell-role="th">TB cases 2020</th>
<th data-quarto-table-cell-role="th">TB cases 2021</th>
<th data-quarto-table-cell-role="th">TB incidence 2019</th>
<th data-quarto-table-cell-role="th">TB incidence 2020</th>
<th data-quarto-table-cell-role="th">TB incidence 2021</th>
<th data-quarto-table-cell-role="th">2019</th>
<th data-quarto-table-cell-role="th">2020</th>
<th data-quarto-table-cell-role="th">2021</th>
<th data-quarto-table-cell-role="th">recompute incidence 2019</th>
<th data-quarto-table-cell-role="th">recompute incidence 2020</th>
<th data-quarto-table-cell-role="th">recompute incidence 2021</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">Total</td>
<td>8900</td>
<td>7173</td>
<td>7860</td>
<td>2.71</td>
<td>2.16</td>
<td>2.37</td>
<td>328239523</td>
<td>331511512</td>
<td>332031554</td>
<td>2.71</td>
<td>2.16</td>
<td>2.37</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Alabama</td>
<td>87</td>
<td>72</td>
<td>92</td>
<td>1.77</td>
<td>1.43</td>
<td>1.83</td>
<td>4903185</td>
<td>5031362</td>
<td>5049846</td>
<td>1.77</td>
<td>1.43</td>
<td>1.82</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Alaska</td>
<td>58</td>
<td>58</td>
<td>58</td>
<td>7.91</td>
<td>7.92</td>
<td>7.92</td>
<td>731545</td>
<td>732923</td>
<td>734182</td>
<td>7.93</td>
<td>7.91</td>
<td>7.90</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Arizona</td>
<td>183</td>
<td>136</td>
<td>129</td>
<td>2.51</td>
<td>1.89</td>
<td>1.77</td>
<td>7278717</td>
<td>7179943</td>
<td>7264877</td>
<td>2.51</td>
<td>1.89</td>
<td>1.78</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Arkansas</td>
<td>64</td>
<td>59</td>
<td>69</td>
<td>2.12</td>
<td>1.96</td>
<td>2.28</td>
<td>3017804</td>
<td>3014195</td>
<td>3028122</td>
<td>2.12</td>
<td>1.96</td>
<td>2.28</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>We reproduced the total U.S. incidences correctly!</p>
<p>We’re almost there. Let’s revisit the quote:</p>
<blockquote class="blockquote">
<p>Reported TB incidence (cases per 100,000 persons) increased <strong>9.4%</strong>, from <strong>2.2</strong> during 2020 to <strong>2.4</strong> during 2021 but was lower than incidence during 2019 (2.7). Increases occurred among both U.S.-born and non–U.S.-born persons.</p>
</blockquote>
<p>Recall that percent change from <span class="math inline">\(A\)</span> to <span class="math inline">\(B\)</span> is computed as <span class="math inline">\(\text{percent change} = \frac{B - A}{A} \times 100\)</span>.</p>
<div class="cell" data-tags="[]" data-execution_count="131">
<div class="sourceCode cell-code" id="cb79"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a>incidence_2020 <span class="op">=</span> tb_census_df.loc[<span class="st">'Total'</span>, <span class="st">'recompute incidence 2020'</span>]</span>
<span id="cb79-2"><a href="#cb79-2" aria-hidden="true" tabindex="-1"></a>incidence_2020</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="131">
<pre><code>2.1637257652759883</code></pre>
</div>
</div>
<div class="cell" data-tags="[]" data-execution_count="132">
<div class="sourceCode cell-code" id="cb81"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a>incidence_2021 <span class="op">=</span> tb_census_df.loc[<span class="st">'Total'</span>, <span class="st">'recompute incidence 2021'</span>]</span>
<span id="cb81-2"><a href="#cb81-2" aria-hidden="true" tabindex="-1"></a>incidence_2021</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="132">
<pre><code>2.3672448914298068</code></pre>
</div>
</div>
<div class="cell" data-tags="[]" data-execution_count="133">
<div class="sourceCode cell-code" id="cb83"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb83-1"><a href="#cb83-1" aria-hidden="true" tabindex="-1"></a>difference <span class="op">=</span> (incidence_2021 <span class="op">-</span> incidence_2020)<span class="op">/</span>incidence_2020 <span class="op">*</span> <span class="dv">100</span></span>
<span id="cb83-2"><a href="#cb83-2" aria-hidden="true" tabindex="-1"></a>difference</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="133">
<pre><code>9.405957511804143</code></pre>
</div>
</div>
</section>
</section>
<section id="eda-demo-2-mauna-loa-co2-data-a-lesson-in-data-faithfulness" class="level1">
<h1>EDA Demo 2: Mauna Loa CO<sub>2</sub> Data – A Lesson in Data Faithfulness</h1>
<p><a href="https://gml.noaa.gov/ccgg/trends/data.html">Mauna Loa Observatory</a> has been monitoring CO<sub>2</sub> concentrations since 1958</p>
<div class="cell" data-execution_count="134">
<div class="sourceCode cell-code" id="cb85"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb85-1"><a href="#cb85-1" aria-hidden="true" tabindex="-1"></a>co2_file <span class="op">=</span> <span class="st">"data/co2_mm_mlo.txt"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Let’s do some <strong>EDA</strong>!!</p>
<section id="reading-this-file-into-pandas" class="level2">
<h2 class="anchored" data-anchor-id="reading-this-file-into-pandas">Reading this file into Pandas?</h2>
<p>Let’s instead check out this <code>.txt</code> file. Some questions to keep in mind: Do we trust this file extension? What structure is it?</p>
<p>Lines 71-78 (inclusive) are shown below:</p>
<pre><code>line number |                            file contents

71          |   #            decimal     average   interpolated    trend    #days
72          |   #             date                             (season corr)
73          |   1958   3    1958.208      315.71      315.71      314.62     -1
74          |   1958   4    1958.292      317.45      317.45      315.29     -1
75          |   1958   5    1958.375      317.50      317.50      314.71     -1
76          |   1958   6    1958.458      -99.99      317.10      314.85     -1
77          |   1958   7    1958.542      315.86      315.86      314.98     -1
78          |   1958   8    1958.625      314.93      314.93      315.94     -1</code></pre>
<p>Notice how:</p>
<ul>
<li>The values are separated by white space, possibly tabs.</li>
<li>The data line up down the rows. For example, the month appears in 7th to 8th position of each line.</li>
<li>The 71st and 72nd lines in the file contain column headings split over two lines.</li>
</ul>
<p>We can use&nbsp;<code>read_csv</code>&nbsp;to read the data into a <code>pandas</code> <code>DataFrame</code>, and we provide several arguments to specify that the separators are white space, there is no header (<strong>we will set our own column names</strong>), and to skip the first 72 rows of the file.</p>
<div class="cell" data-execution_count="135">
<div class="sourceCode cell-code" id="cb87"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb87-1"><a href="#cb87-1" aria-hidden="true" tabindex="-1"></a>co2 <span class="op">=</span> pd.read_csv(</span>
<span id="cb87-2"><a href="#cb87-2" aria-hidden="true" tabindex="-1"></a>    co2_file, header <span class="op">=</span> <span class="va">None</span>, skiprows <span class="op">=</span> <span class="dv">72</span>,</span>
<span id="cb87-3"><a href="#cb87-3" aria-hidden="true" tabindex="-1"></a>    sep <span class="op">=</span> <span class="vs">r'\s+'</span>       <span class="co">#delimiter for continuous whitespace (stay tuned for regex next lecture))</span></span>
<span id="cb87-4"><a href="#cb87-4" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb87-5"><a href="#cb87-5" aria-hidden="true" tabindex="-1"></a>co2.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="135">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">0</th>
<th data-quarto-table-cell-role="th">1</th>
<th data-quarto-table-cell-role="th">2</th>
<th data-quarto-table-cell-role="th">3</th>
<th data-quarto-table-cell-role="th">4</th>
<th data-quarto-table-cell-role="th">5</th>
<th data-quarto-table-cell-role="th">6</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>1958</td>
<td>3</td>
<td>1958.21</td>
<td>315.71</td>
<td>315.71</td>
<td>314.62</td>
<td>-1</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>1958</td>
<td>4</td>
<td>1958.29</td>
<td>317.45</td>
<td>317.45</td>
<td>315.29</td>
<td>-1</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>1958</td>
<td>5</td>
<td>1958.38</td>
<td>317.50</td>
<td>317.50</td>
<td>314.71</td>
<td>-1</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>1958</td>
<td>6</td>
<td>1958.46</td>
<td>-99.99</td>
<td>317.10</td>
<td>314.85</td>
<td>-1</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>1958</td>
<td>7</td>
<td>1958.54</td>
<td>315.86</td>
<td>315.86</td>
<td>314.98</td>
<td>-1</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>Congratulations! You’ve wrangled the data!</p>
<p><br></p>
<p>…But our columns aren’t named. <strong>We need to do more EDA.</strong></p>
</section>
<section id="exploring-variable-feature-types" class="level2">
<h2 class="anchored" data-anchor-id="exploring-variable-feature-types">Exploring Variable Feature Types</h2>
<p>The NOAA <a href="https://gml.noaa.gov/ccgg/trends/">webpage</a> might have some useful tidbits (in this case it doesn’t).</p>
<p>Using this information, we’ll rerun <code>pd.read_csv</code>, but this time with some <strong>custom column names.</strong></p>
<div class="cell" data-execution_count="137">
<div class="sourceCode cell-code" id="cb88"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb88-1"><a href="#cb88-1" aria-hidden="true" tabindex="-1"></a>co2 <span class="op">=</span> pd.read_csv(</span>
<span id="cb88-2"><a href="#cb88-2" aria-hidden="true" tabindex="-1"></a>    co2_file, header <span class="op">=</span> <span class="va">None</span>, skiprows <span class="op">=</span> <span class="dv">72</span>,</span>
<span id="cb88-3"><a href="#cb88-3" aria-hidden="true" tabindex="-1"></a>    sep <span class="op">=</span> <span class="st">'\s+'</span>, <span class="co">#regex for continuous whitespace (next lecture)</span></span>
<span id="cb88-4"><a href="#cb88-4" aria-hidden="true" tabindex="-1"></a>    names <span class="op">=</span> [<span class="st">'Yr'</span>, <span class="st">'Mo'</span>, <span class="st">'DecDate'</span>, <span class="st">'Avg'</span>, <span class="st">'Int'</span>, <span class="st">'Trend'</span>, <span class="st">'Days'</span>]</span>
<span id="cb88-5"><a href="#cb88-5" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb88-6"><a href="#cb88-6" aria-hidden="true" tabindex="-1"></a>co2.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="137">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Yr</th>
<th data-quarto-table-cell-role="th">Mo</th>
<th data-quarto-table-cell-role="th">DecDate</th>
<th data-quarto-table-cell-role="th">Avg</th>
<th data-quarto-table-cell-role="th">Int</th>
<th data-quarto-table-cell-role="th">Trend</th>
<th data-quarto-table-cell-role="th">Days</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>1958</td>
<td>3</td>
<td>1958.21</td>
<td>315.71</td>
<td>315.71</td>
<td>314.62</td>
<td>-1</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>1958</td>
<td>4</td>
<td>1958.29</td>
<td>317.45</td>
<td>317.45</td>
<td>315.29</td>
<td>-1</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>1958</td>
<td>5</td>
<td>1958.38</td>
<td>317.50</td>
<td>317.50</td>
<td>314.71</td>
<td>-1</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>1958</td>
<td>6</td>
<td>1958.46</td>
<td>-99.99</td>
<td>317.10</td>
<td>314.85</td>
<td>-1</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>1958</td>
<td>7</td>
<td>1958.54</td>
<td>315.86</td>
<td>315.86</td>
<td>314.98</td>
<td>-1</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
<section id="visualizing-co2" class="level2">
<h2 class="anchored" data-anchor-id="visualizing-co2">Visualizing CO<sub>2</sub></h2>
<p>Scientific studies tend to have very clean data, right…? Let’s jump right in and make a time series plot of CO2 monthly averages.</p>
<div class="cell" data-execution_count="138">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb89"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb89-1"><a href="#cb89-1" aria-hidden="true" tabindex="-1"></a>sns.lineplot(x<span class="op">=</span><span class="st">'DecDate'</span>, y<span class="op">=</span><span class="st">'Avg'</span>, data<span class="op">=</span>co2)<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<p><img src="eda_files/figure-html/cell-62-output-1.png" class="img-fluid"></p>
</div>
</div>
<p>The code above uses the <code>seaborn</code> plotting library (abbreviated <code>sns</code>). We will cover this in the Visualization lecture, but now you don’t need to worry about how it works!</p>
<p>Yikes! Plotting the data uncovered a problem. The sharp vertical lines suggest that we have some <strong>missing values</strong>. What happened here?</p>
<div class="cell" data-execution_count="139">
<div class="sourceCode cell-code" id="cb90"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb90-1"><a href="#cb90-1" aria-hidden="true" tabindex="-1"></a>co2.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="139">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Yr</th>
<th data-quarto-table-cell-role="th">Mo</th>
<th data-quarto-table-cell-role="th">DecDate</th>
<th data-quarto-table-cell-role="th">Avg</th>
<th data-quarto-table-cell-role="th">Int</th>
<th data-quarto-table-cell-role="th">Trend</th>
<th data-quarto-table-cell-role="th">Days</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>1958</td>
<td>3</td>
<td>1958.21</td>
<td>315.71</td>
<td>315.71</td>
<td>314.62</td>
<td>-1</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>1958</td>
<td>4</td>
<td>1958.29</td>
<td>317.45</td>
<td>317.45</td>
<td>315.29</td>
<td>-1</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>1958</td>
<td>5</td>
<td>1958.38</td>
<td>317.50</td>
<td>317.50</td>
<td>314.71</td>
<td>-1</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>1958</td>
<td>6</td>
<td>1958.46</td>
<td>-99.99</td>
<td>317.10</td>
<td>314.85</td>
<td>-1</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>1958</td>
<td>7</td>
<td>1958.54</td>
<td>315.86</td>
<td>315.86</td>
<td>314.98</td>
<td>-1</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div class="cell" data-execution_count="140">
<div class="sourceCode cell-code" id="cb91"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb91-1"><a href="#cb91-1" aria-hidden="true" tabindex="-1"></a>co2.tail()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="140">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Yr</th>
<th data-quarto-table-cell-role="th">Mo</th>
<th data-quarto-table-cell-role="th">DecDate</th>
<th data-quarto-table-cell-role="th">Avg</th>
<th data-quarto-table-cell-role="th">Int</th>
<th data-quarto-table-cell-role="th">Trend</th>
<th data-quarto-table-cell-role="th">Days</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">733</td>
<td>2019</td>
<td>4</td>
<td>2019.29</td>
<td>413.32</td>
<td>413.32</td>
<td>410.49</td>
<td>26</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">734</td>
<td>2019</td>
<td>5</td>
<td>2019.38</td>
<td>414.66</td>
<td>414.66</td>
<td>411.20</td>
<td>28</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">735</td>
<td>2019</td>
<td>6</td>
<td>2019.46</td>
<td>413.92</td>
<td>413.92</td>
<td>411.58</td>
<td>27</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">736</td>
<td>2019</td>
<td>7</td>
<td>2019.54</td>
<td>411.77</td>
<td>411.77</td>
<td>411.43</td>
<td>23</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">737</td>
<td>2019</td>
<td>8</td>
<td>2019.62</td>
<td>409.95</td>
<td>409.95</td>
<td>411.84</td>
<td>29</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>Some data have unusual values like -1 and -99.99.</p>
<p>Let’s check the description at the top of the file again.</p>
<ul>
<li>-1 signifies a missing value for the number of days <code>Days</code> the equipment was in operation that month.</li>
<li>-99.99 denotes a missing monthly average <code>Avg</code></li>
</ul>
<p>How can we fix this? First, let’s explore other aspects of our data. Understanding our data will help us decide what to do with the missing values.</p>
<p><br></p>
</section>
<section id="sanity-checks-reasoning-about-the-data" class="level2">
<h2 class="anchored" data-anchor-id="sanity-checks-reasoning-about-the-data">Sanity Checks: Reasoning about the data</h2>
<p>First, we consider the shape of the data. How many rows should we have?</p>
<ul>
<li>If chronological order, we should have one record per month.</li>
<li>Data from March 1958 to August 2019.</li>
<li>We should have $ 12 (2019-1957) - 2 - 4 = 738 $ records.</li>
</ul>
<div class="cell" data-execution_count="141">
<div class="sourceCode cell-code" id="cb92"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb92-1"><a href="#cb92-1" aria-hidden="true" tabindex="-1"></a>co2.shape</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="141">
<pre><code>(738, 7)</code></pre>
</div>
</div>
<p>Nice!! The number of rows (i.e.&nbsp;records) match our expectations.<br>
</p>
<p><br></p>
<p>Let’s now check the quality of each feature.</p>
</section>
<section id="understanding-missing-value-1-days" class="level2">
<h2 class="anchored" data-anchor-id="understanding-missing-value-1-days">Understanding Missing Value 1: <code>Days</code></h2>
<p><code>Days</code> is a time field, so let’s analyze other time fields to see if there is an explanation for missing values of days of operation.</p>
<p>Let’s start with <strong>months</strong>, <code>Mo</code>.</p>
<p>Are we missing any records? The number of months should have 62 or 61 instances (March 1957-August 2019).</p>
<div class="cell" data-execution_count="142">
<div class="sourceCode cell-code" id="cb94"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb94-1"><a href="#cb94-1" aria-hidden="true" tabindex="-1"></a>co2[<span class="st">"Mo"</span>].value_counts().sort_index()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="142">
<pre><code>1     61
2     61
3     62
4     62
5     62
6     62
7     62
8     62
9     61
10    61
11    61
12    61
Name: Mo, dtype: int64</code></pre>
</div>
</div>
<p>As expected Jan, Feb, Sep, Oct, Nov, and Dec have 61 occurrences and the rest 62.</p>
<p><br></p>
<p>Next let’s explore <strong>days</strong> <code>Days</code> itself, which is the number of days that the measurement equipment worked.</p>
<div class="cell" data-execution_count="143">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb96"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb96-1"><a href="#cb96-1" aria-hidden="true" tabindex="-1"></a>sns.displot(co2[<span class="st">'Days'</span>])<span class="op">;</span></span>
<span id="cb96-2"><a href="#cb96-2" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"Distribution of days feature"</span>)<span class="op">;</span> <span class="co"># suppresses unneeded plotting output</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<p><img src="eda_files/figure-html/cell-67-output-1.png" class="img-fluid"></p>
</div>
</div>
<p>In terms of data quality, a handful of months have averages based on measurements taken on fewer than half the days. In addition, there are nearly 200 missing values–<strong>that’s about 27% of the data</strong>!</p>
<p><br></p>
<p>Finally, let’s check the last time feature, <strong>year</strong> <code>Yr</code>.</p>
<p>Let’s check to see if there is any connection between missing-ness and the year of the recording.</p>
<div class="cell" data-execution_count="144">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb97"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb97-1"><a href="#cb97-1" aria-hidden="true" tabindex="-1"></a>sns.scatterplot(x<span class="op">=</span><span class="st">"Yr"</span>, y<span class="op">=</span><span class="st">"Days"</span>, data<span class="op">=</span>co2)<span class="op">;</span></span>
<span id="cb97-2"><a href="#cb97-2" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"Day field by Year"</span>)<span class="op">;</span> <span class="co"># the ; suppresses output</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<p><img src="eda_files/figure-html/cell-68-output-1.png" class="img-fluid"></p>
</div>
</div>
<p><strong>Observations</strong>:</p>
<ul>
<li>All of the missing data are in the early years of operation.</li>
<li>It appears there may have been problems with equipment in the mid to late 80s.</li>
</ul>
<p><strong>Potential Next Steps</strong>:</p>
<ul>
<li>Confirm these explanations through documentation about the historical readings.</li>
<li>Maybe drop earliest recordings? However, we would want to delay such action until after we have examined the time trends and assess whether there are any potential problems.</li>
</ul>
<p><br></p>
</section>
<section id="understanding-missing-value-2-avg" class="level2">
<h2 class="anchored" data-anchor-id="understanding-missing-value-2-avg">Understanding Missing Value 2: <code>Avg</code></h2>
<p>Next, let’s return to the -99.99 values in <code>Avg</code> to analyze the overall quality of the CO2 measurements. We’ll plot a histogram of the average CO<sub>2</sub> measurements</p>
<div class="cell" data-execution_count="145">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb98"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb98-1"><a href="#cb98-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Histograms of average CO2 measurements</span></span>
<span id="cb98-2"><a href="#cb98-2" aria-hidden="true" tabindex="-1"></a>sns.displot(co2[<span class="st">'Avg'</span>])<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<p><img src="eda_files/figure-html/cell-69-output-1.png" class="img-fluid"></p>
</div>
</div>
<p>The non-missing values are in the 300-400 range (a regular range of CO2 levels).</p>
<p>We also see that there are only a few missing <code>Avg</code> values (<strong>&lt;1% of values</strong>). Let’s examine all of them:</p>
<div class="cell" data-execution_count="146">
<div class="sourceCode cell-code" id="cb99"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb99-1"><a href="#cb99-1" aria-hidden="true" tabindex="-1"></a>co2[co2[<span class="st">"Avg"</span>] <span class="op">&lt;</span> <span class="dv">0</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="146">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Yr</th>
<th data-quarto-table-cell-role="th">Mo</th>
<th data-quarto-table-cell-role="th">DecDate</th>
<th data-quarto-table-cell-role="th">Avg</th>
<th data-quarto-table-cell-role="th">Int</th>
<th data-quarto-table-cell-role="th">Trend</th>
<th data-quarto-table-cell-role="th">Days</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">3</td>
<td>1958</td>
<td>6</td>
<td>1958.46</td>
<td>-99.99</td>
<td>317.10</td>
<td>314.85</td>
<td>-1</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">7</td>
<td>1958</td>
<td>10</td>
<td>1958.79</td>
<td>-99.99</td>
<td>312.66</td>
<td>315.61</td>
<td>-1</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">71</td>
<td>1964</td>
<td>2</td>
<td>1964.12</td>
<td>-99.99</td>
<td>320.07</td>
<td>319.61</td>
<td>-1</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">72</td>
<td>1964</td>
<td>3</td>
<td>1964.21</td>
<td>-99.99</td>
<td>320.73</td>
<td>319.55</td>
<td>-1</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">73</td>
<td>1964</td>
<td>4</td>
<td>1964.29</td>
<td>-99.99</td>
<td>321.77</td>
<td>319.48</td>
<td>-1</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">213</td>
<td>1975</td>
<td>12</td>
<td>1975.96</td>
<td>-99.99</td>
<td>330.59</td>
<td>331.60</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">313</td>
<td>1984</td>
<td>4</td>
<td>1984.29</td>
<td>-99.99</td>
<td>346.84</td>
<td>344.27</td>
<td>2</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>There doesn’t seem to be a pattern to these values, other than that most records also were missing <code>Days</code> data.</p>
</section>
<section id="drop-nan-or-impute-missing-avg-data" class="level2">
<h2 class="anchored" data-anchor-id="drop-nan-or-impute-missing-avg-data">Drop, <code>NaN</code>, or Impute Missing <code>Avg</code> Data?</h2>
<p>How should we address the invalid <code>Avg</code> data?</p>
<ol type="1">
<li>Drop records</li>
<li>Set to NaN</li>
<li>Impute using some strategy</li>
</ol>
<p>Remember we want to fix the following plot:</p>
<div class="cell" data-execution_count="147">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb100"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb100-1"><a href="#cb100-1" aria-hidden="true" tabindex="-1"></a>sns.lineplot(x<span class="op">=</span><span class="st">'DecDate'</span>, y<span class="op">=</span><span class="st">'Avg'</span>, data<span class="op">=</span>co2)</span>
<span id="cb100-2"><a href="#cb100-2" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"CO2 Average By Month"</span>)<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<p><img src="eda_files/figure-html/cell-71-output-1.png" class="img-fluid"></p>
</div>
</div>
<p>Since we are plotting <code>Avg</code> vs <code>DecDate</code>, we should just focus on dealing with missing values for <code>Avg</code>.</p>
<p>Let’s consider a few options: 1. Drop those records 2. Replace -99.99 with NaN 3. Substitute it with a likely value for the average CO2?</p>
<p>What do you think are the pros and cons of each possible action?</p>
<p><br></p>
<p>Let’s examine each of these three options.</p>
<div class="cell" data-execution_count="149">
<div class="sourceCode cell-code" id="cb101"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb101-1"><a href="#cb101-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 1. Drop missing values</span></span>
<span id="cb101-2"><a href="#cb101-2" aria-hidden="true" tabindex="-1"></a>co2_drop <span class="op">=</span> co2[co2[<span class="st">'Avg'</span>] <span class="op">&gt;</span> <span class="dv">0</span>]</span>
<span id="cb101-3"><a href="#cb101-3" aria-hidden="true" tabindex="-1"></a>co2_drop.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="149">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Yr</th>
<th data-quarto-table-cell-role="th">Mo</th>
<th data-quarto-table-cell-role="th">DecDate</th>
<th data-quarto-table-cell-role="th">Avg</th>
<th data-quarto-table-cell-role="th">Int</th>
<th data-quarto-table-cell-role="th">Trend</th>
<th data-quarto-table-cell-role="th">Days</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>1958</td>
<td>3</td>
<td>1958.21</td>
<td>315.71</td>
<td>315.71</td>
<td>314.62</td>
<td>-1</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>1958</td>
<td>4</td>
<td>1958.29</td>
<td>317.45</td>
<td>317.45</td>
<td>315.29</td>
<td>-1</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>1958</td>
<td>5</td>
<td>1958.38</td>
<td>317.50</td>
<td>317.50</td>
<td>314.71</td>
<td>-1</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">4</td>
<td>1958</td>
<td>7</td>
<td>1958.54</td>
<td>315.86</td>
<td>315.86</td>
<td>314.98</td>
<td>-1</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">5</td>
<td>1958</td>
<td>8</td>
<td>1958.62</td>
<td>314.93</td>
<td>314.93</td>
<td>315.94</td>
<td>-1</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div class="cell" data-execution_count="150">
<div class="sourceCode cell-code" id="cb102"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb102-1"><a href="#cb102-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 2. Replace NaN with -99.99</span></span>
<span id="cb102-2"><a href="#cb102-2" aria-hidden="true" tabindex="-1"></a>co2_NA <span class="op">=</span> co2.replace(<span class="op">-</span><span class="fl">99.99</span>, np.NaN)</span>
<span id="cb102-3"><a href="#cb102-3" aria-hidden="true" tabindex="-1"></a>co2_NA.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="150">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Yr</th>
<th data-quarto-table-cell-role="th">Mo</th>
<th data-quarto-table-cell-role="th">DecDate</th>
<th data-quarto-table-cell-role="th">Avg</th>
<th data-quarto-table-cell-role="th">Int</th>
<th data-quarto-table-cell-role="th">Trend</th>
<th data-quarto-table-cell-role="th">Days</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>1958</td>
<td>3</td>
<td>1958.21</td>
<td>315.71</td>
<td>315.71</td>
<td>314.62</td>
<td>-1</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>1958</td>
<td>4</td>
<td>1958.29</td>
<td>317.45</td>
<td>317.45</td>
<td>315.29</td>
<td>-1</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>1958</td>
<td>5</td>
<td>1958.38</td>
<td>317.50</td>
<td>317.50</td>
<td>314.71</td>
<td>-1</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>1958</td>
<td>6</td>
<td>1958.46</td>
<td>NaN</td>
<td>317.10</td>
<td>314.85</td>
<td>-1</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>1958</td>
<td>7</td>
<td>1958.54</td>
<td>315.86</td>
<td>315.86</td>
<td>314.98</td>
<td>-1</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>We’ll also use a third version of the data.</p>
<p>First, we note that the dataset already comes with a <strong>substitute value</strong> for the -99.99.</p>
<p>From the file description:</p>
<blockquote class="blockquote">
<p>The <code>interpolated</code> column includes average values from the preceding column (<code>average</code>) and <strong>interpolated values</strong> where data are missing. Interpolated values are computed in two steps…</p>
</blockquote>
<p>The <code>Int</code> feature has values that exactly match those in <code>Avg</code>, except when <code>Avg</code> is -99.99, and then a <strong>reasonable</strong> estimate is used instead.</p>
<p>So, the third version of our data will use the <code>Int</code> feature instead of <code>Avg</code>.</p>
<div class="cell" data-execution_count="151">
<div class="sourceCode cell-code" id="cb103"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb103-1"><a href="#cb103-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 3. Use interpolated column which estimates missing Avg values</span></span>
<span id="cb103-2"><a href="#cb103-2" aria-hidden="true" tabindex="-1"></a>co2_impute <span class="op">=</span> co2.copy()</span>
<span id="cb103-3"><a href="#cb103-3" aria-hidden="true" tabindex="-1"></a>co2_impute[<span class="st">'Avg'</span>] <span class="op">=</span> co2[<span class="st">'Int'</span>]</span>
<span id="cb103-4"><a href="#cb103-4" aria-hidden="true" tabindex="-1"></a>co2_impute.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="151">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Yr</th>
<th data-quarto-table-cell-role="th">Mo</th>
<th data-quarto-table-cell-role="th">DecDate</th>
<th data-quarto-table-cell-role="th">Avg</th>
<th data-quarto-table-cell-role="th">Int</th>
<th data-quarto-table-cell-role="th">Trend</th>
<th data-quarto-table-cell-role="th">Days</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>1958</td>
<td>3</td>
<td>1958.21</td>
<td>315.71</td>
<td>315.71</td>
<td>314.62</td>
<td>-1</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>1958</td>
<td>4</td>
<td>1958.29</td>
<td>317.45</td>
<td>317.45</td>
<td>315.29</td>
<td>-1</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>1958</td>
<td>5</td>
<td>1958.38</td>
<td>317.50</td>
<td>317.50</td>
<td>314.71</td>
<td>-1</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>1958</td>
<td>6</td>
<td>1958.46</td>
<td>317.10</td>
<td>317.10</td>
<td>314.85</td>
<td>-1</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>1958</td>
<td>7</td>
<td>1958.54</td>
<td>315.86</td>
<td>315.86</td>
<td>314.98</td>
<td>-1</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>What’s a <strong>reasonable</strong> estimate?</p>
<p>To answer this question, let’s zoom in on a short time period, say the measurements in 1958 (where we know we have two missing values).</p>
<div class="cell" data-execution_count="152">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb104"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb104-1"><a href="#cb104-1" aria-hidden="true" tabindex="-1"></a><span class="co"># results of plotting data in 1958</span></span>
<span id="cb104-2"><a href="#cb104-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb104-3"><a href="#cb104-3" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> line_and_points(data, ax, title):</span>
<span id="cb104-4"><a href="#cb104-4" aria-hidden="true" tabindex="-1"></a>    <span class="co"># assumes single year, hence Mo</span></span>
<span id="cb104-5"><a href="#cb104-5" aria-hidden="true" tabindex="-1"></a>    ax.plot(<span class="st">'Mo'</span>, <span class="st">'Avg'</span>, data<span class="op">=</span>data)</span>
<span id="cb104-6"><a href="#cb104-6" aria-hidden="true" tabindex="-1"></a>    ax.scatter(<span class="st">'Mo'</span>, <span class="st">'Avg'</span>, data<span class="op">=</span>data)</span>
<span id="cb104-7"><a href="#cb104-7" aria-hidden="true" tabindex="-1"></a>    ax.set_xlim(<span class="dv">2</span>, <span class="dv">13</span>)</span>
<span id="cb104-8"><a href="#cb104-8" aria-hidden="true" tabindex="-1"></a>    ax.set_title(title)</span>
<span id="cb104-9"><a href="#cb104-9" aria-hidden="true" tabindex="-1"></a>    ax.set_xticks(np.arange(<span class="dv">3</span>, <span class="dv">13</span>))</span>
<span id="cb104-10"><a href="#cb104-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb104-11"><a href="#cb104-11" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> data_year(data, year):</span>
<span id="cb104-12"><a href="#cb104-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> data[data[<span class="st">"Yr"</span>] <span class="op">==</span> <span class="dv">1958</span>]</span>
<span id="cb104-13"><a href="#cb104-13" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb104-14"><a href="#cb104-14" aria-hidden="true" tabindex="-1"></a><span class="co"># uses matplotlib subplots</span></span>
<span id="cb104-15"><a href="#cb104-15" aria-hidden="true" tabindex="-1"></a><span class="co"># you may see more next week; focus on output for now</span></span>
<span id="cb104-16"><a href="#cb104-16" aria-hidden="true" tabindex="-1"></a>fig, axes <span class="op">=</span> plt.subplots(ncols <span class="op">=</span> <span class="dv">3</span>, figsize<span class="op">=</span>(<span class="dv">12</span>, <span class="dv">4</span>), sharey<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb104-17"><a href="#cb104-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb104-18"><a href="#cb104-18" aria-hidden="true" tabindex="-1"></a>year <span class="op">=</span> <span class="dv">1958</span></span>
<span id="cb104-19"><a href="#cb104-19" aria-hidden="true" tabindex="-1"></a>line_and_points(data_year(co2_drop, year), axes[<span class="dv">0</span>], title<span class="op">=</span><span class="st">"1. Drop Missing"</span>)</span>
<span id="cb104-20"><a href="#cb104-20" aria-hidden="true" tabindex="-1"></a>line_and_points(data_year(co2_NA, year), axes[<span class="dv">1</span>], title<span class="op">=</span><span class="st">"2. Missing Set to NaN"</span>)</span>
<span id="cb104-21"><a href="#cb104-21" aria-hidden="true" tabindex="-1"></a>line_and_points(data_year(co2_impute, year), axes[<span class="dv">2</span>], title<span class="op">=</span><span class="st">"3. Missing Interpolated"</span>)</span>
<span id="cb104-22"><a href="#cb104-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb104-23"><a href="#cb104-23" aria-hidden="true" tabindex="-1"></a>fig.suptitle(<span class="ss">f"Monthly Averages for </span><span class="sc">{</span>year<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb104-24"><a href="#cb104-24" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<p><img src="eda_files/figure-html/cell-75-output-1.png" class="img-fluid"></p>
</div>
</div>
<p>In the big picture since there are only 7 <code>Avg</code> values missing (<strong>&lt;1%</strong> of 738 months), any of these approaches would work.</p>
<p>However there is some appeal to <strong>option C: Imputing</strong>:</p>
<ul>
<li>Shows seasonal trends for CO2</li>
<li>We are plotting all months in our data as a line plot</li>
</ul>
<p><br></p>
<p>Let’s replot our original figure with option 3:</p>
<div class="cell" data-execution_count="153">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb105"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb105-1"><a href="#cb105-1" aria-hidden="true" tabindex="-1"></a>sns.lineplot(x<span class="op">=</span><span class="st">'DecDate'</span>, y<span class="op">=</span><span class="st">'Avg'</span>, data<span class="op">=</span>co2_impute)</span>
<span id="cb105-2"><a href="#cb105-2" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"CO2 Average By Month, Imputed"</span>)<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<p><img src="eda_files/figure-html/cell-76-output-1.png" class="img-fluid"></p>
</div>
</div>
<p>Looks pretty close to what we see on the NOAA <a href="https://gml.noaa.gov/ccgg/trends/">website</a>!</p>
</section>
<section id="presenting-the-data-a-discussion-on-data-granularity" class="level2">
<h2 class="anchored" data-anchor-id="presenting-the-data-a-discussion-on-data-granularity">Presenting the data: A Discussion on Data Granularity</h2>
<p>From the description:</p>
<ul>
<li>monthly measurements are averages of average day measurements.</li>
<li>The NOAA GML website has datasets for daily/hourly measurements too.</li>
</ul>
<p>The data you present depends on your research question.</p>
<p><strong>How do CO2 levels vary by season?</strong></p>
<ul>
<li>You might want to keep average monthly data.</li>
</ul>
<p><strong>Are CO2 levels rising over the past 50+ years, consistent with global warming predictions?</strong></p>
<ul>
<li>You might be happier with a <strong>coarser granularity</strong> of average year data!</li>
</ul>
<div class="cell" data-execution_count="154">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb106"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb106-1"><a href="#cb106-1" aria-hidden="true" tabindex="-1"></a>co2_year <span class="op">=</span> co2_impute.groupby(<span class="st">'Yr'</span>).mean()</span>
<span id="cb106-2"><a href="#cb106-2" aria-hidden="true" tabindex="-1"></a>sns.lineplot(x<span class="op">=</span><span class="st">'Yr'</span>, y<span class="op">=</span><span class="st">'Avg'</span>, data<span class="op">=</span>co2_year)</span>
<span id="cb106-3"><a href="#cb106-3" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"CO2 Average By Year"</span>)<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<p><img src="eda_files/figure-html/cell-77-output-1.png" class="img-fluid"></p>
</div>
</div>
<p>Indeed, we see a rise by nearly 100 ppm of CO2 since Mauna Loa began recording in 1958.</p>
</section>
</section>
<section id="summary" class="level1">
<h1>Summary</h1>
<p>We went over a lot of content this lecture; let’s summarize the most important points:</p>
<section id="dealing-with-missing-values" class="level2">
<h2 class="anchored" data-anchor-id="dealing-with-missing-values">Dealing with Missing Values</h2>
<p>There are a few options we can take to deal with missing data:</p>
<ul>
<li>Drop missing records</li>
<li>Keep <code>NaN</code> missing values</li>
<li>Impute using an interpolated column</li>
</ul>
</section>
<section id="eda-and-data-wrangling" class="level2">
<h2 class="anchored" data-anchor-id="eda-and-data-wrangling">EDA and Data Wrangling</h2>
<p>There are several ways to approach EDA and Data Wrangling:</p>
<ul>
<li>Examine the <strong>data and metadata</strong>: what is the date, size, organization, and structure of the data?</li>
<li>Examine each <strong>field/attribute/dimension</strong> individually.</li>
<li>Examine pairs of related dimensions (e.g.&nbsp;breaking down grades by major).</li>
<li>Along the way, we can:
<ul>
<li><strong>Visualize</strong> or summarize the data.</li>
<li><strong>Validate assumptions</strong> about data and its collection process. Pay particular attention to when the data was collected.</li>
<li>Identify and <strong>address anomalies</strong>.</li>
<li>Apply data transformations and corrections (we’ll cover this in the upcoming lecture).</li>
<li><strong>Record everything you do!</strong> Developing in Jupyter Notebook promotes <em>reproducibility</em> of your own work!</li>
</ul></li>
</ul>
</section>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>